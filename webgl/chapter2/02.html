<!DOCTYPE html>
<html>
<head>
	<title>第二个示列</title>
	<meta charset="utf-8">
	<meta name='viewport' content="width=device-width,initial-scale=1.0,user-scalable=no">
	<script id='vertex-shader' type='x-shader/x-vertex'>
		attribute vec4 vPosition;
		void main(){
			gl_Position=vPosition;
			gl_PointSize=1.0;
		}
	</script>
	<script id='fragment-shader' type="x-shader/x-fragment">
		precision mediump float;
		void main(){
			gl_FragColor=vec4(1.0,0.0,0.0,1.0);
		}
	</script>
	<script src="../Common/webgl-utils.js"></script>
	<script src="../Common/initShaders.js"></script>
	<script src="../Common/MV.js"></script>
</head>
<body>
	<canvas id='gl-canvas' width="512" height="512"></canvas>
	<script  type='text/javascript'>
			var gl;
			var points=[];
			var NumTimesToSubdivide=5;

			window.onload=function init(){
				var canvas=document.getElementById('gl-canvas');
				gl=WebGLUtils.setupWebGL(canvas);
				if(!gl){
					alert("WebGl isn't available");
				}
				var vertices=[
					vec2(-1,-1),
					vec2(0,1),
					vec2(1,-1)
				];

				divideTriangle(vertices[0],vertices[1],vertices[2],NumTimesToSubdivide);
				gl.viewport(0,0,canvas.width,canvas.height);
				gl.clearColor(1.0,1.0,1.0,1.0);
				var program=initShaders(gl,"vertex-shader","fragment-shader");
				gl.useProgram(program);

				//把数据加载到GPU中
				var bufferId=gl.createBuffer();
				gl.bindBuffer(gl.ARRAY_BUFFER,bufferId);
				gl.bufferData(gl.ARRAY_BUFFER,flatten(points),gl.STATIC_DRAW);

				var vPosition=gl.getAttribLocation(program,"vPosition");
				gl.vertexAttribPointer(vPosition,2,gl.FLOAT,false,0,0);
				gl.enableVertexAttribArray(vPosition);
				render();
			}

			function triangle(a,b,c){
				points.push(a,b,c);
			}

			function divideTriangle(a,b,c,count){
				if(count===0){
					triangle(a,b,c);
				}else{
					var ab=mix(a,b,0.5);
					var ac=mix(a,c,0.5);
					var bc=mix(b,c,0.5);
					--count;
					divideTriangle(a,ab,ac,count);
					divideTriangle(c,ac,bc,count);
					divideTriangle(b,ab,bc,count);
				}
			}

			function render(){
				gl.clear(gl.COLOR_BUFFER_BIT);
				gl.drawArrays(gl.TRIANGLES,0,points.length);
			}
	</script>
</body>
</html>


































