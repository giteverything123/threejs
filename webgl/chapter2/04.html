<!DOCTYPE html>
<html>
<head>
	<title>第四个示列</title>
	<meta charset="utf-8">
	<meta name='viewport' content="width=device-width,initial-scale=1.0,user-scalable=no">
	<script id='vertex-shader' type='x-shader/x-vertex'>
		attribute vec4 vPosition;
		attribute vec4 vColor;
		varying vec4 fColor;
		void main(){
			gl_Position=vPosition;
			fColor=vColor;
			gl_PointSize=1.0;
		}
	</script>
	<script id='fragment-shader' type="x-shader/x-fragment">
		precision mediump float;
		varying vec4 fColor;
		void main(){
			gl_FragColor=fColor;
		}
	</script>
	<script src="../Common/webgl-utils.js"></script>
	<script src="../Common/initShaders.js"></script>
	<script src="../Common/MV.js"></script>
</head>
<body>
	<canvas id='gl-canvas' width="512" height="512"></canvas>
	<script  type='text/javascript'>
			var gl;
			var points=[];
			var colors=[];
			var NumTimesToSubdivide=3;
			var baseColors = [
			        vec3(1.0, 0.0, 0.0),
			        vec3(0.0, 1.0, 0.0),
			        vec3(0.0, 0.0, 1.0),
			        vec3(0.0, 0.0, 0.0)
			    ];
			window.onload=function init(){
				var canvas=document.getElementById('gl-canvas');
				gl=WebGLUtils.setupWebGL(canvas);
				if(!gl){
					alert("WebGl isn't available");
				}
				var vertices=[
					vec3(  0.0000,  0.0000, -1.0000 ),
			        vec3(  0.0000,  0.9428,  0.3333 ),
			        vec3( -0.8165, -0.4714,  0.3333 ),
			        vec3(  0.8165, -0.4714,  0.3333 )
					// vec3(-0.5,-0.5,-0.5),
					// vec3(0.5,-0.5,-0.5),
					// vec3(0.0,0.5,0.0),
					// vec3(0.0,-0.5,0.5)
				];

				

			    divideTetra(vertices[0],vertices[1],vertices[2],vertices[3],NumTimesToSubdivide);
				gl.viewport(0,0,canvas.width,canvas.height);
				gl.clearColor(1.0,1.0,1.0,1.0);
				gl.enable(gl.DEPTH_TEST);
				var program=initShaders(gl,"vertex-shader","fragment-shader");
				gl.useProgram(program);

				//把数据发送到GPU
				var cBuffer=gl.createBuffer();
				gl.bindBuffer(gl.ARRAY_BUFFER,cBuffer);
				gl.bufferData(gl.ARRAY_BUFFER,flatten(colors),gl.STATIC_DRAW);

				var vColor=gl.getAttribLocation(program,'vColor');
				gl.vertexAttribPointer(vColor,3,gl.FLOAT,false,0,0);
				gl.enableVertexAttribArray(vColor);

				var vBuffer=gl.createBuffer();
				gl.bindBuffer(gl.ARRAY_BUFFER,vBuffer);
				gl.bufferData(gl.ARRAY_BUFFER,flatten(points),gl.STATIC_DRAW);

				var vPosition = gl.getAttribLocation( program, "vPosition" );
    			gl.vertexAttribPointer( vPosition, 3, gl.FLOAT, false, 0, 0 );
    			gl.enableVertexAttribArray( vPosition );

    			render();

			}

			function triangle(a,b,c,color){
				colors.push(baseColors[color]);
				points.push(a);
				colors.push(baseColors[color]);
				points.push(b);
				colors.push(baseColors[color]);
				points.push(c);
			}

			function tetra(a,b,c,d){
				triangle(a,b,c,0);
				triangle(a,c,d,1);
				triangle(a,b,d,2);
				triangle(b,c,d,3);
			}

			function divideTetra(a,b,c,d,count){
				if(count===0){
					tetra(a,b,c,d);
				}else{
					var ab=mix(a,b,0.5);
					var ac=mix(a,c,0.5);
					var ad=mix(a,d,0.5);
					var bc=mix(b,c,0.5);
					var bd=mix(b,d,0.5);
					var cd=mix(c,d,0.5);
					--count;
					//注意这里的顺序，都保持和大四面体一样的顺序
					divideTetra(a,ab,ac,ad,count);
					divideTetra(ab,b,bc,bd,count);
					divideTetra(ac,bc,c,cd,count);
					divideTetra(ad,bd,cd,d,count);
				}
			}

			function render(){
				gl.clear(gl.COLOR_BUFFER_BIT|gl.DEPTH_BUFFER_BIT);
				gl.drawArrays(gl.TRIANGLES,0,points.length);
			}
	</script>
</body>
</html>


































