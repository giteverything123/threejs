<!DOCTYPE html>
<html>
<head>
	<title>第三个示列</title>
	<meta charset="utf-8">
	<meta name='viewport' content="width=device-width,initial-scale=1.0,user-scalable=no">
	<style type="text/css">
		*{
			padding:0;
			margin:0;
			box-sizing:border-box;
		}

	</style>
	<script id='vertex-shader' type='x-shader/x-vertex'>
		attribute vec4 vPosition;
		void main(){
			gl_Position=vPosition;
		}
	</script>
	<script id='fragment-shader' type="x-shader/x-fragment">
		precision mediump float;
		void main(){
			gl_FragColor=vec4(1.0,0.0,0.0,1.0);
		}
	</script>
	<script src="../Common/webgl-utils.js"></script>
	<script src="../Common/initShaders.js"></script>
	<script src="../Common/MV.js"></script>
</head>
<body>
    recursive steps 0 <input type="range" id="slider" min="0" max="6" step="1" value="0">
	<canvas id='gl-canvas' width="512" height="512"></canvas>
	<script  type='text/javascript'>
            var canvas;
            var gl;
            var points=[];
            var numTimesToSubdivide=0;
            var buffer;
            var vertices=[
                vec2(0.0,1.0),
                vec2(-1.0,-1.0),
                vec2(1.0,-1.0),
                
            ];
            var vPosition;
            
            function init(){
                canvas=document.getElementById("gl-canvas");
                gl=WebGLUtils.setupWebGL(canvas);
                gl.viewport(0,0,canvas.width,canvas.height);
                gl.clearColor(1.0,1.0,1.0,1.0);
                var program=initShaders(gl,"vertex-shader","fragment-shader");
                gl.useProgram(program);
                vPosition=gl.getAttribLocation(program,"vPosition");
            }
            
            function triangle(a,b,c){
                points.push(a,b,c);
            }

            function divideTriangle(a,b,c,count){
                if(count==0){
                    triangle(a,b,c);
                }else{
                    var ab=mix(a,b,0.5);
                    var bc=mix(b,c,0.5);
                    var ac=mix(a,c,0.5);
                    --count;
                    divideTriangle(a,ab,ac,count);
                    divideTriangle(ab,b,bc,count);
                    divideTriangle(bc,c,ac,count);
                }
            }

            var slider=document.getElementById("slider");
            slider.onchange=function(event){
                //根据onchange事件改变迭代的次数
                numTimesToSubdivide=event.target.value;
            }
            
            init();//首先初始化

            function render(gl){//渲染函数
                gl.clear(gl.COLOR_BUFFER_BIT);
                if(buffer){
                    gl.bindBuffer(gl.ARRAY_BUFFER,null);
                }
                buffer=gl.createBuffer();
                divideTriangle(vertices[0],vertices[1],vertices[2],numTimesToSubdivide);
                gl.bindBuffer(gl.ARRAY_BUFFER,buffer);
                gl.bufferData(gl.ARRAY_BUFFER,50000,gl.STATIC_DRAW);
                gl.bufferSubData(gl.ARRAY_BUFFER,0,flatten(points));
                gl.vertexAttribPointer(vPosition,2,gl.FLOAT,false,0,0);
                gl.enableVertexAttribArray(vPosition);//启动顶点属性
                gl.drawArrays(gl.TRIANGLES,0,points.length);
                points=[];
                requestAnimationFrame(function(){
                    render(gl);
                });
            }
            render(gl);
	</script>
	
</body>
</html>