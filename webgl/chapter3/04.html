<!DOCTYPE html>
<html>
<head>
	<title>第四个示列</title>
	<meta charset="utf-8">
	<meta name='viewport' content="width=device-width,initial-scale=1.0,user-scalable=no">
	<style type="text/css">
		*{
			padding:0;
			margin:0;
			box-sizing:border-box;
		}

	</style>
	<script id='vertex-shader' type='x-shader/x-vertex'>
        attribute vec4 vPosition;
        uniform float theta;
		void main(){
            float s=sin(theta);
            float c=cos(theta);
            gl_Position.x=-s * vPosition.y + c * vPosition.x;
            gl_Position.y=s * vPosition.x + c * vPosition.y;
            gl_Position.z=0.0;
            gl_Position.w=1.0;
		}
	</script>
	<script id='fragment-shader' type="x-shader/x-fragment">
		precision mediump float;
		void main(){
			gl_FragColor=vec4(1.0,0.0,0.0,1.0);
		}
	</script>
	<script src="../Common/webgl-utils.js"></script>
	<script src="../Common/initShaders.js"></script>
	<script src="../Common/MV.js"></script>
</head>
<body>
	<canvas id='gl-canvas' width="512" height="512"></canvas>
	<script  type='text/javascript'>
            var gl;
            var vertices=[
                vec2(0.0,1.0),
                vec2(-1.0,0.0),
                vec2(0.0,-1.0),
                vec2(1.0,0.0)
            ];
            var vPosition,uTheta;
            var buffer;

            var theta=0;
            function init(){
                var canvas=document.getElementById("gl-canvas");
                gl=WebGLUtils.setupWebGL(canvas);
                gl.viewport(0,0,canvas.width,canvas.height);
                gl.clearColor(1.0,1.0,1.0,1.0);
                var program=initShaders(gl,"vertex-shader","fragment-shader");
                gl.useProgram(program);
                vPosition=gl.getAttribLocation(program,"vPosition");
                uTheta=gl.getUniformLocation(program,"theta");//取得uniform的方法
            }

            init();
            
            function render(){
                gl.clear(gl.COLOR_BUFFER_BIT); 
                theta+=0.1;
                if(buffer){
                    gl.bindBuffer(gl.ARRAY_BUFFER,null);
                }
                buffer=gl.createBuffer();
                gl.bindBuffer(gl.ARRAY_BUFFER,buffer);
                //要分配多少内存呢？
                //首先一共有四个点，每个点有两个坐标，所以一个顶点要8个字节，四个顶点就是32字节
                gl.bufferData(gl.ARRAY_BUFFER,32,gl.STATIC_DRAW);
                gl.bufferSubData(gl.ARRAY_BUFFER,0,flatten(vertices));//第1个参数原来是偏移量从0开始 
                gl.vertexAttribPointer(vPosition,2,gl.FLOAT,false,0,0);
                gl.enableVertexAttribArray(vPosition);//开启顶点属性
                gl.uniform1f(uTheta,theta);
                gl.drawArrays(gl.TRIANGLE_FAN,0,vertices.length);//注意这是到vertices.length
                window.requestAnimationFrame(render);
            }
            
            render();
	</script>
	
</body>
</html>