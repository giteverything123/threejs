!function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=2)}([function(e,t,r){(function(e){function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var r,n,i,o,a,s,l,h,c,u,d,f,p,m,g,v,y,x,b,_,w,M,S,T,C,E,A,L,P,D,R,k,F,U,N,B,V,z,O,I,H,G,W,j,X,q,Y,K,Q,Z,$,J,ee,te,re,ne,ie,oe,ae,se,le,he,ce,ue,de,fe,pe,me,ge,ve,ye,xe,be,_e,we,Me,Se,Te,Ce,Ee,Ae,Le,Pe,De,Re,ke,Fe,Ue,Ne,Be,Ve,ze,Oe,Ie,He,Ge,We,je,Xe,qe,Ye,Ke,Qe,Ze,$e,Je,et,tt,rt,nt,it,ot,at,st,lt,ht,ct,ut,dt,ft,pt,mt,gt,vt,yt,xt,bt,_t,wt,Mt,St,Tt,Ct,Et,At,Lt,Pt,Dt,Rt,kt,Ft,Ut,Nt,Bt,Vt,zt,Ot,It,Ht={REVISION:"69"};"object"===t(e)&&(e.exports=Ht),void 0===Math.sign&&(Math.sign=function(e){return e<0?-1:0<e?1:0}),Ht.MOUSE={LEFT:0,MIDDLE:1,RIGHT:2},Ht.CullFaceNone=0,Ht.CullFaceBack=1,Ht.CullFaceFront=2,Ht.CullFaceFrontBack=3,Ht.FrontFaceDirectionCW=0,Ht.FrontFaceDirectionCCW=1,Ht.BasicShadowMap=0,Ht.PCFShadowMap=1,Ht.PCFSoftShadowMap=2,Ht.FrontSide=0,Ht.BackSide=1,Ht.DoubleSide=2,Ht.NoShading=0,Ht.FlatShading=1,Ht.SmoothShading=2,Ht.NoColors=0,Ht.FaceColors=1,Ht.VertexColors=2,Ht.NoBlending=0,Ht.NormalBlending=1,Ht.AdditiveBlending=2,Ht.SubtractiveBlending=3,Ht.MultiplyBlending=4,Ht.CustomBlending=5,Ht.AddEquation=100,Ht.SubtractEquation=101,Ht.ReverseSubtractEquation=102,Ht.MinEquation=103,Ht.MaxEquation=104,Ht.ZeroFactor=200,Ht.OneFactor=201,Ht.SrcColorFactor=202,Ht.OneMinusSrcColorFactor=203,Ht.SrcAlphaFactor=204,Ht.OneMinusSrcAlphaFactor=205,Ht.DstAlphaFactor=206,Ht.OneMinusDstAlphaFactor=207,Ht.DstColorFactor=208,Ht.OneMinusDstColorFactor=209,Ht.SrcAlphaSaturateFactor=210,Ht.MultiplyOperation=0,Ht.MixOperation=1,Ht.AddOperation=2,Ht.UVMapping=function(){},Ht.CubeReflectionMapping=function(){},Ht.CubeRefractionMapping=function(){},Ht.SphericalReflectionMapping=function(){},Ht.SphericalRefractionMapping=function(){},Ht.RepeatWrapping=1e3,Ht.ClampToEdgeWrapping=1001,Ht.MirroredRepeatWrapping=1002,Ht.NearestFilter=1003,Ht.NearestMipMapNearestFilter=1004,Ht.NearestMipMapLinearFilter=1005,Ht.LinearFilter=1006,Ht.LinearMipMapNearestFilter=1007,Ht.LinearMipMapLinearFilter=1008,Ht.UnsignedByteType=1009,Ht.ByteType=1010,Ht.ShortType=1011,Ht.UnsignedShortType=1012,Ht.IntType=1013,Ht.UnsignedIntType=1014,Ht.FloatType=1015,Ht.UnsignedShort4444Type=1016,Ht.UnsignedShort5551Type=1017,Ht.UnsignedShort565Type=1018,Ht.AlphaFormat=1019,Ht.RGBFormat=1020,Ht.RGBAFormat=1021,Ht.LuminanceFormat=1022,Ht.LuminanceAlphaFormat=1023,Ht.RGB_S3TC_DXT1_Format=2001,Ht.RGBA_S3TC_DXT1_Format=2002,Ht.RGBA_S3TC_DXT3_Format=2003,Ht.RGBA_S3TC_DXT5_Format=2004,Ht.RGB_PVRTC_4BPPV1_Format=2100,Ht.RGB_PVRTC_2BPPV1_Format=2101,Ht.RGBA_PVRTC_4BPPV1_Format=2102,Ht.RGBA_PVRTC_2BPPV1_Format=2103,Ht.Color=function(e){return 3===arguments.length?this.setRGB(e,arguments[1],arguments[2]):this.set(e)},Ht.Color.prototype={constructor:Ht.Color,r:1,g:1,b:1,set:function(e){return e instanceof Ht.Color?this.copy(e):"number"==typeof e?this.setHex(e):"string"==typeof e&&this.setStyle(e),this},setHex:function(e){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,this},setRGB:function(e,t,r){return this.r=e,this.g=t,this.b=r,this},setHSL:function(e,t,r){if(0===t)this.r=this.g=this.b=r;else{var n=function(e,t,r){return r<0&&(r+=1),1<r&&(r-=1),r<1/6?e+6*(t-e)*r:r<.5?t:r<2/3?e+6*(t-e)*(2/3-r):e},i=r<=.5?r*(1+t):r+t-r*t,o=2*r-i;this.r=n(o,i,e+1/3),this.g=n(o,i,e),this.b=n(o,i,e-1/3)}return this},setStyle:function(e){if(/^rgb\((\d+), ?(\d+), ?(\d+)\)$/i.test(e)){var t=/^rgb\((\d+), ?(\d+), ?(\d+)\)$/i.exec(e);return this.r=Math.min(255,parseInt(t[1],10))/255,this.g=Math.min(255,parseInt(t[2],10))/255,this.b=Math.min(255,parseInt(t[3],10))/255,this}return/^rgb\((\d+)\%, ?(\d+)\%, ?(\d+)\%\)$/i.test(e)?(t=/^rgb\((\d+)\%, ?(\d+)\%, ?(\d+)\%\)$/i.exec(e),this.r=Math.min(100,parseInt(t[1],10))/100,this.g=Math.min(100,parseInt(t[2],10))/100,this.b=Math.min(100,parseInt(t[3],10))/100,this):/^\#([0-9a-f]{6})$/i.test(e)?(t=/^\#([0-9a-f]{6})$/i.exec(e),this.setHex(parseInt(t[1],16)),this):/^\#([0-9a-f])([0-9a-f])([0-9a-f])$/i.test(e)?(t=/^\#([0-9a-f])([0-9a-f])([0-9a-f])$/i.exec(e),this.setHex(parseInt(t[1]+t[1]+t[2]+t[2]+t[3]+t[3],16)),this):/^(\w+)$/i.test(e)?(this.setHex(Ht.ColorKeywords[e]),this):void 0},copy:function(e){return this.r=e.r,this.g=e.g,this.b=e.b,this},copyGammaToLinear:function(e){return this.r=e.r*e.r,this.g=e.g*e.g,this.b=e.b*e.b,this},copyLinearToGamma:function(e){return this.r=Math.sqrt(e.r),this.g=Math.sqrt(e.g),this.b=Math.sqrt(e.b),this},convertGammaToLinear:function(){var e=this.r,t=this.g,r=this.b;return this.r=e*e,this.g=t*t,this.b=r*r,this},convertLinearToGamma:function(){return this.r=Math.sqrt(this.r),this.g=Math.sqrt(this.g),this.b=Math.sqrt(this.b),this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(e){var t,r,n=e||{h:0,s:0,l:0},i=this.r,o=this.g,a=this.b,s=Math.max(i,o,a),l=Math.min(i,o,a),h=(l+s)/2;if(l===s)r=t=0;else{var c=s-l;switch(r=h<=.5?c/(s+l):c/(2-s-l),s){case i:t=(o-a)/c+(o<a?6:0);break;case o:t=(a-i)/c+2;break;case a:t=(i-o)/c+4}t/=6}return n.h=t,n.s=r,n.l=h,n},getStyle:function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"},offsetHSL:function(e,t,r){var n=this.getHSL();return n.h+=e,n.s+=t,n.l+=r,this.setHSL(n.h,n.s,n.l),this},add:function(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this},addColors:function(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this},addScalar:function(e){return this.r+=e,this.g+=e,this.b+=e,this},multiply:function(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this},multiplyScalar:function(e){return this.r*=e,this.g*=e,this.b*=e,this},lerp:function(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this},equals:function(e){return e.r===this.r&&e.g===this.g&&e.b===this.b},fromArray:function(e){return this.r=e[0],this.g=e[1],this.b=e[2],this},toArray:function(){return[this.r,this.g,this.b]},clone:function(){return(new Ht.Color).setRGB(this.r,this.g,this.b)}},Ht.ColorKeywords={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Ht.Quaternion=function(e,t,r,n){this._x=e||0,this._y=t||0,this._z=r||0,this._w=void 0!==n?n:1},Ht.Quaternion.prototype={constructor:Ht.Quaternion,_x:0,_y:0,_z:0,_w:0,get x(){return this._x},set x(e){this._x=e,this.onChangeCallback()},get y(){return this._y},set y(e){this._y=e,this.onChangeCallback()},get z(){return this._z},set z(e){this._z=e,this.onChangeCallback()},get w(){return this._w},set w(e){this._w=e,this.onChangeCallback()},set:function(e,t,r,n){return this._x=e,this._y=t,this._z=r,this._w=n,this.onChangeCallback(),this},copy:function(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this.onChangeCallback(),this},setFromEuler:function(e,t){if(e instanceof Ht.Euler==0)throw new Error("THREE.Quaternion: .setFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var r=Math.cos(e._x/2),n=Math.cos(e._y/2),i=Math.cos(e._z/2),o=Math.sin(e._x/2),a=Math.sin(e._y/2),s=Math.sin(e._z/2);return"XYZ"===e.order?(this._x=o*n*i+r*a*s,this._y=r*a*i-o*n*s,this._z=r*n*s+o*a*i,this._w=r*n*i-o*a*s):"YXZ"===e.order?(this._x=o*n*i+r*a*s,this._y=r*a*i-o*n*s,this._z=r*n*s-o*a*i,this._w=r*n*i+o*a*s):"ZXY"===e.order?(this._x=o*n*i-r*a*s,this._y=r*a*i+o*n*s,this._z=r*n*s+o*a*i,this._w=r*n*i-o*a*s):"ZYX"===e.order?(this._x=o*n*i-r*a*s,this._y=r*a*i+o*n*s,this._z=r*n*s-o*a*i,this._w=r*n*i+o*a*s):"YZX"===e.order?(this._x=o*n*i+r*a*s,this._y=r*a*i+o*n*s,this._z=r*n*s-o*a*i,this._w=r*n*i-o*a*s):"XZY"===e.order&&(this._x=o*n*i-r*a*s,this._y=r*a*i-o*n*s,this._z=r*n*s+o*a*i,this._w=r*n*i+o*a*s),!1!==t&&this.onChangeCallback(),this},setFromAxisAngle:function(e,t){var r=t/2,n=Math.sin(r);return this._x=e.x*n,this._y=e.y*n,this._z=e.z*n,this._w=Math.cos(r),this.onChangeCallback(),this},setFromRotationMatrix:function(e){var t,r=e.elements,n=r[0],i=r[4],o=r[8],a=r[1],s=r[5],l=r[9],h=r[2],c=r[6],u=r[10],d=n+s+u;return this._z=0<d?(t=.5/Math.sqrt(d+1),this._w=.25/t,this._x=(c-l)*t,this._y=(o-h)*t,(a-i)*t):s<n&&u<n?(t=2*Math.sqrt(1+n-s-u),this._w=(c-l)/t,this._x=.25*t,this._y=(i+a)/t,(o+h)/t):u<s?(t=2*Math.sqrt(1+s-n-u),this._w=(o-h)/t,this._x=(i+a)/t,this._y=.25*t,(l+c)/t):(t=2*Math.sqrt(1+u-n-s),this._w=(a-i)/t,this._x=(o+h)/t,this._y=(l+c)/t,.25*t),this.onChangeCallback(),this},setFromUnitVectors:function(e,t){return void 0===r&&(r=new Ht.Vector3),(n=e.dot(t)+1)<1e-6?(n=0,Math.abs(e.x)>Math.abs(e.z)?r.set(-e.y,e.x,0):r.set(0,-e.z,e.y)):r.crossVectors(e,t),this._x=r.x,this._y=r.y,this._z=r.z,this._w=n,this.normalize(),this},inverse:function(){return this.conjugate().normalize(),this},conjugate:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this.onChangeCallback(),this},dot:function(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var e=this.length();return this._w=0===e?(this._x=0,this._y=0,this._z=0,1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w*e),this.onChangeCallback(),this},multiply:function(e,t){return void 0!==t?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)},multiplyQuaternions:function(e,t){var r=e._x,n=e._y,i=e._z,o=e._w,a=t._x,s=t._y,l=t._z,h=t._w;return this._x=r*h+o*a+n*l-i*s,this._y=n*h+o*s+i*a-r*l,this._z=i*h+o*l+r*s-n*a,this._w=o*h-r*a-n*s-i*l,this.onChangeCallback(),this},multiplyVector3:function(e){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),e.applyQuaternion(this)},slerp:function(e,t){if(0===t)return this;if(1===t)return this.copy(e);var r=this._x,n=this._y,i=this._z,o=this._w,a=o*e._w+r*e._x+n*e._y+i*e._z;if(a<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,a=-a):this.copy(e),1<=a)return this._w=o,this._x=r,this._y=n,this._z=i,this;var s=Math.acos(a),l=Math.sqrt(1-a*a);if(Math.abs(l)<.001)return this._w=.5*(o+this._w),this._x=.5*(r+this._x),this._y=.5*(n+this._y),this._z=.5*(i+this._z),this;var h=Math.sin((1-t)*s)/l,c=Math.sin(t*s)/l;return this._w=o*h+this._w*c,this._x=r*h+this._x*c,this._y=n*h+this._y*c,this._z=i*h+this._z*c,this.onChangeCallback(),this},equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w},fromArray:function(e,t){return void 0===t&&(t=0),this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this.onChangeCallback(),this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e},onChange:function(e){return this.onChangeCallback=e,this},onChangeCallback:function(){},clone:function(){return new Ht.Quaternion(this._x,this._y,this._z,this._w)}},Ht.Quaternion.slerp=function(e,t,r,n){return r.copy(e).slerp(t,n)},Ht.Vector2=function(e,t){this.x=e||0,this.y=t||0},Ht.Vector2.prototype={constructor:Ht.Vector2,set:function(e,t){return this.x=e,this.y=t,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}},copy:function(e){return this.x=e.x,this.y=e.y,this},add:function(e,t){return void 0!==t?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this)},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this},addScalar:function(e){return this.x+=e,this.y+=e,this},sub:function(e,t){return void 0!==t?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this)},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this},multiply:function(e){return this.x*=e.x,this.y*=e.y,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this},divide:function(e){return this.x/=e.x,this.y/=e.y,this},divideScalar:function(e){if(0!==e){var t=1/e;this.x*=t,this.y*=t}else this.x=0,this.y=0;return this},min:function(e){return this.x>e.x&&(this.x=e.x),this.y>e.y&&(this.y=e.y),this},max:function(e){return this.x<e.x&&(this.x=e.x),this.y<e.y&&(this.y=e.y),this},clamp:function(e,t){return this.x<e.x?this.x=e.x:this.x>t.x&&(this.x=t.x),this.y<e.y?this.y=e.y:this.y>t.y&&(this.y=t.y),this},clampScalar:function(e,t){return void 0===i&&(i=new Ht.Vector2,o=new Ht.Vector2),i.set(e,e),o.set(t,t),this.clamp(i,o)},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this},negate:function(){return this.x=-this.x,this.y=-this.y,this},dot:function(e){return this.x*e.x+this.y*e.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},normalize:function(){return this.divideScalar(this.length())},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,r=this.y-e.y;return t*t+r*r},setLength:function(e){var t=this.length();return 0!==t&&e!==t&&this.multiplyScalar(e/t),this},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this},equals:function(e){return e.x===this.x&&e.y===this.y},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e},clone:function(){return new Ht.Vector2(this.x,this.y)}},Ht.Vector3=function(e,t,r){this.x=e||0,this.y=t||0,this.z=r||0},Ht.Vector3.prototype={constructor:Ht.Vector3,set:function(e,t,r){return this.x=e,this.y=t,this.z=r,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this},add:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this},sub:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this},multiply:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this},multiplyVectors:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this},applyEuler:function(e){return e instanceof Ht.Euler==0&&console.error("THREE.Vector3: .applyEuler() now expects a Euler rotation rather than a Vector3 and order."),void 0===m&&(m=new Ht.Quaternion),this.applyQuaternion(m.setFromEuler(e)),this},applyAxisAngle:function(e,t){return void 0===p&&(p=new Ht.Quaternion),this.applyQuaternion(p.setFromAxisAngle(e,t)),this},applyMatrix3:function(e){var t=this.x,r=this.y,n=this.z,i=e.elements;return this.x=i[0]*t+i[3]*r+i[6]*n,this.y=i[1]*t+i[4]*r+i[7]*n,this.z=i[2]*t+i[5]*r+i[8]*n,this},applyMatrix4:function(e){var t=this.x,r=this.y,n=this.z,i=e.elements;return this.x=i[0]*t+i[4]*r+i[8]*n+i[12],this.y=i[1]*t+i[5]*r+i[9]*n+i[13],this.z=i[2]*t+i[6]*r+i[10]*n+i[14],this},applyProjection:function(e){var t=this.x,r=this.y,n=this.z,i=e.elements,o=1/(i[3]*t+i[7]*r+i[11]*n+i[15]);return this.x=(i[0]*t+i[4]*r+i[8]*n+i[12])*o,this.y=(i[1]*t+i[5]*r+i[9]*n+i[13])*o,this.z=(i[2]*t+i[6]*r+i[10]*n+i[14])*o,this},applyQuaternion:function(e){var t=this.x,r=this.y,n=this.z,i=e.x,o=e.y,a=e.z,s=e.w,l=s*t+o*n-a*r,h=s*r+a*t-i*n,c=s*n+i*r-o*t,u=-i*t-o*r-a*n;return this.x=l*s+u*-i+h*-a-c*-o,this.y=h*s+u*-o+c*-i-l*-a,this.z=c*s+u*-a+l*-o-h*-i,this},project:function(e){return void 0===f&&(f=new Ht.Matrix4),f.multiplyMatrices(e.projectionMatrix,f.getInverse(e.matrixWorld)),this.applyProjection(f)},unproject:function(e){return void 0===d&&(d=new Ht.Matrix4),d.multiplyMatrices(e.matrixWorld,d.getInverse(e.projectionMatrix)),this.applyProjection(d)},transformDirection:function(e){var t=this.x,r=this.y,n=this.z,i=e.elements;return this.x=i[0]*t+i[4]*r+i[8]*n,this.y=i[1]*t+i[5]*r+i[9]*n,this.z=i[2]*t+i[6]*r+i[10]*n,this.normalize(),this},divide:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this},divideScalar:function(e){if(0!==e){var t=1/e;this.x*=t,this.y*=t,this.z*=t}else this.x=0,this.y=0,this.z=0;return this},min:function(e){return this.x>e.x&&(this.x=e.x),this.y>e.y&&(this.y=e.y),this.z>e.z&&(this.z=e.z),this},max:function(e){return this.x<e.x&&(this.x=e.x),this.y<e.y&&(this.y=e.y),this.z<e.z&&(this.z=e.z),this},clamp:function(e,t){return this.x<e.x?this.x=e.x:this.x>t.x&&(this.x=t.x),this.y<e.y?this.y=e.y:this.y>t.y&&(this.y=t.y),this.z<e.z?this.z=e.z:this.z>t.z&&(this.z=t.z),this},clampScalar:function(e,t){return void 0===c&&(c=new Ht.Vector3,u=new Ht.Vector3),c.set(e,e,e),u.set(t,t,t),this.clamp(c,u)},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length())},setLength:function(e){var t=this.length();return 0!==t&&e!==t&&this.multiplyScalar(e/t),this},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this},cross:function(e,t){if(void 0!==t)return console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t);var r=this.x,n=this.y,i=this.z;return this.x=n*e.z-i*e.y,this.y=i*e.x-r*e.z,this.z=r*e.y-n*e.x,this},crossVectors:function(e,t){var r=e.x,n=e.y,i=e.z,o=t.x,a=t.y,s=t.z;return this.x=n*s-i*a,this.y=i*o-r*s,this.z=r*a-n*o,this},projectOnVector:function(e){return void 0===l&&(l=new Ht.Vector3),l.copy(e).normalize(),h=this.dot(l),this.copy(l).multiplyScalar(h)},projectOnPlane:function(e){return void 0===s&&(s=new Ht.Vector3),s.copy(this).projectOnVector(e),this.sub(s)},reflect:function(e){return void 0===a&&(a=new Ht.Vector3),this.sub(a.copy(e).multiplyScalar(2*this.dot(e)))},angleTo:function(e){var t=this.dot(e)/(this.length()*e.length());return Math.acos(Ht.Math.clamp(t,-1,1))},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,r=this.y-e.y,n=this.z-e.z;return t*t+r*r+n*n},setEulerFromRotationMatrix:function(e,t){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},setEulerFromQuaternion:function(e,t){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},getPositionFromMatrix:function(e){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(e)},getScaleFromMatrix:function(e){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(e)},getColumnFromMatrix:function(e,t){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(e,t)},setFromMatrixPosition:function(e){return this.x=e.elements[12],this.y=e.elements[13],this.z=e.elements[14],this},setFromMatrixScale:function(e){var t=this.set(e.elements[0],e.elements[1],e.elements[2]).length(),r=this.set(e.elements[4],e.elements[5],e.elements[6]).length(),n=this.set(e.elements[8],e.elements[9],e.elements[10]).length();return this.x=t,this.y=r,this.z=n,this},setFromMatrixColumn:function(e,t){var r=4*e,n=t.elements;return this.x=n[r],this.y=n[r+1],this.z=n[r+2],this},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this.z=e[t+2],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e},clone:function(){return new Ht.Vector3(this.x,this.y,this.z)}},Ht.Vector4=function(e,t,r,n){this.x=e||0,this.y=t||0,this.z=r||0,this.w=void 0!==n?n:1},Ht.Vector4.prototype={constructor:Ht.Vector4,set:function(e,t,r,n){return this.x=e,this.y=t,this.z=r,this.w=n,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setW:function(e){return this.w=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this},add:function(e,t){return void 0!==t?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this},sub:function(e,t){return void 0!==t?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this},applyMatrix4:function(e){var t=this.x,r=this.y,n=this.z,i=this.w,o=e.elements;return this.x=o[0]*t+o[4]*r+o[8]*n+o[12]*i,this.y=o[1]*t+o[5]*r+o[9]*n+o[13]*i,this.z=o[2]*t+o[6]*r+o[10]*n+o[14]*i,this.w=o[3]*t+o[7]*r+o[11]*n+o[15]*i,this},divideScalar:function(e){if(0!==e){var t=1/e;this.x*=t,this.y*=t,this.z*=t,this.w*=t}else this.x=0,this.y=0,this.z=0,this.w=1;return this},setAxisAngleFromQuaternion:function(e){this.w=2*Math.acos(e.w);var t=Math.sqrt(1-e.w*e.w);return this.z=t<1e-4?(this.x=1,this.y=0):(this.x=e.x/t,this.y=e.y/t,e.z/t),this},setAxisAngleFromRotationMatrix:function(e){var t,r,n,i,o=e.elements,a=o[0],s=o[4],l=o[8],h=o[1],c=o[5],u=o[9],d=o[2],f=o[6],p=o[10];if(Math.abs(s-h)<.01&&Math.abs(l-d)<.01&&Math.abs(u-f)<.01){if(Math.abs(s+h)<.1&&Math.abs(l+d)<.1&&Math.abs(u+f)<.1&&Math.abs(a+c+p-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;var m=(a+1)/2,g=(c+1)/2,v=(p+1)/2,y=(s+h)/4,x=(l+d)/4,b=(u+f)/4;return g<m&&v<m?i=m<.01?(r=0,n=.707106781):(n=y/(r=Math.sqrt(m)),x/r):v<g?i=g<.01?(n=0,r=.707106781):(r=y/(n=Math.sqrt(g)),b/n):v<.01?(n=r=.707106781,i=0):(r=x/(i=Math.sqrt(v)),n=b/i),this.set(r,n,i,t),this}var _=Math.sqrt((f-u)*(f-u)+(l-d)*(l-d)+(h-s)*(h-s));return Math.abs(_)<.001&&(_=1),this.x=(f-u)/_,this.y=(l-d)/_,this.z=(h-s)/_,this.w=Math.acos((a+c+p-1)/2),this},min:function(e){return this.x>e.x&&(this.x=e.x),this.y>e.y&&(this.y=e.y),this.z>e.z&&(this.z=e.z),this.w>e.w&&(this.w=e.w),this},max:function(e){return this.x<e.x&&(this.x=e.x),this.y<e.y&&(this.y=e.y),this.z<e.z&&(this.z=e.z),this.w<e.w&&(this.w=e.w),this},clamp:function(e,t){return this.x<e.x?this.x=e.x:this.x>t.x&&(this.x=t.x),this.y<e.y?this.y=e.y:this.y>t.y&&(this.y=t.y),this.z<e.z?this.z=e.z:this.z>t.z&&(this.z=t.z),this.w<e.w?this.w=e.w:this.w>t.w&&(this.w=t.w),this},clampScalar:function(e,t){return void 0===g&&(g=new Ht.Vector4,v=new Ht.Vector4),g.set(e,e,e,e),v.set(t,t,t,t),this.clamp(g,v)},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length())},setLength:function(e){var t=this.length();return 0!==t&&e!==t&&this.multiplyScalar(e/t),this},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e},clone:function(){return new Ht.Vector4(this.x,this.y,this.z,this.w)}},Ht.Euler=function(e,t,r,n){this._x=e||0,this._y=t||0,this._z=r||0,this._order=n||Ht.Euler.DefaultOrder},Ht.Euler.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],Ht.Euler.DefaultOrder="XYZ",Ht.Euler.prototype={constructor:Ht.Euler,_x:0,_y:0,_z:0,_order:Ht.Euler.DefaultOrder,get x(){return this._x},set x(e){this._x=e,this.onChangeCallback()},get y(){return this._y},set y(e){this._y=e,this.onChangeCallback()},get z(){return this._z},set z(e){this._z=e,this.onChangeCallback()},get order(){return this._order},set order(e){this._order=e,this.onChangeCallback()},set:function(e,t,r,n){return this._x=e,this._y=t,this._z=r,this._order=n||this._order,this.onChangeCallback(),this},copy:function(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this.onChangeCallback(),this},setFromRotationMatrix:function(e,t){var r=Ht.Math.clamp,n=e.elements,i=n[0],o=n[4],a=n[8],s=n[1],l=n[5],h=n[9],c=n[2],u=n[6],d=n[10];return"XYZ"===(t=t||this._order)?(this._y=Math.asin(r(a,-1,1)),Math.abs(a)<.99999?(this._x=Math.atan2(-h,d),this._z=Math.atan2(-o,i)):(this._x=Math.atan2(u,l),this._z=0)):"YXZ"===t?(this._x=Math.asin(-r(h,-1,1)),Math.abs(h)<.99999?(this._y=Math.atan2(a,d),this._z=Math.atan2(s,l)):(this._y=Math.atan2(-c,i),this._z=0)):"ZXY"===t?(this._x=Math.asin(r(u,-1,1)),Math.abs(u)<.99999?(this._y=Math.atan2(-c,d),this._z=Math.atan2(-o,l)):(this._y=0,this._z=Math.atan2(s,i))):"ZYX"===t?(this._y=Math.asin(-r(c,-1,1)),Math.abs(c)<.99999?(this._x=Math.atan2(u,d),this._z=Math.atan2(s,i)):(this._x=0,this._z=Math.atan2(-o,l))):"YZX"===t?(this._z=Math.asin(r(s,-1,1)),Math.abs(s)<.99999?(this._x=Math.atan2(-h,l),this._y=Math.atan2(-c,i)):(this._x=0,this._y=Math.atan2(a,d))):"XZY"===t?(this._z=Math.asin(-r(o,-1,1)),Math.abs(o)<.99999?(this._x=Math.atan2(u,l),this._y=Math.atan2(a,i)):(this._x=Math.atan2(-h,d),this._y=0)):console.warn("THREE.Euler: .setFromRotationMatrix() given unsupported order: "+t),this._order=t,this.onChangeCallback(),this},setFromQuaternion:function(e,t,r){var n=Ht.Math.clamp,i=e.x*e.x,o=e.y*e.y,a=e.z*e.z,s=e.w*e.w;return"XYZ"===(t=t||this._order)?(this._x=Math.atan2(2*(e.x*e.w-e.y*e.z),s-i-o+a),this._y=Math.asin(n(2*(e.x*e.z+e.y*e.w),-1,1)),this._z=Math.atan2(2*(e.z*e.w-e.x*e.y),s+i-o-a)):"YXZ"===t?(this._x=Math.asin(n(2*(e.x*e.w-e.y*e.z),-1,1)),this._y=Math.atan2(2*(e.x*e.z+e.y*e.w),s-i-o+a),this._z=Math.atan2(2*(e.x*e.y+e.z*e.w),s-i+o-a)):"ZXY"===t?(this._x=Math.asin(n(2*(e.x*e.w+e.y*e.z),-1,1)),this._y=Math.atan2(2*(e.y*e.w-e.z*e.x),s-i-o+a),this._z=Math.atan2(2*(e.z*e.w-e.x*e.y),s-i+o-a)):"ZYX"===t?(this._x=Math.atan2(2*(e.x*e.w+e.z*e.y),s-i-o+a),this._y=Math.asin(n(2*(e.y*e.w-e.x*e.z),-1,1)),this._z=Math.atan2(2*(e.x*e.y+e.z*e.w),s+i-o-a)):"YZX"===t?(this._x=Math.atan2(2*(e.x*e.w-e.z*e.y),s-i+o-a),this._y=Math.atan2(2*(e.y*e.w-e.x*e.z),s+i-o-a),this._z=Math.asin(n(2*(e.x*e.y+e.z*e.w),-1,1))):"XZY"===t?(this._x=Math.atan2(2*(e.x*e.w+e.y*e.z),s-i+o-a),this._y=Math.atan2(2*(e.x*e.z+e.y*e.w),s+i-o-a),this._z=Math.asin(n(2*(e.z*e.w-e.x*e.y),-1,1))):console.warn("THREE.Euler: .setFromQuaternion() given unsupported order: "+t),this._order=t,!1!==r&&this.onChangeCallback(),this},reorder:(y=new Ht.Quaternion,function(e){y.setFromEuler(this),this.setFromQuaternion(y,e)}),equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order},fromArray:function(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this.onChangeCallback(),this},toArray:function(){return[this._x,this._y,this._z,this._order]},onChange:function(e){return this.onChangeCallback=e,this},onChangeCallback:function(){},clone:function(){return new Ht.Euler(this._x,this._y,this._z,this._order)}},Ht.Line3=function(e,t){this.start=void 0!==e?e:new Ht.Vector3,this.end=void 0!==t?t:new Ht.Vector3},Ht.Line3.prototype={constructor:Ht.Line3,set:function(e,t){return this.start.copy(e),this.end.copy(t),this},copy:function(e){return this.start.copy(e.start),this.end.copy(e.end),this},center:function(e){return(e||new Ht.Vector3).addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(e){return(e||new Ht.Vector3).subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(e,t){var r=t||new Ht.Vector3;return this.delta(r).multiplyScalar(e).add(this.start)},closestPointToPointParameter:(x=new Ht.Vector3,b=new Ht.Vector3,function(e,t){x.subVectors(e,this.start),b.subVectors(this.end,this.start);var r=b.dot(b),n=b.dot(x)/r;return t&&(n=Ht.Math.clamp(n,0,1)),n}),closestPointToPoint:function(e,t,r){var n=this.closestPointToPointParameter(e,t),i=r||new Ht.Vector3;return this.delta(i).multiplyScalar(n).add(this.start)},applyMatrix4:function(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this},equals:function(e){return e.start.equals(this.start)&&e.end.equals(this.end)},clone:function(){return(new Ht.Line3).copy(this)}},Ht.Box2=function(e,t){this.min=void 0!==e?e:new Ht.Vector2(1/0,1/0),this.max=void 0!==t?t:new Ht.Vector2(-1/0,-1/0)},Ht.Box2.prototype={constructor:Ht.Box2,set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromPoints:function(e){this.makeEmpty();for(var t=0,r=e.length;t<r;t++)this.expandByPoint(e[t]);return this},setFromCenterAndSize:(w=new Ht.Vector2,function(e,t){var r=w.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(r),this.max.copy(e).add(r),this}),copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this},empty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},center:function(e){return(e||new Ht.Vector2).addVectors(this.min,this.max).multiplyScalar(.5)},size:function(e){return(e||new Ht.Vector2).subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},containsPoint:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y},getParameter:function(e,t){return(t||new Ht.Vector2).set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))},isIntersectionBox:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)},clampPoint:function(e,t){return(t||new Ht.Vector2).copy(e).clamp(this.min,this.max)},distanceToPoint:(_=new Ht.Vector2,function(e){return _.copy(e).clamp(this.min,this.max).sub(e).length()}),intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)},clone:function(){return(new Ht.Box2).copy(this)}},Ht.Box3=function(e,t){this.min=void 0!==e?e:new Ht.Vector3(1/0,1/0,1/0),this.max=void 0!==t?t:new Ht.Vector3(-1/0,-1/0,-1/0)},Ht.Box3.prototype={constructor:Ht.Box3,set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromPoints:function(e){this.makeEmpty();for(var t=0,r=e.length;t<r;t++)this.expandByPoint(e[t]);return this},setFromCenterAndSize:(E=new Ht.Vector3,function(e,t){var r=E.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(r),this.max.copy(e).add(r),this}),setFromObject:(C=new Ht.Vector3,function(e){var t=this;return e.updateMatrixWorld(!0),this.makeEmpty(),e.traverse(function(e){var r=e.geometry;if(void 0!==r)if(r instanceof Ht.Geometry)for(var n=r.vertices,i=0,o=n.length;i<o;i++)C.copy(n[i]),C.applyMatrix4(e.matrixWorld),t.expandByPoint(C);else if(r instanceof Ht.BufferGeometry&&void 0!==r.attributes.position){var a=r.attributes.position.array;for(i=0,o=a.length;i<o;i+=3)C.set(a[i],a[i+1],a[i+2]),C.applyMatrix4(e.matrixWorld),t.expandByPoint(C)}}),this}),copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this},empty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},center:function(e){return(e||new Ht.Vector3).addVectors(this.min,this.max).multiplyScalar(.5)},size:function(e){return(e||new Ht.Vector3).subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},containsPoint:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z},getParameter:function(e,t){return(t||new Ht.Vector3).set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))},isIntersectionBox:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)},clampPoint:function(e,t){return(t||new Ht.Vector3).copy(e).clamp(this.min,this.max)},distanceToPoint:(T=new Ht.Vector3,function(e){return T.copy(e).clamp(this.min,this.max).sub(e).length()}),getBoundingSphere:(S=new Ht.Vector3,function(e){var t=e||new Ht.Sphere;return t.center=this.center(),t.radius=.5*this.size(S).length(),t}),intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},applyMatrix4:(M=[new Ht.Vector3,new Ht.Vector3,new Ht.Vector3,new Ht.Vector3,new Ht.Vector3,new Ht.Vector3,new Ht.Vector3,new Ht.Vector3],function(e){return M[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),M[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),M[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),M[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),M[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),M[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),M[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),M[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.makeEmpty(),this.setFromPoints(M),this}),translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)},clone:function(){return(new Ht.Box3).copy(this)}},Ht.Matrix3=function(){this.elements=new Float32Array([1,0,0,0,1,0,0,0,1]),0<arguments.length&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")},Ht.Matrix3.prototype={constructor:Ht.Matrix3,set:function(e,t,r,n,i,o,a,s,l){var h=this.elements;return h[0]=e,h[3]=t,h[6]=r,h[1]=n,h[4]=i,h[7]=o,h[2]=a,h[5]=s,h[8]=l,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},copy:function(e){var t=e.elements;return this.set(t[0],t[3],t[6],t[1],t[4],t[7],t[2],t[5],t[8]),this},multiplyVector3:function(e){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},multiplyVector3Array:function(e){return console.warn("THREE.Matrix3: .multiplyVector3Array() has been renamed. Use matrix.applyToVector3Array( array ) instead."),this.applyToVector3Array(e)},applyToVector3Array:(A=new Ht.Vector3,function(e,t,r){void 0===t&&(t=0),void 0===r&&(r=e.length);for(var n=0,i=t;n<r;n+=3,i+=3)A.x=e[i],A.y=e[i+1],A.z=e[i+2],A.applyMatrix3(this),e[i]=A.x,e[i+1]=A.y,e[i+2]=A.z;return e}),multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this},determinant:function(){var e=this.elements,t=e[0],r=e[1],n=e[2],i=e[3],o=e[4],a=e[5],s=e[6],l=e[7],h=e[8];return t*o*h-t*a*l-r*i*h+r*a*s+n*i*l-n*o*s},getInverse:function(e,t){var r=e.elements,n=this.elements;n[0]=r[10]*r[5]-r[6]*r[9],n[1]=-r[10]*r[1]+r[2]*r[9],n[2]=r[6]*r[1]-r[2]*r[5],n[3]=-r[10]*r[4]+r[6]*r[8],n[4]=r[10]*r[0]-r[2]*r[8],n[5]=-r[6]*r[0]+r[2]*r[4],n[6]=r[9]*r[4]-r[5]*r[8],n[7]=-r[9]*r[0]+r[1]*r[8],n[8]=r[5]*r[0]-r[1]*r[4];var i=r[0]*n[0]+r[1]*n[3]+r[2]*n[6];if(0!==i)return this.multiplyScalar(1/i),this;var o="Matrix3.getInverse(): can't invert matrix, determinant is 0";if(t)throw new Error(o);return console.warn(o),this.identity(),this},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this},flattenToArrayOffset:function(e,t){var r=this.elements;return e[t]=r[0],e[t+1]=r[1],e[t+2]=r[2],e[t+3]=r[3],e[t+4]=r[4],e[t+5]=r[5],e[t+6]=r[6],e[t+7]=r[7],e[t+8]=r[8],e},getNormalMatrix:function(e){return this.getInverse(e).transpose(),this},transposeIntoArray:function(e){var t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this},fromArray:function(e){return this.elements.set(e),this},toArray:function(){var e=this.elements;return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8]]},clone:function(){return(new Ht.Matrix3).fromArray(this.elements)}},Ht.Matrix4=function(){this.elements=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),0<arguments.length&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")},Ht.Matrix4.prototype={constructor:Ht.Matrix4,set:function(e,t,r,n,i,o,a,s,l,h,c,u,d,f,p,m){var g=this.elements;return g[0]=e,g[4]=t,g[8]=r,g[12]=n,g[1]=i,g[5]=o,g[9]=a,g[13]=s,g[2]=l,g[6]=h,g[10]=c,g[14]=u,g[3]=d,g[7]=f,g[11]=p,g[15]=m,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},copy:function(e){return this.elements.set(e.elements),this},extractPosition:function(e){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(e)},copyPosition:function(e){var t=this.elements,r=e.elements;return t[12]=r[12],t[13]=r[13],t[14]=r[14],this},extractRotation:(N=new Ht.Vector3,function(e){var t=this.elements,r=e.elements,n=1/N.set(r[0],r[1],r[2]).length(),i=1/N.set(r[4],r[5],r[6]).length(),o=1/N.set(r[8],r[9],r[10]).length();return t[0]=r[0]*n,t[1]=r[1]*n,t[2]=r[2]*n,t[4]=r[4]*i,t[5]=r[5]*i,t[6]=r[6]*i,t[8]=r[8]*o,t[9]=r[9]*o,t[10]=r[10]*o,this}),makeRotationFromEuler:function(e){e instanceof Ht.Euler==0&&console.error("THREE.Matrix: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var t=this.elements,r=e.x,n=e.y,i=e.z,o=Math.cos(r),a=Math.sin(r),s=Math.cos(n),l=Math.sin(n),h=Math.cos(i),c=Math.sin(i);if("XYZ"===e.order){var u=o*h,d=o*c,f=a*h,p=a*c;t[0]=s*h,t[4]=-s*c,t[8]=l,t[1]=d+f*l,t[5]=u-p*l,t[9]=-a*s,t[2]=p-u*l,t[6]=f+d*l,t[10]=o*s}else if("YXZ"===e.order){var m=s*h,g=s*c,v=l*h,y=l*c;t[0]=m+y*a,t[4]=v*a-g,t[8]=o*l,t[1]=o*c,t[5]=o*h,t[9]=-a,t[2]=g*a-v,t[6]=y+m*a,t[10]=o*s}else if("ZXY"===e.order)m=s*h,g=s*c,v=l*h,y=l*c,t[0]=m-y*a,t[4]=-o*c,t[8]=v+g*a,t[1]=g+v*a,t[5]=o*h,t[9]=y-m*a,t[2]=-o*l,t[6]=a,t[10]=o*s;else if("ZYX"===e.order)u=o*h,d=o*c,f=a*h,p=a*c,t[0]=s*h,t[4]=f*l-d,t[8]=u*l+p,t[1]=s*c,t[5]=p*l+u,t[9]=d*l-f,t[2]=-l,t[6]=a*s,t[10]=o*s;else if("YZX"===e.order){var x=o*s,b=o*l,_=a*s,w=a*l;t[0]=s*h,t[4]=w-x*c,t[8]=_*c+b,t[1]=c,t[5]=o*h,t[9]=-a*h,t[2]=-l*h,t[6]=b*c+_,t[10]=x-w*c}else"XZY"===e.order&&(x=o*s,b=o*l,_=a*s,w=a*l,t[0]=s*h,t[4]=-c,t[8]=l*h,t[1]=x*c+w,t[5]=o*h,t[9]=b*c-_,t[2]=_*c-b,t[6]=a*h,t[10]=w*c+x);return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},setRotationFromQuaternion:function(e){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(e)},makeRotationFromQuaternion:function(e){var t=this.elements,r=e.x,n=e.y,i=e.z,o=e.w,a=r+r,s=n+n,l=i+i,h=r*a,c=r*s,u=r*l,d=n*s,f=n*l,p=i*l,m=o*a,g=o*s,v=o*l;return t[0]=1-(d+p),t[4]=c-v,t[8]=u+g,t[1]=c+v,t[5]=1-(h+p),t[9]=f-m,t[2]=u-g,t[6]=f+m,t[10]=1-(h+d),t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},lookAt:(k=new Ht.Vector3,F=new Ht.Vector3,U=new Ht.Vector3,function(e,t,r){var n=this.elements;return U.subVectors(e,t).normalize(),0===U.length()&&(U.z=1),k.crossVectors(r,U).normalize(),0===k.length()&&(U.x+=1e-4,k.crossVectors(r,U).normalize()),F.crossVectors(U,k),n[0]=k.x,n[4]=F.x,n[8]=U.x,n[1]=k.y,n[5]=F.y,n[9]=U.y,n[2]=k.z,n[6]=F.z,n[10]=U.z,this}),multiply:function(e,t){return void 0!==t?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)},multiplyMatrices:function(e,t){var r=e.elements,n=t.elements,i=this.elements,o=r[0],a=r[4],s=r[8],l=r[12],h=r[1],c=r[5],u=r[9],d=r[13],f=r[2],p=r[6],m=r[10],g=r[14],v=r[3],y=r[7],x=r[11],b=r[15],_=n[0],w=n[4],M=n[8],S=n[12],T=n[1],C=n[5],E=n[9],A=n[13],L=n[2],P=n[6],D=n[10],R=n[14],k=n[3],F=n[7],U=n[11],N=n[15];return i[0]=o*_+a*T+s*L+l*k,i[4]=o*w+a*C+s*P+l*F,i[8]=o*M+a*E+s*D+l*U,i[12]=o*S+a*A+s*R+l*N,i[1]=h*_+c*T+u*L+d*k,i[5]=h*w+c*C+u*P+d*F,i[9]=h*M+c*E+u*D+d*U,i[13]=h*S+c*A+u*R+d*N,i[2]=f*_+p*T+m*L+g*k,i[6]=f*w+p*C+m*P+g*F,i[10]=f*M+p*E+m*D+g*U,i[14]=f*S+p*A+m*R+g*N,i[3]=v*_+y*T+x*L+b*k,i[7]=v*w+y*C+x*P+b*F,i[11]=v*M+y*E+x*D+b*U,i[15]=v*S+y*A+x*R+b*N,this},multiplyToArray:function(e,t,r){var n=this.elements;return this.multiplyMatrices(e,t),r[0]=n[0],r[1]=n[1],r[2]=n[2],r[3]=n[3],r[4]=n[4],r[5]=n[5],r[6]=n[6],r[7]=n[7],r[8]=n[8],r[9]=n[9],r[10]=n[10],r[11]=n[11],r[12]=n[12],r[13]=n[13],r[14]=n[14],r[15]=n[15],this},multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this},multiplyVector3:function(e){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) or vector.applyProjection( matrix ) instead."),e.applyProjection(this)},multiplyVector4:function(e){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},multiplyVector3Array:function(e){return console.warn("THREE.Matrix4: .multiplyVector3Array() has been renamed. Use matrix.applyToVector3Array( array ) instead."),this.applyToVector3Array(e)},applyToVector3Array:(R=new Ht.Vector3,function(e,t,r){void 0===t&&(t=0),void 0===r&&(r=e.length);for(var n=0,i=t;n<r;n+=3,i+=3)R.x=e[i],R.y=e[i+1],R.z=e[i+2],R.applyMatrix4(this),e[i]=R.x,e[i+1]=R.y,e[i+2]=R.z;return e}),rotateAxis:function(e){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),e.transformDirection(this)},crossVector:function(e){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},determinant:function(){var e=this.elements,t=e[0],r=e[4],n=e[8],i=e[12],o=e[1],a=e[5],s=e[9],l=e[13],h=e[2],c=e[6],u=e[10],d=e[14];return e[3]*(+i*s*c-n*l*c-i*a*u+r*l*u+n*a*d-r*s*d)+e[7]*(+t*s*d-t*l*u+i*o*u-n*o*d+n*l*h-i*s*h)+e[11]*(+t*l*c-t*a*d-i*o*c+r*o*d+i*a*h-r*l*h)+e[15]*(-n*a*h-t*s*c+t*a*u+n*o*c-r*o*u+r*s*h)},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this},flattenToArrayOffset:function(e,t){var r=this.elements;return e[t]=r[0],e[t+1]=r[1],e[t+2]=r[2],e[t+3]=r[3],e[t+4]=r[4],e[t+5]=r[5],e[t+6]=r[6],e[t+7]=r[7],e[t+8]=r[8],e[t+9]=r[9],e[t+10]=r[10],e[t+11]=r[11],e[t+12]=r[12],e[t+13]=r[13],e[t+14]=r[14],e[t+15]=r[15],e},getPosition:(D=new Ht.Vector3,function(){console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead.");var e=this.elements;return D.set(e[12],e[13],e[14])}),setPosition:function(e){var t=this.elements;return t[12]=e.x,t[13]=e.y,t[14]=e.z,this},getInverse:function(e,t){var r=this.elements,n=e.elements,i=n[0],o=n[4],a=n[8],s=n[12],l=n[1],h=n[5],c=n[9],u=n[13],d=n[2],f=n[6],p=n[10],m=n[14],g=n[3],v=n[7],y=n[11],x=n[15];r[0]=c*m*v-u*p*v+u*f*y-h*m*y-c*f*x+h*p*x,r[4]=s*p*v-a*m*v-s*f*y+o*m*y+a*f*x-o*p*x,r[8]=a*u*v-s*c*v+s*h*y-o*u*y-a*h*x+o*c*x,r[12]=s*c*f-a*u*f-s*h*p+o*u*p+a*h*m-o*c*m,r[1]=u*p*g-c*m*g-u*d*y+l*m*y+c*d*x-l*p*x,r[5]=a*m*g-s*p*g+s*d*y-i*m*y-a*d*x+i*p*x,r[9]=s*c*g-a*u*g-s*l*y+i*u*y+a*l*x-i*c*x,r[13]=a*u*d-s*c*d+s*l*p-i*u*p-a*l*m+i*c*m,r[2]=h*m*g-u*f*g+u*d*v-l*m*v-h*d*x+l*f*x,r[6]=s*f*g-o*m*g-s*d*v+i*m*v+o*d*x-i*f*x,r[10]=o*u*g-s*h*g+s*l*v-i*u*v-o*l*x+i*h*x,r[14]=s*h*d-o*u*d-s*l*f+i*u*f+o*l*m-i*h*m,r[3]=c*f*g-h*p*g-c*d*v+l*p*v+h*d*y-l*f*y,r[7]=o*p*g-a*f*g+a*d*v-i*p*v-o*d*y+i*f*y,r[11]=a*h*g-o*c*g-a*l*v+i*c*v+o*l*y-i*h*y,r[15]=o*c*d-a*h*d+a*l*f-i*c*f-o*l*p+i*h*p;var b=i*r[0]+l*r[4]+d*r[8]+g*r[12];if(0!=b)return this.multiplyScalar(1/b),this;var _="Matrix4.getInverse(): can't invert matrix, determinant is 0";if(t)throw new Error(_);return console.warn(_),this.identity(),this},translate:function(e){console.warn("THREE.Matrix4: .translate() has been removed.")},rotateX:function(e){console.warn("THREE.Matrix4: .rotateX() has been removed.")},rotateY:function(e){console.warn("THREE.Matrix4: .rotateY() has been removed.")},rotateZ:function(e){console.warn("THREE.Matrix4: .rotateZ() has been removed.")},rotateByAxis:function(e,t){console.warn("THREE.Matrix4: .rotateByAxis() has been removed.")},scale:function(e){var t=this.elements,r=e.x,n=e.y,i=e.z;return t[0]*=r,t[4]*=n,t[8]*=i,t[1]*=r,t[5]*=n,t[9]*=i,t[2]*=r,t[6]*=n,t[10]*=i,t[3]*=r,t[7]*=n,t[11]*=i,this},getMaxScaleOnAxis:function(){var e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],r=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],n=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,Math.max(r,n)))},makeTranslation:function(e,t,r){return this.set(1,0,0,e,0,1,0,t,0,0,1,r,0,0,0,1),this},makeRotationX:function(e){var t=Math.cos(e),r=Math.sin(e);return this.set(1,0,0,0,0,t,-r,0,0,r,t,0,0,0,0,1),this},makeRotationY:function(e){var t=Math.cos(e),r=Math.sin(e);return this.set(t,0,r,0,0,1,0,0,-r,0,t,0,0,0,0,1),this},makeRotationZ:function(e){var t=Math.cos(e),r=Math.sin(e);return this.set(t,-r,0,0,r,t,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(e,t){var r=Math.cos(t),n=Math.sin(t),i=1-r,o=e.x,a=e.y,s=e.z,l=i*o,h=i*a;return this.set(l*o+r,l*a-n*s,l*s+n*a,0,l*a+n*s,h*a+r,h*s-n*o,0,l*s-n*a,h*s+n*o,i*s*s+r,0,0,0,0,1),this},makeScale:function(e,t,r){return this.set(e,0,0,0,0,t,0,0,0,0,r,0,0,0,0,1),this},compose:function(e,t,r){return this.makeRotationFromQuaternion(t),this.scale(r),this.setPosition(e),this},decompose:(L=new Ht.Vector3,P=new Ht.Matrix4,function(e,t,r){var n=this.elements,i=L.set(n[0],n[1],n[2]).length(),o=L.set(n[4],n[5],n[6]).length(),a=L.set(n[8],n[9],n[10]).length();this.determinant()<0&&(i=-i),e.x=n[12],e.y=n[13],e.z=n[14],P.elements.set(this.elements);var s=1/i,l=1/o,h=1/a;return P.elements[0]*=s,P.elements[1]*=s,P.elements[2]*=s,P.elements[4]*=l,P.elements[5]*=l,P.elements[6]*=l,P.elements[8]*=h,P.elements[9]*=h,P.elements[10]*=h,t.setFromRotationMatrix(P),r.x=i,r.y=o,r.z=a,this}),makeFrustum:function(e,t,r,n,i,o){var a=this.elements,s=2*i/(t-e),l=2*i/(n-r),h=(t+e)/(t-e),c=(n+r)/(n-r),u=-(o+i)/(o-i),d=-2*o*i/(o-i);return a[0]=s,a[4]=0,a[8]=h,a[12]=0,a[1]=0,a[5]=l,a[9]=c,a[13]=0,a[2]=0,a[6]=0,a[10]=u,a[14]=d,a[3]=0,a[7]=0,a[11]=-1,a[15]=0,this},makePerspective:function(e,t,r,n){var i=r*Math.tan(Ht.Math.degToRad(.5*e)),o=-i,a=o*t,s=i*t;return this.makeFrustum(a,s,o,i,r,n)},makeOrthographic:function(e,t,r,n,i,o){var a=this.elements,s=t-e,l=r-n,h=o-i,c=(t+e)/s,u=(r+n)/l,d=(o+i)/h;return a[0]=2/s,a[4]=0,a[8]=0,a[12]=-c,a[1]=0,a[5]=2/l,a[9]=0,a[13]=-u,a[2]=0,a[6]=0,a[10]=-2/h,a[14]=-d,a[3]=0,a[7]=0,a[11]=0,a[15]=1,this},fromArray:function(e){return this.elements.set(e),this},toArray:function(){var e=this.elements;return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15]]},clone:function(){return(new Ht.Matrix4).fromArray(this.elements)}},Ht.Ray=function(e,t){this.origin=void 0!==e?e:new Ht.Vector3,this.direction=void 0!==t?t:new Ht.Vector3},Ht.Ray.prototype={constructor:Ht.Ray,set:function(e,t){return this.origin.copy(e),this.direction.copy(t),this},copy:function(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this},at:function(e,t){return(t||new Ht.Vector3).copy(this.direction).multiplyScalar(e).add(this.origin)},recast:(W=new Ht.Vector3,function(e){return this.origin.copy(this.at(e,W)),this}),closestPointToPoint:function(e,t){var r=t||new Ht.Vector3;r.subVectors(e,this.origin);var n=r.dot(this.direction);return n<0?r.copy(this.origin):r.copy(this.direction).multiplyScalar(n).add(this.origin)},distanceToPoint:(G=new Ht.Vector3,function(e){var t=G.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceTo(e):(G.copy(this.direction).multiplyScalar(t).add(this.origin),G.distanceTo(e))}),distanceSqToSegment:function(e,t,r,n){var i,o,a,s,l=e.clone().add(t).multiplyScalar(.5),h=t.clone().sub(e).normalize(),c=.5*e.distanceTo(t),u=this.origin.clone().sub(l),d=-this.direction.dot(h),f=u.dot(this.direction),p=-u.dot(h),m=u.lengthSq(),g=Math.abs(1-d*d);if(0<=g)if(o=d*f-p,s=c*g,0<=(i=d*p-f))if(-s<=o)if(o<=s){var v=1/g;a=(i*=v)*(i+d*(o*=v)+2*f)+o*(d*i+o+2*p)+m}else o=c,a=-(i=Math.max(0,-(d*o+f)))*i+o*(o+2*p)+m;else o=-c,a=-(i=Math.max(0,-(d*o+f)))*i+o*(o+2*p)+m;else a=o<=-s?-(i=Math.max(0,-(-d*c+f)))*i+(o=0<i?-c:Math.min(Math.max(-c,-p),c))*(o+2*p)+m:o<=s?(i=0,(o=Math.min(Math.max(-c,-p),c))*(o+2*p)+m):-(i=Math.max(0,-(d*c+f)))*i+(o=0<i?c:Math.min(Math.max(-c,-p),c))*(o+2*p)+m;else o=0<d?-c:c,a=-(i=Math.max(0,-(d*o+f)))*i+o*(o+2*p)+m;return r&&r.copy(this.direction.clone().multiplyScalar(i).add(this.origin)),n&&n.copy(h.clone().multiplyScalar(o).add(l)),a},isIntersectionSphere:function(e){return this.distanceToPoint(e.center)<=e.radius},intersectSphere:(H=new Ht.Vector3,function(e,t){H.subVectors(e.center,this.origin);var r=H.dot(this.direction),n=H.dot(H)-r*r,i=e.radius*e.radius;if(i<n)return null;var o=Math.sqrt(i-n),a=r-o,s=r+o;return a<0&&s<0?null:a<0?this.at(s,t):this.at(a,t)}),isIntersectionPlane:function(e){var t=e.distanceToPoint(this.origin);return 0===t||e.normal.dot(this.direction)*t<0},distanceToPlane:function(e){var t=e.normal.dot(this.direction);if(0==t)return 0==e.distanceToPoint(this.origin)?0:null;var r=-(this.origin.dot(e.normal)+e.constant)/t;return 0<=r?r:null},intersectPlane:function(e,t){var r=this.distanceToPlane(e);return null===r?null:this.at(r,t)},isIntersectionBox:(I=new Ht.Vector3,function(e){return null!==this.intersectBox(e,I)}),intersectBox:function(e,t){var r,n,i,o,a,s,l=1/this.direction.x,h=1/this.direction.y,c=1/this.direction.z,u=this.origin;return n=0<=l?(r=(e.min.x-u.x)*l,(e.max.x-u.x)*l):(r=(e.max.x-u.x)*l,(e.min.x-u.x)*l),(o=0<=h?(i=(e.min.y-u.y)*h,(e.max.y-u.y)*h):(i=(e.max.y-u.y)*h,(e.min.y-u.y)*h))<r||n<i?null:((r<i||r!=r)&&(r=i),(o<n||n!=n)&&(n=o),(s=0<=c?(a=(e.min.z-u.z)*c,(e.max.z-u.z)*c):(a=(e.max.z-u.z)*c,(e.min.z-u.z)*c))<r||n<a?null:((r<a||r!=r)&&(r=a),(s<n||n!=n)&&(n=s),n<0?null:this.at(0<=r?r:n,t)))},intersectTriangle:(B=new Ht.Vector3,V=new Ht.Vector3,z=new Ht.Vector3,O=new Ht.Vector3,function(e,t,r,n,i){V.subVectors(t,e),z.subVectors(r,e),O.crossVectors(V,z);var o,a=this.direction.dot(O);if(0<a){if(n)return null;o=1}else{if(!(a<0))return null;o=-1,a=-a}B.subVectors(this.origin,e);var s=o*this.direction.dot(z.crossVectors(B,z));if(s<0)return null;var l=o*this.direction.dot(V.cross(B));if(l<0)return null;if(a<s+l)return null;var h=-o*B.dot(O);return h<0?null:this.at(h/a,i)}),applyMatrix4:function(e){return this.direction.add(this.origin).applyMatrix4(e),this.origin.applyMatrix4(e),this.direction.sub(this.origin),this.direction.normalize(),this},equals:function(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)},clone:function(){return(new Ht.Ray).copy(this)}},Ht.Sphere=function(e,t){this.center=void 0!==e?e:new Ht.Vector3,this.radius=void 0!==t?t:0},Ht.Sphere.prototype={constructor:Ht.Sphere,set:function(e,t){return this.center.copy(e),this.radius=t,this},setFromPoints:(j=new Ht.Box3,function(e,t){var r=this.center;void 0!==t?r.copy(t):j.setFromPoints(e).center(r);for(var n=0,i=0,o=e.length;i<o;i++)n=Math.max(n,r.distanceToSquared(e[i]));return this.radius=Math.sqrt(n),this}),copy:function(e){return this.center.copy(e.center),this.radius=e.radius,this},empty:function(){return this.radius<=0},containsPoint:function(e){return e.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(e){return e.distanceTo(this.center)-this.radius},intersectsSphere:function(e){var t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t},clampPoint:function(e,t){var r=this.center.distanceToSquared(e),n=t||new Ht.Vector3;return n.copy(e),r>this.radius*this.radius&&(n.sub(this.center).normalize(),n.multiplyScalar(this.radius).add(this.center)),n},getBoundingBox:function(e){var t=e||new Ht.Box3;return t.set(this.center,this.center),t.expandByScalar(this.radius),t},applyMatrix4:function(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this},translate:function(e){return this.center.add(e),this},equals:function(e){return e.center.equals(this.center)&&e.radius===this.radius},clone:function(){return(new Ht.Sphere).copy(this)}},Ht.Frustum=function(e,t,r,n,i,o){this.planes=[void 0!==e?e:new Ht.Plane,void 0!==t?t:new Ht.Plane,void 0!==r?r:new Ht.Plane,void 0!==n?n:new Ht.Plane,void 0!==i?i:new Ht.Plane,void 0!==o?o:new Ht.Plane]},Ht.Frustum.prototype={constructor:Ht.Frustum,set:function(e,t,r,n,i,o){var a=this.planes;return a[0].copy(e),a[1].copy(t),a[2].copy(r),a[3].copy(n),a[4].copy(i),a[5].copy(o),this},copy:function(e){for(var t=this.planes,r=0;r<6;r++)t[r].copy(e.planes[r]);return this},setFromMatrix:function(e){var t=this.planes,r=e.elements,n=r[0],i=r[1],o=r[2],a=r[3],s=r[4],l=r[5],h=r[6],c=r[7],u=r[8],d=r[9],f=r[10],p=r[11],m=r[12],g=r[13],v=r[14],y=r[15];return t[0].setComponents(a-n,c-s,p-u,y-m).normalize(),t[1].setComponents(a+n,c+s,p+u,y+m).normalize(),t[2].setComponents(a+i,c+l,p+d,y+g).normalize(),t[3].setComponents(a-i,c-l,p-d,y-g).normalize(),t[4].setComponents(a-o,c-h,p-f,y-v).normalize(),t[5].setComponents(a+o,c+h,p+f,y+v).normalize(),this},intersectsObject:(Y=new Ht.Sphere,function(e){var t=e.geometry;return null===t.boundingSphere&&t.computeBoundingSphere(),Y.copy(t.boundingSphere),Y.applyMatrix4(e.matrixWorld),this.intersectsSphere(Y)}),intersectsSphere:function(e){for(var t=this.planes,r=e.center,n=-e.radius,i=0;i<6;i++)if(t[i].distanceToPoint(r)<n)return!1;return!0},intersectsBox:(X=new Ht.Vector3,q=new Ht.Vector3,function(e){for(var t=this.planes,r=0;r<6;r++){var n=t[r];X.x=0<n.normal.x?e.min.x:e.max.x,q.x=0<n.normal.x?e.max.x:e.min.x,X.y=0<n.normal.y?e.min.y:e.max.y,q.y=0<n.normal.y?e.max.y:e.min.y,X.z=0<n.normal.z?e.min.z:e.max.z,q.z=0<n.normal.z?e.max.z:e.min.z;var i=n.distanceToPoint(X),o=n.distanceToPoint(q);if(i<0&&o<0)return!1}return!0}),containsPoint:function(e){for(var t=this.planes,r=0;r<6;r++)if(t[r].distanceToPoint(e)<0)return!1;return!0},clone:function(){return(new Ht.Frustum).copy(this)}},Ht.Plane=function(e,t){this.normal=void 0!==e?e:new Ht.Vector3(1,0,0),this.constant=void 0!==t?t:0},Ht.Plane.prototype={constructor:Ht.Plane,set:function(e,t){return this.normal.copy(e),this.constant=t,this},setComponents:function(e,t,r,n){return this.normal.set(e,t,r),this.constant=n,this},setFromNormalAndCoplanarPoint:function(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this},setFromCoplanarPoints:(J=new Ht.Vector3,ee=new Ht.Vector3,function(e,t,r){var n=J.subVectors(r,t).cross(ee.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(n,e),this}),copy:function(e){return this.normal.copy(e.normal),this.constant=e.constant,this},normalize:function(){var e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this},negate:function(){return this.constant*=-1,this.normal.negate(),this},distanceToPoint:function(e){return this.normal.dot(e)+this.constant},distanceToSphere:function(e){return this.distanceToPoint(e.center)-e.radius},projectPoint:function(e,t){return this.orthoPoint(e,t).sub(e).negate()},orthoPoint:function(e,t){var r=this.distanceToPoint(e);return(t||new Ht.Vector3).copy(this.normal).multiplyScalar(r)},isIntersectionLine:function(e){var t=this.distanceToPoint(e.start),r=this.distanceToPoint(e.end);return t<0&&0<r||r<0&&0<t},intersectLine:($=new Ht.Vector3,function(e,t){var r=t||new Ht.Vector3,n=e.delta($),i=this.normal.dot(n);if(0==i)return 0==this.distanceToPoint(e.start)?r.copy(e.start):void 0;var o=-(e.start.dot(this.normal)+this.constant)/i;return o<0||1<o?void 0:r.copy(n).multiplyScalar(o).add(e.start)}),coplanarPoint:function(e){return(e||new Ht.Vector3).copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:(K=new Ht.Vector3,Q=new Ht.Vector3,Z=new Ht.Matrix3,function(e,t){var r=t||Z.getNormalMatrix(e),n=K.copy(this.normal).applyMatrix3(r),i=this.coplanarPoint(Q);return i.applyMatrix4(e),this.setFromNormalAndCoplanarPoint(n,i),this}),translate:function(e){return this.constant=this.constant-e.dot(this.normal),this},equals:function(e){return e.normal.equals(this.normal)&&e.constant==this.constant},clone:function(){return(new Ht.Plane).copy(this)}},Ht.Math={generateUUID:(ie="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),oe=new Array(36),ae=0,function(){for(var e=0;e<36;e++)oe[e]=8==e||13==e||18==e||23==e?"-":14==e?"4":(ae<=2&&(ae=33554432+16777216*Math.random()|0),ne=15&ae,ae>>=4,ie[19==e?3&ne|8:ne]);return oe.join("")}),clamp:function(e,t,r){return e<t?t:r<e?r:e},clampBottom:function(e,t){return e<t?t:e},mapLinear:function(e,t,r,n,i){return n+(e-t)*(i-n)/(r-t)},smoothstep:function(e,t,r){return e<=t?0:r<=e?1:(e=(e-t)/(r-t))*e*(3-2*e)},smootherstep:function(e,t,r){return e<=t?0:r<=e?1:(e=(e-t)/(r-t))*e*e*(e*(6*e-15)+10)},random16:function(){return(65280*Math.random()+255*Math.random())/65535},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},degToRad:(re=Math.PI/180,function(e){return e*re}),radToDeg:(te=180/Math.PI,function(e){return e*te}),isPowerOfTwo:function(e){return 0==(e&e-1)&&0!==e}},Ht.Spline=function(e){this.points=e;var t,r,n,i,o,a,s,l,h,c=[],u={x:0,y:0,z:0};function d(e,t,r,n,i,o,a){var s=.5*(r-e),l=.5*(n-t);return(2*(t-r)+s+l)*a+(-3*(t-r)-2*s-l)*o+s*i+t}this.initFromArray=function(e){this.points=[];for(var t=0;t<e.length;t++)this.points[t]={x:e[t][0],y:e[t][1],z:e[t][2]}},this.getPoint=function(e){return t=(this.points.length-1)*e,r=Math.floor(t),n=t-r,c[0]=0===r?r:r-1,c[1]=r,c[2]=r>this.points.length-2?this.points.length-1:r+1,c[3]=r>this.points.length-3?this.points.length-1:r+2,a=this.points[c[0]],s=this.points[c[1]],l=this.points[c[2]],h=this.points[c[3]],o=n*(i=n*n),u.x=d(a.x,s.x,l.x,h.x,n,i,o),u.y=d(a.y,s.y,l.y,h.y,n,i,o),u.z=d(a.z,s.z,l.z,h.z,n,i,o),u},this.getControlPointsArray=function(){var e,t,r=this.points.length,n=[];for(e=0;e<r;e++)t=this.points[e],n[e]=[t.x,t.y,t.z];return n},this.getLength=function(e){var t,r,n,i,o=0,a=0,s=0,l=new Ht.Vector3,h=new Ht.Vector3,c=[],u=0;for(c[0]=0,e||(e=100),n=this.points.length*e,l.copy(this.points[0]),t=1;t<n;t++)r=t/n,i=this.getPoint(r),h.copy(i),u+=h.distanceTo(l),l.copy(i),o=(this.points.length-1)*r,(a=Math.floor(o))!=s&&(c[a]=u,s=a);return c[c.length]=u,{chunks:c,total:u}},this.reparametrizeByArcLength=function(e){var t,r,n,i,o,a,s,l,h=[],c=new Ht.Vector3,u=this.getLength();for(h.push(c.copy(this.points[0]).clone()),t=1;t<this.points.length;t++){for(a=u.chunks[t]-u.chunks[t-1],s=Math.ceil(e*a/u.total),i=(t-1)/(this.points.length-1),o=t/(this.points.length-1),r=1;r<s-1;r++)n=i+r*(1/s)*(o-i),l=this.getPoint(n),h.push(c.copy(l).clone());h.push(c.copy(this.points[t]).clone())}this.points=h}},Ht.Triangle=function(e,t,r){this.a=void 0!==e?e:new Ht.Vector3,this.b=void 0!==t?t:new Ht.Vector3,this.c=void 0!==r?r:new Ht.Vector3},Ht.Triangle.normal=(se=new Ht.Vector3,function(e,t,r,n){var i=n||new Ht.Vector3;i.subVectors(r,t),se.subVectors(e,t),i.cross(se);var o=i.lengthSq();return 0<o?i.multiplyScalar(1/Math.sqrt(o)):i.set(0,0,0)}),Ht.Triangle.barycoordFromPoint=(le=new Ht.Vector3,he=new Ht.Vector3,ce=new Ht.Vector3,function(e,t,r,n,i){le.subVectors(n,t),he.subVectors(r,t),ce.subVectors(e,t);var o=le.dot(le),a=le.dot(he),s=le.dot(ce),l=he.dot(he),h=he.dot(ce),c=o*l-a*a,u=i||new Ht.Vector3;if(0==c)return u.set(-2,-1,-1);var d=1/c,f=(l*s-a*h)*d,p=(o*h-a*s)*d;return u.set(1-f-p,p,f)}),Ht.Triangle.containsPoint=(ue=new Ht.Vector3,function(e,t,r,n){var i=Ht.Triangle.barycoordFromPoint(e,t,r,n,ue);return 0<=i.x&&0<=i.y&&i.x+i.y<=1}),Ht.Triangle.prototype={constructor:Ht.Triangle,set:function(e,t,r){return this.a.copy(e),this.b.copy(t),this.c.copy(r),this},setFromPointsAndIndices:function(e,t,r,n){return this.a.copy(e[t]),this.b.copy(e[r]),this.c.copy(e[n]),this},copy:function(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this},area:(de=new Ht.Vector3,fe=new Ht.Vector3,function(){return de.subVectors(this.c,this.b),fe.subVectors(this.a,this.b),.5*de.cross(fe).length()}),midpoint:function(e){return(e||new Ht.Vector3).addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},normal:function(e){return Ht.Triangle.normal(this.a,this.b,this.c,e)},plane:function(e){return(e||new Ht.Plane).setFromCoplanarPoints(this.a,this.b,this.c)},barycoordFromPoint:function(e,t){return Ht.Triangle.barycoordFromPoint(e,this.a,this.b,this.c,t)},containsPoint:function(e){return Ht.Triangle.containsPoint(e,this.a,this.b,this.c)},equals:function(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)},clone:function(){return(new Ht.Triangle).copy(this)}},Ht.Clock=function(e){this.autoStart=void 0===e||e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1},Ht.Clock.prototype={constructor:Ht.Clock,start:function(){this.startTime=void 0!==self.performance&&void 0!==self.performance.now?self.performance.now():Date.now(),this.oldTime=this.startTime,this.running=!0},stop:function(){this.getElapsedTime(),this.running=!1},getElapsedTime:function(){return this.getDelta(),this.elapsedTime},getDelta:function(){var e=0;if(this.autoStart&&!this.running&&this.start(),this.running){var t=void 0!==self.performance&&void 0!==self.performance.now?self.performance.now():Date.now();e=.001*(t-this.oldTime),this.oldTime=t,this.elapsedTime+=e}return e}},Ht.EventDispatcher=function(){},Ht.EventDispatcher.prototype={constructor:Ht.EventDispatcher,apply:function(e){e.addEventListener=Ht.EventDispatcher.prototype.addEventListener,e.hasEventListener=Ht.EventDispatcher.prototype.hasEventListener,e.removeEventListener=Ht.EventDispatcher.prototype.removeEventListener,e.dispatchEvent=Ht.EventDispatcher.prototype.dispatchEvent},addEventListener:function(e,t){void 0===this._listeners&&(this._listeners={});var r=this._listeners;void 0===r[e]&&(r[e]=[]),-1===r[e].indexOf(t)&&r[e].push(t)},hasEventListener:function(e,t){if(void 0===this._listeners)return!1;var r=this._listeners;return void 0!==r[e]&&-1!==r[e].indexOf(t)},removeEventListener:function(e,t){if(void 0!==this._listeners){var r=this._listeners[e];if(void 0!==r){var n=r.indexOf(t);-1!==n&&r.splice(n,1)}}},dispatchEvent:function(e){if(void 0!==this._listeners){var t=this._listeners[e.type];if(void 0!==t){e.target=this;for(var r=[],n=t.length,i=0;i<n;i++)r[i]=t[i];for(i=0;i<n;i++)r[i].call(this,e)}}}},function(e){e.Raycaster=function(t,r,n,i){this.ray=new e.Ray(t,r),this.near=n||0,this.far=i||1/0,this.params={Sprite:{},Mesh:{},PointCloud:{threshold:1},LOD:{},Line:{}}};var t=function(e,t){return e.distance-t.distance},r=function(e,t,n,i){if(e.raycast(t,n),!0===i)for(var o=e.children,a=0,s=o.length;a<s;a++)r(o[a],t,n,!0)};e.Raycaster.prototype={constructor:e.Raycaster,precision:1e-4,linePrecision:1,set:function(e,t){this.ray.set(e,t)},intersectObject:function(e,n){var i=[];return r(e,this,i,n),i.sort(t),i},intersectObjects:function(e,n){var i=[];if(e instanceof Array==0)return console.log("THREE.Raycaster.intersectObjects: objects is not an Array."),i;for(var o=0,a=e.length;o<a;o++)r(e[o],this,i,n);return i.sort(t),i}}}(Ht),Ht.Object3D=function(){Object.defineProperty(this,"id",{value:Ht.Object3DIdCount++}),this.uuid=Ht.Math.generateUUID(),this.name="",this.type="Object3D",this.parent=void 0,this.children=[],this.up=Ht.Object3D.DefaultUp.clone();var e=new Ht.Vector3,t=new Ht.Euler,r=new Ht.Quaternion,n=new Ht.Vector3(1,1,1);t.onChange(function(){r.setFromEuler(t,!1)}),r.onChange(function(){t.setFromQuaternion(r,void 0,!1)}),Object.defineProperties(this,{position:{enumerable:!0,value:e},rotation:{enumerable:!0,value:t},quaternion:{enumerable:!0,value:r},scale:{enumerable:!0,value:n}}),this.renderDepth=null,this.rotationAutoUpdate=!0,this.matrix=new Ht.Matrix4,this.matrixWorld=new Ht.Matrix4,this.matrixAutoUpdate=!0,this.matrixWorldNeedsUpdate=!1,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.userData={}},Ht.Object3D.DefaultUp=new Ht.Vector3(0,1,0),Ht.Object3D.prototype={constructor:Ht.Object3D,get eulerOrder(){return console.warn("THREE.Object3D: .eulerOrder has been moved to .rotation.order."),this.rotation.order},set eulerOrder(e){console.warn("THREE.Object3D: .eulerOrder has been moved to .rotation.order."),this.rotation.order=e},get useQuaternion(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set useQuaternion(e){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},applyMatrix:function(e){this.matrix.multiplyMatrices(e,this.matrix),this.matrix.decompose(this.position,this.quaternion,this.scale)},setRotationFromAxisAngle:function(e,t){this.quaternion.setFromAxisAngle(e,t)},setRotationFromEuler:function(e){this.quaternion.setFromEuler(e,!0)},setRotationFromMatrix:function(e){this.quaternion.setFromRotationMatrix(e)},setRotationFromQuaternion:function(e){this.quaternion.copy(e)},rotateOnAxis:(Le=new Ht.Quaternion,function(e,t){return Le.setFromAxisAngle(e,t),this.quaternion.multiply(Le),this}),rotateX:(Ae=new Ht.Vector3(1,0,0),function(e){return this.rotateOnAxis(Ae,e)}),rotateY:(Ee=new Ht.Vector3(0,1,0),function(e){return this.rotateOnAxis(Ee,e)}),rotateZ:(Ce=new Ht.Vector3(0,0,1),function(e){return this.rotateOnAxis(Ce,e)}),translateOnAxis:(Te=new Ht.Vector3,function(e,t){return Te.copy(e).applyQuaternion(this.quaternion),this.position.add(Te.multiplyScalar(t)),this}),translate:function(e,t){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(t,e)},translateX:(Se=new Ht.Vector3(1,0,0),function(e){return this.translateOnAxis(Se,e)}),translateY:(Me=new Ht.Vector3(0,1,0),function(e){return this.translateOnAxis(Me,e)}),translateZ:(we=new Ht.Vector3(0,0,1),function(e){return this.translateOnAxis(we,e)}),localToWorld:function(e){return e.applyMatrix4(this.matrixWorld)},worldToLocal:(_e=new Ht.Matrix4,function(e){return e.applyMatrix4(_e.getInverse(this.matrixWorld))}),lookAt:(be=new Ht.Matrix4,function(e){be.lookAt(e,this.position,this.up),this.quaternion.setFromRotationMatrix(be)}),add:function(e){if(1<arguments.length){for(var t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?console.error("THREE.Object3D.add:",e,"can't be added as a child of itself."):e instanceof Ht.Object3D?(void 0!==e.parent&&e.parent.remove(e),e.parent=this,e.dispatchEvent({type:"added"}),this.children.push(e)):console.error("THREE.Object3D.add:",e,"is not an instance of THREE.Object3D."),this},remove:function(e){if(1<arguments.length)for(var t=0;t<arguments.length;t++)this.remove(arguments[t]);var r=this.children.indexOf(e);-1!==r&&(e.parent=void 0,e.dispatchEvent({type:"removed"}),this.children.splice(r,1))},getChildByName:function(e,t){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(e,t)},getObjectById:function(e,t){if(this.id===e)return this;for(var r=0,n=this.children.length;r<n;r++){var i=this.children[r].getObjectById(e,t);if(void 0!==i)return i}},getObjectByName:function(e,t){if(this.name===e)return this;for(var r=0,n=this.children.length;r<n;r++){var i=this.children[r].getObjectByName(e,t);if(void 0!==i)return i}},getWorldPosition:function(e){var t=e||new Ht.Vector3;return this.updateMatrixWorld(!0),t.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:(ye=new Ht.Vector3,xe=new Ht.Vector3,function(e){var t=e||new Ht.Quaternion;return this.updateMatrixWorld(!0),this.matrixWorld.decompose(ye,t,xe),t}),getWorldRotation:(ve=new Ht.Quaternion,function(e){var t=e||new Ht.Euler;return this.getWorldQuaternion(ve),t.setFromQuaternion(ve,this.rotation.order,!1)}),getWorldScale:(me=new Ht.Vector3,ge=new Ht.Quaternion,function(e){var t=e||new Ht.Vector3;return this.updateMatrixWorld(!0),this.matrixWorld.decompose(me,ge,t),t}),getWorldDirection:(pe=new Ht.Quaternion,function(e){var t=e||new Ht.Vector3;return this.getWorldQuaternion(pe),t.set(0,0,1).applyQuaternion(pe)}),raycast:function(){},traverse:function(e){e(this);for(var t=0,r=this.children.length;t<r;t++)this.children[t].traverse(e)},traverseVisible:function(e){if(!1!==this.visible){e(this);for(var t=0,r=this.children.length;t<r;t++)this.children[t].traverseVisible(e)}},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(e){!0===this.matrixAutoUpdate&&this.updateMatrix(),!0!==this.matrixWorldNeedsUpdate&&!0!==e||(void 0===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),e=!(this.matrixWorldNeedsUpdate=!1));for(var t=0,r=this.children.length;t<r;t++)this.children[t].updateMatrixWorld(e)},toJSON:function(){var e={metadata:{version:4.3,type:"Object",generator:"ObjectExporter"}},t={},r=function(r){if(void 0===e.geometries&&(e.geometries=[]),void 0===t[r.uuid]){var n=r.toJSON();delete n.metadata,t[r.uuid]=n,e.geometries.push(n)}return r.uuid},n={},i=function(t){if(void 0===e.materials&&(e.materials=[]),void 0===n[t.uuid]){var r=t.toJSON();delete r.metadata,n[t.uuid]=r,e.materials.push(r)}return t.uuid};return e.object=function e(t){var n={};if(n.uuid=t.uuid,n.type=t.type,""!==t.name&&(n.name=t.name),"{}"!==JSON.stringify(t.userData)&&(n.userData=t.userData),!0!==t.visible&&(n.visible=t.visible),t instanceof Ht.PerspectiveCamera?(n.fov=t.fov,n.aspect=t.aspect,n.near=t.near,n.far=t.far):t instanceof Ht.OrthographicCamera?(n.left=t.left,n.right=t.right,n.top=t.top,n.bottom=t.bottom,n.near=t.near,n.far=t.far):t instanceof Ht.AmbientLight?n.color=t.color.getHex():t instanceof Ht.DirectionalLight?(n.color=t.color.getHex(),n.intensity=t.intensity):t instanceof Ht.PointLight?(n.color=t.color.getHex(),n.intensity=t.intensity,n.distance=t.distance):t instanceof Ht.SpotLight?(n.color=t.color.getHex(),n.intensity=t.intensity,n.distance=t.distance,n.angle=t.angle,n.exponent=t.exponent):t instanceof Ht.HemisphereLight?(n.color=t.color.getHex(),n.groundColor=t.groundColor.getHex()):t instanceof Ht.Mesh?(n.geometry=r(t.geometry),n.material=i(t.material)):t instanceof Ht.Line?(n.geometry=r(t.geometry),n.material=i(t.material)):t instanceof Ht.Sprite&&(n.material=i(t.material)),n.matrix=t.matrix.toArray(),0<t.children.length){n.children=[];for(var o=0;o<t.children.length;o++)n.children.push(e(t.children[o]))}return n}(this),e},clone:function(e,t){if(void 0===e&&(e=new Ht.Object3D),void 0===t&&(t=!0),e.name=this.name,e.up.copy(this.up),e.position.copy(this.position),e.quaternion.copy(this.quaternion),e.scale.copy(this.scale),e.renderDepth=this.renderDepth,e.rotationAutoUpdate=this.rotationAutoUpdate,e.matrix.copy(this.matrix),e.matrixWorld.copy(this.matrixWorld),e.matrixAutoUpdate=this.matrixAutoUpdate,e.matrixWorldNeedsUpdate=this.matrixWorldNeedsUpdate,e.visible=this.visible,e.castShadow=this.castShadow,e.receiveShadow=this.receiveShadow,e.frustumCulled=this.frustumCulled,e.userData=JSON.parse(JSON.stringify(this.userData)),!0===t)for(var r=0;r<this.children.length;r++){var n=this.children[r];e.add(n.clone())}return e}},Ht.EventDispatcher.prototype.apply(Ht.Object3D.prototype),Ht.Object3DIdCount=0,Ht.Projector=function(){console.warn("THREE.Projector has been moved to /examples/renderers/Projector.js."),this.projectVector=function(e,t){console.warn("THREE.Projector: .projectVector() is now vector.project()."),e.project(t)},this.unprojectVector=function(e,t){console.warn("THREE.Projector: .unprojectVector() is now vector.unproject()."),e.unproject(t)},this.pickingRay=function(e,t){console.error("THREE.Projector: .pickingRay() has been removed.")}},Ht.Face3=function(e,t,r,n,i,o){this.a=e,this.b=t,this.c=r,this.normal=n instanceof Ht.Vector3?n:new Ht.Vector3,this.vertexNormals=n instanceof Array?n:[],this.color=i instanceof Ht.Color?i:new Ht.Color,this.vertexColors=i instanceof Array?i:[],this.vertexTangents=[],this.materialIndex=void 0!==o?o:0},Ht.Face3.prototype={constructor:Ht.Face3,clone:function(){var e=new Ht.Face3(this.a,this.b,this.c);e.normal.copy(this.normal),e.color.copy(this.color),e.materialIndex=this.materialIndex;for(var t=0,r=this.vertexNormals.length;t<r;t++)e.vertexNormals[t]=this.vertexNormals[t].clone();for(t=0,r=this.vertexColors.length;t<r;t++)e.vertexColors[t]=this.vertexColors[t].clone();for(t=0,r=this.vertexTangents.length;t<r;t++)e.vertexTangents[t]=this.vertexTangents[t].clone();return e}},Ht.Face4=function(e,t,r,n,i,o,a){return console.warn("THREE.Face4 has been removed. A THREE.Face3 will be created instead."),new Ht.Face3(e,t,r,i,o,a)},Ht.BufferAttribute=function(e,t){this.array=e,this.itemSize=t,this.needsUpdate=!1},Ht.BufferAttribute.prototype={constructor:Ht.BufferAttribute,get length(){return this.array.length},copyAt:function(e,t,r){e*=this.itemSize,r*=t.itemSize;for(var n=0,i=this.itemSize;n<i;n++)this.array[e+n]=t.array[r+n]},set:function(e){return this.array.set(e),this},setX:function(e,t){return this.array[e*this.itemSize]=t,this},setY:function(e,t){return this.array[e*this.itemSize+1]=t,this},setZ:function(e,t){return this.array[e*this.itemSize+2]=t,this},setXY:function(e,t,r){return e*=this.itemSize,this.array[e]=t,this.array[e+1]=r,this},setXYZ:function(e,t,r,n){return e*=this.itemSize,this.array[e]=t,this.array[e+1]=r,this.array[e+2]=n,this},setXYZW:function(e,t,r,n,i){return e*=this.itemSize,this.array[e]=t,this.array[e+1]=r,this.array[e+2]=n,this.array[e+3]=i,this},clone:function(){return new Ht.BufferAttribute(new this.array.constructor(this.array),this.itemSize)}},Ht.Int8Attribute=function(e,t){return console.warn("THREE.Int8Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead."),new Ht.BufferAttribute(e,t)},Ht.Uint8Attribute=function(e,t){return console.warn("THREE.Uint8Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead."),new Ht.BufferAttribute(e,t)},Ht.Uint8ClampedAttribute=function(e,t){return console.warn("THREE.Uint8ClampedAttribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead."),new Ht.BufferAttribute(e,t)},Ht.Int16Attribute=function(e,t){return console.warn("THREE.Int16Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead."),new Ht.BufferAttribute(e,t)},Ht.Uint16Attribute=function(e,t){return console.warn("THREE.Uint16Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead."),new Ht.BufferAttribute(e,t)},Ht.Int32Attribute=function(e,t){return console.warn("THREE.Int32Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead."),new Ht.BufferAttribute(e,t)},Ht.Uint32Attribute=function(e,t){return console.warn("THREE.Uint32Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead."),new Ht.BufferAttribute(e,t)},Ht.Float32Attribute=function(e,t){return console.warn("THREE.Float32Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead."),new Ht.BufferAttribute(e,t)},Ht.Float64Attribute=function(e,t){return console.warn("THREE.Float64Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead."),new Ht.BufferAttribute(e,t)},Ht.BufferGeometry=function(){Object.defineProperty(this,"id",{value:Ht.GeometryIdCount++}),this.uuid=Ht.Math.generateUUID(),this.name="",this.type="BufferGeometry",this.attributes={},this.attributesKeys=[],this.drawcalls=[],this.offsets=this.drawcalls,this.boundingBox=null,this.boundingSphere=null},Ht.BufferGeometry.prototype={constructor:Ht.BufferGeometry,addAttribute:function(e,t){if(t instanceof Ht.BufferAttribute==0)return console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),void(this.attributes[e]={array:t,itemSize:arguments[2]});this.attributes[e]=t,this.attributesKeys=Object.keys(this.attributes)},getAttribute:function(e){return this.attributes[e]},addDrawCall:function(e,t,r){this.drawcalls.push({start:e,count:t,index:void 0!==r?r:0})},applyMatrix:function(e){var t=this.attributes.position;void 0!==t&&(e.applyToVector3Array(t.array),t.needsUpdate=!0);var r=this.attributes.normal;void 0!==r&&((new Ht.Matrix3).getNormalMatrix(e).applyToVector3Array(r.array),r.needsUpdate=!0)},center:function(){},fromGeometry:function(e,t){t=t||{vertexColors:Ht.NoColors};var r=e.vertices,n=e.faces,i=e.faceVertexUvs,o=t.vertexColors,a=0<i[0].length,s=3==n[0].vertexNormals.length,l=new Float32Array(3*n.length*3);this.addAttribute("position",new Ht.BufferAttribute(l,3));var h=new Float32Array(3*n.length*3);if(this.addAttribute("normal",new Ht.BufferAttribute(h,3)),o!==Ht.NoColors){var c=new Float32Array(3*n.length*3);this.addAttribute("color",new Ht.BufferAttribute(c,3))}if(!0===a){var u=new Float32Array(3*n.length*2);this.addAttribute("uv",new Ht.BufferAttribute(u,2))}for(var d=0,f=0,p=0;d<n.length;d++,f+=6,p+=9){var m=n[d],g=r[m.a],v=r[m.b],y=r[m.c];if(l[p]=g.x,l[p+1]=g.y,l[p+2]=g.z,l[p+3]=v.x,l[p+4]=v.y,l[p+5]=v.z,l[p+6]=y.x,l[p+7]=y.y,l[p+8]=y.z,!0===s){var x=m.vertexNormals[0],b=m.vertexNormals[1],_=m.vertexNormals[2];h[p]=x.x,h[p+1]=x.y,h[p+2]=x.z,h[p+3]=b.x,h[p+4]=b.y,h[p+5]=b.z,h[p+6]=_.x,h[p+7]=_.y,h[p+8]=_.z}else{var w=m.normal;h[p]=w.x,h[p+1]=w.y,h[p+2]=w.z,h[p+3]=w.x,h[p+4]=w.y,h[p+5]=w.z,h[p+6]=w.x,h[p+7]=w.y,h[p+8]=w.z}if(o===Ht.FaceColors){var M=m.color;c[p]=M.r,c[p+1]=M.g,c[p+2]=M.b,c[p+3]=M.r,c[p+4]=M.g,c[p+5]=M.b,c[p+6]=M.r,c[p+7]=M.g,c[p+8]=M.b}else if(o===Ht.VertexColors){var S=m.vertexColors[0],T=m.vertexColors[1],C=m.vertexColors[2];c[p]=S.r,c[p+1]=S.g,c[p+2]=S.b,c[p+3]=T.r,c[p+4]=T.g,c[p+5]=T.b,c[p+6]=C.r,c[p+7]=C.g,c[p+8]=C.b}if(!0===a){var E=i[0][d][0],A=i[0][d][1],L=i[0][d][2];u[f]=E.x,u[f+1]=E.y,u[f+2]=A.x,u[f+3]=A.y,u[f+4]=L.x,u[f+5]=L.y}}return this.computeBoundingSphere(),this},computeBoundingBox:(Re=new Ht.Vector3,function(){null===this.boundingBox&&(this.boundingBox=new Ht.Box3);var e=this.attributes.position.array;if(e){var t=this.boundingBox;t.makeEmpty();for(var r=0,n=e.length;r<n;r+=3)Re.set(e[r],e[r+1],e[r+2]),t.expandByPoint(Re)}void 0!==e&&0!==e.length||(this.boundingBox.min.set(0,0,0),this.boundingBox.max.set(0,0,0)),(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The "position" attribute is likely to have NaN values.')}),computeBoundingSphere:(Pe=new Ht.Box3,De=new Ht.Vector3,function(){null===this.boundingSphere&&(this.boundingSphere=new Ht.Sphere);var e=this.attributes.position.array;if(e){Pe.makeEmpty();for(var t=this.boundingSphere.center,r=0,n=e.length;r<n;r+=3)De.set(e[r],e[r+1],e[r+2]),Pe.expandByPoint(De);Pe.center(t);var i=0;for(r=0,n=e.length;r<n;r+=3)De.set(e[r],e[r+1],e[r+2]),i=Math.max(i,t.distanceToSquared(De));this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.')}}),computeFaceNormals:function(){},computeVertexNormals:function(){var e=this.attributes;if(e.position){var t=e.position.array;if(void 0===e.normal)this.addAttribute("normal",new Ht.BufferAttribute(new Float32Array(t.length),3));else for(var r=0,n=(s=e.normal.array).length;r<n;r++)s[r]=0;var i,o,a,s=e.normal.array,l=new Ht.Vector3,h=new Ht.Vector3,c=new Ht.Vector3,u=new Ht.Vector3,d=new Ht.Vector3;if(e.index)for(var f=e.index.array,p=0<this.offsets.length?this.offsets:[{start:0,count:f.length,index:0}],m=0,g=p.length;m<g;++m){var v=p[m].start,y=p[m].count,x=p[m].index;for(r=v,n=v+y;r<n;r+=3)i=3*(x+f[r]),o=3*(x+f[r+1]),a=3*(x+f[r+2]),l.fromArray(t,i),h.fromArray(t,o),c.fromArray(t,a),u.subVectors(c,h),d.subVectors(l,h),u.cross(d),s[i]+=u.x,s[i+1]+=u.y,s[i+2]+=u.z,s[o]+=u.x,s[o+1]+=u.y,s[o+2]+=u.z,s[a]+=u.x,s[a+1]+=u.y,s[a+2]+=u.z}else for(r=0,n=t.length;r<n;r+=9)l.fromArray(t,r),h.fromArray(t,r+3),c.fromArray(t,r+6),u.subVectors(c,h),d.subVectors(l,h),u.cross(d),s[r]=u.x,s[r+1]=u.y,s[r+2]=u.z,s[r+3]=u.x,s[r+4]=u.y,s[r+5]=u.z,s[r+6]=u.x,s[r+7]=u.y,s[r+8]=u.z;this.normalizeNormals(),e.normal.needsUpdate=!0}},computeTangents:function(){if(void 0!==this.attributes.index&&void 0!==this.attributes.position&&void 0!==this.attributes.normal&&void 0!==this.attributes.uv){var e=this.attributes.index.array,t=this.attributes.position.array,r=this.attributes.normal.array,n=this.attributes.uv.array,i=t.length/3;void 0===this.attributes.tangent&&this.addAttribute("tangent",new Ht.BufferAttribute(new Float32Array(4*i),4));for(var o=this.attributes.tangent.array,a=[],s=[],l=0;l<i;l++)a[l]=new Ht.Vector3,s[l]=new Ht.Vector3;var h,c,u,d,f,p,m,g,v,y,x,b,_,w,M,S,T,C,E=new Ht.Vector3,A=new Ht.Vector3,L=new Ht.Vector3,P=new Ht.Vector2,D=new Ht.Vector2,R=new Ht.Vector2,k=new Ht.Vector3,F=new Ht.Vector3;0===this.drawcalls.length&&this.addDrawCall(0,e.length,0);var U,N,B,V=this.drawcalls;for(w=0,M=V.length;w<M;++w){var z=V[w].start,O=V[w].count,I=V[w].index;for(_=(b=z)+O;b<_;b+=3)U=S=I+e[b],N=T=I+e[b+1],B=C=I+e[b+2],E.fromArray(t,3*U),A.fromArray(t,3*N),L.fromArray(t,3*B),P.fromArray(n,2*U),D.fromArray(n,2*N),R.fromArray(n,2*B),h=A.x-E.x,c=L.x-E.x,u=A.y-E.y,d=L.y-E.y,f=A.z-E.z,p=L.z-E.z,m=D.x-P.x,g=R.x-P.x,v=D.y-P.y,x=1/(m*(y=R.y-P.y)-g*v),k.set((y*h-v*c)*x,(y*u-v*d)*x,(y*f-v*p)*x),F.set((m*c-g*h)*x,(m*d-g*u)*x,(m*p-g*f)*x),a[U].add(k),a[N].add(k),a[B].add(k),s[U].add(F),s[N].add(F),s[B].add(F)}var H,G,W,j=new Ht.Vector3,X=new Ht.Vector3,q=new Ht.Vector3,Y=new Ht.Vector3;for(w=0,M=V.length;w<M;++w)for(z=V[w].start,O=V[w].count,I=V[w].index,_=(b=z)+O;b<_;b+=3)S=I+e[b],T=I+e[b+1],C=I+e[b+2],K(S),K(T),K(C)}else console.warn("Missing required attributes (index, position, normal or uv) in BufferGeometry.computeTangents()");function K(e){q.fromArray(r,3*e),Y.copy(q),G=a[e],j.copy(G),j.sub(q.multiplyScalar(q.dot(G))).normalize(),X.crossVectors(Y,G),W=X.dot(s[e]),H=W<0?-1:1,o[4*e]=j.x,o[4*e+1]=j.y,o[4*e+2]=j.z,o[4*e+3]=H}},computeOffsets:function(e){var t=e;void 0===e&&(t=65535),Date.now();for(var r=this.attributes.index.array,n=this.attributes.position.array,i=(n.length,r.length/3),o=new Uint16Array(r.length),a=0,s=0,l=[{start:0,count:0,index:0}],h=l[0],c=0,u=new Int32Array(6),d=new Int32Array(n.length),f=new Int32Array(n.length),p=0;p<n.length;p++)d[p]=-1,f[p]=-1;for(var m=0;m<i;m++){for(var g=c=0;g<3;g++)-1==d[b=r[3*m+g]]?(u[2*g]=b,u[2*g+1]=-1,c++):d[b]<h.index?(u[2*g]=b,u[2*g+1]=-1):(u[2*g]=b,u[2*g+1]=d[b]);if(s+c>h.index+t){var v={start:a,count:0,index:s};l.push(v),h=v;for(var y=0;y<6;y+=2)-1<(x=u[y+1])&&x<h.index&&(u[y+1]=-1)}for(y=0;y<6;y+=2){var x,b=u[y];-1===(x=u[y+1])&&(x=s++),f[d[b]=x]=b,o[a++]=x-h.index,h.count++}}return this.reorderBuffers(o,f,s),this.offsets=l},merge:function(){console.log("BufferGeometry.merge(): TODO")},normalizeNormals:function(){for(var e,t,r,n,i=this.attributes.normal.array,o=0,a=i.length;o<a;o+=3)e=i[o],t=i[o+1],r=i[o+2],n=1/Math.sqrt(e*e+t*t+r*r),i[o]*=n,i[o+1]*=n,i[o+2]*=n},reorderBuffers:function(e,t,r){var n={};for(var i in this.attributes)if("index"!=i){var o=this.attributes[i].array;n[i]=new o.constructor(this.attributes[i].itemSize*r)}for(var a=0;a<r;a++){var s=t[a];for(var i in this.attributes)if("index"!=i)for(var l=this.attributes[i].array,h=this.attributes[i].itemSize,c=n[i],u=0;u<h;u++)c[a*h+u]=l[s*h+u]}for(var i in this.attributes.index.array=e,this.attributes)"index"!=i&&(this.attributes[i].array=n[i],this.attributes[i].numItems=this.attributes[i].itemSize*r)},toJSON:function(){var e={metadata:{version:4,type:"BufferGeometry",generator:"BufferGeometryExporter"},uuid:this.uuid,type:this.type,data:{attributes:{}}},t=this.attributes,r=this.offsets,n=this.boundingSphere;for(var i in t){for(var o=t[i],a=[],s=o.array,l=0,h=s.length;l<h;l++)a[l]=s[l];e.data.attributes[i]={itemSize:o.itemSize,type:o.array.constructor.name,array:a}}return 0<r.length&&(e.data.offsets=JSON.parse(JSON.stringify(r))),null!==n&&(e.data.boundingSphere={center:n.center.toArray(),radius:n.radius}),e},clone:function(){var e=new Ht.BufferGeometry;for(var t in this.attributes){var r=this.attributes[t];e.addAttribute(t,r.clone())}for(var n=0,i=this.offsets.length;n<i;n++){var o=this.offsets[n];e.offsets.push({start:o.start,index:o.index,count:o.count})}return e},dispose:function(){this.dispatchEvent({type:"dispose"})}},Ht.EventDispatcher.prototype.apply(Ht.BufferGeometry.prototype),Ht.Geometry=function(){Object.defineProperty(this,"id",{value:Ht.GeometryIdCount++}),this.uuid=Ht.Math.generateUUID(),this.name="",this.type="Geometry",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphColors=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.hasTangents=!1,this.dynamic=!0,this.verticesNeedUpdate=!1,this.elementsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.tangentsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.groupsNeedUpdate=!1},Ht.Geometry.prototype={constructor:Ht.Geometry,applyMatrix:function(e){for(var t=(new Ht.Matrix3).getNormalMatrix(e),r=0,n=this.vertices.length;r<n;r++)this.vertices[r].applyMatrix4(e);for(r=0,n=this.faces.length;r<n;r++){var i=this.faces[r];i.normal.applyMatrix3(t).normalize();for(var o=0,a=i.vertexNormals.length;o<a;o++)i.vertexNormals[o].applyMatrix3(t).normalize()}this.boundingBox instanceof Ht.Box3&&this.computeBoundingBox(),this.boundingSphere instanceof Ht.Sphere&&this.computeBoundingSphere()},fromBufferGeometry:function(e){for(var t=this,r=e.attributes,n=r.position.array,i=void 0!==r.index?r.index.array:void 0,o=void 0!==r.normal?r.normal.array:void 0,a=void 0!==r.color?r.color.array:void 0,s=void 0!==r.uv?r.uv.array:void 0,l=[],h=[],c=0,u=0;c<n.length;c+=3,u+=2)t.vertices.push(new Ht.Vector3(n[c],n[c+1],n[c+2])),void 0!==o&&l.push(new Ht.Vector3(o[c],o[c+1],o[c+2])),void 0!==a&&t.colors.push(new Ht.Color(a[c],a[c+1],a[c+2])),void 0!==s&&h.push(new Ht.Vector2(s[u],s[u+1]));var d=function(e,r,n){var i=void 0!==o?[l[e].clone(),l[r].clone(),l[n].clone()]:[],s=void 0!==a?[t.colors[e].clone(),t.colors[r].clone(),t.colors[n].clone()]:[];t.faces.push(new Ht.Face3(e,r,n,i,s)),t.faceVertexUvs[0].push([h[e],h[r],h[n]])};if(void 0!==i)for(c=0;c<i.length;c+=3)d(i[c],i[c+1],i[c+2]);else for(c=0;c<n.length/3;c+=3)d(c,c+1,c+2);return this.computeFaceNormals(),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),this},center:function(){this.computeBoundingBox();var e=new Ht.Vector3;return e.addVectors(this.boundingBox.min,this.boundingBox.max),e.multiplyScalar(-.5),this.applyMatrix((new Ht.Matrix4).makeTranslation(e.x,e.y,e.z)),this.computeBoundingBox(),e},computeFaceNormals:function(){for(var e=new Ht.Vector3,t=new Ht.Vector3,r=0,n=this.faces.length;r<n;r++){var i=this.faces[r],o=this.vertices[i.a],a=this.vertices[i.b],s=this.vertices[i.c];e.subVectors(s,a),t.subVectors(o,a),e.cross(t),e.normalize(),i.normal.copy(e)}},computeVertexNormals:function(e){var t,r,n,i,o,a;for(a=new Array(this.vertices.length),t=0,r=this.vertices.length;t<r;t++)a[t]=new Ht.Vector3;if(e){var s,l,h,c=new Ht.Vector3,u=new Ht.Vector3;for(new Ht.Vector3,new Ht.Vector3,new Ht.Vector3,n=0,i=this.faces.length;n<i;n++)o=this.faces[n],s=this.vertices[o.a],l=this.vertices[o.b],h=this.vertices[o.c],c.subVectors(h,l),u.subVectors(s,l),c.cross(u),a[o.a].add(c),a[o.b].add(c),a[o.c].add(c)}else for(n=0,i=this.faces.length;n<i;n++)a[(o=this.faces[n]).a].add(o.normal),a[o.b].add(o.normal),a[o.c].add(o.normal);for(t=0,r=this.vertices.length;t<r;t++)a[t].normalize();for(n=0,i=this.faces.length;n<i;n++)(o=this.faces[n]).vertexNormals[0]=a[o.a].clone(),o.vertexNormals[1]=a[o.b].clone(),o.vertexNormals[2]=a[o.c].clone()},computeMorphNormals:function(){var e,t,r,n,i;for(r=0,n=this.faces.length;r<n;r++)for((i=this.faces[r]).__originalFaceNormal?i.__originalFaceNormal.copy(i.normal):i.__originalFaceNormal=i.normal.clone(),i.__originalVertexNormals||(i.__originalVertexNormals=[]),e=0,t=i.vertexNormals.length;e<t;e++)i.__originalVertexNormals[e]?i.__originalVertexNormals[e].copy(i.vertexNormals[e]):i.__originalVertexNormals[e]=i.vertexNormals[e].clone();var o=new Ht.Geometry;for(o.faces=this.faces,e=0,t=this.morphTargets.length;e<t;e++){if(!this.morphNormals[e]){this.morphNormals[e]={},this.morphNormals[e].faceNormals=[],this.morphNormals[e].vertexNormals=[];var a=this.morphNormals[e].faceNormals,s=this.morphNormals[e].vertexNormals;for(r=0,n=this.faces.length;r<n;r++)l=new Ht.Vector3,h={a:new Ht.Vector3,b:new Ht.Vector3,c:new Ht.Vector3},a.push(l),s.push(h)}var l,h,c=this.morphNormals[e];for(o.vertices=this.morphTargets[e].vertices,o.computeFaceNormals(),o.computeVertexNormals(),r=0,n=this.faces.length;r<n;r++)i=this.faces[r],l=c.faceNormals[r],h=c.vertexNormals[r],l.copy(i.normal),h.a.copy(i.vertexNormals[0]),h.b.copy(i.vertexNormals[1]),h.c.copy(i.vertexNormals[2])}for(r=0,n=this.faces.length;r<n;r++)(i=this.faces[r]).normal=i.__originalFaceNormal,i.vertexNormals=i.__originalVertexNormals},computeTangents:function(){var e,t,r,n,i,o,a,s,l,h,c,u,d,f,p,m,g,v,y,x,b,_,w,M,S,T,C,E,A,L,P,D,R,k,F=[],U=[],N=new Ht.Vector3,B=new Ht.Vector3,V=new Ht.Vector3,z=new Ht.Vector3,O=new Ht.Vector3;for(r=0,n=this.vertices.length;r<n;r++)F[r]=new Ht.Vector3,U[r]=new Ht.Vector3;for(e=0,t=this.faces.length;e<t;e++)a=this.faces[e],s=this.faceVertexUvs[0][e],E=this,A=a.a,L=a.b,P=a.c,D=0,R=1,k=2,l=E.vertices[A],h=E.vertices[L],c=E.vertices[P],u=s[D],d=s[R],f=s[k],p=h.x-l.x,m=c.x-l.x,g=h.y-l.y,v=c.y-l.y,y=h.z-l.z,x=c.z-l.z,b=d.x-u.x,_=f.x-u.x,w=d.y-u.y,S=1/(b*(M=f.y-u.y)-_*w),N.set((M*p-w*m)*S,(M*g-w*v)*S,(M*y-w*x)*S),B.set((b*m-_*p)*S,(b*v-_*g)*S,(b*x-_*y)*S),F[A].add(N),F[L].add(N),F[P].add(N),U[A].add(B),U[L].add(B),U[P].add(B);var I=["a","b","c","d"];for(e=0,t=this.faces.length;e<t;e++)for(a=this.faces[e],i=0;i<Math.min(a.vertexNormals.length,3);i++)O.copy(a.vertexNormals[i]),T=F[o=a[I[i]]],V.copy(T),V.sub(O.multiplyScalar(O.dot(T))).normalize(),z.crossVectors(a.vertexNormals[i],T),C=z.dot(U[o])<0?-1:1,a.vertexTangents[i]=new Ht.Vector4(V.x,V.y,V.z,C);this.hasTangents=!0},computeLineDistances:function(){for(var e=0,t=this.vertices,r=0,n=t.length;r<n;r++)0<r&&(e+=t[r].distanceTo(t[r-1])),this.lineDistances[r]=e},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new Ht.Box3),this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new Ht.Sphere),this.boundingSphere.setFromPoints(this.vertices)},merge:function(e,t,r){if(e instanceof Ht.Geometry!=0){var n,i=this.vertices.length,o=this.vertices,a=e.vertices,s=this.faces,l=e.faces,h=this.faceVertexUvs[0],c=e.faceVertexUvs[0];void 0===r&&(r=0),void 0!==t&&(n=(new Ht.Matrix3).getNormalMatrix(t));for(var u=0,d=a.length;u<d;u++){var f=a[u].clone();void 0!==t&&f.applyMatrix4(t),o.push(f)}for(u=0,d=l.length;u<d;u++){var p,m,g,v=l[u],y=v.vertexNormals,x=v.vertexColors;(p=new Ht.Face3(v.a+i,v.b+i,v.c+i)).normal.copy(v.normal),void 0!==n&&p.normal.applyMatrix3(n).normalize();for(var b=0,_=y.length;b<_;b++)m=y[b].clone(),void 0!==n&&m.applyMatrix3(n).normalize(),p.vertexNormals.push(m);for(p.color.copy(v.color),b=0,_=x.length;b<_;b++)g=x[b],p.vertexColors.push(g.clone());p.materialIndex=v.materialIndex+r,s.push(p)}for(u=0,d=c.length;u<d;u++){var w=c[u],M=[];if(void 0!==w){for(b=0,_=w.length;b<_;b++)M.push(new Ht.Vector2(w[b].x,w[b].y));h.push(M)}}}else console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",e)},mergeVertices:function(){var e,t,r,n,i,o,a,s,l={},h=[],c=[],u=Math.pow(10,4);for(r=0,n=this.vertices.length;r<n;r++)e=this.vertices[r],void 0===l[t=Math.round(e.x*u)+"_"+Math.round(e.y*u)+"_"+Math.round(e.z*u)]?(l[t]=r,h.push(this.vertices[r]),c[r]=h.length-1):c[r]=c[l[t]];var d=[];for(r=0,n=this.faces.length;r<n;r++){(i=this.faces[r]).a=c[i.a],i.b=c[i.b],i.c=c[i.c],o=[i.a,i.b,i.c];for(var f=0;f<3;f++)if(o[f]==o[(f+1)%3]){d.push(r);break}}for(r=d.length-1;0<=r;r--){var p=d[r];for(this.faces.splice(p,1),a=0,s=this.faceVertexUvs.length;a<s;a++)this.faceVertexUvs[a].splice(p,1)}var m=this.vertices.length-h.length;return this.vertices=h,m},toJSON:function(){var e={metadata:{version:4,type:"BufferGeometry",generator:"BufferGeometryExporter"},uuid:this.uuid,type:this.type};if(""!==this.name&&(e.name=this.name),void 0!==this.parameters){var t=this.parameters;for(var r in t)void 0!==t[r]&&(e[r]=t[r]);return e}for(var n=[],i=0;i<this.vertices.length;i++){var o=this.vertices[i];n.push(o.x,o.y,o.z)}var a=[],s=[],l={},h=[],c={},u=[],d={};for(i=0;i<this.faces.length;i++){var f=this.faces[i],p=void 0!==this.faceVertexUvs[0][i],m=0<f.normal.length(),g=0<f.vertexNormals.length,v=1!==f.color.r||1!==f.color.g||1!==f.color.b,y=0<f.vertexColors.length,x=0;if(x=M(x=M(x=M(x=M(x=M(x=M(x=M(x=M(x,0,0),1,!1),2,!1),3,p),4,m),5,g),6,v),7,y),a.push(x),a.push(f.a,f.b,f.c),p){var b=this.faceVertexUvs[0][i];a.push(C(b[0]),C(b[1]),C(b[2]))}if(m&&a.push(S(f.normal)),g){var _=f.vertexNormals;a.push(S(_[0]),S(_[1]),S(_[2]))}if(v&&a.push(T(f.color)),y){var w=f.vertexColors;a.push(T(w[0]),T(w[1]),T(w[2]))}}function M(e,t,r){return r?e|1<<t:e&~(1<<t)}function S(e){var t=e.x.toString()+e.y.toString()+e.z.toString();return void 0!==l[t]||(l[t]=s.length/3,s.push(e.x,e.y,e.z)),l[t]}function T(e){var t=e.r.toString()+e.g.toString()+e.b.toString();return void 0!==c[t]||(c[t]=h.length,h.push(e.getHex())),c[t]}function C(e){var t=e.x.toString()+e.y.toString();return void 0!==d[t]||(d[t]=u.length/2,u.push(e.x,e.y)),d[t]}return e.data={},e.data.vertices=n,e.data.normals=s,0<h.length&&(e.data.colors=h),0<u.length&&(e.data.uvs=[u]),e.data.faces=a,e},clone:function(){for(var e=new Ht.Geometry,t=this.vertices,r=0,n=t.length;r<n;r++)e.vertices.push(t[r].clone());var i=this.faces;for(r=0,n=i.length;r<n;r++)e.faces.push(i[r].clone());var o=this.faceVertexUvs[0];for(r=0,n=o.length;r<n;r++){for(var a=o[r],s=[],l=0,h=a.length;l<h;l++)s.push(new Ht.Vector2(a[l].x,a[l].y));e.faceVertexUvs[0].push(s)}return e},dispose:function(){this.dispatchEvent({type:"dispose"})}},Ht.EventDispatcher.prototype.apply(Ht.Geometry.prototype),Ht.GeometryIdCount=0,Ht.Camera=function(){Ht.Object3D.call(this),this.type="Camera",this.matrixWorldInverse=new Ht.Matrix4,this.projectionMatrix=new Ht.Matrix4},Ht.Camera.prototype=Object.create(Ht.Object3D.prototype),Ht.Camera.prototype.getWorldDirection=(ke=new Ht.Quaternion,function(e){var t=e||new Ht.Vector3;return this.getWorldQuaternion(ke),t.set(0,0,-1).applyQuaternion(ke)}),Ht.Camera.prototype.lookAt=(Fe=new Ht.Matrix4,function(e){Fe.lookAt(this.position,e,this.up),this.quaternion.setFromRotationMatrix(Fe)}),Ht.Camera.prototype.clone=function(e){return void 0===e&&(e=new Ht.Camera),Ht.Object3D.prototype.clone.call(this,e),e.matrixWorldInverse.copy(this.matrixWorldInverse),e.projectionMatrix.copy(this.projectionMatrix),e},Ht.CubeCamera=function(e,t,r){Ht.Object3D.call(this),this.type="CubeCamera";var n=new Ht.PerspectiveCamera(90,1,e,t);n.up.set(0,-1,0),n.lookAt(new Ht.Vector3(1,0,0)),this.add(n);var i=new Ht.PerspectiveCamera(90,1,e,t);i.up.set(0,-1,0),i.lookAt(new Ht.Vector3(-1,0,0)),this.add(i);var o=new Ht.PerspectiveCamera(90,1,e,t);o.up.set(0,0,1),o.lookAt(new Ht.Vector3(0,1,0)),this.add(o);var a=new Ht.PerspectiveCamera(90,1,e,t);a.up.set(0,0,-1),a.lookAt(new Ht.Vector3(0,-1,0)),this.add(a);var s=new Ht.PerspectiveCamera(90,1,e,t);s.up.set(0,-1,0),s.lookAt(new Ht.Vector3(0,0,1)),this.add(s);var l=new Ht.PerspectiveCamera(90,1,e,t);l.up.set(0,-1,0),l.lookAt(new Ht.Vector3(0,0,-1)),this.add(l),this.renderTarget=new Ht.WebGLRenderTargetCube(r,r,{format:Ht.RGBFormat,magFilter:Ht.LinearFilter,minFilter:Ht.LinearFilter}),this.updateCubeMap=function(e,t){var r=this.renderTarget,h=r.generateMipmaps;r.generateMipmaps=!1,r.activeCubeFace=0,e.render(t,n,r),r.activeCubeFace=1,e.render(t,i,r),r.activeCubeFace=2,e.render(t,o,r),r.activeCubeFace=3,e.render(t,a,r),r.activeCubeFace=4,e.render(t,s,r),r.generateMipmaps=h,r.activeCubeFace=5,e.render(t,l,r)}},Ht.CubeCamera.prototype=Object.create(Ht.Object3D.prototype),Ht.OrthographicCamera=function(e,t,r,n,i,o){Ht.Camera.call(this),this.type="OrthographicCamera",this.zoom=1,this.left=e,this.right=t,this.top=r,this.bottom=n,this.near=void 0!==i?i:.1,this.far=void 0!==o?o:2e3,this.updateProjectionMatrix()},Ht.OrthographicCamera.prototype=Object.create(Ht.Camera.prototype),Ht.OrthographicCamera.prototype.updateProjectionMatrix=function(){var e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),r=(this.right+this.left)/2,n=(this.top+this.bottom)/2;this.projectionMatrix.makeOrthographic(r-e,r+e,n+t,n-t,this.near,this.far)},Ht.OrthographicCamera.prototype.clone=function(){var e=new Ht.OrthographicCamera;return Ht.Camera.prototype.clone.call(this,e),e.zoom=this.zoom,e.left=this.left,e.right=this.right,e.top=this.top,e.bottom=this.bottom,e.near=this.near,e.far=this.far,e.projectionMatrix.copy(this.projectionMatrix),e},Ht.PerspectiveCamera=function(e,t,r,n){Ht.Camera.call(this),this.type="PerspectiveCamera",this.zoom=1,this.fov=void 0!==e?e:50,this.aspect=void 0!==t?t:1,this.near=void 0!==r?r:.1,this.far=void 0!==n?n:2e3,this.updateProjectionMatrix()},Ht.PerspectiveCamera.prototype=Object.create(Ht.Camera.prototype),Ht.PerspectiveCamera.prototype.setLens=function(e,t){void 0===t&&(t=24),this.fov=2*Ht.Math.radToDeg(Math.atan(t/(2*e))),this.updateProjectionMatrix()},Ht.PerspectiveCamera.prototype.setViewOffset=function(e,t,r,n,i,o){this.fullWidth=e,this.fullHeight=t,this.x=r,this.y=n,this.width=i,this.height=o,this.updateProjectionMatrix()},Ht.PerspectiveCamera.prototype.updateProjectionMatrix=function(){var e=Ht.Math.radToDeg(2*Math.atan(Math.tan(.5*Ht.Math.degToRad(this.fov))/this.zoom));if(this.fullWidth){var t=this.fullWidth/this.fullHeight,r=Math.tan(Ht.Math.degToRad(.5*e))*this.near,n=-r,i=t*n,o=t*r,a=Math.abs(o-i),s=Math.abs(r-n);this.projectionMatrix.makeFrustum(i+this.x*a/this.fullWidth,i+(this.x+this.width)*a/this.fullWidth,r-(this.y+this.height)*s/this.fullHeight,r-this.y*s/this.fullHeight,this.near,this.far)}else this.projectionMatrix.makePerspective(e,this.aspect,this.near,this.far)},Ht.PerspectiveCamera.prototype.clone=function(){var e=new Ht.PerspectiveCamera;return Ht.Camera.prototype.clone.call(this,e),e.zoom=this.zoom,e.fov=this.fov,e.aspect=this.aspect,e.near=this.near,e.far=this.far,e.projectionMatrix.copy(this.projectionMatrix),e},Ht.Light=function(e){Ht.Object3D.call(this),this.type="Light",this.color=new Ht.Color(e)},Ht.Light.prototype=Object.create(Ht.Object3D.prototype),Ht.Light.prototype.clone=function(e){return void 0===e&&(e=new Ht.Light),Ht.Object3D.prototype.clone.call(this,e),e.color.copy(this.color),e},Ht.AmbientLight=function(e){Ht.Light.call(this,e),this.type="AmbientLight"},Ht.AmbientLight.prototype=Object.create(Ht.Light.prototype),Ht.AmbientLight.prototype.clone=function(){var e=new Ht.AmbientLight;return Ht.Light.prototype.clone.call(this,e),e},Ht.AreaLight=function(e,t){Ht.Light.call(this,e),this.type="AreaLight",this.normal=new Ht.Vector3(0,-1,0),this.right=new Ht.Vector3(1,0,0),this.intensity=void 0!==t?t:1,this.width=1,this.height=1,this.constantAttenuation=1.5,this.linearAttenuation=.5,this.quadraticAttenuation=.1},Ht.AreaLight.prototype=Object.create(Ht.Light.prototype),Ht.DirectionalLight=function(e,t){Ht.Light.call(this,e),this.type="DirectionalLight",this.position.set(0,1,0),this.target=new Ht.Object3D,this.intensity=void 0!==t?t:1,this.castShadow=!1,this.onlyShadow=!1,this.shadowCameraNear=50,this.shadowCameraFar=5e3,this.shadowCameraLeft=-500,this.shadowCameraRight=500,this.shadowCameraTop=500,this.shadowCameraBottom=-500,this.shadowCameraVisible=!1,this.shadowBias=0,this.shadowDarkness=.5,this.shadowMapWidth=512,this.shadowMapHeight=512,this.shadowCascade=!1,this.shadowCascadeOffset=new Ht.Vector3(0,0,-1e3),this.shadowCascadeCount=2,this.shadowCascadeBias=[0,0,0],this.shadowCascadeWidth=[512,512,512],this.shadowCascadeHeight=[512,512,512],this.shadowCascadeNearZ=[-1,.99,.998],this.shadowCascadeFarZ=[.99,.998,1],this.shadowCascadeArray=[],this.shadowMap=null,this.shadowMapSize=null,this.shadowCamera=null,this.shadowMatrix=null},Ht.DirectionalLight.prototype=Object.create(Ht.Light.prototype),Ht.DirectionalLight.prototype.clone=function(){var e=new Ht.DirectionalLight;return Ht.Light.prototype.clone.call(this,e),e.target=this.target.clone(),e.intensity=this.intensity,e.castShadow=this.castShadow,e.onlyShadow=this.onlyShadow,e.shadowCameraNear=this.shadowCameraNear,e.shadowCameraFar=this.shadowCameraFar,e.shadowCameraLeft=this.shadowCameraLeft,e.shadowCameraRight=this.shadowCameraRight,e.shadowCameraTop=this.shadowCameraTop,e.shadowCameraBottom=this.shadowCameraBottom,e.shadowCameraVisible=this.shadowCameraVisible,e.shadowBias=this.shadowBias,e.shadowDarkness=this.shadowDarkness,e.shadowMapWidth=this.shadowMapWidth,e.shadowMapHeight=this.shadowMapHeight,e.shadowCascade=this.shadowCascade,e.shadowCascadeOffset.copy(this.shadowCascadeOffset),e.shadowCascadeCount=this.shadowCascadeCount,e.shadowCascadeBias=this.shadowCascadeBias.slice(0),e.shadowCascadeWidth=this.shadowCascadeWidth.slice(0),e.shadowCascadeHeight=this.shadowCascadeHeight.slice(0),e.shadowCascadeNearZ=this.shadowCascadeNearZ.slice(0),e.shadowCascadeFarZ=this.shadowCascadeFarZ.slice(0),e},Ht.HemisphereLight=function(e,t,r){Ht.Light.call(this,e),this.type="HemisphereLight",this.position.set(0,100,0),this.groundColor=new Ht.Color(t),this.intensity=void 0!==r?r:1},Ht.HemisphereLight.prototype=Object.create(Ht.Light.prototype),Ht.HemisphereLight.prototype.clone=function(){var e=new Ht.HemisphereLight;return Ht.Light.prototype.clone.call(this,e),e.groundColor.copy(this.groundColor),e.intensity=this.intensity,e},Ht.PointLight=function(e,t,r){Ht.Light.call(this,e),this.type="PointLight",this.intensity=void 0!==t?t:1,this.distance=void 0!==r?r:0},Ht.PointLight.prototype=Object.create(Ht.Light.prototype),Ht.PointLight.prototype.clone=function(){var e=new Ht.PointLight;return Ht.Light.prototype.clone.call(this,e),e.intensity=this.intensity,e.distance=this.distance,e},Ht.SpotLight=function(e,t,r,n,i){Ht.Light.call(this,e),this.type="SpotLight",this.position.set(0,1,0),this.target=new Ht.Object3D,this.intensity=void 0!==t?t:1,this.distance=void 0!==r?r:0,this.angle=void 0!==n?n:Math.PI/3,this.exponent=void 0!==i?i:10,this.castShadow=!1,this.onlyShadow=!1,this.shadowCameraNear=50,this.shadowCameraFar=5e3,this.shadowCameraFov=50,this.shadowCameraVisible=!1,this.shadowBias=0,this.shadowDarkness=.5,this.shadowMapWidth=512,this.shadowMapHeight=512,this.shadowMap=null,this.shadowMapSize=null,this.shadowCamera=null,this.shadowMatrix=null},Ht.SpotLight.prototype=Object.create(Ht.Light.prototype),Ht.SpotLight.prototype.clone=function(){var e=new Ht.SpotLight;return Ht.Light.prototype.clone.call(this,e),e.target=this.target.clone(),e.intensity=this.intensity,e.distance=this.distance,e.angle=this.angle,e.exponent=this.exponent,e.castShadow=this.castShadow,e.onlyShadow=this.onlyShadow,e.shadowCameraNear=this.shadowCameraNear,e.shadowCameraFar=this.shadowCameraFar,e.shadowCameraFov=this.shadowCameraFov,e.shadowCameraVisible=this.shadowCameraVisible,e.shadowBias=this.shadowBias,e.shadowDarkness=this.shadowDarkness,e.shadowMapWidth=this.shadowMapWidth,e.shadowMapHeight=this.shadowMapHeight,e},Ht.Cache=function(){this.files={}},Ht.Cache.prototype={constructor:Ht.Cache,add:function(e,t){this.files[e]=t},get:function(e){return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}},Ht.Loader=function(e){this.showStatus=e,this.statusDomElement=e?Ht.Loader.prototype.addStatusElement():null,this.imageLoader=new Ht.ImageLoader,this.onLoadStart=function(){},this.onLoadProgress=function(){},this.onLoadComplete=function(){}},Ht.Loader.prototype={constructor:Ht.Loader,crossOrigin:void 0,addStatusElement:function(){var e=document.createElement("div");return e.style.position="absolute",e.style.right="0px",e.style.top="0px",e.style.fontSize="0.8em",e.style.textAlign="left",e.style.background="rgba(0,0,0,0.25)",e.style.color="#fff",e.style.width="120px",e.style.padding="0.5em 0.5em 0.5em 0.5em",e.style.zIndex=1e3,e.innerHTML="Loading ...",e},updateProgress:function(e){var t="Loaded ";e.total?t+=(100*e.loaded/e.total).toFixed(0)+"%":t+=(e.loaded/1024).toFixed(2)+" KB",this.statusDomElement.innerHTML=t},extractUrlBase:function(e){var t=e.split("/");return 1===t.length?"./":(t.pop(),t.join("/")+"/")},initMaterials:function(e,t){for(var r=[],n=0;n<e.length;++n)r[n]=this.createMaterial(e[n],t);return r},needsTangents:function(e){for(var t=0,r=e.length;t<r;t++)if(e[t]instanceof Ht.ShaderMaterial)return!0;return!1},createMaterial:function(e,t){var r=this;function n(e){var t=Math.log(e)/Math.LN2;return Math.pow(2,Math.round(t))}function i(e,i,o,a,s,l,h){var c,u=t+o,d=Ht.Loader.Handlers.get(u);if(null!==d?c=d.load(u):(c=new Ht.Texture,(d=r.imageLoader).crossOrigin=r.crossOrigin,d.load(u,function(e){if(!1===Ht.Math.isPowerOfTwo(e.width)||!1===Ht.Math.isPowerOfTwo(e.height)){var t=n(e.width),r=n(e.height),i=document.createElement("canvas");i.width=t,i.height=r,i.getContext("2d").drawImage(e,0,0,t,r),c.image=i}else c.image=e;c.needsUpdate=!0})),c.sourceFile=o,a&&(c.repeat.set(a[0],a[1]),1!==a[0]&&(c.wrapS=Ht.RepeatWrapping),1!==a[1]&&(c.wrapT=Ht.RepeatWrapping)),s&&c.offset.set(s[0],s[1]),l){var f={repeat:Ht.RepeatWrapping,mirror:Ht.MirroredRepeatWrapping};void 0!==f[l[0]]&&(c.wrapS=f[l[0]]),void 0!==f[l[1]]&&(c.wrapT=f[l[1]])}h&&(c.anisotropy=h),e[i]=c}function o(e){return(255*e[0]<<16)+(255*e[1]<<8)+255*e[2]}var a="MeshLambertMaterial",s={color:15658734,opacity:1,map:null,lightMap:null,normalMap:null,bumpMap:null,wireframe:!1};if(e.shading){var l=e.shading.toLowerCase();"phong"===l?a="MeshPhongMaterial":"basic"===l&&(a="MeshBasicMaterial")}if(void 0!==e.blending&&void 0!==Ht[e.blending]&&(s.blending=Ht[e.blending]),(void 0!==e.transparent||e.opacity<1)&&(s.transparent=e.transparent),void 0!==e.depthTest&&(s.depthTest=e.depthTest),void 0!==e.depthWrite&&(s.depthWrite=e.depthWrite),void 0!==e.visible&&(s.visible=e.visible),void 0!==e.flipSided&&(s.side=Ht.BackSide),void 0!==e.doubleSided&&(s.side=Ht.DoubleSide),void 0!==e.wireframe&&(s.wireframe=e.wireframe),void 0!==e.vertexColors&&("face"===e.vertexColors?s.vertexColors=Ht.FaceColors:e.vertexColors&&(s.vertexColors=Ht.VertexColors)),e.colorDiffuse?s.color=o(e.colorDiffuse):e.DbgColor&&(s.color=e.DbgColor),e.colorSpecular&&(s.specular=o(e.colorSpecular)),e.colorAmbient&&(s.ambient=o(e.colorAmbient)),e.colorEmissive&&(s.emissive=o(e.colorEmissive)),e.transparency&&(s.opacity=e.transparency),e.specularCoef&&(s.shininess=e.specularCoef),e.mapDiffuse&&t&&i(s,"map",e.mapDiffuse,e.mapDiffuseRepeat,e.mapDiffuseOffset,e.mapDiffuseWrap,e.mapDiffuseAnisotropy),e.mapLight&&t&&i(s,"lightMap",e.mapLight,e.mapLightRepeat,e.mapLightOffset,e.mapLightWrap,e.mapLightAnisotropy),e.mapBump&&t&&i(s,"bumpMap",e.mapBump,e.mapBumpRepeat,e.mapBumpOffset,e.mapBumpWrap,e.mapBumpAnisotropy),e.mapNormal&&t&&i(s,"normalMap",e.mapNormal,e.mapNormalRepeat,e.mapNormalOffset,e.mapNormalWrap,e.mapNormalAnisotropy),e.mapSpecular&&t&&i(s,"specularMap",e.mapSpecular,e.mapSpecularRepeat,e.mapSpecularOffset,e.mapSpecularWrap,e.mapSpecularAnisotropy),e.mapAlpha&&t&&i(s,"alphaMap",e.mapAlpha,e.mapAlphaRepeat,e.mapAlphaOffset,e.mapAlphaWrap,e.mapAlphaAnisotropy),e.mapBumpScale&&(s.bumpScale=e.mapBumpScale),e.mapNormal){var h=Ht.ShaderLib.normalmap,c=Ht.UniformsUtils.clone(h.uniforms);c.tNormal.value=s.normalMap,e.mapNormalFactor&&c.uNormalScale.value.set(e.mapNormalFactor,e.mapNormalFactor),s.map&&(c.tDiffuse.value=s.map,c.enableDiffuse.value=!0),s.specularMap&&(c.tSpecular.value=s.specularMap,c.enableSpecular.value=!0),s.lightMap&&(c.tAO.value=s.lightMap,c.enableAO.value=!0),c.diffuse.value.setHex(s.color),c.specular.value.setHex(s.specular),c.ambient.value.setHex(s.ambient),c.shininess.value=s.shininess,void 0!==s.opacity&&(c.opacity.value=s.opacity);var u={fragmentShader:h.fragmentShader,vertexShader:h.vertexShader,uniforms:c,lights:!0,fog:!0},d=new Ht.ShaderMaterial(u);s.transparent&&(d.transparent=!0)}else d=new Ht[a](s);return void 0!==e.DbgName&&(d.name=e.DbgName),d}},Ht.Loader.Handlers={handlers:[],add:function(e,t){this.handlers.push(e,t)},get:function(e){for(var t=0,r=this.handlers.length;t<r;t+=2){var n=this.handlers[t],i=this.handlers[t+1];if(n.test(e))return i}return null}},Ht.XHRLoader=function(e){this.cache=new Ht.Cache,this.manager=void 0!==e?e:Ht.DefaultLoadingManager},Ht.XHRLoader.prototype={constructor:Ht.XHRLoader,load:function(e,t,r,n){var i=this,o=i.cache.get(e);if(void 0===o){var a=new XMLHttpRequest;a.open("GET",e,!0),a.addEventListener("load",function(r){i.cache.add(e,this.response),t&&t(this.response),i.manager.itemEnd(e)},!1),void 0!==r&&a.addEventListener("progress",function(e){r(e)},!1),void 0!==n&&a.addEventListener("error",function(e){n(e)},!1),void 0!==this.crossOrigin&&(a.crossOrigin=this.crossOrigin),void 0!==this.responseType&&(a.responseType=this.responseType),a.send(null),i.manager.itemStart(e)}else t&&t(o)},setResponseType:function(e){this.responseType=e},setCrossOrigin:function(e){this.crossOrigin=e}},Ht.ImageLoader=function(e){this.cache=new Ht.Cache,this.manager=void 0!==e?e:Ht.DefaultLoadingManager},Ht.ImageLoader.prototype={constructor:Ht.ImageLoader,load:function(e,t,r,n){var i=this,o=i.cache.get(e);if(void 0===o){var a=document.createElement("img");return void 0!==t&&a.addEventListener("load",function(r){i.cache.add(e,this),t(this),i.manager.itemEnd(e)},!1),void 0!==r&&a.addEventListener("progress",function(e){r(e)},!1),void 0!==n&&a.addEventListener("error",function(e){n(e)},!1),void 0!==this.crossOrigin&&(a.crossOrigin=this.crossOrigin),a.src=e,i.manager.itemStart(e),a}t(o)},setCrossOrigin:function(e){this.crossOrigin=e}},Ht.JSONLoader=function(e){Ht.Loader.call(this,e),this.withCredentials=!1},Ht.JSONLoader.prototype=Object.create(Ht.Loader.prototype),Ht.JSONLoader.prototype.load=function(e,t,r){r=r&&"string"==typeof r?r:this.extractUrlBase(e),this.onLoadStart(),this.loadAjaxJSON(this,e,t,r)},Ht.JSONLoader.prototype.loadAjaxJSON=function(e,t,r,n,i){var o=new XMLHttpRequest,a=0;o.onreadystatechange=function(){if(o.readyState===o.DONE)if(200===o.status||0===o.status){if(o.responseText){var s=JSON.parse(o.responseText);if(void 0!==s.metadata&&"scene"===s.metadata.type)return void console.error('THREE.JSONLoader: "'+t+'" seems to be a Scene. Use THREE.SceneLoader instead.');var l=e.parse(s,n);r(l.geometry,l.materials)}else console.error('THREE.JSONLoader: "'+t+'" seems to be unreachable or the file is empty.');e.onLoadComplete()}else console.error("THREE.JSONLoader: Couldn't load \""+t+'" ('+o.status+")");else o.readyState===o.LOADING?i&&(0===a&&(a=o.getResponseHeader("Content-Length")),i({total:a,loaded:o.responseText.length})):o.readyState===o.HEADERS_RECEIVED&&void 0!==i&&(a=o.getResponseHeader("Content-Length"))},o.open("GET",t,!0),o.withCredentials=this.withCredentials,o.send(null)},Ht.JSONLoader.prototype.parse=function(e,t){var r=new Ht.Geometry,n=void 0!==e.scale?1/e.scale:1;if(function(t){function n(e,t){return e&1<<t}var i,o,a,s,l,h,c,u,d,f,p,m,g,v,y,x,b,_,w,M,S,T,C,E,A,L,P,D=e.faces,R=e.vertices,k=e.normals,F=e.colors,U=0;if(void 0!==e.uvs){for(i=0;i<e.uvs.length;i++)e.uvs[i].length&&U++;for(i=0;i<U;i++)r.faceVertexUvs[i]=[]}for(s=0,l=R.length;s<l;)(_=new Ht.Vector3).x=R[s++]*t,_.y=R[s++]*t,_.z=R[s++]*t,r.vertices.push(_);for(s=0,l=D.length;s<l;)if(p=n(f=D[s++],0),m=n(f,1),g=n(f,3),v=n(f,4),y=n(f,5),x=n(f,6),b=n(f,7),p){if((M=new Ht.Face3).a=D[s],M.b=D[s+1],M.c=D[s+3],(S=new Ht.Face3).a=D[s+1],S.b=D[s+2],S.c=D[s+3],s+=4,m&&(d=D[s++],M.materialIndex=d,S.materialIndex=d),a=r.faces.length,g)for(i=0;i<U;i++)for(E=e.uvs[i],r.faceVertexUvs[i][a]=[],r.faceVertexUvs[i][a+1]=[],o=0;o<4;o++)L=E[2*(u=D[s++])],P=E[2*u+1],A=new Ht.Vector2(L,P),2!==o&&r.faceVertexUvs[i][a].push(A),0!==o&&r.faceVertexUvs[i][a+1].push(A);if(v&&(c=3*D[s++],M.normal.set(k[c++],k[c++],k[c]),S.normal.copy(M.normal)),y)for(i=0;i<4;i++)c=3*D[s++],C=new Ht.Vector3(k[c++],k[c++],k[c]),2!==i&&M.vertexNormals.push(C),0!==i&&S.vertexNormals.push(C);if(x&&(T=F[h=D[s++]],M.color.setHex(T),S.color.setHex(T)),b)for(i=0;i<4;i++)T=F[h=D[s++]],2!==i&&M.vertexColors.push(new Ht.Color(T)),0!==i&&S.vertexColors.push(new Ht.Color(T));r.faces.push(M),r.faces.push(S)}else{if((w=new Ht.Face3).a=D[s++],w.b=D[s++],w.c=D[s++],m&&(d=D[s++],w.materialIndex=d),a=r.faces.length,g)for(i=0;i<U;i++)for(E=e.uvs[i],r.faceVertexUvs[i][a]=[],o=0;o<3;o++)L=E[2*(u=D[s++])],P=E[2*u+1],A=new Ht.Vector2(L,P),r.faceVertexUvs[i][a].push(A);if(v&&(c=3*D[s++],w.normal.set(k[c++],k[c++],k[c])),y)for(i=0;i<3;i++)c=3*D[s++],C=new Ht.Vector3(k[c++],k[c++],k[c]),w.vertexNormals.push(C);if(x&&(h=D[s++],w.color.setHex(F[h])),b)for(i=0;i<3;i++)h=D[s++],w.vertexColors.push(new Ht.Color(F[h]));r.faces.push(w)}}(n),function(){var t=void 0!==e.influencesPerVertex?e.influencesPerVertex:2;if(e.skinWeights)for(var n=0,i=e.skinWeights.length;n<i;n+=t){var o=e.skinWeights[n],a=1<t?e.skinWeights[n+1]:0,s=2<t?e.skinWeights[n+2]:0,l=3<t?e.skinWeights[n+3]:0;r.skinWeights.push(new Ht.Vector4(o,a,s,l))}if(e.skinIndices)for(n=0,i=e.skinIndices.length;n<i;n+=t){var h=e.skinIndices[n],c=1<t?e.skinIndices[n+1]:0,u=2<t?e.skinIndices[n+2]:0,d=3<t?e.skinIndices[n+3]:0;r.skinIndices.push(new Ht.Vector4(h,c,u,d))}r.bones=e.bones,r.bones&&0<r.bones.length&&(r.skinWeights.length!==r.skinIndices.length||r.skinIndices.length!==r.vertices.length)&&console.warn("When skinning, number of vertices ("+r.vertices.length+"), skinIndices ("+r.skinIndices.length+"), and skinWeights ("+r.skinWeights.length+") should match."),r.animation=e.animation,r.animations=e.animations}(),function(t){var n,i,o,a,s,l,h,c,u,d,f;if(void 0!==e.morphTargets)for(s=0,l=e.morphTargets.length;s<l;s++)for(r.morphTargets[s]={},r.morphTargets[s].name=e.morphTargets[s].name,r.morphTargets[s].vertices=[],o=r.morphTargets[s].vertices,n=0,i=(a=e.morphTargets[s].vertices).length;n<i;n+=3){var p=new Ht.Vector3;p.x=a[n]*t,p.y=a[n+1]*t,p.z=a[n+2]*t,o.push(p)}if(void 0!==e.morphColors)for(s=0,l=e.morphColors.length;s<l;s++)for(r.morphColors[s]={},r.morphColors[s].name=e.morphColors[s].name,r.morphColors[s].colors=[],u=r.morphColors[s].colors,h=0,c=(d=e.morphColors[s].colors).length;h<c;h+=3)(f=new Ht.Color(16755200)).setRGB(d[h],d[h+1],d[h+2]),u.push(f)}(n),r.computeFaceNormals(),r.computeBoundingSphere(),void 0===e.materials||0===e.materials.length)return{geometry:r};var i=this.initMaterials(e.materials,t);return this.needsTangents(i)&&r.computeTangents(),{geometry:r,materials:i}},Ht.LoadingManager=function(e,t,r){var n=this,i=0,o=0;this.onLoad=e,this.onProgress=t,this.onError=r,this.itemStart=function(e){o++},this.itemEnd=function(e){i++,void 0!==n.onProgress&&n.onProgress(e,i,o),i===o&&void 0!==n.onLoad&&n.onLoad()}},Ht.DefaultLoadingManager=new Ht.LoadingManager,Ht.BufferGeometryLoader=function(e){this.manager=void 0!==e?e:Ht.DefaultLoadingManager},Ht.BufferGeometryLoader.prototype={constructor:Ht.BufferGeometryLoader,load:function(e,t,r,n){var i=this,o=new Ht.XHRLoader;o.setCrossOrigin(this.crossOrigin),o.load(e,function(e){t(i.parse(JSON.parse(e)))},r,n)},setCrossOrigin:function(e){this.crossOrigin=e},parse:function(e){var t=new Ht.BufferGeometry,r=e.attributes;for(var n in r){var i=r[n],o=new self[i.type](i.array);t.addAttribute(n,new Ht.BufferAttribute(o,i.itemSize))}var a=e.offsets;void 0!==a&&(t.offsets=JSON.parse(JSON.stringify(a)));var s=e.boundingSphere;if(void 0!==s){var l=new Ht.Vector3;void 0!==s.center&&l.fromArray(s.center),t.boundingSphere=new Ht.Sphere(l,s.radius)}return t}},Ht.MaterialLoader=function(e){this.manager=void 0!==e?e:Ht.DefaultLoadingManager},Ht.MaterialLoader.prototype={constructor:Ht.MaterialLoader,load:function(e,t,r,n){var i=this,o=new Ht.XHRLoader;o.setCrossOrigin(this.crossOrigin),o.load(e,function(e){t(i.parse(JSON.parse(e)))},r,n)},setCrossOrigin:function(e){this.crossOrigin=e},parse:function(e){var t=new Ht[e.type];if(void 0!==e.color&&t.color.setHex(e.color),void 0!==e.ambient&&t.ambient.setHex(e.ambient),void 0!==e.emissive&&t.emissive.setHex(e.emissive),void 0!==e.specular&&t.specular.setHex(e.specular),void 0!==e.shininess&&(t.shininess=e.shininess),void 0!==e.uniforms&&(t.uniforms=e.uniforms),void 0!==e.vertexShader&&(t.vertexShader=e.vertexShader),void 0!==e.fragmentShader&&(t.fragmentShader=e.fragmentShader),void 0!==e.vertexColors&&(t.vertexColors=e.vertexColors),void 0!==e.shading&&(t.shading=e.shading),void 0!==e.blending&&(t.blending=e.blending),void 0!==e.side&&(t.side=e.side),void 0!==e.opacity&&(t.opacity=e.opacity),void 0!==e.transparent&&(t.transparent=e.transparent),void 0!==e.wireframe&&(t.wireframe=e.wireframe),void 0!==e.materials)for(var r=0,n=e.materials.length;r<n;r++)t.materials.push(this.parse(e.materials[r]));return t}},Ht.ObjectLoader=function(e){this.manager=void 0!==e?e:Ht.DefaultLoadingManager},Ht.ObjectLoader.prototype={constructor:Ht.ObjectLoader,load:function(e,t,r,n){var i=this,o=new Ht.XHRLoader(i.manager);o.setCrossOrigin(this.crossOrigin),o.load(e,function(e){t(i.parse(JSON.parse(e)))},r,n)},setCrossOrigin:function(e){this.crossOrigin=e},parse:function(e){var t=this.parseGeometries(e.geometries),r=this.parseMaterials(e.materials);return this.parseObject(e.object,t,r)},parseGeometries:function(e){var t={};if(void 0!==e)for(var r=new Ht.JSONLoader,n=new Ht.BufferGeometryLoader,i=0,o=e.length;i<o;i++){var a,s=e[i];switch(s.type){case"PlaneGeometry":a=new Ht.PlaneGeometry(s.width,s.height,s.widthSegments,s.heightSegments);break;case"BoxGeometry":case"CubeGeometry":a=new Ht.BoxGeometry(s.width,s.height,s.depth,s.widthSegments,s.heightSegments,s.depthSegments);break;case"CircleGeometry":a=new Ht.CircleGeometry(s.radius,s.segments);break;case"CylinderGeometry":a=new Ht.CylinderGeometry(s.radiusTop,s.radiusBottom,s.height,s.radialSegments,s.heightSegments,s.openEnded);break;case"SphereGeometry":a=new Ht.SphereGeometry(s.radius,s.widthSegments,s.heightSegments,s.phiStart,s.phiLength,s.thetaStart,s.thetaLength);break;case"IcosahedronGeometry":a=new Ht.IcosahedronGeometry(s.radius,s.detail);break;case"TorusGeometry":a=new Ht.TorusGeometry(s.radius,s.tube,s.radialSegments,s.tubularSegments,s.arc);break;case"TorusKnotGeometry":a=new Ht.TorusKnotGeometry(s.radius,s.tube,s.radialSegments,s.tubularSegments,s.p,s.q,s.heightScale);break;case"BufferGeometry":a=n.parse(s.data);break;case"Geometry":a=r.parse(s.data).geometry}a.uuid=s.uuid,void 0!==s.name&&(a.name=s.name),t[s.uuid]=a}return t},parseMaterials:function(e){var t={};if(void 0!==e)for(var r=new Ht.MaterialLoader,n=0,i=e.length;n<i;n++){var o=e[n],a=r.parse(o);a.uuid=o.uuid,void 0!==o.name&&(a.name=o.name),t[o.uuid]=a}return t},parseObject:(Ue=new Ht.Matrix4,function(e,t,r){var n;switch(e.type){case"Scene":n=new Ht.Scene;break;case"PerspectiveCamera":n=new Ht.PerspectiveCamera(e.fov,e.aspect,e.near,e.far);break;case"OrthographicCamera":n=new Ht.OrthographicCamera(e.left,e.right,e.top,e.bottom,e.near,e.far);break;case"AmbientLight":n=new Ht.AmbientLight(e.color);break;case"DirectionalLight":n=new Ht.DirectionalLight(e.color,e.intensity);break;case"PointLight":n=new Ht.PointLight(e.color,e.intensity,e.distance);break;case"SpotLight":n=new Ht.SpotLight(e.color,e.intensity,e.distance,e.angle,e.exponent);break;case"HemisphereLight":n=new Ht.HemisphereLight(e.color,e.groundColor,e.intensity);break;case"Mesh":var i=t[e.geometry],o=r[e.material];void 0===i&&console.warn("THREE.ObjectLoader: Undefined geometry",e.geometry),void 0===o&&console.warn("THREE.ObjectLoader: Undefined material",e.material),n=new Ht.Mesh(i,o);break;case"Line":i=t[e.geometry],o=r[e.material],void 0===i&&console.warn("THREE.ObjectLoader: Undefined geometry",e.geometry),void 0===o&&console.warn("THREE.ObjectLoader: Undefined material",e.material),n=new Ht.Line(i,o);break;case"Sprite":void 0===(o=r[e.material])&&console.warn("THREE.ObjectLoader: Undefined material",e.material),n=new Ht.Sprite(o);break;case"Group":n=new Ht.Group;break;default:n=new Ht.Object3D}if(n.uuid=e.uuid,void 0!==e.name&&(n.name=e.name),void 0!==e.matrix?(Ue.fromArray(e.matrix),Ue.decompose(n.position,n.quaternion,n.scale)):(void 0!==e.position&&n.position.fromArray(e.position),void 0!==e.rotation&&n.rotation.fromArray(e.rotation),void 0!==e.scale&&n.scale.fromArray(e.scale)),void 0!==e.visible&&(n.visible=e.visible),void 0!==e.userData&&(n.userData=e.userData),void 0!==e.children)for(var a in e.children)n.add(this.parseObject(e.children[a],t,r));return n})},Ht.TextureLoader=function(e){this.manager=void 0!==e?e:Ht.DefaultLoadingManager},Ht.TextureLoader.prototype={constructor:Ht.TextureLoader,load:function(e,t,r,n){var i=new Ht.ImageLoader(this.manager);i.setCrossOrigin(this.crossOrigin),i.load(e,function(e){var r=new Ht.Texture(e);r.needsUpdate=!0,void 0!==t&&t(r)},r,n)},setCrossOrigin:function(e){this.crossOrigin=e}},Ht.CompressedTextureLoader=function(){this._parser=null},Ht.CompressedTextureLoader.prototype={constructor:Ht.CompressedTextureLoader,load:function(e,t,r){var n=this,i=[],o=new Ht.CompressedTexture;o.image=i;var a=new Ht.XHRLoader;if(a.setResponseType("arraybuffer"),e instanceof Array)for(var s=0,l=function(r){a.load(e[r],function(e){var a=n._parser(e,!0);i[r]={width:a.width,height:a.height,format:a.format,mipmaps:a.mipmaps},6===(s+=1)&&(1==a.mipmapCount&&(o.minFilter=Ht.LinearFilter),o.format=a.format,o.needsUpdate=!0,t&&t(o))})},h=0,c=e.length;h<c;++h)l(h);else a.load(e,function(e){var r=n._parser(e,!0);if(r.isCubemap)for(var a=r.mipmaps.length/r.mipmapCount,s=0;s<a;s++){i[s]={mipmaps:[]};for(var l=0;l<r.mipmapCount;l++)i[s].mipmaps.push(r.mipmaps[s*r.mipmapCount+l]),i[s].format=r.format,i[s].width=r.width,i[s].height=r.height}else o.image.width=r.width,o.image.height=r.height,o.mipmaps=r.mipmaps;1===r.mipmapCount&&(o.minFilter=Ht.LinearFilter),o.format=r.format,o.needsUpdate=!0,t&&t(o)});return o}},Ht.Material=function(){Object.defineProperty(this,"id",{value:Ht.MaterialIdCount++}),this.uuid=Ht.Math.generateUUID(),this.name="",this.type="Material",this.side=Ht.FrontSide,this.opacity=1,this.transparent=!1,this.blending=Ht.NormalBlending,this.blendSrc=Ht.SrcAlphaFactor,this.blendDst=Ht.OneMinusSrcAlphaFactor,this.blendEquation=Ht.AddEquation,this.depthTest=!0,this.depthWrite=!0,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.alphaTest=0,this.overdraw=0,this.visible=!0,this.needsUpdate=!0},Ht.Material.prototype={constructor:Ht.Material,setValues:function(e){if(void 0!==e)for(var t in e){var r=e[t];if(void 0!==r){if(t in this){var n=this[t];n instanceof Ht.Color?n.set(r):n instanceof Ht.Vector3&&r instanceof Ht.Vector3?n.copy(r):this[t]="overdraw"==t?Number(r):r}}else console.warn("THREE.Material: '"+t+"' parameter is undefined.")}},toJSON:function(){var e={metadata:{version:4.2,type:"material",generator:"MaterialExporter"},uuid:this.uuid,type:this.type};return""!==this.name&&(e.name=this.name),this instanceof Ht.MeshBasicMaterial?(e.color=this.color.getHex(),this.vertexColors!==Ht.NoColors&&(e.vertexColors=this.vertexColors),this.blending!==Ht.NormalBlending&&(e.blending=this.blending),this.side!==Ht.FrontSide&&(e.side=this.side)):this instanceof Ht.MeshLambertMaterial?(e.color=this.color.getHex(),e.ambient=this.ambient.getHex(),e.emissive=this.emissive.getHex(),this.vertexColors!==Ht.NoColors&&(e.vertexColors=this.vertexColors),this.blending!==Ht.NormalBlending&&(e.blending=this.blending),this.side!==Ht.FrontSide&&(e.side=this.side)):this instanceof Ht.MeshPhongMaterial?(e.color=this.color.getHex(),e.ambient=this.ambient.getHex(),e.emissive=this.emissive.getHex(),e.specular=this.specular.getHex(),e.shininess=this.shininess,this.vertexColors!==Ht.NoColors&&(e.vertexColors=this.vertexColors),this.blending!==Ht.NormalBlending&&(e.blending=this.blending),this.side!==Ht.FrontSide&&(e.side=this.side)):this instanceof Ht.MeshNormalMaterial?(this.shading!==Ht.FlatShading&&(e.shading=this.shading),this.blending!==Ht.NormalBlending&&(e.blending=this.blending),this.side!==Ht.FrontSide&&(e.side=this.side)):this instanceof Ht.MeshDepthMaterial?(this.blending!==Ht.NormalBlending&&(e.blending=this.blending),this.side!==Ht.FrontSide&&(e.side=this.side)):this instanceof Ht.ShaderMaterial?(e.uniforms=this.uniforms,e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader):this instanceof Ht.SpriteMaterial&&(e.color=this.color.getHex()),this.opacity<1&&(e.opacity=this.opacity),!1!==this.transparent&&(e.transparent=this.transparent),!1!==this.wireframe&&(e.wireframe=this.wireframe),e},clone:function(e){return void 0===e&&(e=new Ht.Material),e.name=this.name,e.side=this.side,e.opacity=this.opacity,e.transparent=this.transparent,e.blending=this.blending,e.blendSrc=this.blendSrc,e.blendDst=this.blendDst,e.blendEquation=this.blendEquation,e.depthTest=this.depthTest,e.depthWrite=this.depthWrite,e.polygonOffset=this.polygonOffset,e.polygonOffsetFactor=this.polygonOffsetFactor,e.polygonOffsetUnits=this.polygonOffsetUnits,e.alphaTest=this.alphaTest,e.overdraw=this.overdraw,e.visible=this.visible,e},dispose:function(){this.dispatchEvent({type:"dispose"})}},Ht.EventDispatcher.prototype.apply(Ht.Material.prototype),Ht.MaterialIdCount=0,Ht.LineBasicMaterial=function(e){Ht.Material.call(this),this.type="LineBasicMaterial",this.color=new Ht.Color(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.vertexColors=Ht.NoColors,this.fog=!0,this.setValues(e)},Ht.LineBasicMaterial.prototype=Object.create(Ht.Material.prototype),Ht.LineBasicMaterial.prototype.clone=function(){var e=new Ht.LineBasicMaterial;return Ht.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.linewidth=this.linewidth,e.linecap=this.linecap,e.linejoin=this.linejoin,e.vertexColors=this.vertexColors,e.fog=this.fog,e},Ht.LineDashedMaterial=function(e){Ht.Material.call(this),this.type="LineDashedMaterial",this.color=new Ht.Color(16777215),this.linewidth=1,this.scale=1,this.dashSize=3,this.gapSize=1,this.vertexColors=!1,this.fog=!0,this.setValues(e)},Ht.LineDashedMaterial.prototype=Object.create(Ht.Material.prototype),Ht.LineDashedMaterial.prototype.clone=function(){var e=new Ht.LineDashedMaterial;return Ht.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.linewidth=this.linewidth,e.scale=this.scale,e.dashSize=this.dashSize,e.gapSize=this.gapSize,e.vertexColors=this.vertexColors,e.fog=this.fog,e},Ht.MeshBasicMaterial=function(e){Ht.Material.call(this),this.type="MeshBasicMaterial",this.color=new Ht.Color(16777215),this.map=null,this.lightMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Ht.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.shading=Ht.SmoothShading,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.vertexColors=Ht.NoColors,this.skinning=!1,this.morphTargets=!1,this.setValues(e)},Ht.MeshBasicMaterial.prototype=Object.create(Ht.Material.prototype),Ht.MeshBasicMaterial.prototype.clone=function(){var e=new Ht.MeshBasicMaterial;return Ht.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.map=this.map,e.lightMap=this.lightMap,e.specularMap=this.specularMap,e.alphaMap=this.alphaMap,e.envMap=this.envMap,e.combine=this.combine,e.reflectivity=this.reflectivity,e.refractionRatio=this.refractionRatio,e.fog=this.fog,e.shading=this.shading,e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e.wireframeLinecap=this.wireframeLinecap,e.wireframeLinejoin=this.wireframeLinejoin,e.vertexColors=this.vertexColors,e.skinning=this.skinning,e.morphTargets=this.morphTargets,e},Ht.MeshLambertMaterial=function(e){Ht.Material.call(this),this.type="MeshLambertMaterial",this.color=new Ht.Color(16777215),this.ambient=new Ht.Color(16777215),this.emissive=new Ht.Color(0),this.wrapAround=!1,this.wrapRGB=new Ht.Vector3(1,1,1),this.map=null,this.lightMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Ht.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.shading=Ht.SmoothShading,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.vertexColors=Ht.NoColors,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)},Ht.MeshLambertMaterial.prototype=Object.create(Ht.Material.prototype),Ht.MeshLambertMaterial.prototype.clone=function(){var e=new Ht.MeshLambertMaterial;return Ht.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.ambient.copy(this.ambient),e.emissive.copy(this.emissive),e.wrapAround=this.wrapAround,e.wrapRGB.copy(this.wrapRGB),e.map=this.map,e.lightMap=this.lightMap,e.specularMap=this.specularMap,e.alphaMap=this.alphaMap,e.envMap=this.envMap,e.combine=this.combine,e.reflectivity=this.reflectivity,e.refractionRatio=this.refractionRatio,e.fog=this.fog,e.shading=this.shading,e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e.wireframeLinecap=this.wireframeLinecap,e.wireframeLinejoin=this.wireframeLinejoin,e.vertexColors=this.vertexColors,e.skinning=this.skinning,e.morphTargets=this.morphTargets,e.morphNormals=this.morphNormals,e},Ht.MeshPhongMaterial=function(e){Ht.Material.call(this),this.type="MeshPhongMaterial",this.color=new Ht.Color(16777215),this.ambient=new Ht.Color(16777215),this.emissive=new Ht.Color(0),this.specular=new Ht.Color(1118481),this.shininess=30,this.metal=!1,this.wrapAround=!1,this.wrapRGB=new Ht.Vector3(1,1,1),this.map=null,this.lightMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalScale=new Ht.Vector2(1,1),this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Ht.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.shading=Ht.SmoothShading,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.vertexColors=Ht.NoColors,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)},Ht.MeshPhongMaterial.prototype=Object.create(Ht.Material.prototype),Ht.MeshPhongMaterial.prototype.clone=function(){var e=new Ht.MeshPhongMaterial;return Ht.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.ambient.copy(this.ambient),e.emissive.copy(this.emissive),e.specular.copy(this.specular),e.shininess=this.shininess,e.metal=this.metal,e.wrapAround=this.wrapAround,e.wrapRGB.copy(this.wrapRGB),e.map=this.map,e.lightMap=this.lightMap,e.bumpMap=this.bumpMap,e.bumpScale=this.bumpScale,e.normalMap=this.normalMap,e.normalScale.copy(this.normalScale),e.specularMap=this.specularMap,e.alphaMap=this.alphaMap,e.envMap=this.envMap,e.combine=this.combine,e.reflectivity=this.reflectivity,e.refractionRatio=this.refractionRatio,e.fog=this.fog,e.shading=this.shading,e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e.wireframeLinecap=this.wireframeLinecap,e.wireframeLinejoin=this.wireframeLinejoin,e.vertexColors=this.vertexColors,e.skinning=this.skinning,e.morphTargets=this.morphTargets,e.morphNormals=this.morphNormals,e},Ht.MeshDepthMaterial=function(e){Ht.Material.call(this),this.type="MeshDepthMaterial",this.morphTargets=!1,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)},Ht.MeshDepthMaterial.prototype=Object.create(Ht.Material.prototype),Ht.MeshDepthMaterial.prototype.clone=function(){var e=new Ht.MeshDepthMaterial;return Ht.Material.prototype.clone.call(this,e),e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e},Ht.MeshNormalMaterial=function(e){Ht.Material.call(this,e),this.type="MeshNormalMaterial",this.shading=Ht.FlatShading,this.wireframe=!1,this.wireframeLinewidth=1,this.morphTargets=!1,this.setValues(e)},Ht.MeshNormalMaterial.prototype=Object.create(Ht.Material.prototype),Ht.MeshNormalMaterial.prototype.clone=function(){var e=new Ht.MeshNormalMaterial;return Ht.Material.prototype.clone.call(this,e),e.shading=this.shading,e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e},Ht.MeshFaceMaterial=function(e){this.uuid=Ht.Math.generateUUID(),this.type="MeshFaceMaterial",this.materials=e instanceof Array?e:[]},Ht.MeshFaceMaterial.prototype={constructor:Ht.MeshFaceMaterial,toJSON:function(){for(var e={metadata:{version:4.2,type:"material",generator:"MaterialExporter"},uuid:this.uuid,type:this.type,materials:[]},t=0,r=this.materials.length;t<r;t++)e.materials.push(this.materials[t].toJSON());return e},clone:function(){for(var e=new Ht.MeshFaceMaterial,t=0;t<this.materials.length;t++)e.materials.push(this.materials[t].clone());return e}},Ht.PointCloudMaterial=function(e){Ht.Material.call(this),this.type="PointCloudMaterial",this.color=new Ht.Color(16777215),this.map=null,this.size=1,this.sizeAttenuation=!0,this.vertexColors=Ht.NoColors,this.fog=!0,this.setValues(e)},Ht.PointCloudMaterial.prototype=Object.create(Ht.Material.prototype),Ht.PointCloudMaterial.prototype.clone=function(){var e=new Ht.PointCloudMaterial;return Ht.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.map=this.map,e.size=this.size,e.sizeAttenuation=this.sizeAttenuation,e.vertexColors=this.vertexColors,e.fog=this.fog,e},Ht.ParticleBasicMaterial=function(e){return console.warn("THREE.ParticleBasicMaterial has been renamed to THREE.PointCloudMaterial."),new Ht.PointCloudMaterial(e)},Ht.ParticleSystemMaterial=function(e){return console.warn("THREE.ParticleSystemMaterial has been renamed to THREE.PointCloudMaterial."),new Ht.PointCloudMaterial(e)},Ht.ShaderMaterial=function(e){Ht.Material.call(this),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.attributes=null,this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.shading=Ht.SmoothShading,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.vertexColors=Ht.NoColors,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.setValues(e)},Ht.ShaderMaterial.prototype=Object.create(Ht.Material.prototype),Ht.ShaderMaterial.prototype.clone=function(){var e=new Ht.ShaderMaterial;return Ht.Material.prototype.clone.call(this,e),e.fragmentShader=this.fragmentShader,e.vertexShader=this.vertexShader,e.uniforms=Ht.UniformsUtils.clone(this.uniforms),e.attributes=this.attributes,e.defines=this.defines,e.shading=this.shading,e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e.fog=this.fog,e.lights=this.lights,e.vertexColors=this.vertexColors,e.skinning=this.skinning,e.morphTargets=this.morphTargets,e.morphNormals=this.morphNormals,e},Ht.RawShaderMaterial=function(e){Ht.ShaderMaterial.call(this,e),this.type="RawShaderMaterial"},Ht.RawShaderMaterial.prototype=Object.create(Ht.ShaderMaterial.prototype),Ht.RawShaderMaterial.prototype.clone=function(){var e=new Ht.RawShaderMaterial;return Ht.ShaderMaterial.prototype.clone.call(this,e),e},Ht.SpriteMaterial=function(e){Ht.Material.call(this),this.type="SpriteMaterial",this.color=new Ht.Color(16777215),this.map=null,this.rotation=0,this.fog=!1,this.setValues(e)},Ht.SpriteMaterial.prototype=Object.create(Ht.Material.prototype),Ht.SpriteMaterial.prototype.clone=function(){var e=new Ht.SpriteMaterial;return Ht.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.map=this.map,e.rotation=this.rotation,e.fog=this.fog,e},Ht.Texture=function(e,t,r,n,i,o,a,s,l){Object.defineProperty(this,"id",{value:Ht.TextureIdCount++}),this.uuid=Ht.Math.generateUUID(),this.name="",this.image=void 0!==e?e:Ht.Texture.DEFAULT_IMAGE,this.mipmaps=[],this.mapping=void 0!==t?t:Ht.Texture.DEFAULT_MAPPING,this.wrapS=void 0!==r?r:Ht.ClampToEdgeWrapping,this.wrapT=void 0!==n?n:Ht.ClampToEdgeWrapping,this.magFilter=void 0!==i?i:Ht.LinearFilter,this.minFilter=void 0!==o?o:Ht.LinearMipMapLinearFilter,this.anisotropy=void 0!==l?l:1,this.format=void 0!==a?a:Ht.RGBAFormat,this.type=void 0!==s?s:Ht.UnsignedByteType,this.offset=new Ht.Vector2(0,0),this.repeat=new Ht.Vector2(1,1),this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this._needsUpdate=!1,this.onUpdate=null},Ht.Texture.DEFAULT_IMAGE=void 0,Ht.Texture.DEFAULT_MAPPING=new Ht.UVMapping,Ht.Texture.prototype={constructor:Ht.Texture,get needsUpdate(){return this._needsUpdate},set needsUpdate(e){!0===e&&this.update(),this._needsUpdate=e},clone:function(e){return void 0===e&&(e=new Ht.Texture),e.image=this.image,e.mipmaps=this.mipmaps.slice(0),e.mapping=this.mapping,e.wrapS=this.wrapS,e.wrapT=this.wrapT,e.magFilter=this.magFilter,e.minFilter=this.minFilter,e.anisotropy=this.anisotropy,e.format=this.format,e.type=this.type,e.offset.copy(this.offset),e.repeat.copy(this.repeat),e.generateMipmaps=this.generateMipmaps,e.premultiplyAlpha=this.premultiplyAlpha,e.flipY=this.flipY,e.unpackAlignment=this.unpackAlignment,e},update:function(){this.dispatchEvent({type:"update"})},dispose:function(){this.dispatchEvent({type:"dispose"})}},Ht.EventDispatcher.prototype.apply(Ht.Texture.prototype),Ht.TextureIdCount=0,Ht.CubeTexture=function(e,t,r,n,i,o,a,s,l){Ht.Texture.call(this,e,t,r,n,i,o,a,s,l),this.images=e},Ht.CubeTexture.prototype=Object.create(Ht.Texture.prototype),Ht.CubeTexture.clone=function(e){return void 0===e&&(e=new Ht.CubeTexture),Ht.Texture.prototype.clone.call(this,e),e.images=this.images,e},Ht.CompressedTexture=function(e,t,r,n,i,o,a,s,l,h,c){Ht.Texture.call(this,null,o,a,s,l,h,n,i,c),this.image={width:t,height:r},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1},Ht.CompressedTexture.prototype=Object.create(Ht.Texture.prototype),Ht.CompressedTexture.prototype.clone=function(){var e=new Ht.CompressedTexture;return Ht.Texture.prototype.clone.call(this,e),e},Ht.DataTexture=function(e,t,r,n,i,o,a,s,l,h,c){Ht.Texture.call(this,null,o,a,s,l,h,n,i,c),this.image={data:e,width:t,height:r}},Ht.DataTexture.prototype=Object.create(Ht.Texture.prototype),Ht.DataTexture.prototype.clone=function(){var e=new Ht.DataTexture;return Ht.Texture.prototype.clone.call(this,e),e},Ht.VideoTexture=function(e,t,r,n,i,o,a,s,l){Ht.Texture.call(this,e,t,r,n,i,o,a,s,l),this.generateMipmaps=!1;var h=this;!function t(){requestAnimationFrame(t),e.readyState===e.HAVE_ENOUGH_DATA&&(h.needsUpdate=!0)}()},Ht.VideoTexture.prototype=Object.create(Ht.Texture.prototype),Ht.Group=function(){Ht.Object3D.call(this),this.type="Group"},Ht.Group.prototype=Object.create(Ht.Object3D.prototype),Ht.PointCloud=function(e,t){Ht.Object3D.call(this),this.type="PointCloud",this.geometry=void 0!==e?e:new Ht.Geometry,this.material=void 0!==t?t:new Ht.PointCloudMaterial({color:16777215*Math.random()}),this.sortParticles=!1},Ht.PointCloud.prototype=Object.create(Ht.Object3D.prototype),Ht.PointCloud.prototype.raycast=(Ne=new Ht.Matrix4,Be=new Ht.Ray,function(e,t){var r=this,n=r.geometry,i=e.params.PointCloud.threshold;if(Ne.getInverse(this.matrixWorld),Be.copy(e.ray).applyMatrix4(Ne),null===n.boundingBox||!1!==Be.isIntersectionBox(n.boundingBox)){var o=i/((this.scale.x+this.scale.y+this.scale.z)/3),a=new Ht.Vector3,s=function(n,i){var a=Be.distanceToPoint(n);if(a<o){var s=Be.closestPointToPoint(n);s.applyMatrix4(r.matrixWorld);var l=e.ray.origin.distanceTo(s);t.push({distance:l,distanceToRay:a,point:s.clone(),index:i,face:null,object:r})}};if(n instanceof Ht.BufferGeometry){var l=n.attributes,h=l.position.array;if(void 0!==l.index){var c=l.index.array,u=n.offsets;0===u.length&&(u=[{start:0,count:c.length,index:0}]);for(var d=0,f=u.length;d<f;++d)for(var p=u[d].start,m=u[d].count,g=u[d].index,v=p,y=p+m;v<y;v++){var x=g+c[v];a.fromArray(h,3*x),s(a,x)}}else{var b=h.length/3;for(v=0;v<b;v++)a.set(h[3*v],h[3*v+1],h[3*v+2]),s(a,v)}}else{var _=this.geometry.vertices;for(v=0;v<_.length;v++)s(_[v],v)}}}),Ht.PointCloud.prototype.clone=function(e){return void 0===e&&(e=new Ht.PointCloud(this.geometry,this.material)),e.sortParticles=this.sortParticles,Ht.Object3D.prototype.clone.call(this,e),e},Ht.ParticleSystem=function(e,t){return console.warn("THREE.ParticleSystem has been renamed to THREE.PointCloud."),new Ht.PointCloud(e,t)},Ht.Line=function(e,t,r){Ht.Object3D.call(this),this.type="Line",this.geometry=void 0!==e?e:new Ht.Geometry,this.material=void 0!==t?t:new Ht.LineBasicMaterial({color:16777215*Math.random()}),this.mode=void 0!==r?r:Ht.LineStrip},Ht.LineStrip=0,Ht.LinePieces=1,Ht.Line.prototype=Object.create(Ht.Object3D.prototype),Ht.Line.prototype.raycast=(Ve=new Ht.Matrix4,ze=new Ht.Ray,Oe=new Ht.Sphere,function(e,t){var r=e.linePrecision,n=r*r,i=this.geometry;if(null===i.boundingSphere&&i.computeBoundingSphere(),Oe.copy(i.boundingSphere),Oe.applyMatrix4(this.matrixWorld),!1!==e.ray.isIntersectionSphere(Oe)&&(Ve.getInverse(this.matrixWorld),ze.copy(e.ray).applyMatrix4(Ve),i instanceof Ht.Geometry))for(var o=i.vertices,a=o.length,s=new Ht.Vector3,l=new Ht.Vector3,h=this.mode===Ht.LineStrip?1:2,c=0;c<a-1;c+=h)if(!(n<ze.distanceSqToSegment(o[c],o[c+1],l,s))){var u=ze.origin.distanceTo(l);u<e.near||u>e.far||t.push({distance:u,point:s.clone().applyMatrix4(this.matrixWorld),face:null,faceIndex:null,object:this})}}),Ht.Line.prototype.clone=function(e){return void 0===e&&(e=new Ht.Line(this.geometry,this.material,this.mode)),Ht.Object3D.prototype.clone.call(this,e),e},Ht.Mesh=function(e,t){Ht.Object3D.call(this),this.type="Mesh",this.geometry=void 0!==e?e:new Ht.Geometry,this.material=void 0!==t?t:new Ht.MeshBasicMaterial({color:16777215*Math.random()}),this.updateMorphTargets()},Ht.Mesh.prototype=Object.create(Ht.Object3D.prototype),Ht.Mesh.prototype.updateMorphTargets=function(){if(void 0!==this.geometry.morphTargets&&0<this.geometry.morphTargets.length){this.morphTargetBase=-1,this.morphTargetForcedOrder=[],this.morphTargetInfluences=[],this.morphTargetDictionary={};for(var e=0,t=this.geometry.morphTargets.length;e<t;e++)this.morphTargetInfluences.push(0),this.morphTargetDictionary[this.geometry.morphTargets[e].name]=e}},Ht.Mesh.prototype.getMorphTargetIndexByName=function(e){return void 0!==this.morphTargetDictionary[e]?this.morphTargetDictionary[e]:(console.log("THREE.Mesh.getMorphTargetIndexByName: morph target "+e+" does not exist. Returning 0."),0)},Ht.Mesh.prototype.raycast=(Ie=new Ht.Matrix4,He=new Ht.Ray,Ge=new Ht.Sphere,We=new Ht.Vector3,je=new Ht.Vector3,Xe=new Ht.Vector3,function(e,t){var r=this.geometry;if(null===r.boundingSphere&&r.computeBoundingSphere(),Ge.copy(r.boundingSphere),Ge.applyMatrix4(this.matrixWorld),!1!==e.ray.isIntersectionSphere(Ge)&&(Ie.getInverse(this.matrixWorld),He.copy(e.ray).applyMatrix4(Ie),null===r.boundingBox||!1!==He.isIntersectionBox(r.boundingBox)))if(r instanceof Ht.BufferGeometry){if(void 0===(T=this.material))return;var n=r.attributes,i=e.precision;if(void 0!==n.index){var o=n.index.array,a=n.position.array,s=r.offsets;0===s.length&&(s=[{start:0,count:o.length,index:0}]);for(var l=0,h=s.length;l<h;++l)for(var c=s[l].start,u=s[l].count,d=s[l].index,f=c,p=c+u;f<p;f+=3){if(v=d+o[f],y=d+o[f+1],x=d+o[f+2],We.fromArray(a,3*v),je.fromArray(a,3*y),Xe.fromArray(a,3*x),T.side===Ht.BackSide)var m=He.intersectTriangle(Xe,je,We,!0);else m=He.intersectTriangle(We,je,Xe,T.side!==Ht.DoubleSide);null!==m&&(m.applyMatrix4(this.matrixWorld),(k=e.ray.origin.distanceTo(m))<i||k<e.near||k>e.far||t.push({distance:k,point:m,face:new Ht.Face3(v,y,x,Ht.Triangle.normal(We,je,Xe)),faceIndex:null,object:this}))}}else{var g=f=0;for(p=(a=n.position.array).length;f<p;f+=3,g+=9)y=(v=f)+1,x=f+2,We.fromArray(a,g),je.fromArray(a,g+3),Xe.fromArray(a,g+6),null!==(m=T.side===Ht.BackSide?He.intersectTriangle(Xe,je,We,!0):He.intersectTriangle(We,je,Xe,T.side!==Ht.DoubleSide))&&(m.applyMatrix4(this.matrixWorld),(k=e.ray.origin.distanceTo(m))<i||k<e.near||k>e.far||t.push({distance:k,point:m,face:new Ht.Face3(v,y,x,Ht.Triangle.normal(We,je,Xe)),faceIndex:null,object:this}))}}else if(r instanceof Ht.Geometry)for(var v,y,x,b=this.material instanceof Ht.MeshFaceMaterial,_=!0===b?this.material.materials:null,w=(i=e.precision,r.vertices),M=0,S=r.faces.length;M<S;M++){var T,C=r.faces[M];if(void 0!==(T=!0===b?_[C.materialIndex]:this.material)){if(v=w[C.a],y=w[C.b],x=w[C.c],!0===T.morphTargets){var E=r.morphTargets,A=this.morphTargetInfluences;We.set(0,0,0),je.set(0,0,0),Xe.set(0,0,0);for(var L=0,P=E.length;L<P;L++){var D=A[L];if(0!==D){var R=E[L].vertices;We.x+=(R[C.a].x-v.x)*D,We.y+=(R[C.a].y-v.y)*D,We.z+=(R[C.a].z-v.z)*D,je.x+=(R[C.b].x-y.x)*D,je.y+=(R[C.b].y-y.y)*D,je.z+=(R[C.b].z-y.z)*D,Xe.x+=(R[C.c].x-x.x)*D,Xe.y+=(R[C.c].y-x.y)*D,Xe.z+=(R[C.c].z-x.z)*D}}We.add(v),je.add(y),Xe.add(x),v=We,y=je,x=Xe}var k;null!==(m=T.side===Ht.BackSide?He.intersectTriangle(x,y,v,!0):He.intersectTriangle(v,y,x,T.side!==Ht.DoubleSide))&&(m.applyMatrix4(this.matrixWorld),(k=e.ray.origin.distanceTo(m))<i||k<e.near||k>e.far||t.push({distance:k,point:m,face:C,faceIndex:M,object:this}))}}}),Ht.Mesh.prototype.clone=function(e,t){return void 0===e&&(e=new Ht.Mesh(this.geometry,this.material)),Ht.Object3D.prototype.clone.call(this,e,t),e},Ht.Bone=function(e){Ht.Object3D.call(this),this.skin=e},Ht.Bone.prototype=Object.create(Ht.Object3D.prototype),Ht.Skeleton=function(e,t,r){var n;if(this.useVertexTexture=void 0===r||r,this.identityMatrix=new Ht.Matrix4,e=e||[],this.bones=e.slice(0),this.useVertexTexture?(n=256<this.bones.length?64:64<this.bones.length?32:16<this.bones.length?16:8,this.boneTextureWidth=n,this.boneTextureHeight=n,this.boneMatrices=new Float32Array(this.boneTextureWidth*this.boneTextureHeight*4),this.boneTexture=new Ht.DataTexture(this.boneMatrices,this.boneTextureWidth,this.boneTextureHeight,Ht.RGBAFormat,Ht.FloatType),this.boneTexture.minFilter=Ht.NearestFilter,this.boneTexture.magFilter=Ht.NearestFilter,this.boneTexture.generateMipmaps=!1,this.boneTexture.flipY=!1):this.boneMatrices=new Float32Array(16*this.bones.length),void 0===t)this.calculateInverses();else if(this.bones.length===t.length)this.boneInverses=t.slice(0);else{console.warn("THREE.Skeleton bonInverses is the wrong length."),this.boneInverses=[];for(var i=0,o=this.bones.length;i<o;i++)this.boneInverses.push(new Ht.Matrix4)}},Ht.Skeleton.prototype.calculateInverses=function(){this.boneInverses=[];for(var e=0,t=this.bones.length;e<t;e++){var r=new Ht.Matrix4;this.bones[e]&&r.getInverse(this.bones[e].matrixWorld),this.boneInverses.push(r)}},Ht.Skeleton.prototype.pose=function(){for(var e,t=0,r=this.bones.length;t<r;t++)(e=this.bones[t])&&e.matrixWorld.getInverse(this.boneInverses[t]);for(t=0,r=this.bones.length;t<r;t++)(e=this.bones[t])&&(e.parent?(e.matrix.getInverse(e.parent.matrixWorld),e.matrix.multiply(e.matrixWorld)):e.matrix.copy(e.matrixWorld),e.matrix.decompose(e.position,e.quaternion,e.scale))},Ht.Skeleton.prototype.update=(qe=new Ht.Matrix4,function(){for(var e=0,t=this.bones.length;e<t;e++){var r=this.bones[e]?this.bones[e].matrixWorld:this.identityMatrix;qe.multiplyMatrices(r,this.boneInverses[e]),qe.flattenToArrayOffset(this.boneMatrices,16*e)}this.useVertexTexture&&(this.boneTexture.needsUpdate=!0)}),Ht.SkinnedMesh=function(e,t,r){Ht.Mesh.call(this,e,t),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new Ht.Matrix4,this.bindMatrixInverse=new Ht.Matrix4;var n=[];if(this.geometry&&void 0!==this.geometry.bones){for(var i,o,a,s,l,h=0,c=this.geometry.bones.length;h<c;++h)a=(o=this.geometry.bones[h]).pos,s=o.rotq,l=o.scl,i=new Ht.Bone(this),n.push(i),i.name=o.name,i.position.set(a[0],a[1],a[2]),i.quaternion.set(s[0],s[1],s[2],s[3]),void 0!==l?i.scale.set(l[0],l[1],l[2]):i.scale.set(1,1,1);for(h=0,c=this.geometry.bones.length;h<c;++h)-1!==(o=this.geometry.bones[h]).parent?n[o.parent].add(n[h]):this.add(n[h])}this.normalizeSkinWeights(),this.updateMatrixWorld(!0),this.bind(new Ht.Skeleton(n,void 0,r))},Ht.SkinnedMesh.prototype=Object.create(Ht.Mesh.prototype),Ht.SkinnedMesh.prototype.bind=function(e,t){this.skeleton=e,void 0===t&&(this.updateMatrixWorld(!0),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.getInverse(t)},Ht.SkinnedMesh.prototype.pose=function(){this.skeleton.pose()},Ht.SkinnedMesh.prototype.normalizeSkinWeights=function(){if(this.geometry instanceof Ht.Geometry)for(var e=0;e<this.geometry.skinIndices.length;e++){var t=this.geometry.skinWeights[e],r=1/t.lengthManhattan();r!==1/0?t.multiplyScalar(r):t.set(1)}},Ht.SkinnedMesh.prototype.updateMatrixWorld=function(e){Ht.Mesh.prototype.updateMatrixWorld.call(this,!0),"attached"===this.bindMode?this.bindMatrixInverse.getInverse(this.matrixWorld):"detached"===this.bindMode?this.bindMatrixInverse.getInverse(this.bindMatrix):console.warn("THREE.SkinnedMesh unreckognized bindMode: "+this.bindMode)},Ht.SkinnedMesh.prototype.clone=function(e){return void 0===e&&(e=new Ht.SkinnedMesh(this.geometry,this.material,this.useVertexTexture)),Ht.Mesh.prototype.clone.call(this,e),e},Ht.MorphAnimMesh=function(e,t){Ht.Mesh.call(this,e,t),this.type="MorphAnimMesh",this.duration=1e3,this.mirroredLoop=!1,this.time=0,this.lastKeyframe=0,this.currentKeyframe=0,this.direction=1,this.directionBackwards=!1,this.setFrameRange(0,this.geometry.morphTargets.length-1)},Ht.MorphAnimMesh.prototype=Object.create(Ht.Mesh.prototype),Ht.MorphAnimMesh.prototype.setFrameRange=function(e,t){this.startKeyframe=e,this.endKeyframe=t,this.length=this.endKeyframe-this.startKeyframe+1},Ht.MorphAnimMesh.prototype.setDirectionForward=function(){this.direction=1,this.directionBackwards=!1},Ht.MorphAnimMesh.prototype.setDirectionBackward=function(){this.direction=-1,this.directionBackwards=!0},Ht.MorphAnimMesh.prototype.parseAnimations=function(){var e=this.geometry;e.animations||(e.animations={});for(var t,r=e.animations,n=/([a-z]+)_?(\d+)/,i=0,o=e.morphTargets.length;i<o;i++){var a=e.morphTargets[i].name.match(n);if(a&&1<a.length){var s=a[1];a[2],r[s]||(r[s]={start:1/0,end:-1/0});var l=r[s];i<l.start&&(l.start=i),i>l.end&&(l.end=i),t||(t=s)}}e.firstAnimation=t},Ht.MorphAnimMesh.prototype.setAnimationLabel=function(e,t,r){this.geometry.animations||(this.geometry.animations={}),this.geometry.animations[e]={start:t,end:r}},Ht.MorphAnimMesh.prototype.playAnimation=function(e,t){var r=this.geometry.animations[e];r?(this.setFrameRange(r.start,r.end),this.duration=(r.end-r.start)/t*1e3,this.time=0):console.warn("animation["+e+"] undefined")},Ht.MorphAnimMesh.prototype.updateAnimation=function(e){var t=this.duration/this.length;this.time+=this.direction*e,this.mirroredLoop?(this.time>this.duration||this.time<0)&&(this.direction*=-1,this.time>this.duration&&(this.time=this.duration,this.directionBackwards=!0),this.time<0&&(this.time=0,this.directionBackwards=!1)):(this.time=this.time%this.duration,this.time<0&&(this.time+=this.duration));var r=this.startKeyframe+Ht.Math.clamp(Math.floor(this.time/t),0,this.length-1);r!==this.currentKeyframe&&(this.morphTargetInfluences[this.lastKeyframe]=0,this.morphTargetInfluences[this.currentKeyframe]=1,this.morphTargetInfluences[r]=0,this.lastKeyframe=this.currentKeyframe,this.currentKeyframe=r);var n=this.time%t/t;this.directionBackwards&&(n=1-n),this.morphTargetInfluences[this.currentKeyframe]=n,this.morphTargetInfluences[this.lastKeyframe]=1-n},Ht.MorphAnimMesh.prototype.interpolateTargets=function(e,t,r){for(var n=this.morphTargetInfluences,i=0,o=n.length;i<o;i++)n[i]=0;-1<e&&(n[e]=1-r),-1<t&&(n[t]=r)},Ht.MorphAnimMesh.prototype.clone=function(e){return void 0===e&&(e=new Ht.MorphAnimMesh(this.geometry,this.material)),e.duration=this.duration,e.mirroredLoop=this.mirroredLoop,e.time=this.time,e.lastKeyframe=this.lastKeyframe,e.currentKeyframe=this.currentKeyframe,e.direction=this.direction,e.directionBackwards=this.directionBackwards,Ht.Mesh.prototype.clone.call(this,e),e},Ht.LOD=function(){Ht.Object3D.call(this),this.objects=[]},Ht.LOD.prototype=Object.create(Ht.Object3D.prototype),Ht.LOD.prototype.addLevel=function(e,t){void 0===t&&(t=0),t=Math.abs(t);for(var r=0;r<this.objects.length&&!(t<this.objects[r].distance);r++);this.objects.splice(r,0,{distance:t,object:e}),this.add(e)},Ht.LOD.prototype.getObjectForDistance=function(e){for(var t=1,r=this.objects.length;t<r&&!(e<this.objects[t].distance);t++);return this.objects[t-1].object},Ht.LOD.prototype.raycast=(Ye=new Ht.Vector3,function(e,t){Ye.setFromMatrixPosition(this.matrixWorld);var r=e.ray.origin.distanceTo(Ye);this.getObjectForDistance(r).raycast(e,t)}),Ht.LOD.prototype.update=(Ke=new Ht.Vector3,Qe=new Ht.Vector3,function(e){if(1<this.objects.length){Ke.setFromMatrixPosition(e.matrixWorld),Qe.setFromMatrixPosition(this.matrixWorld);var t=Ke.distanceTo(Qe);this.objects[0].object.visible=!0;for(var r=1,n=this.objects.length;r<n&&t>=this.objects[r].distance;r++)this.objects[r-1].object.visible=!1,this.objects[r].object.visible=!0;for(;r<n;r++)this.objects[r].object.visible=!1}}),Ht.LOD.prototype.clone=function(e){void 0===e&&(e=new Ht.LOD),Ht.Object3D.prototype.clone.call(this,e);for(var t=0,r=this.objects.length;t<r;t++){var n=this.objects[t].object.clone();n.visible=0===t,e.addLevel(n,this.objects[t].distance)}return e},Ht.Sprite=(Ze=new Uint16Array([0,1,2,0,2,3]),$e=new Float32Array([-.5,-.5,0,.5,-.5,0,.5,.5,0,-.5,.5,0]),Je=new Float32Array([0,0,1,0,1,1,0,1]),(et=new Ht.BufferGeometry).addAttribute("index",new Ht.BufferAttribute(Ze,1)),et.addAttribute("position",new Ht.BufferAttribute($e,3)),et.addAttribute("uv",new Ht.BufferAttribute(Je,2)),function(e){Ht.Object3D.call(this),this.type="Sprite",this.geometry=et,this.material=void 0!==e?e:new Ht.SpriteMaterial}),Ht.Sprite.prototype=Object.create(Ht.Object3D.prototype),Ht.Sprite.prototype.raycast=(tt=new Ht.Vector3,function(e,t){tt.setFromMatrixPosition(this.matrixWorld);var r=e.ray.distanceToPoint(tt);r>this.scale.x||t.push({distance:r,point:this.position,face:null,object:this})}),Ht.Sprite.prototype.clone=function(e){return void 0===e&&(e=new Ht.Sprite(this.material)),Ht.Object3D.prototype.clone.call(this,e),e},Ht.Particle=Ht.Sprite,Ht.LensFlare=function(e,t,r,n,i){Ht.Object3D.call(this),this.lensFlares=[],this.positionScreen=new Ht.Vector3,(this.customUpdateCallback=void 0)!==e&&this.add(e,t,r,n,i)},Ht.LensFlare.prototype=Object.create(Ht.Object3D.prototype),Ht.LensFlare.prototype.add=function(e,t,r,n,i,o){void 0===t&&(t=-1),void 0===r&&(r=0),void 0===o&&(o=1),void 0===i&&(i=new Ht.Color(16777215)),void 0===n&&(n=Ht.NormalBlending),r=Math.min(r,Math.max(0,r)),this.lensFlares.push({texture:e,size:t,distance:r,x:0,y:0,z:0,scale:1,rotation:1,opacity:o,color:i,blending:n})},Ht.LensFlare.prototype.updateLensFlares=function(){var e,t,r=this.lensFlares.length,n=2*-this.positionScreen.x,i=2*-this.positionScreen.y;for(e=0;e<r;e++)(t=this.lensFlares[e]).x=this.positionScreen.x+n*t.distance,t.y=this.positionScreen.y+i*t.distance,t.wantedRotation=t.x*Math.PI*.25,t.rotation+=.25*(t.wantedRotation-t.rotation)},Ht.Scene=function(){Ht.Object3D.call(this),this.type="Scene",this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0},Ht.Scene.prototype=Object.create(Ht.Object3D.prototype),Ht.Scene.prototype.clone=function(e){return void 0===e&&(e=new Ht.Scene),Ht.Object3D.prototype.clone.call(this,e),null!==this.fog&&(e.fog=this.fog.clone()),null!==this.overrideMaterial&&(e.overrideMaterial=this.overrideMaterial.clone()),e.autoUpdate=this.autoUpdate,e.matrixAutoUpdate=this.matrixAutoUpdate,e},Ht.Fog=function(e,t,r){this.name="",this.color=new Ht.Color(e),this.near=void 0!==t?t:1,this.far=void 0!==r?r:1e3},Ht.Fog.prototype.clone=function(){return new Ht.Fog(this.color.getHex(),this.near,this.far)},Ht.FogExp2=function(e,t){this.name="",this.color=new Ht.Color(e),this.density=void 0!==t?t:25e-5},Ht.FogExp2.prototype.clone=function(){return new Ht.FogExp2(this.color.getHex(),this.density)},Ht.ShaderChunk={},Ht.ShaderChunk.alphatest_fragment="#ifdef ALPHATEST\n\n\tif ( gl_FragColor.a < ALPHATEST ) discard;\n\n#endif\n",Ht.ShaderChunk.lights_lambert_vertex="vLightFront = vec3( 0.0 );\n\n#ifdef DOUBLE_SIDED\n\n\tvLightBack = vec3( 0.0 );\n\n#endif\n\ntransformedNormal = normalize( transformedNormal );\n\n#if MAX_DIR_LIGHTS > 0\n\nfor( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {\n\n\tvec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\n\tvec3 dirVector = normalize( lDirection.xyz );\n\n\tfloat dotProduct = dot( transformedNormal, dirVector );\n\tvec3 directionalLightWeighting = vec3( max( dotProduct, 0.0 ) );\n\n\t#ifdef DOUBLE_SIDED\n\n\t\tvec3 directionalLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );\n\n\t\t#ifdef WRAP_AROUND\n\n\t\t\tvec3 directionalLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );\n\n\t\t#endif\n\n\t#endif\n\n\t#ifdef WRAP_AROUND\n\n\t\tvec3 directionalLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );\n\t\tdirectionalLightWeighting = mix( directionalLightWeighting, directionalLightWeightingHalf, wrapRGB );\n\n\t\t#ifdef DOUBLE_SIDED\n\n\t\t\tdirectionalLightWeightingBack = mix( directionalLightWeightingBack, directionalLightWeightingHalfBack, wrapRGB );\n\n\t\t#endif\n\n\t#endif\n\n\tvLightFront += directionalLightColor[ i ] * directionalLightWeighting;\n\n\t#ifdef DOUBLE_SIDED\n\n\t\tvLightBack += directionalLightColor[ i ] * directionalLightWeightingBack;\n\n\t#endif\n\n}\n\n#endif\n\n#if MAX_POINT_LIGHTS > 0\n\n\tfor( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\n\n\t\tvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\n\t\tvec3 lVector = lPosition.xyz - mvPosition.xyz;\n\n\t\tfloat lDistance = 1.0;\n\t\tif ( pointLightDistance[ i ] > 0.0 )\n\t\t\tlDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );\n\n\t\tlVector = normalize( lVector );\n\t\tfloat dotProduct = dot( transformedNormal, lVector );\n\n\t\tvec3 pointLightWeighting = vec3( max( dotProduct, 0.0 ) );\n\n\t\t#ifdef DOUBLE_SIDED\n\n\t\t\tvec3 pointLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );\n\n\t\t\t#ifdef WRAP_AROUND\n\n\t\t\t\tvec3 pointLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );\n\n\t\t\t#endif\n\n\t\t#endif\n\n\t\t#ifdef WRAP_AROUND\n\n\t\t\tvec3 pointLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );\n\t\t\tpointLightWeighting = mix( pointLightWeighting, pointLightWeightingHalf, wrapRGB );\n\n\t\t\t#ifdef DOUBLE_SIDED\n\n\t\t\t\tpointLightWeightingBack = mix( pointLightWeightingBack, pointLightWeightingHalfBack, wrapRGB );\n\n\t\t\t#endif\n\n\t\t#endif\n\n\t\tvLightFront += pointLightColor[ i ] * pointLightWeighting * lDistance;\n\n\t\t#ifdef DOUBLE_SIDED\n\n\t\t\tvLightBack += pointLightColor[ i ] * pointLightWeightingBack * lDistance;\n\n\t\t#endif\n\n\t}\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0\n\n\tfor( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\n\n\t\tvec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );\n\t\tvec3 lVector = lPosition.xyz - mvPosition.xyz;\n\n\t\tfloat spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - worldPosition.xyz ) );\n\n\t\tif ( spotEffect > spotLightAngleCos[ i ] ) {\n\n\t\t\tspotEffect = max( pow( max( spotEffect, 0.0 ), spotLightExponent[ i ] ), 0.0 );\n\n\t\t\tfloat lDistance = 1.0;\n\t\t\tif ( spotLightDistance[ i ] > 0.0 )\n\t\t\t\tlDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );\n\n\t\t\tlVector = normalize( lVector );\n\n\t\t\tfloat dotProduct = dot( transformedNormal, lVector );\n\t\t\tvec3 spotLightWeighting = vec3( max( dotProduct, 0.0 ) );\n\n\t\t\t#ifdef DOUBLE_SIDED\n\n\t\t\t\tvec3 spotLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );\n\n\t\t\t\t#ifdef WRAP_AROUND\n\n\t\t\t\t\tvec3 spotLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );\n\n\t\t\t\t#endif\n\n\t\t\t#endif\n\n\t\t\t#ifdef WRAP_AROUND\n\n\t\t\t\tvec3 spotLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );\n\t\t\t\tspotLightWeighting = mix( spotLightWeighting, spotLightWeightingHalf, wrapRGB );\n\n\t\t\t\t#ifdef DOUBLE_SIDED\n\n\t\t\t\t\tspotLightWeightingBack = mix( spotLightWeightingBack, spotLightWeightingHalfBack, wrapRGB );\n\n\t\t\t\t#endif\n\n\t\t\t#endif\n\n\t\t\tvLightFront += spotLightColor[ i ] * spotLightWeighting * lDistance * spotEffect;\n\n\t\t\t#ifdef DOUBLE_SIDED\n\n\t\t\t\tvLightBack += spotLightColor[ i ] * spotLightWeightingBack * lDistance * spotEffect;\n\n\t\t\t#endif\n\n\t\t}\n\n\t}\n\n#endif\n\n#if MAX_HEMI_LIGHTS > 0\n\n\tfor( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {\n\n\t\tvec4 lDirection = viewMatrix * vec4( hemisphereLightDirection[ i ], 0.0 );\n\t\tvec3 lVector = normalize( lDirection.xyz );\n\n\t\tfloat dotProduct = dot( transformedNormal, lVector );\n\n\t\tfloat hemiDiffuseWeight = 0.5 * dotProduct + 0.5;\n\t\tfloat hemiDiffuseWeightBack = -0.5 * dotProduct + 0.5;\n\n\t\tvLightFront += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );\n\n\t\t#ifdef DOUBLE_SIDED\n\n\t\t\tvLightBack += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeightBack );\n\n\t\t#endif\n\n\t}\n\n#endif\n\nvLightFront = vLightFront * diffuse + ambient * ambientLightColor + emissive;\n\n#ifdef DOUBLE_SIDED\n\n\tvLightBack = vLightBack * diffuse + ambient * ambientLightColor + emissive;\n\n#endif",Ht.ShaderChunk.map_particle_pars_fragment="#ifdef USE_MAP\n\n\tuniform sampler2D map;\n\n#endif",Ht.ShaderChunk.default_vertex="vec4 mvPosition;\n\n#ifdef USE_SKINNING\n\n\tmvPosition = modelViewMatrix * skinned;\n\n#endif\n\n#if !defined( USE_SKINNING ) && defined( USE_MORPHTARGETS )\n\n\tmvPosition = modelViewMatrix * vec4( morphed, 1.0 );\n\n#endif\n\n#if !defined( USE_SKINNING ) && ! defined( USE_MORPHTARGETS )\n\n\tmvPosition = modelViewMatrix * vec4( position, 1.0 );\n\n#endif\n\ngl_Position = projectionMatrix * mvPosition;",Ht.ShaderChunk.map_pars_fragment="#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP )\n\n\tvarying vec2 vUv;\n\n#endif\n\n#ifdef USE_MAP\n\n\tuniform sampler2D map;\n\n#endif",Ht.ShaderChunk.skinnormal_vertex="#ifdef USE_SKINNING\n\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix  = bindMatrixInverse * skinMatrix * bindMatrix;\n\n\t#ifdef USE_MORPHNORMALS\n\n\tvec4 skinnedNormal = skinMatrix * vec4( morphedNormal, 0.0 );\n\n\t#else\n\n\tvec4 skinnedNormal = skinMatrix * vec4( normal, 0.0 );\n\n\t#endif\n\n#endif\n",Ht.ShaderChunk.logdepthbuf_pars_vertex="#ifdef USE_LOGDEPTHBUF\n\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\n\t\tvarying float vFragDepth;\n\n\t#endif\n\n\tuniform float logDepthBufFC;\n\n#endif",Ht.ShaderChunk.lightmap_pars_vertex="#ifdef USE_LIGHTMAP\n\n\tvarying vec2 vUv2;\n\n#endif",Ht.ShaderChunk.lights_phong_fragment="vec3 normal = normalize( vNormal );\nvec3 viewPosition = normalize( vViewPosition );\n\n#ifdef DOUBLE_SIDED\n\n\tnormal = normal * ( -1.0 + 2.0 * float( gl_FrontFacing ) );\n\n#endif\n\n#ifdef USE_NORMALMAP\n\n\tnormal = perturbNormal2Arb( -vViewPosition, normal );\n\n#elif defined( USE_BUMPMAP )\n\n\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n\n#endif\n\n#if MAX_POINT_LIGHTS > 0\n\n\tvec3 pointDiffuse = vec3( 0.0 );\n\tvec3 pointSpecular = vec3( 0.0 );\n\n\tfor ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\n\n\t\tvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\n\t\tvec3 lVector = lPosition.xyz + vViewPosition.xyz;\n\n\t\tfloat lDistance = 1.0;\n\t\tif ( pointLightDistance[ i ] > 0.0 )\n\t\t\tlDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );\n\n\t\tlVector = normalize( lVector );\n\n\t\t\t\t// diffuse\n\n\t\tfloat dotProduct = dot( normal, lVector );\n\n\t\t#ifdef WRAP_AROUND\n\n\t\t\tfloat pointDiffuseWeightFull = max( dotProduct, 0.0 );\n\t\t\tfloat pointDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\n\n\t\t\tvec3 pointDiffuseWeight = mix( vec3( pointDiffuseWeightFull ), vec3( pointDiffuseWeightHalf ), wrapRGB );\n\n\t\t#else\n\n\t\t\tfloat pointDiffuseWeight = max( dotProduct, 0.0 );\n\n\t\t#endif\n\n\t\tpointDiffuse += diffuse * pointLightColor[ i ] * pointDiffuseWeight * lDistance;\n\n\t\t\t\t// specular\n\n\t\tvec3 pointHalfVector = normalize( lVector + viewPosition );\n\t\tfloat pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );\n\t\tfloat pointSpecularWeight = specularStrength * max( pow( pointDotNormalHalf, shininess ), 0.0 );\n\n\t\tfloat specularNormalization = ( shininess + 2.0 ) / 8.0;\n\n\t\tvec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVector, pointHalfVector ), 0.0 ), 5.0 );\n\t\tpointSpecular += schlick * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * lDistance * specularNormalization;\n\n\t}\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0\n\n\tvec3 spotDiffuse = vec3( 0.0 );\n\tvec3 spotSpecular = vec3( 0.0 );\n\n\tfor ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\n\n\t\tvec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );\n\t\tvec3 lVector = lPosition.xyz + vViewPosition.xyz;\n\n\t\tfloat lDistance = 1.0;\n\t\tif ( spotLightDistance[ i ] > 0.0 )\n\t\t\tlDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );\n\n\t\tlVector = normalize( lVector );\n\n\t\tfloat spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - vWorldPosition ) );\n\n\t\tif ( spotEffect > spotLightAngleCos[ i ] ) {\n\n\t\t\tspotEffect = max( pow( max( spotEffect, 0.0 ), spotLightExponent[ i ] ), 0.0 );\n\n\t\t\t\t\t// diffuse\n\n\t\t\tfloat dotProduct = dot( normal, lVector );\n\n\t\t\t#ifdef WRAP_AROUND\n\n\t\t\t\tfloat spotDiffuseWeightFull = max( dotProduct, 0.0 );\n\t\t\t\tfloat spotDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\n\n\t\t\t\tvec3 spotDiffuseWeight = mix( vec3( spotDiffuseWeightFull ), vec3( spotDiffuseWeightHalf ), wrapRGB );\n\n\t\t\t#else\n\n\t\t\t\tfloat spotDiffuseWeight = max( dotProduct, 0.0 );\n\n\t\t\t#endif\n\n\t\t\tspotDiffuse += diffuse * spotLightColor[ i ] * spotDiffuseWeight * lDistance * spotEffect;\n\n\t\t\t\t\t// specular\n\n\t\t\tvec3 spotHalfVector = normalize( lVector + viewPosition );\n\t\t\tfloat spotDotNormalHalf = max( dot( normal, spotHalfVector ), 0.0 );\n\t\t\tfloat spotSpecularWeight = specularStrength * max( pow( spotDotNormalHalf, shininess ), 0.0 );\n\n\t\t\tfloat specularNormalization = ( shininess + 2.0 ) / 8.0;\n\n\t\t\tvec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVector, spotHalfVector ), 0.0 ), 5.0 );\n\t\t\tspotSpecular += schlick * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * lDistance * specularNormalization * spotEffect;\n\n\t\t}\n\n\t}\n\n#endif\n\n#if MAX_DIR_LIGHTS > 0\n\n\tvec3 dirDiffuse = vec3( 0.0 );\n\tvec3 dirSpecular = vec3( 0.0 );\n\n\tfor( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {\n\n\t\tvec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\n\t\tvec3 dirVector = normalize( lDirection.xyz );\n\n\t\t\t\t// diffuse\n\n\t\tfloat dotProduct = dot( normal, dirVector );\n\n\t\t#ifdef WRAP_AROUND\n\n\t\t\tfloat dirDiffuseWeightFull = max( dotProduct, 0.0 );\n\t\t\tfloat dirDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\n\n\t\t\tvec3 dirDiffuseWeight = mix( vec3( dirDiffuseWeightFull ), vec3( dirDiffuseWeightHalf ), wrapRGB );\n\n\t\t#else\n\n\t\t\tfloat dirDiffuseWeight = max( dotProduct, 0.0 );\n\n\t\t#endif\n\n\t\tdirDiffuse += diffuse * directionalLightColor[ i ] * dirDiffuseWeight;\n\n\t\t// specular\n\n\t\tvec3 dirHalfVector = normalize( dirVector + viewPosition );\n\t\tfloat dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );\n\t\tfloat dirSpecularWeight = specularStrength * max( pow( dirDotNormalHalf, shininess ), 0.0 );\n\n\t\t/*\n\t\t// fresnel term from skin shader\n\t\tconst float F0 = 0.128;\n\n\t\tfloat base = 1.0 - dot( viewPosition, dirHalfVector );\n\t\tfloat exponential = pow( base, 5.0 );\n\n\t\tfloat fresnel = exponential + F0 * ( 1.0 - exponential );\n\t\t*/\n\n\t\t/*\n\t\t// fresnel term from fresnel shader\n\t\tconst float mFresnelBias = 0.08;\n\t\tconst float mFresnelScale = 0.3;\n\t\tconst float mFresnelPower = 5.0;\n\n\t\tfloat fresnel = mFresnelBias + mFresnelScale * pow( 1.0 + dot( normalize( -viewPosition ), normal ), mFresnelPower );\n\t\t*/\n\n\t\tfloat specularNormalization = ( shininess + 2.0 ) / 8.0;\n\n\t\t// \t\tdirSpecular += specular * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization * fresnel;\n\n\t\tvec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( dirVector, dirHalfVector ), 0.0 ), 5.0 );\n\t\tdirSpecular += schlick * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization;\n\n\n\t}\n\n#endif\n\n#if MAX_HEMI_LIGHTS > 0\n\n\tvec3 hemiDiffuse = vec3( 0.0 );\n\tvec3 hemiSpecular = vec3( 0.0 );\n\n\tfor( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {\n\n\t\tvec4 lDirection = viewMatrix * vec4( hemisphereLightDirection[ i ], 0.0 );\n\t\tvec3 lVector = normalize( lDirection.xyz );\n\n\t\t// diffuse\n\n\t\tfloat dotProduct = dot( normal, lVector );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotProduct + 0.5;\n\n\t\tvec3 hemiColor = mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );\n\n\t\themiDiffuse += diffuse * hemiColor;\n\n\t\t// specular (sky light)\n\n\t\tvec3 hemiHalfVectorSky = normalize( lVector + viewPosition );\n\t\tfloat hemiDotNormalHalfSky = 0.5 * dot( normal, hemiHalfVectorSky ) + 0.5;\n\t\tfloat hemiSpecularWeightSky = specularStrength * max( pow( max( hemiDotNormalHalfSky, 0.0 ), shininess ), 0.0 );\n\n\t\t// specular (ground light)\n\n\t\tvec3 lVectorGround = -lVector;\n\n\t\tvec3 hemiHalfVectorGround = normalize( lVectorGround + viewPosition );\n\t\tfloat hemiDotNormalHalfGround = 0.5 * dot( normal, hemiHalfVectorGround ) + 0.5;\n\t\tfloat hemiSpecularWeightGround = specularStrength * max( pow( max( hemiDotNormalHalfGround, 0.0 ), shininess ), 0.0 );\n\n\t\tfloat dotProductGround = dot( normal, lVectorGround );\n\n\t\tfloat specularNormalization = ( shininess + 2.0 ) / 8.0;\n\n\t\tvec3 schlickSky = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVector, hemiHalfVectorSky ), 0.0 ), 5.0 );\n\t\tvec3 schlickGround = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVectorGround, hemiHalfVectorGround ), 0.0 ), 5.0 );\n\t\themiSpecular += hemiColor * specularNormalization * ( schlickSky * hemiSpecularWeightSky * max( dotProduct, 0.0 ) + schlickGround * hemiSpecularWeightGround * max( dotProductGround, 0.0 ) );\n\n\t}\n\n#endif\n\nvec3 totalDiffuse = vec3( 0.0 );\nvec3 totalSpecular = vec3( 0.0 );\n\n#if MAX_DIR_LIGHTS > 0\n\n\ttotalDiffuse += dirDiffuse;\n\ttotalSpecular += dirSpecular;\n\n#endif\n\n#if MAX_HEMI_LIGHTS > 0\n\n\ttotalDiffuse += hemiDiffuse;\n\ttotalSpecular += hemiSpecular;\n\n#endif\n\n#if MAX_POINT_LIGHTS > 0\n\n\ttotalDiffuse += pointDiffuse;\n\ttotalSpecular += pointSpecular;\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0\n\n\ttotalDiffuse += spotDiffuse;\n\ttotalSpecular += spotSpecular;\n\n#endif\n\n#ifdef METAL\n\n\tgl_FragColor.xyz = gl_FragColor.xyz * ( emissive + totalDiffuse + ambientLightColor * ambient + totalSpecular );\n\n#else\n\n\tgl_FragColor.xyz = gl_FragColor.xyz * ( emissive + totalDiffuse + ambientLightColor * ambient ) + totalSpecular;\n\n#endif",Ht.ShaderChunk.fog_pars_fragment="#ifdef USE_FOG\n\n\tuniform vec3 fogColor;\n\n\t#ifdef FOG_EXP2\n\n\t\tuniform float fogDensity;\n\n\t#else\n\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n\n#endif",Ht.ShaderChunk.morphnormal_vertex="#ifdef USE_MORPHNORMALS\n\n\tvec3 morphedNormal = vec3( 0.0 );\n\n\tmorphedNormal += ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];\n\tmorphedNormal += ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];\n\tmorphedNormal += ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];\n\tmorphedNormal += ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];\n\n\tmorphedNormal += normal;\n\n#endif",Ht.ShaderChunk.envmap_pars_fragment="#ifdef USE_ENVMAP\n\n\tuniform float reflectivity;\n\tuniform samplerCube envMap;\n\tuniform float flipEnvMap;\n\tuniform int combine;\n\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\n\t\tuniform bool useRefract;\n\t\tuniform float refractionRatio;\n\n\t#else\n\n\t\tvarying vec3 vReflect;\n\n\t#endif\n\n#endif",Ht.ShaderChunk.logdepthbuf_fragment="#if defined(USE_LOGDEPTHBUF) && defined(USE_LOGDEPTHBUF_EXT)\n\n\tgl_FragDepthEXT = log2(vFragDepth) * logDepthBufFC * 0.5;\n\n#endif",Ht.ShaderChunk.normalmap_pars_fragment="#ifdef USE_NORMALMAP\n\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n\n\t\t\t// Per-Pixel Tangent Space Normal Mapping\n\t\t\t// http://hacksoflife.blogspot.ch/2009/11/per-pixel-tangent-space-normal-mapping.html\n\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {\n\n\t\tvec3 q0 = dFdx( eye_pos.xyz );\n\t\tvec3 q1 = dFdy( eye_pos.xyz );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\n\t\tvec3 S = normalize( q0 * st1.t - q1 * st0.t );\n\t\tvec3 T = normalize( -q0 * st1.s + q1 * st0.s );\n\t\tvec3 N = normalize( surf_norm );\n\n\t\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t\tmapN.xy = normalScale * mapN.xy;\n\t\tmat3 tsn = mat3( S, T, N );\n\t\treturn normalize( tsn * mapN );\n\n\t}\n\n#endif\n",Ht.ShaderChunk.lights_phong_pars_vertex="#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP ) || defined( USE_ENVMAP )\n\n\tvarying vec3 vWorldPosition;\n\n#endif\n",Ht.ShaderChunk.lightmap_pars_fragment="#ifdef USE_LIGHTMAP\n\n\tvarying vec2 vUv2;\n\tuniform sampler2D lightMap;\n\n#endif",Ht.ShaderChunk.shadowmap_vertex="#ifdef USE_SHADOWMAP\n\n\tfor( int i = 0; i < MAX_SHADOWS; i ++ ) {\n\n\t\tvShadowCoord[ i ] = shadowMatrix[ i ] * worldPosition;\n\n\t}\n\n#endif",Ht.ShaderChunk.lights_phong_vertex="#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP ) || defined( USE_ENVMAP )\n\n\tvWorldPosition = worldPosition.xyz;\n\n#endif",Ht.ShaderChunk.map_fragment="#ifdef USE_MAP\n\n\tvec4 texelColor = texture2D( map, vUv );\n\n\t#ifdef GAMMA_INPUT\n\n\t\ttexelColor.xyz *= texelColor.xyz;\n\n\t#endif\n\n\tgl_FragColor = gl_FragColor * texelColor;\n\n#endif",Ht.ShaderChunk.lightmap_vertex="#ifdef USE_LIGHTMAP\n\n\tvUv2 = uv2;\n\n#endif",Ht.ShaderChunk.map_particle_fragment="#ifdef USE_MAP\n\n\tgl_FragColor = gl_FragColor * texture2D( map, vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y ) );\n\n#endif",Ht.ShaderChunk.color_pars_fragment="#ifdef USE_COLOR\n\n\tvarying vec3 vColor;\n\n#endif\n",Ht.ShaderChunk.color_vertex="#ifdef USE_COLOR\n\n\t#ifdef GAMMA_INPUT\n\n\t\tvColor = color * color;\n\n\t#else\n\n\t\tvColor = color;\n\n\t#endif\n\n#endif",Ht.ShaderChunk.skinning_vertex="#ifdef USE_SKINNING\n\n\t#ifdef USE_MORPHTARGETS\n\n\tvec4 skinVertex = bindMatrix * vec4( morphed, 1.0 );\n\n\t#else\n\n\tvec4 skinVertex = bindMatrix * vec4( position, 1.0 );\n\n\t#endif\n\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\tskinned  = bindMatrixInverse * skinned;\n\n#endif\n",Ht.ShaderChunk.envmap_pars_vertex="#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP ) && ! defined( PHONG )\n\n\tvarying vec3 vReflect;\n\n\tuniform float refractionRatio;\n\tuniform bool useRefract;\n\n#endif\n",Ht.ShaderChunk.linear_to_gamma_fragment="#ifdef GAMMA_OUTPUT\n\n\tgl_FragColor.xyz = sqrt( gl_FragColor.xyz );\n\n#endif",Ht.ShaderChunk.color_pars_vertex="#ifdef USE_COLOR\n\n\tvarying vec3 vColor;\n\n#endif",Ht.ShaderChunk.lights_lambert_pars_vertex="uniform vec3 ambient;\nuniform vec3 diffuse;\nuniform vec3 emissive;\n\nuniform vec3 ambientLightColor;\n\n#if MAX_DIR_LIGHTS > 0\n\n\tuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\n\tuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n\n#endif\n\n#if MAX_HEMI_LIGHTS > 0\n\n\tuniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];\n\tuniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];\n\tuniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];\n\n#endif\n\n#if MAX_POINT_LIGHTS > 0\n\n\tuniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\n\tuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\n\tuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0\n\n\tuniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];\n\tuniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\n\tuniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];\n\tuniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\n\tuniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];\n\tuniform float spotLightExponent[ MAX_SPOT_LIGHTS ];\n\n#endif\n\n#ifdef WRAP_AROUND\n\n\tuniform vec3 wrapRGB;\n\n#endif\n",Ht.ShaderChunk.map_pars_vertex="#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP )\n\n\tvarying vec2 vUv;\n\tuniform vec4 offsetRepeat;\n\n#endif\n",Ht.ShaderChunk.envmap_fragment="#ifdef USE_ENVMAP\n\n\tvec3 reflectVec;\n\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\n\t\tvec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );\n\n\t\t// http://en.wikibooks.org/wiki/GLSL_Programming/Applying_Matrix_Transformations\n\t\t// Transforming Normal Vectors with the Inverse Transformation\n\n\t\tvec3 worldNormal = normalize( vec3( vec4( normal, 0.0 ) * viewMatrix ) );\n\n\t\tif ( useRefract ) {\n\n\t\t\treflectVec = refract( cameraToVertex, worldNormal, refractionRatio );\n\n\t\t} else { \n\n\t\t\treflectVec = reflect( cameraToVertex, worldNormal );\n\n\t\t}\n\n\t#else\n\n\t\treflectVec = vReflect;\n\n\t#endif\n\n\t#ifdef DOUBLE_SIDED\n\n\t\tfloat flipNormal = ( -1.0 + 2.0 * float( gl_FrontFacing ) );\n\t\tvec4 cubeColor = textureCube( envMap, flipNormal * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\n\t#else\n\n\t\tvec4 cubeColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\n\t#endif\n\n\t#ifdef GAMMA_INPUT\n\n\t\tcubeColor.xyz *= cubeColor.xyz;\n\n\t#endif\n\n\tif ( combine == 1 ) {\n\n\t\tgl_FragColor.xyz = mix( gl_FragColor.xyz, cubeColor.xyz, specularStrength * reflectivity );\n\n\t} else if ( combine == 2 ) {\n\n\t\tgl_FragColor.xyz += cubeColor.xyz * specularStrength * reflectivity;\n\n\t} else {\n\n\t\tgl_FragColor.xyz = mix( gl_FragColor.xyz, gl_FragColor.xyz * cubeColor.xyz, specularStrength * reflectivity );\n\n\t}\n\n#endif",Ht.ShaderChunk.specularmap_pars_fragment="#ifdef USE_SPECULARMAP\n\n\tuniform sampler2D specularMap;\n\n#endif",Ht.ShaderChunk.logdepthbuf_vertex="#ifdef USE_LOGDEPTHBUF\n\n\tgl_Position.z = log2(max(1e-6, gl_Position.w + 1.0)) * logDepthBufFC;\n\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\n#else\n\n\t\tgl_Position.z = (gl_Position.z - 1.0) * gl_Position.w;\n\n\t#endif\n\n#endif",Ht.ShaderChunk.morphtarget_pars_vertex="#ifdef USE_MORPHTARGETS\n\n\t#ifndef USE_MORPHNORMALS\n\n\tuniform float morphTargetInfluences[ 8 ];\n\n\t#else\n\n\tuniform float morphTargetInfluences[ 4 ];\n\n\t#endif\n\n#endif",Ht.ShaderChunk.specularmap_fragment="float specularStrength;\n\n#ifdef USE_SPECULARMAP\n\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n\n#else\n\n\tspecularStrength = 1.0;\n\n#endif",Ht.ShaderChunk.fog_fragment="#ifdef USE_FOG\n\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\n\t\tfloat depth = gl_FragDepthEXT / gl_FragCoord.w;\n\n\t#else\n\n\t\tfloat depth = gl_FragCoord.z / gl_FragCoord.w;\n\n\t#endif\n\n\t#ifdef FOG_EXP2\n\n\t\tconst float LOG2 = 1.442695;\n\t\tfloat fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );\n\t\tfogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );\n\n\t#else\n\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, depth );\n\n\t#endif\n\t\n\tgl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );\n\n#endif",Ht.ShaderChunk.bumpmap_pars_fragment="#ifdef USE_BUMPMAP\n\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\n\t\t\t// Derivative maps - bump mapping unparametrized surfaces by Morten Mikkelsen\n\t\t\t//\thttp://mmikkelsen3d.blogspot.sk/2011/07/derivative-maps.html\n\n\t\t\t// Evaluate the derivative of the height w.r.t. screen-space using forward differencing (listing 2)\n\n\tvec2 dHdxy_fwd() {\n\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\n\t\treturn vec2( dBx, dBy );\n\n\t}\n\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\n\n\t\tvec3 vSigmaX = dFdx( surf_pos );\n\t\tvec3 vSigmaY = dFdy( surf_pos );\n\t\tvec3 vN = surf_norm;\t\t// normalized\n\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\n\t\tfloat fDet = dot( vSigmaX, R1 );\n\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\n\t}\n\n#endif",Ht.ShaderChunk.defaultnormal_vertex="vec3 objectNormal;\n\n#ifdef USE_SKINNING\n\n\tobjectNormal = skinnedNormal.xyz;\n\n#endif\n\n#if !defined( USE_SKINNING ) && defined( USE_MORPHNORMALS )\n\n\tobjectNormal = morphedNormal;\n\n#endif\n\n#if !defined( USE_SKINNING ) && ! defined( USE_MORPHNORMALS )\n\n\tobjectNormal = normal;\n\n#endif\n\n#ifdef FLIP_SIDED\n\n\tobjectNormal = -objectNormal;\n\n#endif\n\nvec3 transformedNormal = normalMatrix * objectNormal;",Ht.ShaderChunk.lights_phong_pars_fragment="uniform vec3 ambientLightColor;\n\n#if MAX_DIR_LIGHTS > 0\n\n\tuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\n\tuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n\n#endif\n\n#if MAX_HEMI_LIGHTS > 0\n\n\tuniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];\n\tuniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];\n\tuniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];\n\n#endif\n\n#if MAX_POINT_LIGHTS > 0\n\n\tuniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\n\n\tuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\n\tuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0\n\n\tuniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];\n\tuniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\n\tuniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];\n\tuniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];\n\tuniform float spotLightExponent[ MAX_SPOT_LIGHTS ];\n\n\tuniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP ) || defined( USE_ENVMAP )\n\n\tvarying vec3 vWorldPosition;\n\n#endif\n\n#ifdef WRAP_AROUND\n\n\tuniform vec3 wrapRGB;\n\n#endif\n\nvarying vec3 vViewPosition;\nvarying vec3 vNormal;",Ht.ShaderChunk.skinbase_vertex="#ifdef USE_SKINNING\n\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n\n#endif",Ht.ShaderChunk.map_vertex="#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP )\n\n\tvUv = uv * offsetRepeat.zw + offsetRepeat.xy;\n\n#endif",Ht.ShaderChunk.lightmap_fragment="#ifdef USE_LIGHTMAP\n\n\tgl_FragColor = gl_FragColor * texture2D( lightMap, vUv2 );\n\n#endif",Ht.ShaderChunk.shadowmap_pars_vertex="#ifdef USE_SHADOWMAP\n\n\tvarying vec4 vShadowCoord[ MAX_SHADOWS ];\n\tuniform mat4 shadowMatrix[ MAX_SHADOWS ];\n\n#endif",Ht.ShaderChunk.color_fragment="#ifdef USE_COLOR\n\n\tgl_FragColor = gl_FragColor * vec4( vColor, 1.0 );\n\n#endif",Ht.ShaderChunk.morphtarget_vertex="#ifdef USE_MORPHTARGETS\n\n\tvec3 morphed = vec3( 0.0 );\n\tmorphed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];\n\tmorphed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];\n\tmorphed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];\n\tmorphed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];\n\n\t#ifndef USE_MORPHNORMALS\n\n\tmorphed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];\n\tmorphed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];\n\tmorphed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];\n\tmorphed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];\n\n\t#endif\n\n\tmorphed += position;\n\n#endif",Ht.ShaderChunk.envmap_vertex="#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP ) && ! defined( PHONG )\n\n\tvec3 worldNormal = mat3( modelMatrix[ 0 ].xyz, modelMatrix[ 1 ].xyz, modelMatrix[ 2 ].xyz ) * objectNormal;\n\tworldNormal = normalize( worldNormal );\n\n\tvec3 cameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\n\tif ( useRefract ) {\n\n\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\n\t} else {\n\n\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\n\t}\n\n#endif",Ht.ShaderChunk.shadowmap_fragment="#ifdef USE_SHADOWMAP\n\n\t#ifdef SHADOWMAP_DEBUG\n\n\t\tvec3 frustumColors[3];\n\t\tfrustumColors[0] = vec3( 1.0, 0.5, 0.0 );\n\t\tfrustumColors[1] = vec3( 0.0, 1.0, 0.8 );\n\t\tfrustumColors[2] = vec3( 0.0, 0.5, 1.0 );\n\n\t#endif\n\n\t#ifdef SHADOWMAP_CASCADE\n\n\t\tint inFrustumCount = 0;\n\n\t#endif\n\n\tfloat fDepth;\n\tvec3 shadowColor = vec3( 1.0 );\n\n\tfor( int i = 0; i < MAX_SHADOWS; i ++ ) {\n\n\t\tvec3 shadowCoord = vShadowCoord[ i ].xyz / vShadowCoord[ i ].w;\n\n\t\t\t\t// if ( something && something ) breaks ATI OpenGL shader compiler\n\t\t\t\t// if ( all( something, something ) ) using this instead\n\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\n\t\t\t\t// don't shadow pixels outside of light frustum\n\t\t\t\t// use just first frustum (for cascades)\n\t\t\t\t// don't shadow pixels behind far plane of light frustum\n\n\t\t#ifdef SHADOWMAP_CASCADE\n\n\t\t\tinFrustumCount += int( inFrustum );\n\t\t\tbvec3 frustumTestVec = bvec3( inFrustum, inFrustumCount == 1, shadowCoord.z <= 1.0 );\n\n\t\t#else\n\n\t\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\n\t\t#endif\n\n\t\tbool frustumTest = all( frustumTestVec );\n\n\t\tif ( frustumTest ) {\n\n\t\t\tshadowCoord.z += shadowBias[ i ];\n\n\t\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\n\t\t\t\t\t\t// Percentage-close filtering\n\t\t\t\t\t\t// (9 pixel kernel)\n\t\t\t\t\t\t// http://fabiensanglard.net/shadowmappingPCF/\n\n\t\t\t\tfloat shadow = 0.0;\n\n\t\t/*\n\t\t\t\t\t\t// nested loops breaks shader compiler / validator on some ATI cards when using OpenGL\n\t\t\t\t\t\t// must enroll loop manually\n\n\t\t\t\tfor ( float y = -1.25; y <= 1.25; y += 1.25 )\n\t\t\t\t\tfor ( float x = -1.25; x <= 1.25; x += 1.25 ) {\n\n\t\t\t\t\t\tvec4 rgbaDepth = texture2D( shadowMap[ i ], vec2( x * xPixelOffset, y * yPixelOffset ) + shadowCoord.xy );\n\n\t\t\t\t\t\t\t\t// doesn't seem to produce any noticeable visual difference compared to simple texture2D lookup\n\t\t\t\t\t\t\t\t//vec4 rgbaDepth = texture2DProj( shadowMap[ i ], vec4( vShadowCoord[ i ].w * ( vec2( x * xPixelOffset, y * yPixelOffset ) + shadowCoord.xy ), 0.05, vShadowCoord[ i ].w ) );\n\n\t\t\t\t\t\tfloat fDepth = unpackDepth( rgbaDepth );\n\n\t\t\t\t\t\tif ( fDepth < shadowCoord.z )\n\t\t\t\t\t\t\tshadow += 1.0;\n\n\t\t\t\t}\n\n\t\t\t\tshadow /= 9.0;\n\n\t\t*/\n\n\t\t\t\tconst float shadowDelta = 1.0 / 9.0;\n\n\t\t\t\tfloat xPixelOffset = 1.0 / shadowMapSize[ i ].x;\n\t\t\t\tfloat yPixelOffset = 1.0 / shadowMapSize[ i ].y;\n\n\t\t\t\tfloat dx0 = -1.25 * xPixelOffset;\n\t\t\t\tfloat dy0 = -1.25 * yPixelOffset;\n\t\t\t\tfloat dx1 = 1.25 * xPixelOffset;\n\t\t\t\tfloat dy1 = 1.25 * yPixelOffset;\n\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy1 ) ) );\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n\t\t\t\tshadowColor = shadowColor * vec3( ( 1.0 - shadowDarkness[ i ] * shadow ) );\n\n\t\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\n\t\t\t\t\t\t// Percentage-close filtering\n\t\t\t\t\t\t// (9 pixel kernel)\n\t\t\t\t\t\t// http://fabiensanglard.net/shadowmappingPCF/\n\n\t\t\t\tfloat shadow = 0.0;\n\n\t\t\t\tfloat xPixelOffset = 1.0 / shadowMapSize[ i ].x;\n\t\t\t\tfloat yPixelOffset = 1.0 / shadowMapSize[ i ].y;\n\n\t\t\t\tfloat dx0 = -1.0 * xPixelOffset;\n\t\t\t\tfloat dy0 = -1.0 * yPixelOffset;\n\t\t\t\tfloat dx1 = 1.0 * xPixelOffset;\n\t\t\t\tfloat dy1 = 1.0 * yPixelOffset;\n\n\t\t\t\tmat3 shadowKernel;\n\t\t\t\tmat3 depthKernel;\n\n\t\t\t\tdepthKernel[0][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );\n\t\t\t\tdepthKernel[0][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );\n\t\t\t\tdepthKernel[0][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy1 ) ) );\n\t\t\t\tdepthKernel[1][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );\n\t\t\t\tdepthKernel[1][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );\n\t\t\t\tdepthKernel[1][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );\n\t\t\t\tdepthKernel[2][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );\n\t\t\t\tdepthKernel[2][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );\n\t\t\t\tdepthKernel[2][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );\n\n\t\t\t\tvec3 shadowZ = vec3( shadowCoord.z );\n\t\t\t\tshadowKernel[0] = vec3(lessThan(depthKernel[0], shadowZ ));\n\t\t\t\tshadowKernel[0] *= vec3(0.25);\n\n\t\t\t\tshadowKernel[1] = vec3(lessThan(depthKernel[1], shadowZ ));\n\t\t\t\tshadowKernel[1] *= vec3(0.25);\n\n\t\t\t\tshadowKernel[2] = vec3(lessThan(depthKernel[2], shadowZ ));\n\t\t\t\tshadowKernel[2] *= vec3(0.25);\n\n\t\t\t\tvec2 fractionalCoord = 1.0 - fract( shadowCoord.xy * shadowMapSize[i].xy );\n\n\t\t\t\tshadowKernel[0] = mix( shadowKernel[1], shadowKernel[0], fractionalCoord.x );\n\t\t\t\tshadowKernel[1] = mix( shadowKernel[2], shadowKernel[1], fractionalCoord.x );\n\n\t\t\t\tvec4 shadowValues;\n\t\t\t\tshadowValues.x = mix( shadowKernel[0][1], shadowKernel[0][0], fractionalCoord.y );\n\t\t\t\tshadowValues.y = mix( shadowKernel[0][2], shadowKernel[0][1], fractionalCoord.y );\n\t\t\t\tshadowValues.z = mix( shadowKernel[1][1], shadowKernel[1][0], fractionalCoord.y );\n\t\t\t\tshadowValues.w = mix( shadowKernel[1][2], shadowKernel[1][1], fractionalCoord.y );\n\n\t\t\t\tshadow = dot( shadowValues, vec4( 1.0 ) );\n\n\t\t\t\tshadowColor = shadowColor * vec3( ( 1.0 - shadowDarkness[ i ] * shadow ) );\n\n\t\t\t#else\n\n\t\t\t\tvec4 rgbaDepth = texture2D( shadowMap[ i ], shadowCoord.xy );\n\t\t\t\tfloat fDepth = unpackDepth( rgbaDepth );\n\n\t\t\t\tif ( fDepth < shadowCoord.z )\n\n\t\t// spot with multiple shadows is darker\n\n\t\t\t\t\tshadowColor = shadowColor * vec3( 1.0 - shadowDarkness[ i ] );\n\n\t\t// spot with multiple shadows has the same color as single shadow spot\n\n\t\t// \t\t\t\t\tshadowColor = min( shadowColor, vec3( shadowDarkness[ i ] ) );\n\n\t\t\t#endif\n\n\t\t}\n\n\n\t\t#ifdef SHADOWMAP_DEBUG\n\n\t\t\t#ifdef SHADOWMAP_CASCADE\n\n\t\t\t\tif ( inFrustum && inFrustumCount == 1 ) gl_FragColor.xyz *= frustumColors[ i ];\n\n\t\t\t#else\n\n\t\t\t\tif ( inFrustum ) gl_FragColor.xyz *= frustumColors[ i ];\n\n\t\t\t#endif\n\n\t\t#endif\n\n\t}\n\n\t#ifdef GAMMA_OUTPUT\n\n\t\tshadowColor *= shadowColor;\n\n\t#endif\n\n\tgl_FragColor.xyz = gl_FragColor.xyz * shadowColor;\n\n#endif\n",Ht.ShaderChunk.worldpos_vertex="#if defined( USE_ENVMAP ) || defined( PHONG ) || defined( LAMBERT ) || defined ( USE_SHADOWMAP )\n\n\t#ifdef USE_SKINNING\n\n\t\tvec4 worldPosition = modelMatrix * skinned;\n\n\t#endif\n\n\t#if defined( USE_MORPHTARGETS ) && ! defined( USE_SKINNING )\n\n\t\tvec4 worldPosition = modelMatrix * vec4( morphed, 1.0 );\n\n\t#endif\n\n\t#if ! defined( USE_MORPHTARGETS ) && ! defined( USE_SKINNING )\n\n\t\tvec4 worldPosition = modelMatrix * vec4( position, 1.0 );\n\n\t#endif\n\n#endif",Ht.ShaderChunk.shadowmap_pars_fragment="#ifdef USE_SHADOWMAP\n\n\tuniform sampler2D shadowMap[ MAX_SHADOWS ];\n\tuniform vec2 shadowMapSize[ MAX_SHADOWS ];\n\n\tuniform float shadowDarkness[ MAX_SHADOWS ];\n\tuniform float shadowBias[ MAX_SHADOWS ];\n\n\tvarying vec4 vShadowCoord[ MAX_SHADOWS ];\n\n\tfloat unpackDepth( const in vec4 rgba_depth ) {\n\n\t\tconst vec4 bit_shift = vec4( 1.0 / ( 256.0 * 256.0 * 256.0 ), 1.0 / ( 256.0 * 256.0 ), 1.0 / 256.0, 1.0 );\n\t\tfloat depth = dot( rgba_depth, bit_shift );\n\t\treturn depth;\n\n\t}\n\n#endif",Ht.ShaderChunk.skinning_pars_vertex="#ifdef USE_SKINNING\n\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\n\t#ifdef BONE_TEXTURE\n\n\t\tuniform sampler2D boneTexture;\n\t\tuniform int boneTextureWidth;\n\t\tuniform int boneTextureHeight;\n\n\t\tmat4 getBoneMatrix( const in float i ) {\n\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureWidth ) );\n\t\t\tfloat y = floor( j / float( boneTextureWidth ) );\n\n\t\t\tfloat dx = 1.0 / float( boneTextureWidth );\n\t\t\tfloat dy = 1.0 / float( boneTextureHeight );\n\n\t\t\ty = dy * ( y + 0.5 );\n\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\n\t\t\treturn bone;\n\n\t\t}\n\n\t#else\n\n\t\tuniform mat4 boneGlobalMatrices[ MAX_BONES ];\n\n\t\tmat4 getBoneMatrix( const in float i ) {\n\n\t\t\tmat4 bone = boneGlobalMatrices[ int(i) ];\n\t\t\treturn bone;\n\n\t\t}\n\n\t#endif\n\n#endif\n",Ht.ShaderChunk.logdepthbuf_pars_fragment="#ifdef USE_LOGDEPTHBUF\n\n\tuniform float logDepthBufFC;\n\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\n\t\t#extension GL_EXT_frag_depth : enable\n\t\tvarying float vFragDepth;\n\n\t#endif\n\n#endif",Ht.ShaderChunk.alphamap_fragment="#ifdef USE_ALPHAMAP\n\n\tgl_FragColor.a *= texture2D( alphaMap, vUv ).g;\n\n#endif\n",Ht.ShaderChunk.alphamap_pars_fragment="#ifdef USE_ALPHAMAP\n\n\tuniform sampler2D alphaMap;\n\n#endif\n",Ht.UniformsUtils={merge:function(e){for(var t={},r=0;r<e.length;r++){var n=this.clone(e[r]);for(var i in n)t[i]=n[i]}return t},clone:function(e){var t={};for(var r in e)for(var n in t[r]={},e[r]){var i=e[r][n];i instanceof Ht.Color||i instanceof Ht.Vector2||i instanceof Ht.Vector3||i instanceof Ht.Vector4||i instanceof Ht.Matrix4||i instanceof Ht.Texture?t[r][n]=i.clone():i instanceof Array?t[r][n]=i.slice():t[r][n]=i}return t}},Ht.UniformsLib={common:{diffuse:{type:"c",value:new Ht.Color(15658734)},opacity:{type:"f",value:1},map:{type:"t",value:null},offsetRepeat:{type:"v4",value:new Ht.Vector4(0,0,1,1)},lightMap:{type:"t",value:null},specularMap:{type:"t",value:null},alphaMap:{type:"t",value:null},envMap:{type:"t",value:null},flipEnvMap:{type:"f",value:-1},useRefract:{type:"i",value:0},reflectivity:{type:"f",value:1},refractionRatio:{type:"f",value:.98},combine:{type:"i",value:0},morphTargetInfluences:{type:"f",value:0}},bump:{bumpMap:{type:"t",value:null},bumpScale:{type:"f",value:1}},normalmap:{normalMap:{type:"t",value:null},normalScale:{type:"v2",value:new Ht.Vector2(1,1)}},fog:{fogDensity:{type:"f",value:25e-5},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},fogColor:{type:"c",value:new Ht.Color(16777215)}},lights:{ambientLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]},directionalLightColor:{type:"fv",value:[]},hemisphereLightDirection:{type:"fv",value:[]},hemisphereLightSkyColor:{type:"fv",value:[]},hemisphereLightGroundColor:{type:"fv",value:[]},pointLightColor:{type:"fv",value:[]},pointLightPosition:{type:"fv",value:[]},pointLightDistance:{type:"fv1",value:[]},spotLightColor:{type:"fv",value:[]},spotLightPosition:{type:"fv",value:[]},spotLightDirection:{type:"fv",value:[]},spotLightDistance:{type:"fv1",value:[]},spotLightAngleCos:{type:"fv1",value:[]},spotLightExponent:{type:"fv1",value:[]}},particle:{psColor:{type:"c",value:new Ht.Color(15658734)},opacity:{type:"f",value:1},size:{type:"f",value:1},scale:{type:"f",value:1},map:{type:"t",value:null},fogDensity:{type:"f",value:25e-5},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},fogColor:{type:"c",value:new Ht.Color(16777215)}},shadowmap:{shadowMap:{type:"tv",value:[]},shadowMapSize:{type:"v2v",value:[]},shadowBias:{type:"fv1",value:[]},shadowDarkness:{type:"fv1",value:[]},shadowMatrix:{type:"m4v",value:[]}}},Ht.ShaderLib={basic:{uniforms:Ht.UniformsUtils.merge([Ht.UniformsLib.common,Ht.UniformsLib.fog,Ht.UniformsLib.shadowmap]),vertexShader:[Ht.ShaderChunk.map_pars_vertex,Ht.ShaderChunk.lightmap_pars_vertex,Ht.ShaderChunk.envmap_pars_vertex,Ht.ShaderChunk.color_pars_vertex,Ht.ShaderChunk.morphtarget_pars_vertex,Ht.ShaderChunk.skinning_pars_vertex,Ht.ShaderChunk.shadowmap_pars_vertex,Ht.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",Ht.ShaderChunk.map_vertex,Ht.ShaderChunk.lightmap_vertex,Ht.ShaderChunk.color_vertex,Ht.ShaderChunk.skinbase_vertex,"\t#ifdef USE_ENVMAP",Ht.ShaderChunk.morphnormal_vertex,Ht.ShaderChunk.skinnormal_vertex,Ht.ShaderChunk.defaultnormal_vertex,"\t#endif",Ht.ShaderChunk.morphtarget_vertex,Ht.ShaderChunk.skinning_vertex,Ht.ShaderChunk.default_vertex,Ht.ShaderChunk.logdepthbuf_vertex,Ht.ShaderChunk.worldpos_vertex,Ht.ShaderChunk.envmap_vertex,Ht.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;","uniform float opacity;",Ht.ShaderChunk.color_pars_fragment,Ht.ShaderChunk.map_pars_fragment,Ht.ShaderChunk.alphamap_pars_fragment,Ht.ShaderChunk.lightmap_pars_fragment,Ht.ShaderChunk.envmap_pars_fragment,Ht.ShaderChunk.fog_pars_fragment,Ht.ShaderChunk.shadowmap_pars_fragment,Ht.ShaderChunk.specularmap_pars_fragment,Ht.ShaderChunk.logdepthbuf_pars_fragment,"void main() {","\tgl_FragColor = vec4( diffuse, opacity );",Ht.ShaderChunk.logdepthbuf_fragment,Ht.ShaderChunk.map_fragment,Ht.ShaderChunk.alphamap_fragment,Ht.ShaderChunk.alphatest_fragment,Ht.ShaderChunk.specularmap_fragment,Ht.ShaderChunk.lightmap_fragment,Ht.ShaderChunk.color_fragment,Ht.ShaderChunk.envmap_fragment,Ht.ShaderChunk.shadowmap_fragment,Ht.ShaderChunk.linear_to_gamma_fragment,Ht.ShaderChunk.fog_fragment,"}"].join("\n")},lambert:{uniforms:Ht.UniformsUtils.merge([Ht.UniformsLib.common,Ht.UniformsLib.fog,Ht.UniformsLib.lights,Ht.UniformsLib.shadowmap,{ambient:{type:"c",value:new Ht.Color(16777215)},emissive:{type:"c",value:new Ht.Color(0)},wrapRGB:{type:"v3",value:new Ht.Vector3(1,1,1)}}]),vertexShader:["#define LAMBERT","varying vec3 vLightFront;","#ifdef DOUBLE_SIDED","\tvarying vec3 vLightBack;","#endif",Ht.ShaderChunk.map_pars_vertex,Ht.ShaderChunk.lightmap_pars_vertex,Ht.ShaderChunk.envmap_pars_vertex,Ht.ShaderChunk.lights_lambert_pars_vertex,Ht.ShaderChunk.color_pars_vertex,Ht.ShaderChunk.morphtarget_pars_vertex,Ht.ShaderChunk.skinning_pars_vertex,Ht.ShaderChunk.shadowmap_pars_vertex,Ht.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",Ht.ShaderChunk.map_vertex,Ht.ShaderChunk.lightmap_vertex,Ht.ShaderChunk.color_vertex,Ht.ShaderChunk.morphnormal_vertex,Ht.ShaderChunk.skinbase_vertex,Ht.ShaderChunk.skinnormal_vertex,Ht.ShaderChunk.defaultnormal_vertex,Ht.ShaderChunk.morphtarget_vertex,Ht.ShaderChunk.skinning_vertex,Ht.ShaderChunk.default_vertex,Ht.ShaderChunk.logdepthbuf_vertex,Ht.ShaderChunk.worldpos_vertex,Ht.ShaderChunk.envmap_vertex,Ht.ShaderChunk.lights_lambert_vertex,Ht.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform float opacity;","varying vec3 vLightFront;","#ifdef DOUBLE_SIDED","\tvarying vec3 vLightBack;","#endif",Ht.ShaderChunk.color_pars_fragment,Ht.ShaderChunk.map_pars_fragment,Ht.ShaderChunk.alphamap_pars_fragment,Ht.ShaderChunk.lightmap_pars_fragment,Ht.ShaderChunk.envmap_pars_fragment,Ht.ShaderChunk.fog_pars_fragment,Ht.ShaderChunk.shadowmap_pars_fragment,Ht.ShaderChunk.specularmap_pars_fragment,Ht.ShaderChunk.logdepthbuf_pars_fragment,"void main() {","\tgl_FragColor = vec4( vec3( 1.0 ), opacity );",Ht.ShaderChunk.logdepthbuf_fragment,Ht.ShaderChunk.map_fragment,Ht.ShaderChunk.alphamap_fragment,Ht.ShaderChunk.alphatest_fragment,Ht.ShaderChunk.specularmap_fragment,"\t#ifdef DOUBLE_SIDED","\t\tif ( gl_FrontFacing )","\t\t\tgl_FragColor.xyz *= vLightFront;","\t\telse","\t\t\tgl_FragColor.xyz *= vLightBack;","\t#else","\t\tgl_FragColor.xyz *= vLightFront;","\t#endif",Ht.ShaderChunk.lightmap_fragment,Ht.ShaderChunk.color_fragment,Ht.ShaderChunk.envmap_fragment,Ht.ShaderChunk.shadowmap_fragment,Ht.ShaderChunk.linear_to_gamma_fragment,Ht.ShaderChunk.fog_fragment,"}"].join("\n")},phong:{uniforms:Ht.UniformsUtils.merge([Ht.UniformsLib.common,Ht.UniformsLib.bump,Ht.UniformsLib.normalmap,Ht.UniformsLib.fog,Ht.UniformsLib.lights,Ht.UniformsLib.shadowmap,{ambient:{type:"c",value:new Ht.Color(16777215)},emissive:{type:"c",value:new Ht.Color(0)},specular:{type:"c",value:new Ht.Color(1118481)},shininess:{type:"f",value:30},wrapRGB:{type:"v3",value:new Ht.Vector3(1,1,1)}}]),vertexShader:["#define PHONG","varying vec3 vViewPosition;","varying vec3 vNormal;",Ht.ShaderChunk.map_pars_vertex,Ht.ShaderChunk.lightmap_pars_vertex,Ht.ShaderChunk.envmap_pars_vertex,Ht.ShaderChunk.lights_phong_pars_vertex,Ht.ShaderChunk.color_pars_vertex,Ht.ShaderChunk.morphtarget_pars_vertex,Ht.ShaderChunk.skinning_pars_vertex,Ht.ShaderChunk.shadowmap_pars_vertex,Ht.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",Ht.ShaderChunk.map_vertex,Ht.ShaderChunk.lightmap_vertex,Ht.ShaderChunk.color_vertex,Ht.ShaderChunk.morphnormal_vertex,Ht.ShaderChunk.skinbase_vertex,Ht.ShaderChunk.skinnormal_vertex,Ht.ShaderChunk.defaultnormal_vertex,"\tvNormal = normalize( transformedNormal );",Ht.ShaderChunk.morphtarget_vertex,Ht.ShaderChunk.skinning_vertex,Ht.ShaderChunk.default_vertex,Ht.ShaderChunk.logdepthbuf_vertex,"\tvViewPosition = -mvPosition.xyz;",Ht.ShaderChunk.worldpos_vertex,Ht.ShaderChunk.envmap_vertex,Ht.ShaderChunk.lights_phong_vertex,Ht.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["#define PHONG","uniform vec3 diffuse;","uniform float opacity;","uniform vec3 ambient;","uniform vec3 emissive;","uniform vec3 specular;","uniform float shininess;",Ht.ShaderChunk.color_pars_fragment,Ht.ShaderChunk.map_pars_fragment,Ht.ShaderChunk.alphamap_pars_fragment,Ht.ShaderChunk.lightmap_pars_fragment,Ht.ShaderChunk.envmap_pars_fragment,Ht.ShaderChunk.fog_pars_fragment,Ht.ShaderChunk.lights_phong_pars_fragment,Ht.ShaderChunk.shadowmap_pars_fragment,Ht.ShaderChunk.bumpmap_pars_fragment,Ht.ShaderChunk.normalmap_pars_fragment,Ht.ShaderChunk.specularmap_pars_fragment,Ht.ShaderChunk.logdepthbuf_pars_fragment,"void main() {","\tgl_FragColor = vec4( vec3( 1.0 ), opacity );",Ht.ShaderChunk.logdepthbuf_fragment,Ht.ShaderChunk.map_fragment,Ht.ShaderChunk.alphamap_fragment,Ht.ShaderChunk.alphatest_fragment,Ht.ShaderChunk.specularmap_fragment,Ht.ShaderChunk.lights_phong_fragment,Ht.ShaderChunk.lightmap_fragment,Ht.ShaderChunk.color_fragment,Ht.ShaderChunk.envmap_fragment,Ht.ShaderChunk.shadowmap_fragment,Ht.ShaderChunk.linear_to_gamma_fragment,Ht.ShaderChunk.fog_fragment,"}"].join("\n")},particle_basic:{uniforms:Ht.UniformsUtils.merge([Ht.UniformsLib.particle,Ht.UniformsLib.shadowmap]),vertexShader:["uniform float size;","uniform float scale;",Ht.ShaderChunk.color_pars_vertex,Ht.ShaderChunk.shadowmap_pars_vertex,Ht.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",Ht.ShaderChunk.color_vertex,"\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","\t#ifdef USE_SIZEATTENUATION","\t\tgl_PointSize = size * ( scale / length( mvPosition.xyz ) );","\t#else","\t\tgl_PointSize = size;","\t#endif","\tgl_Position = projectionMatrix * mvPosition;",Ht.ShaderChunk.logdepthbuf_vertex,Ht.ShaderChunk.worldpos_vertex,Ht.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 psColor;","uniform float opacity;",Ht.ShaderChunk.color_pars_fragment,Ht.ShaderChunk.map_particle_pars_fragment,Ht.ShaderChunk.fog_pars_fragment,Ht.ShaderChunk.shadowmap_pars_fragment,Ht.ShaderChunk.logdepthbuf_pars_fragment,"void main() {","\tgl_FragColor = vec4( psColor, opacity );",Ht.ShaderChunk.logdepthbuf_fragment,Ht.ShaderChunk.map_particle_fragment,Ht.ShaderChunk.alphatest_fragment,Ht.ShaderChunk.color_fragment,Ht.ShaderChunk.shadowmap_fragment,Ht.ShaderChunk.fog_fragment,"}"].join("\n")},dashed:{uniforms:Ht.UniformsUtils.merge([Ht.UniformsLib.common,Ht.UniformsLib.fog,{scale:{type:"f",value:1},dashSize:{type:"f",value:1},totalSize:{type:"f",value:2}}]),vertexShader:["uniform float scale;","attribute float lineDistance;","varying float vLineDistance;",Ht.ShaderChunk.color_pars_vertex,Ht.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",Ht.ShaderChunk.color_vertex,"\tvLineDistance = scale * lineDistance;","\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","\tgl_Position = projectionMatrix * mvPosition;",Ht.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;","uniform float opacity;","uniform float dashSize;","uniform float totalSize;","varying float vLineDistance;",Ht.ShaderChunk.color_pars_fragment,Ht.ShaderChunk.fog_pars_fragment,Ht.ShaderChunk.logdepthbuf_pars_fragment,"void main() {","\tif ( mod( vLineDistance, totalSize ) > dashSize ) {","\t\tdiscard;","\t}","\tgl_FragColor = vec4( diffuse, opacity );",Ht.ShaderChunk.logdepthbuf_fragment,Ht.ShaderChunk.color_fragment,Ht.ShaderChunk.fog_fragment,"}"].join("\n")},depth:{uniforms:{mNear:{type:"f",value:1},mFar:{type:"f",value:2e3},opacity:{type:"f",value:1}},vertexShader:[Ht.ShaderChunk.morphtarget_pars_vertex,Ht.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",Ht.ShaderChunk.morphtarget_vertex,Ht.ShaderChunk.default_vertex,Ht.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),fragmentShader:["uniform float mNear;","uniform float mFar;","uniform float opacity;",Ht.ShaderChunk.logdepthbuf_pars_fragment,"void main() {",Ht.ShaderChunk.logdepthbuf_fragment,"\t#ifdef USE_LOGDEPTHBUF_EXT","\t\tfloat depth = gl_FragDepthEXT / gl_FragCoord.w;","\t#else","\t\tfloat depth = gl_FragCoord.z / gl_FragCoord.w;","\t#endif","\tfloat color = 1.0 - smoothstep( mNear, mFar, depth );","\tgl_FragColor = vec4( vec3( color ), opacity );","}"].join("\n")},normal:{uniforms:{opacity:{type:"f",value:1}},vertexShader:["varying vec3 vNormal;",Ht.ShaderChunk.morphtarget_pars_vertex,Ht.ShaderChunk.logdepthbuf_pars_vertex,"void main() {","\tvNormal = normalize( normalMatrix * normal );",Ht.ShaderChunk.morphtarget_vertex,Ht.ShaderChunk.default_vertex,Ht.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),fragmentShader:["uniform float opacity;","varying vec3 vNormal;",Ht.ShaderChunk.logdepthbuf_pars_fragment,"void main() {","\tgl_FragColor = vec4( 0.5 * normalize( vNormal ) + 0.5, opacity );",Ht.ShaderChunk.logdepthbuf_fragment,"}"].join("\n")},normalmap:{uniforms:Ht.UniformsUtils.merge([Ht.UniformsLib.fog,Ht.UniformsLib.lights,Ht.UniformsLib.shadowmap,{enableAO:{type:"i",value:0},enableDiffuse:{type:"i",value:0},enableSpecular:{type:"i",value:0},enableReflection:{type:"i",value:0},enableDisplacement:{type:"i",value:0},tDisplacement:{type:"t",value:null},tDiffuse:{type:"t",value:null},tCube:{type:"t",value:null},tNormal:{type:"t",value:null},tSpecular:{type:"t",value:null},tAO:{type:"t",value:null},uNormalScale:{type:"v2",value:new Ht.Vector2(1,1)},uDisplacementBias:{type:"f",value:0},uDisplacementScale:{type:"f",value:1},diffuse:{type:"c",value:new Ht.Color(16777215)},specular:{type:"c",value:new Ht.Color(1118481)},ambient:{type:"c",value:new Ht.Color(16777215)},shininess:{type:"f",value:30},opacity:{type:"f",value:1},useRefract:{type:"i",value:0},refractionRatio:{type:"f",value:.98},reflectivity:{type:"f",value:.5},uOffset:{type:"v2",value:new Ht.Vector2(0,0)},uRepeat:{type:"v2",value:new Ht.Vector2(1,1)},wrapRGB:{type:"v3",value:new Ht.Vector3(1,1,1)}}]),fragmentShader:["uniform vec3 ambient;","uniform vec3 diffuse;","uniform vec3 specular;","uniform float shininess;","uniform float opacity;","uniform bool enableDiffuse;","uniform bool enableSpecular;","uniform bool enableAO;","uniform bool enableReflection;","uniform sampler2D tDiffuse;","uniform sampler2D tNormal;","uniform sampler2D tSpecular;","uniform sampler2D tAO;","uniform samplerCube tCube;","uniform vec2 uNormalScale;","uniform bool useRefract;","uniform float refractionRatio;","uniform float reflectivity;","varying vec3 vTangent;","varying vec3 vBinormal;","varying vec3 vNormal;","varying vec2 vUv;","uniform vec3 ambientLightColor;","#if MAX_DIR_LIGHTS > 0","\tuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];","\tuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];","#endif","#if MAX_HEMI_LIGHTS > 0","\tuniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];","\tuniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];","\tuniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];","#endif","#if MAX_POINT_LIGHTS > 0","\tuniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];","\tuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];","\tuniform float pointLightDistance[ MAX_POINT_LIGHTS ];","#endif","#if MAX_SPOT_LIGHTS > 0","\tuniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];","\tuniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];","\tuniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];","\tuniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];","\tuniform float spotLightExponent[ MAX_SPOT_LIGHTS ];","\tuniform float spotLightDistance[ MAX_SPOT_LIGHTS ];","#endif","#ifdef WRAP_AROUND","\tuniform vec3 wrapRGB;","#endif","varying vec3 vWorldPosition;","varying vec3 vViewPosition;",Ht.ShaderChunk.shadowmap_pars_fragment,Ht.ShaderChunk.fog_pars_fragment,Ht.ShaderChunk.logdepthbuf_pars_fragment,"void main() {",Ht.ShaderChunk.logdepthbuf_fragment,"\tgl_FragColor = vec4( vec3( 1.0 ), opacity );","\tvec3 specularTex = vec3( 1.0 );","\tvec3 normalTex = texture2D( tNormal, vUv ).xyz * 2.0 - 1.0;","\tnormalTex.xy *= uNormalScale;","\tnormalTex = normalize( normalTex );","\tif( enableDiffuse ) {","\t\t#ifdef GAMMA_INPUT","\t\t\tvec4 texelColor = texture2D( tDiffuse, vUv );","\t\t\ttexelColor.xyz *= texelColor.xyz;","\t\t\tgl_FragColor = gl_FragColor * texelColor;","\t\t#else","\t\t\tgl_FragColor = gl_FragColor * texture2D( tDiffuse, vUv );","\t\t#endif","\t}","\tif( enableAO ) {","\t\t#ifdef GAMMA_INPUT","\t\t\tvec4 aoColor = texture2D( tAO, vUv );","\t\t\taoColor.xyz *= aoColor.xyz;","\t\t\tgl_FragColor.xyz = gl_FragColor.xyz * aoColor.xyz;","\t\t#else","\t\t\tgl_FragColor.xyz = gl_FragColor.xyz * texture2D( tAO, vUv ).xyz;","\t\t#endif","\t}",Ht.ShaderChunk.alphatest_fragment,"\tif( enableSpecular )","\t\tspecularTex = texture2D( tSpecular, vUv ).xyz;","\tmat3 tsb = mat3( normalize( vTangent ), normalize( vBinormal ), normalize( vNormal ) );","\tvec3 finalNormal = tsb * normalTex;","\t#ifdef FLIP_SIDED","\t\tfinalNormal = -finalNormal;","\t#endif","\tvec3 normal = normalize( finalNormal );","\tvec3 viewPosition = normalize( vViewPosition );","\t#if MAX_POINT_LIGHTS > 0","\t\tvec3 pointDiffuse = vec3( 0.0 );","\t\tvec3 pointSpecular = vec3( 0.0 );","\t\tfor ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {","\t\t\tvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );","\t\t\tvec3 pointVector = lPosition.xyz + vViewPosition.xyz;","\t\t\tfloat pointDistance = 1.0;","\t\t\tif ( pointLightDistance[ i ] > 0.0 )","\t\t\t\tpointDistance = 1.0 - min( ( length( pointVector ) / pointLightDistance[ i ] ), 1.0 );","\t\t\tpointVector = normalize( pointVector );","\t\t\t#ifdef WRAP_AROUND","\t\t\t\tfloat pointDiffuseWeightFull = max( dot( normal, pointVector ), 0.0 );","\t\t\t\tfloat pointDiffuseWeightHalf = max( 0.5 * dot( normal, pointVector ) + 0.5, 0.0 );","\t\t\t\tvec3 pointDiffuseWeight = mix( vec3( pointDiffuseWeightFull ), vec3( pointDiffuseWeightHalf ), wrapRGB );","\t\t\t#else","\t\t\t\tfloat pointDiffuseWeight = max( dot( normal, pointVector ), 0.0 );","\t\t\t#endif","\t\t\tpointDiffuse += pointDistance * pointLightColor[ i ] * diffuse * pointDiffuseWeight;","\t\t\tvec3 pointHalfVector = normalize( pointVector + viewPosition );","\t\t\tfloat pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );","\t\t\tfloat pointSpecularWeight = specularTex.r * max( pow( pointDotNormalHalf, shininess ), 0.0 );","\t\t\tfloat specularNormalization = ( shininess + 2.0 ) / 8.0;","\t\t\tvec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( pointVector, pointHalfVector ), 0.0 ), 5.0 );","\t\t\tpointSpecular += schlick * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * pointDistance * specularNormalization;","\t\t}","\t#endif","\t#if MAX_SPOT_LIGHTS > 0","\t\tvec3 spotDiffuse = vec3( 0.0 );","\t\tvec3 spotSpecular = vec3( 0.0 );","\t\tfor ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {","\t\t\tvec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );","\t\t\tvec3 spotVector = lPosition.xyz + vViewPosition.xyz;","\t\t\tfloat spotDistance = 1.0;","\t\t\tif ( spotLightDistance[ i ] > 0.0 )","\t\t\t\tspotDistance = 1.0 - min( ( length( spotVector ) / spotLightDistance[ i ] ), 1.0 );","\t\t\tspotVector = normalize( spotVector );","\t\t\tfloat spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - vWorldPosition ) );","\t\t\tif ( spotEffect > spotLightAngleCos[ i ] ) {","\t\t\t\tspotEffect = max( pow( max( spotEffect, 0.0 ), spotLightExponent[ i ] ), 0.0 );","\t\t\t\t#ifdef WRAP_AROUND","\t\t\t\t\tfloat spotDiffuseWeightFull = max( dot( normal, spotVector ), 0.0 );","\t\t\t\t\tfloat spotDiffuseWeightHalf = max( 0.5 * dot( normal, spotVector ) + 0.5, 0.0 );","\t\t\t\t\tvec3 spotDiffuseWeight = mix( vec3( spotDiffuseWeightFull ), vec3( spotDiffuseWeightHalf ), wrapRGB );","\t\t\t\t#else","\t\t\t\t\tfloat spotDiffuseWeight = max( dot( normal, spotVector ), 0.0 );","\t\t\t\t#endif","\t\t\t\tspotDiffuse += spotDistance * spotLightColor[ i ] * diffuse * spotDiffuseWeight * spotEffect;","\t\t\t\tvec3 spotHalfVector = normalize( spotVector + viewPosition );","\t\t\t\tfloat spotDotNormalHalf = max( dot( normal, spotHalfVector ), 0.0 );","\t\t\t\tfloat spotSpecularWeight = specularTex.r * max( pow( spotDotNormalHalf, shininess ), 0.0 );","\t\t\t\tfloat specularNormalization = ( shininess + 2.0 ) / 8.0;","\t\t\t\tvec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( spotVector, spotHalfVector ), 0.0 ), 5.0 );","\t\t\t\tspotSpecular += schlick * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * spotDistance * specularNormalization * spotEffect;","\t\t\t}","\t\t}","\t#endif","\t#if MAX_DIR_LIGHTS > 0","\t\tvec3 dirDiffuse = vec3( 0.0 );","\t\tvec3 dirSpecular = vec3( 0.0 );","\t\tfor( int i = 0; i < MAX_DIR_LIGHTS; i++ ) {","\t\t\tvec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );","\t\t\tvec3 dirVector = normalize( lDirection.xyz );","\t\t\t#ifdef WRAP_AROUND","\t\t\t\tfloat directionalLightWeightingFull = max( dot( normal, dirVector ), 0.0 );","\t\t\t\tfloat directionalLightWeightingHalf = max( 0.5 * dot( normal, dirVector ) + 0.5, 0.0 );","\t\t\t\tvec3 dirDiffuseWeight = mix( vec3( directionalLightWeightingFull ), vec3( directionalLightWeightingHalf ), wrapRGB );","\t\t\t#else","\t\t\t\tfloat dirDiffuseWeight = max( dot( normal, dirVector ), 0.0 );","\t\t\t#endif","\t\t\tdirDiffuse += directionalLightColor[ i ] * diffuse * dirDiffuseWeight;","\t\t\tvec3 dirHalfVector = normalize( dirVector + viewPosition );","\t\t\tfloat dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );","\t\t\tfloat dirSpecularWeight = specularTex.r * max( pow( dirDotNormalHalf, shininess ), 0.0 );","\t\t\tfloat specularNormalization = ( shininess + 2.0 ) / 8.0;","\t\t\tvec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( dirVector, dirHalfVector ), 0.0 ), 5.0 );","\t\t\tdirSpecular += schlick * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization;","\t\t}","\t#endif","\t#if MAX_HEMI_LIGHTS > 0","\t\tvec3 hemiDiffuse = vec3( 0.0 );","\t\tvec3 hemiSpecular = vec3( 0.0 );","\t\tfor( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {","\t\t\tvec4 lDirection = viewMatrix * vec4( hemisphereLightDirection[ i ], 0.0 );","\t\t\tvec3 lVector = normalize( lDirection.xyz );","\t\t\tfloat dotProduct = dot( normal, lVector );","\t\t\tfloat hemiDiffuseWeight = 0.5 * dotProduct + 0.5;","\t\t\tvec3 hemiColor = mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );","\t\t\themiDiffuse += diffuse * hemiColor;","\t\t\tvec3 hemiHalfVectorSky = normalize( lVector + viewPosition );","\t\t\tfloat hemiDotNormalHalfSky = 0.5 * dot( normal, hemiHalfVectorSky ) + 0.5;","\t\t\tfloat hemiSpecularWeightSky = specularTex.r * max( pow( max( hemiDotNormalHalfSky, 0.0 ), shininess ), 0.0 );","\t\t\tvec3 lVectorGround = -lVector;","\t\t\tvec3 hemiHalfVectorGround = normalize( lVectorGround + viewPosition );","\t\t\tfloat hemiDotNormalHalfGround = 0.5 * dot( normal, hemiHalfVectorGround ) + 0.5;","\t\t\tfloat hemiSpecularWeightGround = specularTex.r * max( pow( max( hemiDotNormalHalfGround, 0.0 ), shininess ), 0.0 );","\t\t\tfloat dotProductGround = dot( normal, lVectorGround );","\t\t\tfloat specularNormalization = ( shininess + 2.0 ) / 8.0;","\t\t\tvec3 schlickSky = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVector, hemiHalfVectorSky ), 0.0 ), 5.0 );","\t\t\tvec3 schlickGround = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVectorGround, hemiHalfVectorGround ), 0.0 ), 5.0 );","\t\t\themiSpecular += hemiColor * specularNormalization * ( schlickSky * hemiSpecularWeightSky * max( dotProduct, 0.0 ) + schlickGround * hemiSpecularWeightGround * max( dotProductGround, 0.0 ) );","\t\t}","\t#endif","\tvec3 totalDiffuse = vec3( 0.0 );","\tvec3 totalSpecular = vec3( 0.0 );","\t#if MAX_DIR_LIGHTS > 0","\t\ttotalDiffuse += dirDiffuse;","\t\ttotalSpecular += dirSpecular;","\t#endif","\t#if MAX_HEMI_LIGHTS > 0","\t\ttotalDiffuse += hemiDiffuse;","\t\ttotalSpecular += hemiSpecular;","\t#endif","\t#if MAX_POINT_LIGHTS > 0","\t\ttotalDiffuse += pointDiffuse;","\t\ttotalSpecular += pointSpecular;","\t#endif","\t#if MAX_SPOT_LIGHTS > 0","\t\ttotalDiffuse += spotDiffuse;","\t\ttotalSpecular += spotSpecular;","\t#endif","\t#ifdef METAL","\t\tgl_FragColor.xyz = gl_FragColor.xyz * ( totalDiffuse + ambientLightColor * ambient + totalSpecular );","\t#else","\t\tgl_FragColor.xyz = gl_FragColor.xyz * ( totalDiffuse + ambientLightColor * ambient ) + totalSpecular;","\t#endif","\tif ( enableReflection ) {","\t\tvec3 vReflect;","\t\tvec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );","\t\tif ( useRefract ) {","\t\t\tvReflect = refract( cameraToVertex, normal, refractionRatio );","\t\t} else {","\t\t\tvReflect = reflect( cameraToVertex, normal );","\t\t}","\t\tvec4 cubeColor = textureCube( tCube, vec3( -vReflect.x, vReflect.yz ) );","\t\t#ifdef GAMMA_INPUT","\t\t\tcubeColor.xyz *= cubeColor.xyz;","\t\t#endif","\t\tgl_FragColor.xyz = mix( gl_FragColor.xyz, cubeColor.xyz, specularTex.r * reflectivity );","\t}",Ht.ShaderChunk.shadowmap_fragment,Ht.ShaderChunk.linear_to_gamma_fragment,Ht.ShaderChunk.fog_fragment,"}"].join("\n"),vertexShader:["attribute vec4 tangent;","uniform vec2 uOffset;","uniform vec2 uRepeat;","uniform bool enableDisplacement;","#ifdef VERTEX_TEXTURES","\tuniform sampler2D tDisplacement;","\tuniform float uDisplacementScale;","\tuniform float uDisplacementBias;","#endif","varying vec3 vTangent;","varying vec3 vBinormal;","varying vec3 vNormal;","varying vec2 vUv;","varying vec3 vWorldPosition;","varying vec3 vViewPosition;",Ht.ShaderChunk.skinning_pars_vertex,Ht.ShaderChunk.shadowmap_pars_vertex,Ht.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",Ht.ShaderChunk.skinbase_vertex,Ht.ShaderChunk.skinnormal_vertex,"\t#ifdef USE_SKINNING","\t\tvNormal = normalize( normalMatrix * skinnedNormal.xyz );","\t\tvec4 skinnedTangent = skinMatrix * vec4( tangent.xyz, 0.0 );","\t\tvTangent = normalize( normalMatrix * skinnedTangent.xyz );","\t#else","\t\tvNormal = normalize( normalMatrix * normal );","\t\tvTangent = normalize( normalMatrix * tangent.xyz );","\t#endif","\tvBinormal = normalize( cross( vNormal, vTangent ) * tangent.w );","\tvUv = uv * uRepeat + uOffset;","\tvec3 displacedPosition;","\t#ifdef VERTEX_TEXTURES","\t\tif ( enableDisplacement ) {","\t\t\tvec3 dv = texture2D( tDisplacement, uv ).xyz;","\t\t\tfloat df = uDisplacementScale * dv.x + uDisplacementBias;","\t\t\tdisplacedPosition = position + normalize( normal ) * df;","\t\t} else {","\t\t\t#ifdef USE_SKINNING","\t\t\t\tvec4 skinVertex = bindMatrix * vec4( position, 1.0 );","\t\t\t\tvec4 skinned = vec4( 0.0 );","\t\t\t\tskinned += boneMatX * skinVertex * skinWeight.x;","\t\t\t\tskinned += boneMatY * skinVertex * skinWeight.y;","\t\t\t\tskinned += boneMatZ * skinVertex * skinWeight.z;","\t\t\t\tskinned += boneMatW * skinVertex * skinWeight.w;","\t\t\t\tskinned  = bindMatrixInverse * skinned;","\t\t\t\tdisplacedPosition = skinned.xyz;","\t\t\t#else","\t\t\t\tdisplacedPosition = position;","\t\t\t#endif","\t\t}","\t#else","\t\t#ifdef USE_SKINNING","\t\t\tvec4 skinVertex = bindMatrix * vec4( position, 1.0 );","\t\t\tvec4 skinned = vec4( 0.0 );","\t\t\tskinned += boneMatX * skinVertex * skinWeight.x;","\t\t\tskinned += boneMatY * skinVertex * skinWeight.y;","\t\t\tskinned += boneMatZ * skinVertex * skinWeight.z;","\t\t\tskinned += boneMatW * skinVertex * skinWeight.w;","\t\t\tskinned  = bindMatrixInverse * skinned;","\t\t\tdisplacedPosition = skinned.xyz;","\t\t#else","\t\t\tdisplacedPosition = position;","\t\t#endif","\t#endif","\tvec4 mvPosition = modelViewMatrix * vec4( displacedPosition, 1.0 );","\tvec4 worldPosition = modelMatrix * vec4( displacedPosition, 1.0 );","\tgl_Position = projectionMatrix * mvPosition;",Ht.ShaderChunk.logdepthbuf_vertex,"\tvWorldPosition = worldPosition.xyz;","\tvViewPosition = -mvPosition.xyz;","\t#ifdef USE_SHADOWMAP","\t\tfor( int i = 0; i < MAX_SHADOWS; i ++ ) {","\t\t\tvShadowCoord[ i ] = shadowMatrix[ i ] * worldPosition;","\t\t}","\t#endif","}"].join("\n")},cube:{uniforms:{tCube:{type:"t",value:null},tFlip:{type:"f",value:-1}},vertexShader:["varying vec3 vWorldPosition;",Ht.ShaderChunk.logdepthbuf_pars_vertex,"void main() {","\tvec4 worldPosition = modelMatrix * vec4( position, 1.0 );","\tvWorldPosition = worldPosition.xyz;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );",Ht.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),fragmentShader:["uniform samplerCube tCube;","uniform float tFlip;","varying vec3 vWorldPosition;",Ht.ShaderChunk.logdepthbuf_pars_fragment,"void main() {","\tgl_FragColor = textureCube( tCube, vec3( tFlip * vWorldPosition.x, vWorldPosition.yz ) );",Ht.ShaderChunk.logdepthbuf_fragment,"}"].join("\n")},depthRGBA:{uniforms:{},vertexShader:[Ht.ShaderChunk.morphtarget_pars_vertex,Ht.ShaderChunk.skinning_pars_vertex,Ht.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",Ht.ShaderChunk.skinbase_vertex,Ht.ShaderChunk.morphtarget_vertex,Ht.ShaderChunk.skinning_vertex,Ht.ShaderChunk.default_vertex,Ht.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),fragmentShader:[Ht.ShaderChunk.logdepthbuf_pars_fragment,"vec4 pack_depth( const in float depth ) {","\tconst vec4 bit_shift = vec4( 256.0 * 256.0 * 256.0, 256.0 * 256.0, 256.0, 1.0 );","\tconst vec4 bit_mask = vec4( 0.0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0 );","\tvec4 res = mod( depth * bit_shift * vec4( 255 ), vec4( 256 ) ) / vec4( 255 );","\tres -= res.xxyz * bit_mask;","\treturn res;","}","void main() {",Ht.ShaderChunk.logdepthbuf_fragment,"\t#ifdef USE_LOGDEPTHBUF_EXT","\t\tgl_FragData[ 0 ] = pack_depth( gl_FragDepthEXT );","\t#else","\t\tgl_FragData[ 0 ] = pack_depth( gl_FragCoord.z );","\t#endif","}"].join("\n")}},Ht.WebGLRenderer=function(e){console.log("THREE.WebGLRenderer",Ht.REVISION);var t=void 0!==(e=e||{}).canvas?e.canvas:document.createElement("canvas"),r=void 0!==e.context?e.context:null,n=void 0!==e.precision?e.precision:"highp",i=void 0!==e.alpha&&e.alpha,o=void 0===e.depth||e.depth,a=void 0===e.stencil||e.stencil,s=void 0!==e.antialias&&e.antialias,l=void 0===e.premultipliedAlpha||e.premultipliedAlpha,h=void 0!==e.preserveDrawingBuffer&&e.preserveDrawingBuffer,c=void 0!==e.logarithmicDepthBuffer&&e.logarithmicDepthBuffer,u=new Ht.Color(0),d=0,f=[],p={},m=[],g=[],v=[],y=[],x=[];this.domElement=t,this.context=null,this.devicePixelRatio=void 0!==e.devicePixelRatio?e.devicePixelRatio:void 0!==self.devicePixelRatio?self.devicePixelRatio:1,this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.gammaInput=!1,this.gammaOutput=!1,this.shadowMapEnabled=!1,this.shadowMapType=Ht.PCFShadowMap,this.shadowMapCullFace=Ht.CullFaceFront,this.shadowMapDebug=!1,this.shadowMapCascade=!1,this.maxMorphTargets=8,this.maxMorphNormals=4,this.autoScaleCubemaps=!0,this.info={memory:{programs:0,geometries:0,textures:0},render:{calls:0,vertices:0,faces:0,points:0}};var b,_=this,w=[],M=null,S=null,T=-1,C=-1,E=null,A=0,L=-1,P=-1,D=-1,R=-1,k=-1,F=-1,U=-1,N=-1,B=null,V=null,z=null,O=null,I=0,H=0,G=t.width,W=t.height,j=0,X=0,q=new Uint8Array(16),Y=new Uint8Array(16),K=new Ht.Frustum,Q=new Ht.Matrix4,Z=new Ht.Matrix4,$=new Ht.Vector3,J=new Ht.Vector3,ee=!0,te={ambient:[0,0,0],directional:{length:0,colors:[],positions:[]},point:{length:0,colors:[],positions:[],distances:[]},spot:{length:0,colors:[],positions:[],distances:[],directions:[],anglesCos:[],exponents:[]},hemi:{length:0,skyColors:[],groundColors:[],positions:[]}};try{var re={alpha:i,depth:o,stencil:a,antialias:s,premultipliedAlpha:l,preserveDrawingBuffer:h};if(null===(b=r||t.getContext("webgl",re)||t.getContext("experimental-webgl",re)))throw null!==t.getContext("webgl")?"Error creating WebGL context with your selected attributes.":"Error creating WebGL context."}catch(e){console.error(e)}void 0===b.getShaderPrecisionFormat&&(b.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}});var ne=new Ht.WebGLExtensions(b);ne.get("OES_texture_float"),ne.get("OES_texture_float_linear"),ne.get("OES_standard_derivatives"),c&&ne.get("EXT_frag_depth"),b.clearColor(0,0,0,1),b.clearDepth(1),b.clearStencil(0),b.enable(b.DEPTH_TEST),b.depthFunc(b.LEQUAL),b.frontFace(b.CCW),b.cullFace(b.BACK),b.enable(b.CULL_FACE),b.enable(b.BLEND),b.blendEquation(b.FUNC_ADD),b.blendFunc(b.SRC_ALPHA,b.ONE_MINUS_SRC_ALPHA),b.viewport(I,H,G,W),b.clearColor(u.r,u.g,u.b,d);var ie,oe=(this.context=b).getParameter(b.MAX_TEXTURE_IMAGE_UNITS),ae=b.getParameter(b.MAX_VERTEX_TEXTURE_IMAGE_UNITS),se=b.getParameter(b.MAX_TEXTURE_SIZE),le=b.getParameter(b.MAX_CUBE_MAP_TEXTURE_SIZE),he=0<ae,ce=he&&ne.get("OES_texture_float"),ue=b.getShaderPrecisionFormat(b.VERTEX_SHADER,b.HIGH_FLOAT),de=b.getShaderPrecisionFormat(b.VERTEX_SHADER,b.MEDIUM_FLOAT),fe=(b.getShaderPrecisionFormat(b.VERTEX_SHADER,b.LOW_FLOAT),b.getShaderPrecisionFormat(b.FRAGMENT_SHADER,b.HIGH_FLOAT)),pe=b.getShaderPrecisionFormat(b.FRAGMENT_SHADER,b.MEDIUM_FLOAT),me=(b.getShaderPrecisionFormat(b.FRAGMENT_SHADER,b.LOW_FLOAT),function(){if(void 0!==ie)return ie;if(ie=[],ne.get("WEBGL_compressed_texture_pvrtc")||ne.get("WEBGL_compressed_texture_s3tc"))for(var e=b.getParameter(b.COMPRESSED_TEXTURE_FORMATS),t=0;t<e.length;t++)ie.push(e[t]);return ie}),ge=0<ue.precision&&0<fe.precision,ve=0<de.precision&&0<pe.precision;"highp"!==n||ge||(ve?(n="mediump",console.warn("THREE.WebGLRenderer: highp not supported, using mediump.")):(n="lowp",console.warn("THREE.WebGLRenderer: highp and mediump not supported, using lowp."))),"mediump"!==n||ve||(n="lowp",console.warn("THREE.WebGLRenderer: mediump not supported, using lowp."));var ye,xe=new Ht.ShadowMapPlugin(this,f,p,m),be=new Ht.SpritePlugin(this,y),_e=new Ht.LensFlarePlugin(this,x);function we(e){var t,r;if(e.__webglVertexBuffer=b.createBuffer(),e.__webglNormalBuffer=b.createBuffer(),e.__webglTangentBuffer=b.createBuffer(),e.__webglColorBuffer=b.createBuffer(),e.__webglUVBuffer=b.createBuffer(),e.__webglUV2Buffer=b.createBuffer(),e.__webglSkinIndicesBuffer=b.createBuffer(),e.__webglSkinWeightsBuffer=b.createBuffer(),e.__webglFaceBuffer=b.createBuffer(),e.__webglLineBuffer=b.createBuffer(),e.numMorphTargets)for(e.__webglMorphTargetsBuffers=[],t=0,r=e.numMorphTargets;t<r;t++)e.__webglMorphTargetsBuffers.push(b.createBuffer());if(e.numMorphNormals)for(e.__webglMorphNormalsBuffers=[],t=0,r=e.numMorphNormals;t<r;t++)e.__webglMorphNormalsBuffers.push(b.createBuffer());_.info.memory.geometries++}this.getContext=function(){return b},this.supportsVertexTextures=function(){return he},this.supportsFloatTextures=function(){return ne.get("OES_texture_float")},this.supportsStandardDerivatives=function(){return ne.get("OES_standard_derivatives")},this.supportsCompressedTextureS3TC=function(){return ne.get("WEBGL_compressed_texture_s3tc")},this.supportsCompressedTexturePVRTC=function(){return ne.get("WEBGL_compressed_texture_pvrtc")},this.supportsBlendMinMax=function(){return ne.get("EXT_blend_minmax")},this.getMaxAnisotropy=function(){if(void 0!==ye)return ye;var e=ne.get("EXT_texture_filter_anisotropic");return ye=null!==e?b.getParameter(e.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0},this.getPrecision=function(){return n},this.setSize=function(e,r,n){t.width=e*this.devicePixelRatio,t.height=r*this.devicePixelRatio,!1!==n&&(t.style.width=e+"px",t.style.height=r+"px"),this.setViewport(0,0,e,r)},this.setViewport=function(e,t,r,n){I=e*this.devicePixelRatio,H=t*this.devicePixelRatio,G=r*this.devicePixelRatio,W=n*this.devicePixelRatio,b.viewport(I,H,G,W)},this.setScissor=function(e,t,r,n){b.scissor(e*this.devicePixelRatio,t*this.devicePixelRatio,r*this.devicePixelRatio,n*this.devicePixelRatio)},this.enableScissorTest=function(e){e?b.enable(b.SCISSOR_TEST):b.disable(b.SCISSOR_TEST)},this.setClearColor=function(e,t){u.set(e),d=void 0!==t?t:1,b.clearColor(u.r,u.g,u.b,d)},this.setClearColorHex=function(e,t){console.warn("THREE.WebGLRenderer: .setClearColorHex() is being removed. Use .setClearColor() instead."),this.setClearColor(e,t)},this.getClearColor=function(){return u},this.getClearAlpha=function(){return d},this.clear=function(e,t,r){var n=0;(void 0===e||e)&&(n|=b.COLOR_BUFFER_BIT),(void 0===t||t)&&(n|=b.DEPTH_BUFFER_BIT),(void 0===r||r)&&(n|=b.STENCIL_BUFFER_BIT),b.clear(n)},this.clearColor=function(){b.clear(b.COLOR_BUFFER_BIT)},this.clearDepth=function(){b.clear(b.DEPTH_BUFFER_BIT)},this.clearStencil=function(){b.clear(b.STENCIL_BUFFER_BIT)},this.clearTarget=function(e,t,r,n){this.setRenderTarget(e),this.clear(t,r,n)},this.resetGLState=function(){T=C=P=L=N=U=D=-1,ee=!(E=M=null)};var Me=function e(t){t.target.traverse(function(t){t.removeEventListener("remove",e),function(e){e instanceof Ht.Mesh||e instanceof Ht.PointCloud||e instanceof Ht.Line?delete p[e.id]:(e instanceof Ht.ImmediateRenderObject||e.immediateRenderCallback)&&function(e,t){for(var r=e.length-1;0<=r;r--)e[r].object===t&&e.splice(r,1)}(m,e),delete e.__webglInit,delete e._modelViewMatrix,delete e._normalMatrix,delete e.__webglActive}(t)})},Se=function e(t){var r=t.target;r.removeEventListener("dispose",e),Le(r)},Te=function e(t){var r=t.target;r.removeEventListener("dispose",e),Pe(r),_.info.memory.textures--},Ce=function e(t){var r=t.target;r.removeEventListener("dispose",e),De(r),_.info.memory.textures--},Ee=function e(t){var r=t.target;r.removeEventListener("dispose",e),Re(r)},Ae=function(e){for(var t=["__webglVertexBuffer","__webglNormalBuffer","__webglTangentBuffer","__webglColorBuffer","__webglUVBuffer","__webglUV2Buffer","__webglSkinIndicesBuffer","__webglSkinWeightsBuffer","__webglFaceBuffer","__webglLineBuffer","__webglLineDistanceBuffer"],r=0,n=t.length;r<n;r++)void 0!==e[i=t[r]]&&(b.deleteBuffer(e[i]),delete e[i]);if(void 0!==e.__webglCustomAttributesList){for(var i in e.__webglCustomAttributesList)b.deleteBuffer(e.__webglCustomAttributesList[i].buffer);delete e.__webglCustomAttributesList}_.info.memory.geometries--},Le=function(e){if(delete e.__webglInit,e instanceof Ht.BufferGeometry){for(var t in e.attributes){var r=e.attributes[t];void 0!==r.buffer&&(b.deleteBuffer(r.buffer),delete r.buffer)}_.info.memory.geometries--}else{var n=Ye[e.id];if(void 0!==n){for(var i=0,o=n.length;i<o;i++){var a=n[i];if(void 0!==a.numMorphTargets){for(var s=0,l=a.numMorphTargets;s<l;s++)b.deleteBuffer(a.__webglMorphTargetsBuffers[s]);delete a.__webglMorphTargetsBuffers}if(void 0!==a.numMorphNormals){for(s=0,l=a.numMorphNormals;s<l;s++)b.deleteBuffer(a.__webglMorphNormalsBuffers[s]);delete a.__webglMorphNormalsBuffers}Ae(a)}delete Ye[e.id]}else Ae(e)}C=-1},Pe=function(e){if(e.image&&e.image.__webglTextureCube)b.deleteTexture(e.image.__webglTextureCube),delete e.image.__webglTextureCube;else{if(void 0===e.__webglInit)return;b.deleteTexture(e.__webglTexture),delete e.__webglTexture,delete e.__webglInit}},De=function(e){if(e&&void 0!==e.__webglTexture){if(b.deleteTexture(e.__webglTexture),delete e.__webglTexture,e instanceof Ht.WebGLRenderTargetCube)for(var t=0;t<6;t++)b.deleteFramebuffer(e.__webglFramebuffer[t]),b.deleteRenderbuffer(e.__webglRenderbuffer[t]);else b.deleteFramebuffer(e.__webglFramebuffer),b.deleteRenderbuffer(e.__webglRenderbuffer);delete e.__webglFramebuffer,delete e.__webglRenderbuffer}},Re=function(e){var t=e.program.program;if(void 0!==t){var r,n,i;e.program=void 0;var o=!1;for(r=0,n=w.length;r<n;r++)if((i=w[r]).program===t){i.usedTimes--,0===i.usedTimes&&(o=!0);break}if(!0===o){var a=[];for(r=0,n=w.length;r<n;r++)(i=w[r]).program!==t&&a.push(i);w=a,b.deleteProgram(t),_.info.memory.programs--}}};function ke(e){var t=e.geometry,r=e.material,n=t.vertices.length;if(r.attributes)for(var i in void 0===t.__webglCustomAttributesList&&(t.__webglCustomAttributesList=[]),r.attributes){var o=r.attributes[i];if(!o.__webglInitialized||o.createUniqueBuffers){o.__webglInitialized=!0;var a=1;"v2"===o.type?a=2:"v3"===o.type?a=3:"v4"===o.type?a=4:"c"===o.type&&(a=3),o.size=a,o.array=new Float32Array(n*a),o.buffer=b.createBuffer(),o.buffer.belongsToAttribute=i,o.needsUpdate=!0}t.__webglCustomAttributesList.push(o)}}function Fe(e,t){var r=t.geometry,n=e.faces3,i=3*n.length,o=1*n.length,a=3*n.length,s=Ue(t,e);e.__vertexArray=new Float32Array(3*i),e.__normalArray=new Float32Array(3*i),e.__colorArray=new Float32Array(3*i),e.__uvArray=new Float32Array(2*i),1<r.faceVertexUvs.length&&(e.__uv2Array=new Float32Array(2*i)),r.hasTangents&&(e.__tangentArray=new Float32Array(4*i)),t.geometry.skinWeights.length&&t.geometry.skinIndices.length&&(e.__skinIndexArray=new Float32Array(4*i),e.__skinWeightArray=new Float32Array(4*i));var l,h,c=null!==ne.get("OES_element_index_uint")&&21845<o?Uint32Array:Uint16Array;if(e.__typeArray=c,e.__faceArray=new c(3*o),e.__lineArray=new c(2*a),e.numMorphTargets)for(e.__morphTargetsArrays=[],l=0,h=e.numMorphTargets;l<h;l++)e.__morphTargetsArrays.push(new Float32Array(3*i));if(e.numMorphNormals)for(e.__morphNormalsArrays=[],l=0,h=e.numMorphNormals;l<h;l++)e.__morphNormalsArrays.push(new Float32Array(3*i));if(e.__webglFaceCount=3*o,e.__webglLineCount=2*a,s.attributes)for(var u in void 0===e.__webglCustomAttributesList&&(e.__webglCustomAttributesList=[]),s.attributes){var d=s.attributes[u],f={};for(var p in d)f[p]=d[p];if(!f.__webglInitialized||f.createUniqueBuffers){f.__webglInitialized=!0;var m=1;"v2"===f.type?m=2:"v3"===f.type?m=3:"v4"===f.type?m=4:"c"===f.type&&(m=3),f.size=m,f.array=new Float32Array(i*m),f.buffer=b.createBuffer(),f.buffer.belongsToAttribute=u,d.needsUpdate=!0,f.__original=d}e.__webglCustomAttributesList.push(f)}e.__inittedArrays=!0}function Ue(e,t){return e.material instanceof Ht.MeshFaceMaterial?e.material.materials[t.materialIndex]:e.material}function Ne(e,t,r,n,i){if(e.__inittedArrays){var o,a,s,l,h,c,u,d,f,p,m,g,v,y,x,_,w,M,S,T,C,E,A,L,P,D,R,k,F,U,N,B,V,z,O,I,H,G,W,j,X,q,Y=(o=i)&&void 0!==o.shading&&o.shading===Ht.SmoothShading,K=0,Q=0,Z=0,$=0,J=0,ee=0,te=0,re=0,ne=0,ie=0,oe=0,ae=0,se=e.__vertexArray,le=e.__uvArray,he=e.__uv2Array,ce=e.__normalArray,ue=e.__tangentArray,de=e.__colorArray,fe=e.__skinIndexArray,pe=e.__skinWeightArray,me=e.__morphTargetsArrays,ge=e.__morphNormalsArrays,ve=e.__webglCustomAttributesList,ye=e.__faceArray,xe=e.__lineArray,be=t.geometry,_e=be.verticesNeedUpdate,we=be.elementsNeedUpdate,Me=be.uvsNeedUpdate,Se=be.normalsNeedUpdate,Te=be.tangentsNeedUpdate,Ce=be.colorsNeedUpdate,Ee=be.morphTargetsNeedUpdate,Ae=be.vertices,Le=e.faces3,Pe=be.faces,De=be.faceVertexUvs[0],Re=be.faceVertexUvs[1],ke=(be.colors,be.skinIndices),Fe=be.skinWeights,Ue=be.morphTargets,Ne=be.morphNormals;if(_e){for(a=0,s=Le.length;a<s;a++)g=Ae[(l=Pe[Le[a]]).a],v=Ae[l.b],y=Ae[l.c],se[Q]=g.x,se[Q+1]=g.y,se[Q+2]=g.z,se[Q+3]=v.x,se[Q+4]=v.y,se[Q+5]=v.z,se[Q+6]=y.x,se[Q+7]=y.y,se[Q+8]=y.z,Q+=9;b.bindBuffer(b.ARRAY_BUFFER,e.__webglVertexBuffer),b.bufferData(b.ARRAY_BUFFER,se,r)}if(Ee)for(O=0,I=Ue.length;O<I;O++){for(a=oe=0,s=Le.length;a<s;a++)l=Pe[W=Le[a]],g=Ue[O].vertices[l.a],v=Ue[O].vertices[l.b],y=Ue[O].vertices[l.c],(H=me[O])[oe]=g.x,H[oe+1]=g.y,H[oe+2]=g.z,H[oe+3]=v.x,H[oe+4]=v.y,H[oe+5]=v.z,H[oe+6]=y.x,H[oe+7]=y.y,H[oe+8]=y.z,i.morphNormals&&(T=Y?(M=(j=Ne[O].vertexNormals[W]).a,S=j.b,j.c):S=M=Ne[O].faceNormals[W],(G=ge[O])[oe]=M.x,G[oe+1]=M.y,G[oe+2]=M.z,G[oe+3]=S.x,G[oe+4]=S.y,G[oe+5]=S.z,G[oe+6]=T.x,G[oe+7]=T.y,G[oe+8]=T.z),oe+=9;b.bindBuffer(b.ARRAY_BUFFER,e.__webglMorphTargetsBuffers[O]),b.bufferData(b.ARRAY_BUFFER,me[O],r),i.morphNormals&&(b.bindBuffer(b.ARRAY_BUFFER,e.__webglMorphNormalsBuffers[O]),b.bufferData(b.ARRAY_BUFFER,ge[O],r))}if(Fe.length){for(a=0,s=Le.length;a<s;a++)L=Fe[(l=Pe[Le[a]]).a],P=Fe[l.b],D=Fe[l.c],pe[ie]=L.x,pe[ie+1]=L.y,pe[ie+2]=L.z,pe[ie+3]=L.w,pe[ie+4]=P.x,pe[ie+5]=P.y,pe[ie+6]=P.z,pe[ie+7]=P.w,pe[ie+8]=D.x,pe[ie+9]=D.y,pe[ie+10]=D.z,pe[ie+11]=D.w,R=ke[l.a],k=ke[l.b],F=ke[l.c],fe[ie]=R.x,fe[ie+1]=R.y,fe[ie+2]=R.z,fe[ie+3]=R.w,fe[ie+4]=k.x,fe[ie+5]=k.y,fe[ie+6]=k.z,fe[ie+7]=k.w,fe[ie+8]=F.x,fe[ie+9]=F.y,fe[ie+10]=F.z,fe[ie+11]=F.w,ie+=12;0<ie&&(b.bindBuffer(b.ARRAY_BUFFER,e.__webglSkinIndicesBuffer),b.bufferData(b.ARRAY_BUFFER,fe,r),b.bindBuffer(b.ARRAY_BUFFER,e.__webglSkinWeightsBuffer),b.bufferData(b.ARRAY_BUFFER,pe,r))}if(Ce){for(a=0,s=Le.length;a<s;a++)u=(l=Pe[Le[a]]).vertexColors,d=l.color,A=3===u.length&&i.vertexColors===Ht.VertexColors?(C=u[0],E=u[1],u[2]):E=C=d,de[ne]=C.r,de[ne+1]=C.g,de[ne+2]=C.b,de[ne+3]=E.r,de[ne+4]=E.g,de[ne+5]=E.b,de[ne+6]=A.r,de[ne+7]=A.g,de[ne+8]=A.b,ne+=9;0<ne&&(b.bindBuffer(b.ARRAY_BUFFER,e.__webglColorBuffer),b.bufferData(b.ARRAY_BUFFER,de,r))}if(Te&&be.hasTangents){for(a=0,s=Le.length;a<s;a++)x=(f=(l=Pe[Le[a]]).vertexTangents)[0],_=f[1],w=f[2],ue[te]=x.x,ue[te+1]=x.y,ue[te+2]=x.z,ue[te+3]=x.w,ue[te+4]=_.x,ue[te+5]=_.y,ue[te+6]=_.z,ue[te+7]=_.w,ue[te+8]=w.x,ue[te+9]=w.y,ue[te+10]=w.z,ue[te+11]=w.w,te+=12;b.bindBuffer(b.ARRAY_BUFFER,e.__webglTangentBuffer),b.bufferData(b.ARRAY_BUFFER,ue,r)}if(Se){for(a=0,s=Le.length;a<s;a++)if(h=(l=Pe[Le[a]]).vertexNormals,c=l.normal,3===h.length&&Y)for(U=0;U<3;U++)B=h[U],ce[ee]=B.x,ce[ee+1]=B.y,ce[ee+2]=B.z,ee+=3;else for(U=0;U<3;U++)ce[ee]=c.x,ce[ee+1]=c.y,ce[ee+2]=c.z,ee+=3;b.bindBuffer(b.ARRAY_BUFFER,e.__webglNormalBuffer),b.bufferData(b.ARRAY_BUFFER,ce,r)}if(Me&&De){for(a=0,s=Le.length;a<s;a++)if(void 0!==(p=De[Le[a]]))for(U=0;U<3;U++)V=p[U],le[Z]=V.x,le[Z+1]=V.y,Z+=2;0<Z&&(b.bindBuffer(b.ARRAY_BUFFER,e.__webglUVBuffer),b.bufferData(b.ARRAY_BUFFER,le,r))}if(Me&&Re){for(a=0,s=Le.length;a<s;a++)if(void 0!==(m=Re[Le[a]]))for(U=0;U<3;U++)z=m[U],he[$]=z.x,he[$+1]=z.y,$+=2;0<$&&(b.bindBuffer(b.ARRAY_BUFFER,e.__webglUV2Buffer),b.bufferData(b.ARRAY_BUFFER,he,r))}if(we){for(a=0,s=Le.length;a<s;a++)ye[J]=K,ye[J+1]=K+1,ye[J+2]=K+2,J+=3,xe[re]=K,xe[re+1]=K+1,xe[re+2]=K,xe[re+3]=K+2,xe[re+4]=K+1,xe[re+5]=K+2,re+=6,K+=3;b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,e.__webglFaceBuffer),b.bufferData(b.ELEMENT_ARRAY_BUFFER,ye,r),b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,e.__webglLineBuffer),b.bufferData(b.ELEMENT_ARRAY_BUFFER,xe,r)}if(ve)for(U=0,N=ve.length;U<N;U++)if((q=ve[U]).__original.needsUpdate){if(ae=0,1===q.size){if(void 0===q.boundTo||"vertices"===q.boundTo)for(a=0,s=Le.length;a<s;a++)l=Pe[Le[a]],q.array[ae]=q.value[l.a],q.array[ae+1]=q.value[l.b],q.array[ae+2]=q.value[l.c],ae+=3;else if("faces"===q.boundTo)for(a=0,s=Le.length;a<s;a++)X=q.value[Le[a]],q.array[ae]=X,q.array[ae+1]=X,q.array[ae+2]=X,ae+=3}else if(2===q.size){if(void 0===q.boundTo||"vertices"===q.boundTo)for(a=0,s=Le.length;a<s;a++)l=Pe[Le[a]],g=q.value[l.a],v=q.value[l.b],y=q.value[l.c],q.array[ae]=g.x,q.array[ae+1]=g.y,q.array[ae+2]=v.x,q.array[ae+3]=v.y,q.array[ae+4]=y.x,q.array[ae+5]=y.y,ae+=6;else if("faces"===q.boundTo)for(a=0,s=Le.length;a<s;a++)y=v=g=X=q.value[Le[a]],q.array[ae]=g.x,q.array[ae+1]=g.y,q.array[ae+2]=v.x,q.array[ae+3]=v.y,q.array[ae+4]=y.x,q.array[ae+5]=y.y,ae+=6}else if(3===q.size){var Be;if(Be="c"===q.type?["r","g","b"]:["x","y","z"],void 0===q.boundTo||"vertices"===q.boundTo)for(a=0,s=Le.length;a<s;a++)l=Pe[Le[a]],g=q.value[l.a],v=q.value[l.b],y=q.value[l.c],q.array[ae]=g[Be[0]],q.array[ae+1]=g[Be[1]],q.array[ae+2]=g[Be[2]],q.array[ae+3]=v[Be[0]],q.array[ae+4]=v[Be[1]],q.array[ae+5]=v[Be[2]],q.array[ae+6]=y[Be[0]],q.array[ae+7]=y[Be[1]],q.array[ae+8]=y[Be[2]],ae+=9;else if("faces"===q.boundTo)for(a=0,s=Le.length;a<s;a++)y=v=g=X=q.value[Le[a]],q.array[ae]=g[Be[0]],q.array[ae+1]=g[Be[1]],q.array[ae+2]=g[Be[2]],q.array[ae+3]=v[Be[0]],q.array[ae+4]=v[Be[1]],q.array[ae+5]=v[Be[2]],q.array[ae+6]=y[Be[0]],q.array[ae+7]=y[Be[1]],q.array[ae+8]=y[Be[2]],ae+=9;else if("faceVertices"===q.boundTo)for(a=0,s=Le.length;a<s;a++)g=(X=q.value[Le[a]])[0],v=X[1],y=X[2],q.array[ae]=g[Be[0]],q.array[ae+1]=g[Be[1]],q.array[ae+2]=g[Be[2]],q.array[ae+3]=v[Be[0]],q.array[ae+4]=v[Be[1]],q.array[ae+5]=v[Be[2]],q.array[ae+6]=y[Be[0]],q.array[ae+7]=y[Be[1]],q.array[ae+8]=y[Be[2]],ae+=9}else if(4===q.size)if(void 0===q.boundTo||"vertices"===q.boundTo)for(a=0,s=Le.length;a<s;a++)l=Pe[Le[a]],g=q.value[l.a],v=q.value[l.b],y=q.value[l.c],q.array[ae]=g.x,q.array[ae+1]=g.y,q.array[ae+2]=g.z,q.array[ae+3]=g.w,q.array[ae+4]=v.x,q.array[ae+5]=v.y,q.array[ae+6]=v.z,q.array[ae+7]=v.w,q.array[ae+8]=y.x,q.array[ae+9]=y.y,q.array[ae+10]=y.z,q.array[ae+11]=y.w,ae+=12;else if("faces"===q.boundTo)for(a=0,s=Le.length;a<s;a++)y=v=g=X=q.value[Le[a]],q.array[ae]=g.x,q.array[ae+1]=g.y,q.array[ae+2]=g.z,q.array[ae+3]=g.w,q.array[ae+4]=v.x,q.array[ae+5]=v.y,q.array[ae+6]=v.z,q.array[ae+7]=v.w,q.array[ae+8]=y.x,q.array[ae+9]=y.y,q.array[ae+10]=y.z,q.array[ae+11]=y.w,ae+=12;else if("faceVertices"===q.boundTo)for(a=0,s=Le.length;a<s;a++)g=(X=q.value[Le[a]])[0],v=X[1],y=X[2],q.array[ae]=g.x,q.array[ae+1]=g.y,q.array[ae+2]=g.z,q.array[ae+3]=g.w,q.array[ae+4]=v.x,q.array[ae+5]=v.y,q.array[ae+6]=v.z,q.array[ae+7]=v.w,q.array[ae+8]=y.x,q.array[ae+9]=y.y,q.array[ae+10]=y.z,q.array[ae+11]=y.w,ae+=12;b.bindBuffer(b.ARRAY_BUFFER,q.buffer),b.bufferData(b.ARRAY_BUFFER,q.array,r)}n&&(delete e.__inittedArrays,delete e.__colorArray,delete e.__normalArray,delete e.__tangentArray,delete e.__uvArray,delete e.__uv2Array,delete e.__faceArray,delete e.__vertexArray,delete e.__lineArray,delete e.__skinIndexArray,delete e.__skinWeightArray)}}function Be(e,t,r,n){for(var i=r.attributes,o=t.attributes,a=t.attributesKeys,s=0,l=a.length;s<l;s++){var h=a[s],c=o[h];if(0<=c){var u=i[h];if(void 0!==u){var d=u.itemSize;b.bindBuffer(b.ARRAY_BUFFER,u.buffer),ze(c),b.vertexAttribPointer(c,d,b.FLOAT,!1,0,n*d*4)}else void 0!==e.defaultAttributeValues&&(2===e.defaultAttributeValues[h].length?b.vertexAttrib2fv(c,e.defaultAttributeValues[h]):3===e.defaultAttributeValues[h].length&&b.vertexAttrib3fv(c,e.defaultAttributeValues[h]))}}Oe()}function Ve(){for(var e=0,t=q.length;e<t;e++)q[e]=0}function ze(e){q[e]=1,0===Y[e]&&(b.enableVertexAttribArray(e),Y[e]=1)}function Oe(){for(var e=0,t=Y.length;e<t;e++)Y[e]!==q[e]&&(b.disableVertexAttribArray(e),Y[e]=0)}function Ie(e,t){return e.material.id!==t.material.id?t.material.id-e.material.id:e.z!==t.z?t.z-e.z:e.id-t.id}function He(e,t){return e.z!==t.z?e.z-t.z:e.id-t.id}function Ge(e,t){return t[0]-e[0]}function We(e,t,r,n,i,o){for(var a,s=e.length-1;-1!==s;s--){var l=e[s],h=l.object,c=l.buffer;if(it(h,t),o)a=o;else{if(!(a=l.material))continue;i&&_.setBlending(a.blending,a.blendEquation,a.blendSrc,a.blendDst),_.setDepthTest(a.depthTest),_.setDepthWrite(a.depthWrite),lt(a.polygonOffset,a.polygonOffsetFactor,a.polygonOffsetUnits)}_.setMaterialFaces(a),c instanceof Ht.BufferGeometry?_.renderBufferDirect(t,r,n,a,c,h):_.renderBuffer(t,r,n,a,c,h)}}function je(e,t,r,n,i,o,a){for(var s,l=0,h=e.length;l<h;l++){var c=e[l],u=c.object;if(u.visible){if(a)s=a;else{if(!(s=c[t]))continue;o&&_.setBlending(s.blending,s.blendEquation,s.blendSrc,s.blendDst),_.setDepthTest(s.depthTest),_.setDepthWrite(s.depthWrite),lt(s.polygonOffset,s.polygonOffsetFactor,s.polygonOffsetUnits)}_.renderImmediateObject(r,n,i,s,u)}}}function Xe(e){var t=e.object.material;t.transparent?(e.transparent=t,e.opaque=null):(e.opaque=t,e.transparent=null)}function qe(e){var t=e.object,r=e.buffer,n=t.geometry,i=t.material;if(i instanceof Ht.MeshFaceMaterial){var o=n instanceof Ht.BufferGeometry?0:r.materialIndex;i=i.materials[o],(e.material=i).transparent?v.push(e):g.push(e)}else i&&((e.material=i).transparent?v.push(e):g.push(e))}this.renderBufferImmediate=function(e,t,r){if(Ve(),e.hasPositions&&!e.__webglVertexBuffer&&(e.__webglVertexBuffer=b.createBuffer()),e.hasNormals&&!e.__webglNormalBuffer&&(e.__webglNormalBuffer=b.createBuffer()),e.hasUvs&&!e.__webglUvBuffer&&(e.__webglUvBuffer=b.createBuffer()),e.hasColors&&!e.__webglColorBuffer&&(e.__webglColorBuffer=b.createBuffer()),e.hasPositions&&(b.bindBuffer(b.ARRAY_BUFFER,e.__webglVertexBuffer),b.bufferData(b.ARRAY_BUFFER,e.positionArray,b.DYNAMIC_DRAW),ze(t.attributes.position),b.vertexAttribPointer(t.attributes.position,3,b.FLOAT,!1,0,0)),e.hasNormals){if(b.bindBuffer(b.ARRAY_BUFFER,e.__webglNormalBuffer),r.shading===Ht.FlatShading){var n,i,o,a,s,l,h,c,u,d,f,p=3*e.count;for(f=0;f<p;f+=9)a=(d=e.normalArray)[f],l=d[f+1],c=d[f+2],s=d[f+3],h=d[f+4],u=d[f+5],n=(a+s+d[f+6])/3,i=(l+h+d[f+7])/3,o=(c+u+d[f+8])/3,d[f]=n,d[f+1]=i,d[f+2]=o,d[f+3]=n,d[f+4]=i,d[f+5]=o,d[f+6]=n,d[f+7]=i,d[f+8]=o}b.bufferData(b.ARRAY_BUFFER,e.normalArray,b.DYNAMIC_DRAW),ze(t.attributes.normal),b.vertexAttribPointer(t.attributes.normal,3,b.FLOAT,!1,0,0)}e.hasUvs&&r.map&&(b.bindBuffer(b.ARRAY_BUFFER,e.__webglUvBuffer),b.bufferData(b.ARRAY_BUFFER,e.uvArray,b.DYNAMIC_DRAW),ze(t.attributes.uv),b.vertexAttribPointer(t.attributes.uv,2,b.FLOAT,!1,0,0)),e.hasColors&&r.vertexColors!==Ht.NoColors&&(b.bindBuffer(b.ARRAY_BUFFER,e.__webglColorBuffer),b.bufferData(b.ARRAY_BUFFER,e.colorArray,b.DYNAMIC_DRAW),ze(t.attributes.color),b.vertexAttribPointer(t.attributes.color,3,b.FLOAT,!1,0,0)),Oe(),b.drawArrays(b.TRIANGLES,0,e.count),e.count=0},this.renderBufferDirect=function(e,t,r,n,i,o){if(!1!==n.visible){var a=et(e,t,r,n,o),s=!1,l=n.wireframe?1:0,h=16777215*i.id+2*a.id+l;if(h!==C&&(C=h,s=!0),s&&Ve(),o instanceof Ht.Mesh){var c=!0===n.wireframe?b.LINES:b.TRIANGLES;if(m=i.attributes.index)if(v=m.array instanceof Uint32Array&&ne.get("OES_element_index_uint")?(g=b.UNSIGNED_INT,4):(g=b.UNSIGNED_SHORT,2),0===(y=i.offsets).length)s&&(Be(n,a,i,0),b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,m.buffer)),b.drawElements(c,m.array.length,g,0),_.info.render.calls++,_.info.render.vertices+=m.array.length,_.info.render.faces+=m.array.length/3;else{s=!0;for(var u=0,d=y.length;u<d;u++){var f=y[u].index;s&&(Be(n,a,i,f),b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,m.buffer)),b.drawElements(c,y[u].count,g,y[u].start*v),_.info.render.calls++,_.info.render.vertices+=y[u].count,_.info.render.faces+=y[u].count/3}}else{s&&Be(n,a,i,0);var p=i.attributes.position;b.drawArrays(c,0,p.array.length/3),_.info.render.calls++,_.info.render.vertices+=p.array.length/3,_.info.render.faces+=p.array.length/9}}else if(o instanceof Ht.PointCloud)s&&Be(n,a,i,0),p=i.attributes.position,b.drawArrays(b.POINTS,0,p.array.length/3),_.info.render.calls++,_.info.render.points+=p.array.length/3;else if(o instanceof Ht.Line){var m,g,v,y;if(c=o.mode===Ht.LineStrip?b.LINE_STRIP:b.LINES,st(n.linewidth),m=i.attributes.index)if(v=m.array instanceof Uint32Array?(g=b.UNSIGNED_INT,4):(g=b.UNSIGNED_SHORT,2),0===(y=i.offsets).length)s&&(Be(n,a,i,0),b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,m.buffer)),b.drawElements(c,m.array.length,g,0),_.info.render.calls++,_.info.render.vertices+=m.array.length;else for(1<y.length&&(s=!0),u=0,d=y.length;u<d;u++)f=y[u].index,s&&(Be(n,a,i,f),b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,m.buffer)),b.drawElements(c,y[u].count,g,y[u].start*v),_.info.render.calls++,_.info.render.vertices+=y[u].count;else s&&Be(n,a,i,0),p=i.attributes.position,b.drawArrays(c,0,p.array.length/3),_.info.render.calls++,_.info.render.points+=p.array.length/3}}},this.renderBuffer=function(e,t,r,n,i,o){if(!1!==n.visible){var a=et(e,t,r,n,o),s=a.attributes,l=!1,h=n.wireframe?1:0,c=16777215*i.id+2*a.id+h;if(c!==C&&(C=c,l=!0),l&&Ve(),!n.morphTargets&&0<=s.position?l&&(b.bindBuffer(b.ARRAY_BUFFER,i.__webglVertexBuffer),ze(s.position),b.vertexAttribPointer(s.position,3,b.FLOAT,!1,0,0)):o.morphTargetBase&&function(e,t,r){var n=e.program.attributes;if(-1!==r.morphTargetBase&&0<=n.position?(b.bindBuffer(b.ARRAY_BUFFER,t.__webglMorphTargetsBuffers[r.morphTargetBase]),ze(n.position),b.vertexAttribPointer(n.position,3,b.FLOAT,!1,0,0)):0<=n.position&&(b.bindBuffer(b.ARRAY_BUFFER,t.__webglVertexBuffer),ze(n.position),b.vertexAttribPointer(n.position,3,b.FLOAT,!1,0,0)),r.morphTargetForcedOrder.length)for(var i=0,o=r.morphTargetForcedOrder,a=r.morphTargetInfluences;i<e.numSupportedMorphTargets&&i<o.length;)0<=n["morphTarget"+i]&&(b.bindBuffer(b.ARRAY_BUFFER,t.__webglMorphTargetsBuffers[o[i]]),ze(n["morphTarget"+i]),b.vertexAttribPointer(n["morphTarget"+i],3,b.FLOAT,!1,0,0)),0<=n["morphNormal"+i]&&e.morphNormals&&(b.bindBuffer(b.ARRAY_BUFFER,t.__webglMorphNormalsBuffers[o[i]]),ze(n["morphNormal"+i]),b.vertexAttribPointer(n["morphNormal"+i],3,b.FLOAT,!1,0,0)),r.__webglMorphTargetInfluences[i]=a[o[i]],i++;else{var s,l,h=[],c=(a=r.morphTargetInfluences).length;for(l=0;l<c;l++)0<(s=a[l])&&h.push([s,l]);h.length>e.numSupportedMorphTargets?(h.sort(Ge),h.length=e.numSupportedMorphTargets):h.length>e.numSupportedMorphNormals?h.sort(Ge):0===h.length&&h.push([0,0]);var u;for(i=0;i<e.numSupportedMorphTargets;)h[i]?(u=h[i][1],0<=n["morphTarget"+i]&&(b.bindBuffer(b.ARRAY_BUFFER,t.__webglMorphTargetsBuffers[u]),ze(n["morphTarget"+i]),b.vertexAttribPointer(n["morphTarget"+i],3,b.FLOAT,!1,0,0)),0<=n["morphNormal"+i]&&e.morphNormals&&(b.bindBuffer(b.ARRAY_BUFFER,t.__webglMorphNormalsBuffers[u]),ze(n["morphNormal"+i]),b.vertexAttribPointer(n["morphNormal"+i],3,b.FLOAT,!1,0,0)),r.__webglMorphTargetInfluences[i]=a[u]):r.__webglMorphTargetInfluences[i]=0,i++}null!==e.program.uniforms.morphTargetInfluences&&b.uniform1fv(e.program.uniforms.morphTargetInfluences,r.__webglMorphTargetInfluences)}(n,i,o),l){if(i.__webglCustomAttributesList)for(var u=0,d=i.__webglCustomAttributesList.length;u<d;u++){var f=i.__webglCustomAttributesList[u];0<=s[f.buffer.belongsToAttribute]&&(b.bindBuffer(b.ARRAY_BUFFER,f.buffer),ze(s[f.buffer.belongsToAttribute]),b.vertexAttribPointer(s[f.buffer.belongsToAttribute],f.size,b.FLOAT,!1,0,0))}0<=s.color&&(0<o.geometry.colors.length||0<o.geometry.faces.length?(b.bindBuffer(b.ARRAY_BUFFER,i.__webglColorBuffer),ze(s.color),b.vertexAttribPointer(s.color,3,b.FLOAT,!1,0,0)):void 0!==n.defaultAttributeValues&&b.vertexAttrib3fv(s.color,n.defaultAttributeValues.color)),0<=s.normal&&(b.bindBuffer(b.ARRAY_BUFFER,i.__webglNormalBuffer),ze(s.normal),b.vertexAttribPointer(s.normal,3,b.FLOAT,!1,0,0)),0<=s.tangent&&(b.bindBuffer(b.ARRAY_BUFFER,i.__webglTangentBuffer),ze(s.tangent),b.vertexAttribPointer(s.tangent,4,b.FLOAT,!1,0,0)),0<=s.uv&&(o.geometry.faceVertexUvs[0]?(b.bindBuffer(b.ARRAY_BUFFER,i.__webglUVBuffer),ze(s.uv),b.vertexAttribPointer(s.uv,2,b.FLOAT,!1,0,0)):void 0!==n.defaultAttributeValues&&b.vertexAttrib2fv(s.uv,n.defaultAttributeValues.uv)),0<=s.uv2&&(o.geometry.faceVertexUvs[1]?(b.bindBuffer(b.ARRAY_BUFFER,i.__webglUV2Buffer),ze(s.uv2),b.vertexAttribPointer(s.uv2,2,b.FLOAT,!1,0,0)):void 0!==n.defaultAttributeValues&&b.vertexAttrib2fv(s.uv2,n.defaultAttributeValues.uv2)),n.skinning&&0<=s.skinIndex&&0<=s.skinWeight&&(b.bindBuffer(b.ARRAY_BUFFER,i.__webglSkinIndicesBuffer),ze(s.skinIndex),b.vertexAttribPointer(s.skinIndex,4,b.FLOAT,!1,0,0),b.bindBuffer(b.ARRAY_BUFFER,i.__webglSkinWeightsBuffer),ze(s.skinWeight),b.vertexAttribPointer(s.skinWeight,4,b.FLOAT,!1,0,0)),0<=s.lineDistance&&(b.bindBuffer(b.ARRAY_BUFFER,i.__webglLineDistanceBuffer),ze(s.lineDistance),b.vertexAttribPointer(s.lineDistance,1,b.FLOAT,!1,0,0))}if(Oe(),o instanceof Ht.Mesh){var p=i.__typeArray===Uint32Array?b.UNSIGNED_INT:b.UNSIGNED_SHORT;n.wireframe?(st(n.wireframeLinewidth),l&&b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,i.__webglLineBuffer),b.drawElements(b.LINES,i.__webglLineCount,p,0)):(l&&b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,i.__webglFaceBuffer),b.drawElements(b.TRIANGLES,i.__webglFaceCount,p,0)),_.info.render.calls++,_.info.render.vertices+=i.__webglFaceCount,_.info.render.faces+=i.__webglFaceCount/3}else if(o instanceof Ht.Line){var m=o.mode===Ht.LineStrip?b.LINE_STRIP:b.LINES;st(n.linewidth),b.drawArrays(m,0,i.__webglLineCount),_.info.render.calls++}else o instanceof Ht.PointCloud&&(b.drawArrays(b.POINTS,0,i.__webglParticleCount),_.info.render.calls++,_.info.render.points+=i.__webglParticleCount)}},this.render=function(e,t,r,n){if(t instanceof Ht.Camera!=0){var i,o=e.fog;T=C=-1,(ee=!(E=null))===e.autoUpdate&&e.updateMatrixWorld(),void 0===t.parent&&t.updateMatrixWorld(),e.traverse(function(e){e instanceof Ht.SkinnedMesh&&e.skeleton.update()}),t.matrixWorldInverse.getInverse(t.matrixWorld),Q.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),K.setFromMatrix(Q),f.length=0,g.length=0,v.length=0,y.length=0,x.length=0,function e(t,r){if(!1!==r.visible){if(r instanceof Ht.Scene||r instanceof Ht.Group);else if(function(e,t){void 0===e.__webglInit&&(e.__webglInit=!0,e._modelViewMatrix=new Ht.Matrix4,e._normalMatrix=new Ht.Matrix3,e.addEventListener("removed",Me));var r,n,i,o,a,s,l,h,c,u=e.geometry;if(void 0===u||void 0===u.__webglInit&&(u.__webglInit=!0,u.addEventListener("dispose",Se),u instanceof Ht.BufferGeometry||(e instanceof Ht.Mesh?Qe(t,e,u):e instanceof Ht.Line?void 0===u.__webglVertexBuffer&&((h=u).__webglVertexBuffer=b.createBuffer(),h.__webglColorBuffer=b.createBuffer(),h.__webglLineDistanceBuffer=b.createBuffer(),_.info.memory.geometries++,s=e,l=(a=u).vertices.length,a.__vertexArray=new Float32Array(3*l),a.__colorArray=new Float32Array(3*l),a.__lineDistanceArray=new Float32Array(1*l),a.__webglLineCount=l,ke(s),u.verticesNeedUpdate=!0,u.colorsNeedUpdate=!0,u.lineDistancesNeedUpdate=!0):e instanceof Ht.PointCloud&&void 0===u.__webglVertexBuffer&&((o=u).__webglVertexBuffer=b.createBuffer(),o.__webglColorBuffer=b.createBuffer(),_.info.memory.geometries++,n=e,i=(r=u).vertices.length,r.__vertexArray=new Float32Array(3*i),r.__colorArray=new Float32Array(3*i),r.__sortArray=[],r.__webglParticleCount=i,ke(n),u.verticesNeedUpdate=!0,u.colorsNeedUpdate=!0))),void 0===e.__webglActive)if(e.__webglActive=!0,e instanceof Ht.Mesh){if(u instanceof Ht.BufferGeometry)Ze(p,u,e);else if(u instanceof Ht.Geometry)for(var d=Ye[u.id],f=0,g=d.length;f<g;f++)Ze(p,d[f],e)}else e instanceof Ht.Line||e instanceof Ht.PointCloud?Ze(p,u,e):(e instanceof Ht.ImmediateRenderObject||e.immediateRenderCallback)&&(c=e,m.push({id:null,object:c,opaque:null,transparent:null,z:0}))}(r,t),r instanceof Ht.Light)f.push(r);else if(r instanceof Ht.Sprite)y.push(r);else if(r instanceof Ht.LensFlare)x.push(r);else{var n=p[r.id];if(n&&(!1===r.frustumCulled||!0===K.intersectsObject(r))){!function(e,t){var r,n,i=e.geometry;if(i instanceof Ht.BufferGeometry)!function(e){for(var t=e.attributes,r=e.attributesKeys,n=0,i=r.length;n<i;n++){var o=r[n],a=t[o];if(void 0===a.buffer&&(a.buffer=b.createBuffer(),a.needsUpdate=!0),!0===a.needsUpdate){var s="index"===o?b.ELEMENT_ARRAY_BUFFER:b.ARRAY_BUFFER;b.bindBuffer(s,a.buffer),b.bufferData(s,a.array,b.STATIC_DRAW),a.needsUpdate=!1}}}(i);else if(e instanceof Ht.Mesh){!0===i.groupsNeedUpdate&&Qe(0,e,i);for(var o=Ye[i.id],a=0,s=o.length;a<s;a++){var l=o[a];n=Ue(e,l),!0===i.groupsNeedUpdate&&Fe(l,e),r=n.attributes&&$e(n),(i.verticesNeedUpdate||i.morphTargetsNeedUpdate||i.elementsNeedUpdate||i.uvsNeedUpdate||i.normalsNeedUpdate||i.colorsNeedUpdate||i.tangentsNeedUpdate||r)&&Ne(l,e,b.DYNAMIC_DRAW,!i.dynamic,n)}i.verticesNeedUpdate=!1,i.morphTargetsNeedUpdate=!1,i.elementsNeedUpdate=!1,i.uvsNeedUpdate=!1,i.normalsNeedUpdate=!1,i.colorsNeedUpdate=!1,i.tangentsNeedUpdate=!1,n.attributes&&Je(n)}else e instanceof Ht.Line?(r=(n=Ue(e,i)).attributes&&$e(n),(i.verticesNeedUpdate||i.colorsNeedUpdate||i.lineDistancesNeedUpdate||r)&&function(e,t){var r,n,i,o,a,s,l,h,c,u,d,f,p=e.vertices,m=e.colors,g=e.lineDistances,v=p.length,y=m.length,x=g.length,_=e.__vertexArray,w=e.__colorArray,M=e.__lineDistanceArray,S=e.verticesNeedUpdate,T=e.colorsNeedUpdate,C=e.lineDistancesNeedUpdate,E=e.__webglCustomAttributesList;if(S){for(r=0;r<v;r++)o=p[r],_[a=3*r]=o.x,_[a+1]=o.y,_[a+2]=o.z;b.bindBuffer(b.ARRAY_BUFFER,e.__webglVertexBuffer),b.bufferData(b.ARRAY_BUFFER,_,t)}if(T){for(n=0;n<y;n++)s=m[n],w[a=3*n]=s.r,w[a+1]=s.g,w[a+2]=s.b;b.bindBuffer(b.ARRAY_BUFFER,e.__webglColorBuffer),b.bufferData(b.ARRAY_BUFFER,w,t)}if(C){for(i=0;i<x;i++)M[i]=g[i];b.bindBuffer(b.ARRAY_BUFFER,e.__webglLineDistanceBuffer),b.bufferData(b.ARRAY_BUFFER,M,t)}if(E)for(l=0,h=E.length;l<h;l++)if((f=E[l]).needsUpdate&&(void 0===f.boundTo||"vertices"===f.boundTo)){if(a=0,u=f.value.length,1===f.size)for(c=0;c<u;c++)f.array[c]=f.value[c];else if(2===f.size)for(c=0;c<u;c++)d=f.value[c],f.array[a]=d.x,f.array[a+1]=d.y,a+=2;else if(3===f.size)if("c"===f.type)for(c=0;c<u;c++)d=f.value[c],f.array[a]=d.r,f.array[a+1]=d.g,f.array[a+2]=d.b,a+=3;else for(c=0;c<u;c++)d=f.value[c],f.array[a]=d.x,f.array[a+1]=d.y,f.array[a+2]=d.z,a+=3;else if(4===f.size)for(c=0;c<u;c++)d=f.value[c],f.array[a]=d.x,f.array[a+1]=d.y,f.array[a+2]=d.z,f.array[a+3]=d.w,a+=4;b.bindBuffer(b.ARRAY_BUFFER,f.buffer),b.bufferData(b.ARRAY_BUFFER,f.array,t)}}(i,b.DYNAMIC_DRAW),i.verticesNeedUpdate=!1,i.colorsNeedUpdate=!1,i.lineDistancesNeedUpdate=!1,n.attributes&&Je(n)):e instanceof Ht.PointCloud&&(r=(n=Ue(e,i)).attributes&&$e(n),(i.verticesNeedUpdate||i.colorsNeedUpdate||e.sortParticles||r)&&function(e,t,r){var n,i,o,a,s,l,h,c,u,d,f,p,m=e.vertices,g=m.length,v=e.colors,y=v.length,x=e.__vertexArray,_=e.__colorArray,w=e.__sortArray,M=e.verticesNeedUpdate,S=(e.elementsNeedUpdate,e.colorsNeedUpdate),T=e.__webglCustomAttributesList;if(r.sortParticles){for(Z.copy(Q),Z.multiply(r.matrixWorld),n=0;n<g;n++)o=m[n],$.copy(o),$.applyProjection(Z),w[n]=[$.z,n];for(w.sort(Ge),n=0;n<g;n++)o=m[w[n][1]],x[a=3*n]=o.x,x[a+1]=o.y,x[a+2]=o.z;for(i=0;i<y;i++)a=3*i,l=v[w[i][1]],_[a]=l.r,_[a+1]=l.g,_[a+2]=l.b;if(T)for(h=0,c=T.length;h<c;h++)if(void 0===(p=T[h]).boundTo||"vertices"===p.boundTo)if(a=0,d=p.value.length,1===p.size)for(u=0;u<d;u++)s=w[u][1],p.array[u]=p.value[s];else if(2===p.size)for(u=0;u<d;u++)s=w[u][1],f=p.value[s],p.array[a]=f.x,p.array[a+1]=f.y,a+=2;else if(3===p.size)if("c"===p.type)for(u=0;u<d;u++)s=w[u][1],f=p.value[s],p.array[a]=f.r,p.array[a+1]=f.g,p.array[a+2]=f.b,a+=3;else for(u=0;u<d;u++)s=w[u][1],f=p.value[s],p.array[a]=f.x,p.array[a+1]=f.y,p.array[a+2]=f.z,a+=3;else if(4===p.size)for(u=0;u<d;u++)s=w[u][1],f=p.value[s],p.array[a]=f.x,p.array[a+1]=f.y,p.array[a+2]=f.z,p.array[a+3]=f.w,a+=4}else{if(M)for(n=0;n<g;n++)o=m[n],x[a=3*n]=o.x,x[a+1]=o.y,x[a+2]=o.z;if(S)for(i=0;i<y;i++)l=v[i],_[a=3*i]=l.r,_[a+1]=l.g,_[a+2]=l.b;if(T)for(h=0,c=T.length;h<c;h++)if((p=T[h]).needsUpdate&&(void 0===p.boundTo||"vertices"===p.boundTo))if(d=p.value.length,a=0,1===p.size)for(u=0;u<d;u++)p.array[u]=p.value[u];else if(2===p.size)for(u=0;u<d;u++)f=p.value[u],p.array[a]=f.x,p.array[a+1]=f.y,a+=2;else if(3===p.size)if("c"===p.type)for(u=0;u<d;u++)f=p.value[u],p.array[a]=f.r,p.array[a+1]=f.g,p.array[a+2]=f.b,a+=3;else for(u=0;u<d;u++)f=p.value[u],p.array[a]=f.x,p.array[a+1]=f.y,p.array[a+2]=f.z,a+=3;else if(4===p.size)for(u=0;u<d;u++)f=p.value[u],p.array[a]=f.x,p.array[a+1]=f.y,p.array[a+2]=f.z,p.array[a+3]=f.w,a+=4}if((M||r.sortParticles)&&(b.bindBuffer(b.ARRAY_BUFFER,e.__webglVertexBuffer),b.bufferData(b.ARRAY_BUFFER,x,t)),(S||r.sortParticles)&&(b.bindBuffer(b.ARRAY_BUFFER,e.__webglColorBuffer),b.bufferData(b.ARRAY_BUFFER,_,t)),T)for(h=0,c=T.length;h<c;h++)((p=T[h]).needsUpdate||r.sortParticles)&&(b.bindBuffer(b.ARRAY_BUFFER,p.buffer),b.bufferData(b.ARRAY_BUFFER,p.array,t))}(i,b.DYNAMIC_DRAW,e),i.verticesNeedUpdate=!1,i.colorsNeedUpdate=!1,n.attributes&&Je(n))}(r);for(var i=0,o=n.length;i<o;i++){var a=n[i];qe(a),(a.render=!0)===_.sortObjects&&(null!==r.renderDepth?a.z=r.renderDepth:($.setFromMatrixPosition(r.matrixWorld),$.applyProjection(Q),a.z=$.z))}}}for(i=0,o=r.children.length;i<o;i++)e(t,r.children[i])}}(e,e),!0===_.sortObjects&&(g.sort(Ie),v.sort(He)),xe.render(e,t),_.info.render.calls=0,_.info.render.vertices=0,_.info.render.faces=0,_.info.render.points=0,this.setRenderTarget(r),(this.autoClear||n)&&this.clear(this.autoClearColor,this.autoClearDepth,this.autoClearStencil);for(var a=0,s=m.length;a<s;a++){var l=m[a],h=l.object;h.visible&&(it(h,t),Xe(l))}if(e.overrideMaterial){var c=e.overrideMaterial;this.setBlending(c.blending,c.blendEquation,c.blendSrc,c.blendDst),this.setDepthTest(c.depthTest),this.setDepthWrite(c.depthWrite),lt(c.polygonOffset,c.polygonOffsetFactor,c.polygonOffsetUnits),We(g,t,f,o,!0,c),We(v,t,f,o,!0,c),je(m,"",t,f,o,!1,c)}else c=null,this.setBlending(Ht.NoBlending),We(g,t,f,o,!1,c),je(m,"opaque",t,f,o,!1,c),We(v,t,f,o,!0,c),je(m,"transparent",t,f,o,!0,c);be.render(e,t),_e.render(e,t,j,X),r&&r.generateMipmaps&&r.minFilter!==Ht.NearestFilter&&r.minFilter!==Ht.LinearFilter&&((i=r)instanceof Ht.WebGLRenderTargetCube?(b.bindTexture(b.TEXTURE_CUBE_MAP,i.__webglTexture),b.generateMipmap(b.TEXTURE_CUBE_MAP),b.bindTexture(b.TEXTURE_CUBE_MAP,null)):(b.bindTexture(b.TEXTURE_2D,i.__webglTexture),b.generateMipmap(b.TEXTURE_2D),b.bindTexture(b.TEXTURE_2D,null))),this.setDepthTest(!0),this.setDepthWrite(!0)}else console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.")},this.renderImmediateObject=function(e,t,r,n,i){var o=et(e,t,r,n,i);C=-1,_.setMaterialFaces(n),i.immediateRenderCallback?i.immediateRenderCallback(o,b,K):i.render(function(e){_.renderBufferImmediate(e,o,n)})};var Ye={},Ke=0;function Qe(e,t,r){var n=t.material;void 0!==Ye[r.id]&&!0!==r.groupsNeedUpdate||(delete p[t.id],Ye[r.id]=function(e,t){for(var r,n,i=ne.get("OES_element_index_uint")?4294967296:65535,o={},a=e.morphTargets.length,s=e.morphNormals.length,l={},h=[],c=0,u=e.faces.length;c<u;c++){var d=e.faces[c],f=t?d.materialIndex:0;f in o||(o[f]={hash:f,counter:0}),(r=o[f].hash+"_"+o[f].counter)in l||(n={id:Ke++,faces3:[],materialIndex:f,vertices:0,numMorphTargets:a,numMorphNormals:s},l[r]=n,h.push(n)),l[r].vertices+3>i&&(o[f].counter+=1,(r=o[f].hash+"_"+o[f].counter)in l||(n={id:Ke++,faces3:[],materialIndex:f,vertices:0,numMorphTargets:a,numMorphNormals:s},l[r]=n,h.push(n))),l[r].faces3.push(c),l[r].vertices+=3}return h}(r,n instanceof Ht.MeshFaceMaterial),r.groupsNeedUpdate=!1);for(var i=Ye[r.id],o=0,a=i.length;o<a;o++){var s=i[o];(void 0===s.__webglVertexBuffer&&(we(s),Fe(s,t),r.verticesNeedUpdate=!0,r.morphTargetsNeedUpdate=!0,r.elementsNeedUpdate=!0,r.uvsNeedUpdate=!0,r.normalsNeedUpdate=!0,r.tangentsNeedUpdate=!0,r.colorsNeedUpdate=!0)||void 0===t.__webglActive)&&Ze(p,s,t)}t.__webglActive=!0}function Ze(e,t,r){var n=r.id;e[n]=e[n]||[],e[n].push({id:n,buffer:t,object:r,material:null,z:0})}function $e(e){for(var t in e.attributes)if(e.attributes[t].needsUpdate)return!0;return!1}function Je(e){for(var t in e.attributes)e.attributes[t].needsUpdate=!1}function et(e,r,i,o,a){A=0,o.needsUpdate&&(o.program&&Re(o),function(e,t,r,i){var o;if(e.addEventListener("dispose",Ee),e instanceof Ht.MeshDepthMaterial?o="depth":e instanceof Ht.MeshNormalMaterial?o="normal":e instanceof Ht.MeshBasicMaterial?o="basic":e instanceof Ht.MeshLambertMaterial?o="lambert":e instanceof Ht.MeshPhongMaterial?o="phong":e instanceof Ht.LineBasicMaterial?o="basic":e instanceof Ht.LineDashedMaterial?o="dashed":e instanceof Ht.PointCloudMaterial&&(o="particle_basic"),o){var a=Ht.ShaderLib[o];e.__webglShader={uniforms:Ht.UniformsUtils.clone(a.uniforms),vertexShader:a.vertexShader,fragmentShader:a.fragmentShader}}else e.__webglShader={uniforms:e.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader};var s=function(e){for(var t=0,r=0,n=0,i=0,o=0,a=e.length;o<a;o++){var s=e[o];s.onlyShadow||!1===s.visible||(s instanceof Ht.DirectionalLight&&t++,s instanceof Ht.PointLight&&r++,s instanceof Ht.SpotLight&&n++,s instanceof Ht.HemisphereLight&&i++)}return{directional:t,point:r,spot:n,hemi:i}}(t),l=function(e){for(var t=0,r=0,n=e.length;r<n;r++){var i=e[r];i.castShadow&&(i instanceof Ht.SpotLight&&t++,i instanceof Ht.DirectionalLight&&!i.shadowCascade&&t++)}return t}(t),h=function(e){if(ce&&e&&e.skeleton&&e.skeleton.useVertexTexture)return 1024;var t=b.getParameter(b.MAX_VERTEX_UNIFORM_VECTORS),r=Math.floor((t-20)/4);return void 0!==e&&e instanceof Ht.SkinnedMesh&&(r=Math.min(e.skeleton.bones.length,r))<e.skeleton.bones.length&&console.warn("WebGLRenderer: too many bones - "+e.skeleton.bones.length+", this GPU supports just "+r+" (try OpenGL instead of ANGLE)"),r}(i),u={precision:n,supportsVertexTextures:he,map:!!e.map,envMap:!!e.envMap,lightMap:!!e.lightMap,bumpMap:!!e.bumpMap,normalMap:!!e.normalMap,specularMap:!!e.specularMap,alphaMap:!!e.alphaMap,vertexColors:e.vertexColors,fog:r,useFog:e.fog,fogExp:r instanceof Ht.FogExp2,sizeAttenuation:e.sizeAttenuation,logarithmicDepthBuffer:c,skinning:e.skinning,maxBones:h,useVertexTexture:ce&&i&&i.skeleton&&i.skeleton.useVertexTexture,morphTargets:e.morphTargets,morphNormals:e.morphNormals,maxMorphTargets:_.maxMorphTargets,maxMorphNormals:_.maxMorphNormals,maxDirLights:s.directional,maxPointLights:s.point,maxSpotLights:s.spot,maxHemiLights:s.hemi,maxShadows:l,shadowMapEnabled:_.shadowMapEnabled&&i.receiveShadow&&0<l,shadowMapType:_.shadowMapType,shadowMapDebug:_.shadowMapDebug,shadowMapCascade:_.shadowMapCascade,alphaTest:e.alphaTest,metal:e.metal,wrapAround:e.wrapAround,doubleSided:e.side===Ht.DoubleSide,flipSided:e.side===Ht.BackSide},d=[];if(o?d.push(o):(d.push(e.fragmentShader),d.push(e.vertexShader)),void 0!==e.defines)for(var f in e.defines)d.push(f),d.push(e.defines[f]);for(var f in u)d.push(f),d.push(u[f]);for(var p,m=d.join(),g=0,v=w.length;g<v;g++){var y=w[g];if(y.code===m){(p=y).usedTimes++;break}}void 0===p&&(p=new Ht.WebGLProgram(_,m,e,u),w.push(p),_.info.memory.programs=w.length);var x=(e.program=p).attributes;if(e.morphTargets)for(var M="morphTarget",S=e.numSupportedMorphTargets=0;S<_.maxMorphTargets;S++)0<=x[M+S]&&e.numSupportedMorphTargets++;if(e.morphNormals)for(M="morphNormal",S=e.numSupportedMorphNormals=0;S<_.maxMorphNormals;S++)0<=x[M+S]&&e.numSupportedMorphNormals++;for(var T in e.uniformsList=[],e.__webglShader.uniforms){var C=e.program.uniforms[T];C&&e.uniformsList.push([e.__webglShader.uniforms[T],C])}}(o,r,i,a),o.needsUpdate=!1),o.morphTargets&&(a.__webglMorphTargetInfluences||(a.__webglMorphTargetInfluences=new Float32Array(_.maxMorphTargets)));var s,l,h,u,d,f,p,m,g,v,y=!1,x=!1,S=!1,C=o.program,L=C.uniforms,P=o.__webglShader.uniforms;if(C.id!==M&&(b.useProgram(C.program),M=C.id,S=x=y=!0),o.id!==T&&(-1===T&&(S=!0),T=o.id,x=!0),(y||e!==E)&&(b.uniformMatrix4fv(L.projectionMatrix,!1,e.projectionMatrix.elements),c&&b.uniform1f(L.logDepthBufFC,2/(Math.log(e.far+1)/Math.LN2)),e!==E&&(E=e),(o instanceof Ht.ShaderMaterial||o instanceof Ht.MeshPhongMaterial||o.envMap)&&null!==L.cameraPosition&&($.setFromMatrixPosition(e.matrixWorld),b.uniform3f(L.cameraPosition,$.x,$.y,$.z)),(o instanceof Ht.MeshPhongMaterial||o instanceof Ht.MeshLambertMaterial||o instanceof Ht.ShaderMaterial||o.skinning)&&null!==L.viewMatrix&&b.uniformMatrix4fv(L.viewMatrix,!1,e.matrixWorldInverse.elements)),o.skinning)if(a.bindMatrix&&null!==L.bindMatrix&&b.uniformMatrix4fv(L.bindMatrix,!1,a.bindMatrix.elements),a.bindMatrixInverse&&null!==L.bindMatrixInverse&&b.uniformMatrix4fv(L.bindMatrixInverse,!1,a.bindMatrixInverse.elements),ce&&a.skeleton&&a.skeleton.useVertexTexture){if(null!==L.boneTexture){var D=nt();b.uniform1i(L.boneTexture,D),_.setTexture(a.skeleton.boneTexture,D)}null!==L.boneTextureWidth&&b.uniform1i(L.boneTextureWidth,a.skeleton.boneTextureWidth),null!==L.boneTextureHeight&&b.uniform1i(L.boneTextureHeight,a.skeleton.boneTextureHeight)}else a.skeleton&&a.skeleton.boneMatrices&&null!==L.boneGlobalMatrices&&b.uniformMatrix4fv(L.boneGlobalMatrices,!1,a.skeleton.boneMatrices);return x&&(i&&o.fog&&(m=i,(p=P).fogColor.value=m.color,m instanceof Ht.Fog?(p.fogNear.value=m.near,p.fogFar.value=m.far):m instanceof Ht.FogExp2&&(p.fogDensity.value=m.density)),(o instanceof Ht.MeshPhongMaterial||o instanceof Ht.MeshLambertMaterial||o.lights)&&(ee&&(S=!0,function(e){var t,r,n,i,o,a,s,l,h,c=0,u=0,d=0,f=te,p=f.directional.colors,m=f.directional.positions,g=f.point.colors,v=f.point.positions,y=f.point.distances,x=f.spot.colors,b=f.spot.positions,w=f.spot.distances,M=f.spot.directions,S=f.spot.anglesCos,T=f.spot.exponents,C=f.hemi.skyColors,E=f.hemi.groundColors,A=f.hemi.positions,L=0,P=0,D=0,R=0,k=0,F=0,U=0,N=0,B=0,V=0,z=0,O=0;for(t=0,r=e.length;t<r;t++)if(!(n=e[t]).onlyShadow)if(i=n.color,s=n.intensity,h=n.distance,n instanceof Ht.AmbientLight){if(!n.visible)continue;_.gammaInput?(c+=i.r*i.r,u+=i.g*i.g,d+=i.b*i.b):(c+=i.r,u+=i.g,d+=i.b)}else if(n instanceof Ht.DirectionalLight){if(k+=1,!n.visible)continue;J.setFromMatrixPosition(n.matrixWorld),$.setFromMatrixPosition(n.target.matrixWorld),J.sub($),J.normalize(),m[B=3*L]=J.x,m[B+1]=J.y,m[B+2]=J.z,_.gammaInput?ot(p,B,i,s*s):at(p,B,i,s),L+=1}else if(n instanceof Ht.PointLight){if(F+=1,!n.visible)continue;V=3*P,_.gammaInput?ot(g,V,i,s*s):at(g,V,i,s),$.setFromMatrixPosition(n.matrixWorld),v[V]=$.x,v[V+1]=$.y,v[V+2]=$.z,y[P]=h,P+=1}else if(n instanceof Ht.SpotLight){if(U+=1,!n.visible)continue;z=3*D,_.gammaInput?ot(x,z,i,s*s):at(x,z,i,s),J.setFromMatrixPosition(n.matrixWorld),b[z]=J.x,b[z+1]=J.y,b[z+2]=J.z,w[D]=h,$.setFromMatrixPosition(n.target.matrixWorld),J.sub($),J.normalize(),M[z]=J.x,M[z+1]=J.y,M[z+2]=J.z,S[D]=Math.cos(n.angle),T[D]=n.exponent,D+=1}else if(n instanceof Ht.HemisphereLight){if(N+=1,!n.visible)continue;J.setFromMatrixPosition(n.matrixWorld),J.normalize(),A[O=3*R]=J.x,A[O+1]=J.y,A[O+2]=J.z,o=n.color,a=n.groundColor,_.gammaInput?(ot(C,O,o,l=s*s),ot(E,O,a,l)):(at(C,O,o,s),at(E,O,a,s)),R+=1}for(t=3*L,r=Math.max(p.length,3*k);t<r;t++)p[t]=0;for(t=3*P,r=Math.max(g.length,3*F);t<r;t++)g[t]=0;for(t=3*D,r=Math.max(x.length,3*U);t<r;t++)x[t]=0;for(t=3*R,r=Math.max(C.length,3*N);t<r;t++)C[t]=0;for(t=3*R,r=Math.max(E.length,3*N);t<r;t++)E[t]=0;f.directional.length=L,f.point.length=P,f.spot.length=D,f.hemi.length=R,f.ambient[0]=c,f.ambient[1]=u,f.ambient[2]=d}(r),ee=!1),S?(f=te,(d=P).ambientLightColor.value=f.ambient,d.directionalLightColor.value=f.directional.colors,d.directionalLightDirection.value=f.directional.positions,d.pointLightColor.value=f.point.colors,d.pointLightPosition.value=f.point.positions,d.pointLightDistance.value=f.point.distances,d.spotLightColor.value=f.spot.colors,d.spotLightPosition.value=f.spot.positions,d.spotLightDistance.value=f.spot.distances,d.spotLightDirection.value=f.spot.directions,d.spotLightAngleCos.value=f.spot.anglesCos,d.spotLightExponent.value=f.spot.exponents,d.hemisphereLightSkyColor.value=f.hemi.skyColors,d.hemisphereLightGroundColor.value=f.hemi.groundColors,d.hemisphereLightDirection.value=f.hemi.positions,rt(P,!0)):rt(P,!1)),(o instanceof Ht.MeshBasicMaterial||o instanceof Ht.MeshLambertMaterial||o instanceof Ht.MeshPhongMaterial)&&function(e,t){var r;if(e.opacity.value=t.opacity,_.gammaInput?e.diffuse.value.copyGammaToLinear(t.color):e.diffuse.value=t.color,e.map.value=t.map,e.lightMap.value=t.lightMap,e.specularMap.value=t.specularMap,e.alphaMap.value=t.alphaMap,t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale)),t.map?r=t.map:t.specularMap?r=t.specularMap:t.normalMap?r=t.normalMap:t.bumpMap?r=t.bumpMap:t.alphaMap&&(r=t.alphaMap),void 0!==r){var n=r.offset,i=r.repeat;e.offsetRepeat.value.set(n.x,n.y,i.x,i.y)}e.envMap.value=t.envMap,e.flipEnvMap.value=t.envMap instanceof Ht.WebGLRenderTargetCube?1:-1,_.gammaInput,e.reflectivity.value=t.reflectivity,e.refractionRatio.value=t.refractionRatio,e.combine.value=t.combine,e.useRefract.value=t.envMap&&t.envMap.mapping instanceof Ht.CubeRefractionMapping}(P,o),o instanceof Ht.LineBasicMaterial?tt(P,o):o instanceof Ht.LineDashedMaterial?(tt(P,o),u=o,(h=P).dashSize.value=u.dashSize,h.totalSize.value=u.dashSize+u.gapSize,h.scale.value=u.scale):o instanceof Ht.PointCloudMaterial?(l=o,(s=P).psColor.value=l.color,s.opacity.value=l.opacity,s.size.value=l.size,s.scale.value=t.height/2,s.map.value=l.map):o instanceof Ht.MeshPhongMaterial?function(e,t){e.shininess.value=t.shininess,_.gammaInput?(e.ambient.value.copyGammaToLinear(t.ambient),e.emissive.value.copyGammaToLinear(t.emissive),e.specular.value.copyGammaToLinear(t.specular)):(e.ambient.value=t.ambient,e.emissive.value=t.emissive,e.specular.value=t.specular),t.wrapAround&&e.wrapRGB.value.copy(t.wrapRGB)}(P,o):o instanceof Ht.MeshLambertMaterial?function(e,t){_.gammaInput?(e.ambient.value.copyGammaToLinear(t.ambient),e.emissive.value.copyGammaToLinear(t.emissive)):(e.ambient.value=t.ambient,e.emissive.value=t.emissive),t.wrapAround&&e.wrapRGB.value.copy(t.wrapRGB)}(P,o):o instanceof Ht.MeshDepthMaterial?(P.mNear.value=e.near,P.mFar.value=e.far,P.opacity.value=o.opacity):o instanceof Ht.MeshNormalMaterial&&(P.opacity.value=o.opacity),a.receiveShadow&&!o._shadowPass&&function(e,t){if(e.shadowMatrix)for(var r=0,n=0,i=t.length;n<i;n++){var o=t[n];o.castShadow&&(o instanceof Ht.SpotLight||o instanceof Ht.DirectionalLight&&!o.shadowCascade)&&(e.shadowMap.value[r]=o.shadowMap,e.shadowMapSize.value[r]=o.shadowMapSize,e.shadowMatrix.value[r]=o.shadowMatrix,e.shadowDarkness.value[r]=o.shadowDarkness,e.shadowBias.value[r]=o.shadowBias,r++)}}(P,r),function(e){for(var t,r,n,i=0,o=e.length;i<o;i++){var a=e[i][0];if(!1!==a.needsUpdate){var s=a.type,l=a.value,h=e[i][1];switch(s){case"1i":b.uniform1i(h,l);break;case"1f":b.uniform1f(h,l);break;case"2f":b.uniform2f(h,l[0],l[1]);break;case"3f":b.uniform3f(h,l[0],l[1],l[2]);break;case"4f":b.uniform4f(h,l[0],l[1],l[2],l[3]);break;case"1iv":b.uniform1iv(h,l);break;case"3iv":b.uniform3iv(h,l);break;case"1fv":b.uniform1fv(h,l);break;case"2fv":b.uniform2fv(h,l);break;case"3fv":b.uniform3fv(h,l);break;case"4fv":b.uniform4fv(h,l);break;case"Matrix3fv":b.uniformMatrix3fv(h,!1,l);break;case"Matrix4fv":b.uniformMatrix4fv(h,!1,l);break;case"i":b.uniform1i(h,l);break;case"f":b.uniform1f(h,l);break;case"v2":b.uniform2f(h,l.x,l.y);break;case"v3":b.uniform3f(h,l.x,l.y,l.z);break;case"v4":b.uniform4f(h,l.x,l.y,l.z,l.w);break;case"c":b.uniform3f(h,l.r,l.g,l.b);break;case"iv1":b.uniform1iv(h,l);break;case"iv":b.uniform3iv(h,l);break;case"fv1":b.uniform1fv(h,l);break;case"fv":b.uniform3fv(h,l);break;case"v2v":void 0===a._array&&(a._array=new Float32Array(2*l.length));for(var c=0,u=l.length;c<u;c++)n=2*c,a._array[n]=l[c].x,a._array[n+1]=l[c].y;b.uniform2fv(h,a._array);break;case"v3v":void 0===a._array&&(a._array=new Float32Array(3*l.length));for(c=0,u=l.length;c<u;c++)n=3*c,a._array[n]=l[c].x,a._array[n+1]=l[c].y,a._array[n+2]=l[c].z;b.uniform3fv(h,a._array);break;case"v4v":void 0===a._array&&(a._array=new Float32Array(4*l.length));for(c=0,u=l.length;c<u;c++)n=4*c,a._array[n]=l[c].x,a._array[n+1]=l[c].y,a._array[n+2]=l[c].z,a._array[n+3]=l[c].w;b.uniform4fv(h,a._array);break;case"m3":b.uniformMatrix3fv(h,!1,l.elements);break;case"m3v":void 0===a._array&&(a._array=new Float32Array(9*l.length));for(c=0,u=l.length;c<u;c++)l[c].flattenToArrayOffset(a._array,9*c);b.uniformMatrix3fv(h,!1,a._array);break;case"m4":b.uniformMatrix4fv(h,!1,l.elements);break;case"m4v":void 0===a._array&&(a._array=new Float32Array(16*l.length));for(c=0,u=l.length;c<u;c++)l[c].flattenToArrayOffset(a._array,16*c);b.uniformMatrix4fv(h,!1,a._array);break;case"t":if(t=l,r=nt(),b.uniform1i(h,r),!t)continue;t instanceof Ht.CubeTexture||t.image instanceof Array&&6===t.image.length?ut(t,r):t instanceof Ht.WebGLRenderTargetCube?dt(t,r):_.setTexture(t,r);break;case"tv":void 0===a._array&&(a._array=[]);for(c=0,u=a.value.length;c<u;c++)a._array[c]=nt();b.uniform1iv(h,a._array);for(c=0,u=a.value.length;c<u;c++)t=a.value[c],r=a._array[c],t&&_.setTexture(t,r);break;default:console.warn("THREE.WebGLRenderer: Unknown uniform type: "+s)}}}}(o.uniformsList)),g=L,v=a,b.uniformMatrix4fv(g.modelViewMatrix,!1,v._modelViewMatrix.elements),g.normalMatrix&&b.uniformMatrix3fv(g.normalMatrix,!1,v._normalMatrix.elements),null!==L.modelMatrix&&b.uniformMatrix4fv(L.modelMatrix,!1,a.matrixWorld.elements),C}function tt(e,t){e.diffuse.value=t.color,e.opacity.value=t.opacity}function rt(e,t){e.ambientLightColor.needsUpdate=t,e.directionalLightColor.needsUpdate=t,e.directionalLightDirection.needsUpdate=t,e.pointLightColor.needsUpdate=t,e.pointLightPosition.needsUpdate=t,e.pointLightDistance.needsUpdate=t,e.spotLightColor.needsUpdate=t,e.spotLightPosition.needsUpdate=t,e.spotLightDistance.needsUpdate=t,e.spotLightDirection.needsUpdate=t,e.spotLightAngleCos.needsUpdate=t,e.spotLightExponent.needsUpdate=t,e.hemisphereLightSkyColor.needsUpdate=t,e.hemisphereLightGroundColor.needsUpdate=t,e.hemisphereLightDirection.needsUpdate=t}function nt(){var e=A;return oe<=e&&console.warn("WebGLRenderer: trying to use "+e+" texture units while this GPU supports only "+oe),A+=1,e}function it(e,t){e._modelViewMatrix.multiplyMatrices(t.matrixWorldInverse,e.matrixWorld),e._normalMatrix.getNormalMatrix(e._modelViewMatrix)}function ot(e,t,r,n){e[t]=r.r*r.r*n,e[t+1]=r.g*r.g*n,e[t+2]=r.b*r.b*n}function at(e,t,r,n){e[t]=r.r*n,e[t+1]=r.g*n,e[t+2]=r.b*n}function st(e){e!==O&&(b.lineWidth(e),O=e)}function lt(e,t,r){B!==e&&(e?b.enable(b.POLYGON_OFFSET_FILL):b.disable(b.POLYGON_OFFSET_FILL),B=e),!e||V===t&&z===r||(b.polygonOffset(t,r),V=t,z=r)}function ht(e,t,r){var n;r?(b.texParameteri(e,b.TEXTURE_WRAP_S,gt(t.wrapS)),b.texParameteri(e,b.TEXTURE_WRAP_T,gt(t.wrapT)),b.texParameteri(e,b.TEXTURE_MAG_FILTER,gt(t.magFilter)),b.texParameteri(e,b.TEXTURE_MIN_FILTER,gt(t.minFilter))):(b.texParameteri(e,b.TEXTURE_WRAP_S,b.CLAMP_TO_EDGE),b.texParameteri(e,b.TEXTURE_WRAP_T,b.CLAMP_TO_EDGE),b.texParameteri(e,b.TEXTURE_MAG_FILTER,mt(t.magFilter)),b.texParameteri(e,b.TEXTURE_MIN_FILTER,mt(t.minFilter))),(n=ne.get("EXT_texture_filter_anisotropic"))&&t.type!==Ht.FloatType&&(1<t.anisotropy||t.__oldAnisotropy)&&(b.texParameterf(e,n.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(t.anisotropy,_.getMaxAnisotropy())),t.__oldAnisotropy=t.anisotropy)}function ct(e,t){if(e.width>t||e.height>t){var r=t/Math.max(e.width,e.height),n=document.createElement("canvas");return n.width=Math.floor(e.width*r),n.height=Math.floor(e.height*r),n.getContext("2d").drawImage(e,0,0,e.width,e.height,0,0,n.width,n.height),console.log("THREE.WebGLRenderer:",e,"is too big ("+e.width+"x"+e.height+"). Resized to "+n.width+"x"+n.height+"."),n}return e}function ut(e,t){if(6===e.image.length)if(e.needsUpdate){e.image.__webglTextureCube||(e.addEventListener("dispose",Te),e.image.__webglTextureCube=b.createTexture(),_.info.memory.textures++),b.activeTexture(b.TEXTURE0+t),b.bindTexture(b.TEXTURE_CUBE_MAP,e.image.__webglTextureCube),b.pixelStorei(b.UNPACK_FLIP_Y_WEBGL,e.flipY);for(var r=e instanceof Ht.CompressedTexture,n=e.image[0]instanceof Ht.DataTexture,i=[],o=0;o<6;o++)!_.autoScaleCubemaps||r||n?i[o]=n?e.image[o].image:e.image[o]:i[o]=ct(e.image[o],le);var a=i[0],s=Ht.Math.isPowerOfTwo(a.width)&&Ht.Math.isPowerOfTwo(a.height),l=gt(e.format),h=gt(e.type);for(ht(b.TEXTURE_CUBE_MAP,e,s),o=0;o<6;o++)if(r)for(var c,u=i[o].mipmaps,d=0,f=u.length;d<f;d++)c=u[d],e.format!==Ht.RGBAFormat&&e.format!==Ht.RGBFormat?-1<me().indexOf(l)?b.compressedTexImage2D(b.TEXTURE_CUBE_MAP_POSITIVE_X+o,d,l,c.width,c.height,0,c.data):console.warn("Attempt to load unsupported compressed texture format"):b.texImage2D(b.TEXTURE_CUBE_MAP_POSITIVE_X+o,d,l,c.width,c.height,0,l,h,c.data);else n?b.texImage2D(b.TEXTURE_CUBE_MAP_POSITIVE_X+o,0,l,i[o].width,i[o].height,0,l,h,i[o].data):b.texImage2D(b.TEXTURE_CUBE_MAP_POSITIVE_X+o,0,l,l,h,i[o]);e.generateMipmaps&&s&&b.generateMipmap(b.TEXTURE_CUBE_MAP),e.needsUpdate=!1,e.onUpdate&&e.onUpdate()}else b.activeTexture(b.TEXTURE0+t),b.bindTexture(b.TEXTURE_CUBE_MAP,e.image.__webglTextureCube)}function dt(e,t){b.activeTexture(b.TEXTURE0+t),b.bindTexture(b.TEXTURE_CUBE_MAP,e.__webglTexture)}function ft(e,t,r){b.bindFramebuffer(b.FRAMEBUFFER,e),b.framebufferTexture2D(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0,r,t.__webglTexture,0)}function pt(e,t){b.bindRenderbuffer(b.RENDERBUFFER,e),t.depthBuffer&&!t.stencilBuffer?(b.renderbufferStorage(b.RENDERBUFFER,b.DEPTH_COMPONENT16,t.width,t.height),b.framebufferRenderbuffer(b.FRAMEBUFFER,b.DEPTH_ATTACHMENT,b.RENDERBUFFER,e)):t.depthBuffer&&t.stencilBuffer?(b.renderbufferStorage(b.RENDERBUFFER,b.DEPTH_STENCIL,t.width,t.height),b.framebufferRenderbuffer(b.FRAMEBUFFER,b.DEPTH_STENCIL_ATTACHMENT,b.RENDERBUFFER,e)):b.renderbufferStorage(b.RENDERBUFFER,b.RGBA4,t.width,t.height)}function mt(e){return e===Ht.NearestFilter||e===Ht.NearestMipMapNearestFilter||e===Ht.NearestMipMapLinearFilter?b.NEAREST:b.LINEAR}function gt(e){var t;if(e===Ht.RepeatWrapping)return b.REPEAT;if(e===Ht.ClampToEdgeWrapping)return b.CLAMP_TO_EDGE;if(e===Ht.MirroredRepeatWrapping)return b.MIRRORED_REPEAT;if(e===Ht.NearestFilter)return b.NEAREST;if(e===Ht.NearestMipMapNearestFilter)return b.NEAREST_MIPMAP_NEAREST;if(e===Ht.NearestMipMapLinearFilter)return b.NEAREST_MIPMAP_LINEAR;if(e===Ht.LinearFilter)return b.LINEAR;if(e===Ht.LinearMipMapNearestFilter)return b.LINEAR_MIPMAP_NEAREST;if(e===Ht.LinearMipMapLinearFilter)return b.LINEAR_MIPMAP_LINEAR;if(e===Ht.UnsignedByteType)return b.UNSIGNED_BYTE;if(e===Ht.UnsignedShort4444Type)return b.UNSIGNED_SHORT_4_4_4_4;if(e===Ht.UnsignedShort5551Type)return b.UNSIGNED_SHORT_5_5_5_1;if(e===Ht.UnsignedShort565Type)return b.UNSIGNED_SHORT_5_6_5;if(e===Ht.ByteType)return b.BYTE;if(e===Ht.ShortType)return b.SHORT;if(e===Ht.UnsignedShortType)return b.UNSIGNED_SHORT;if(e===Ht.IntType)return b.INT;if(e===Ht.UnsignedIntType)return b.UNSIGNED_INT;if(e===Ht.FloatType)return b.FLOAT;if(e===Ht.AlphaFormat)return b.ALPHA;if(e===Ht.RGBFormat)return b.RGB;if(e===Ht.RGBAFormat)return b.RGBA;if(e===Ht.LuminanceFormat)return b.LUMINANCE;if(e===Ht.LuminanceAlphaFormat)return b.LUMINANCE_ALPHA;if(e===Ht.AddEquation)return b.FUNC_ADD;if(e===Ht.SubtractEquation)return b.FUNC_SUBTRACT;if(e===Ht.ReverseSubtractEquation)return b.FUNC_REVERSE_SUBTRACT;if(e===Ht.ZeroFactor)return b.ZERO;if(e===Ht.OneFactor)return b.ONE;if(e===Ht.SrcColorFactor)return b.SRC_COLOR;if(e===Ht.OneMinusSrcColorFactor)return b.ONE_MINUS_SRC_COLOR;if(e===Ht.SrcAlphaFactor)return b.SRC_ALPHA;if(e===Ht.OneMinusSrcAlphaFactor)return b.ONE_MINUS_SRC_ALPHA;if(e===Ht.DstAlphaFactor)return b.DST_ALPHA;if(e===Ht.OneMinusDstAlphaFactor)return b.ONE_MINUS_DST_ALPHA;if(e===Ht.DstColorFactor)return b.DST_COLOR;if(e===Ht.OneMinusDstColorFactor)return b.ONE_MINUS_DST_COLOR;if(e===Ht.SrcAlphaSaturateFactor)return b.SRC_ALPHA_SATURATE;if(null!==(t=ne.get("WEBGL_compressed_texture_s3tc"))){if(e===Ht.RGB_S3TC_DXT1_Format)return t.COMPRESSED_RGB_S3TC_DXT1_EXT;if(e===Ht.RGBA_S3TC_DXT1_Format)return t.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(e===Ht.RGBA_S3TC_DXT3_Format)return t.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(e===Ht.RGBA_S3TC_DXT5_Format)return t.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(null!==(t=ne.get("WEBGL_compressed_texture_pvrtc"))){if(e===Ht.RGB_PVRTC_4BPPV1_Format)return t.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(e===Ht.RGB_PVRTC_2BPPV1_Format)return t.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(e===Ht.RGBA_PVRTC_4BPPV1_Format)return t.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(e===Ht.RGBA_PVRTC_2BPPV1_Format)return t.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(null!==(t=ne.get("EXT_blend_minmax"))){if(e===Ht.MinEquation)return t.MIN_EXT;if(e===Ht.MaxEquation)return t.MAX_EXT}return 0}this.setFaceCulling=function(e,t){e===Ht.CullFaceNone?b.disable(b.CULL_FACE):(t===Ht.FrontFaceDirectionCW?b.frontFace(b.CW):b.frontFace(b.CCW),e===Ht.CullFaceBack?b.cullFace(b.BACK):e===Ht.CullFaceFront?b.cullFace(b.FRONT):b.cullFace(b.FRONT_AND_BACK),b.enable(b.CULL_FACE))},this.setMaterialFaces=function(e){var t=e.side===Ht.DoubleSide,r=e.side===Ht.BackSide;L!==t&&(t?b.disable(b.CULL_FACE):b.enable(b.CULL_FACE),L=t),P!==r&&(r?b.frontFace(b.CW):b.frontFace(b.CCW),P=r)},this.setDepthTest=function(e){U!==e&&(e?b.enable(b.DEPTH_TEST):b.disable(b.DEPTH_TEST),U=e)},this.setDepthWrite=function(e){N!==e&&(b.depthMask(e),N=e)},this.setBlending=function(e,t,r,n){e!==D&&(e===Ht.NoBlending?b.disable(b.BLEND):e===Ht.AdditiveBlending?(b.enable(b.BLEND),b.blendEquation(b.FUNC_ADD),b.blendFunc(b.SRC_ALPHA,b.ONE)):e===Ht.SubtractiveBlending?(b.enable(b.BLEND),b.blendEquation(b.FUNC_ADD),b.blendFunc(b.ZERO,b.ONE_MINUS_SRC_COLOR)):e===Ht.MultiplyBlending?(b.enable(b.BLEND),b.blendEquation(b.FUNC_ADD),b.blendFunc(b.ZERO,b.SRC_COLOR)):e===Ht.CustomBlending?b.enable(b.BLEND):(b.enable(b.BLEND),b.blendEquationSeparate(b.FUNC_ADD,b.FUNC_ADD),b.blendFuncSeparate(b.SRC_ALPHA,b.ONE_MINUS_SRC_ALPHA,b.ONE,b.ONE_MINUS_SRC_ALPHA)),D=e),e===Ht.CustomBlending?(t!==R&&(b.blendEquation(gt(t)),R=t),r===k&&n===F||(b.blendFunc(gt(r),gt(n)),k=r,F=n)):F=k=R=null},this.uploadTexture=function(e){void 0===e.__webglInit&&(e.__webglInit=!0,e.addEventListener("dispose",Te),e.__webglTexture=b.createTexture(),_.info.memory.textures++),b.bindTexture(b.TEXTURE_2D,e.__webglTexture),b.pixelStorei(b.UNPACK_FLIP_Y_WEBGL,e.flipY),b.pixelStorei(b.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.premultiplyAlpha),b.pixelStorei(b.UNPACK_ALIGNMENT,e.unpackAlignment),e.image=ct(e.image,se);var t=e.image,r=Ht.Math.isPowerOfTwo(t.width)&&Ht.Math.isPowerOfTwo(t.height),n=gt(e.format),i=gt(e.type);ht(b.TEXTURE_2D,e,r);var o,a=e.mipmaps;if(e instanceof Ht.DataTexture)if(0<a.length&&r){for(var s=0,l=a.length;s<l;s++)o=a[s],b.texImage2D(b.TEXTURE_2D,s,n,o.width,o.height,0,n,i,o.data);e.generateMipmaps=!1}else b.texImage2D(b.TEXTURE_2D,0,n,t.width,t.height,0,n,i,t.data);else if(e instanceof Ht.CompressedTexture)for(s=0,l=a.length;s<l;s++)o=a[s],e.format!==Ht.RGBAFormat&&e.format!==Ht.RGBFormat?-1<me().indexOf(n)?b.compressedTexImage2D(b.TEXTURE_2D,s,n,o.width,o.height,0,o.data):console.warn("Attempt to load unsupported compressed texture format"):b.texImage2D(b.TEXTURE_2D,s,n,o.width,o.height,0,n,i,o.data);else if(0<a.length&&r){for(s=0,l=a.length;s<l;s++)o=a[s],b.texImage2D(b.TEXTURE_2D,s,n,n,i,o);e.generateMipmaps=!1}else b.texImage2D(b.TEXTURE_2D,0,n,n,i,e.image);e.generateMipmaps&&r&&b.generateMipmap(b.TEXTURE_2D),e.needsUpdate=!1,e.onUpdate&&e.onUpdate()},this.setTexture=function(e,t){b.activeTexture(b.TEXTURE0+t),e.needsUpdate?_.uploadTexture(e):b.bindTexture(b.TEXTURE_2D,e.__webglTexture)},this.setRenderTarget=function(e){var t,r,n,i,o,a=e instanceof Ht.WebGLRenderTargetCube;if(e&&void 0===e.__webglFramebuffer){void 0===e.depthBuffer&&(e.depthBuffer=!0),void 0===e.stencilBuffer&&(e.stencilBuffer=!0),e.addEventListener("dispose",Ce),e.__webglTexture=b.createTexture(),_.info.memory.textures++;var s=Ht.Math.isPowerOfTwo(e.width)&&Ht.Math.isPowerOfTwo(e.height),l=gt(e.format),h=gt(e.type);if(a){e.__webglFramebuffer=[],e.__webglRenderbuffer=[],b.bindTexture(b.TEXTURE_CUBE_MAP,e.__webglTexture),ht(b.TEXTURE_CUBE_MAP,e,s);for(var c=0;c<6;c++)e.__webglFramebuffer[c]=b.createFramebuffer(),e.__webglRenderbuffer[c]=b.createRenderbuffer(),b.texImage2D(b.TEXTURE_CUBE_MAP_POSITIVE_X+c,0,l,e.width,e.height,0,l,h,null),ft(e.__webglFramebuffer[c],e,b.TEXTURE_CUBE_MAP_POSITIVE_X+c),pt(e.__webglRenderbuffer[c],e);s&&b.generateMipmap(b.TEXTURE_CUBE_MAP)}else e.__webglFramebuffer=b.createFramebuffer(),e.shareDepthFrom?e.__webglRenderbuffer=e.shareDepthFrom.__webglRenderbuffer:e.__webglRenderbuffer=b.createRenderbuffer(),b.bindTexture(b.TEXTURE_2D,e.__webglTexture),ht(b.TEXTURE_2D,e,s),b.texImage2D(b.TEXTURE_2D,0,l,e.width,e.height,0,l,h,null),ft(e.__webglFramebuffer,e,b.TEXTURE_2D),e.shareDepthFrom?e.depthBuffer&&!e.stencilBuffer?b.framebufferRenderbuffer(b.FRAMEBUFFER,b.DEPTH_ATTACHMENT,b.RENDERBUFFER,e.__webglRenderbuffer):e.depthBuffer&&e.stencilBuffer&&b.framebufferRenderbuffer(b.FRAMEBUFFER,b.DEPTH_STENCIL_ATTACHMENT,b.RENDERBUFFER,e.__webglRenderbuffer):pt(e.__webglRenderbuffer,e),s&&b.generateMipmap(b.TEXTURE_2D);a?b.bindTexture(b.TEXTURE_CUBE_MAP,null):b.bindTexture(b.TEXTURE_2D,null),b.bindRenderbuffer(b.RENDERBUFFER,null),b.bindFramebuffer(b.FRAMEBUFFER,null)}o=e?(t=a?e.__webglFramebuffer[e.activeCubeFace]:e.__webglFramebuffer,r=e.width,n=e.height,i=0):(t=null,r=G,n=W,i=I,H),t!==S&&(b.bindFramebuffer(b.FRAMEBUFFER,t),b.viewport(i,o,r,n),S=t),j=r,X=n},this.initMaterial=function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},this.addPrePlugin=function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},this.addPostPlugin=function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},this.updateShadowMap=function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")}},Ht.WebGLRenderTarget=function(e,t,r){this.width=e,this.height=t,r=r||{},this.wrapS=void 0!==r.wrapS?r.wrapS:Ht.ClampToEdgeWrapping,this.wrapT=void 0!==r.wrapT?r.wrapT:Ht.ClampToEdgeWrapping,this.magFilter=void 0!==r.magFilter?r.magFilter:Ht.LinearFilter,this.minFilter=void 0!==r.minFilter?r.minFilter:Ht.LinearMipMapLinearFilter,this.anisotropy=void 0!==r.anisotropy?r.anisotropy:1,this.offset=new Ht.Vector2(0,0),this.repeat=new Ht.Vector2(1,1),this.format=void 0!==r.format?r.format:Ht.RGBAFormat,this.type=void 0!==r.type?r.type:Ht.UnsignedByteType,this.depthBuffer=void 0===r.depthBuffer||r.depthBuffer,this.stencilBuffer=void 0===r.stencilBuffer||r.stencilBuffer,this.generateMipmaps=!0,this.shareDepthFrom=null},Ht.WebGLRenderTarget.prototype={constructor:Ht.WebGLRenderTarget,setSize:function(e,t){this.width=e,this.height=t},clone:function(){var e=new Ht.WebGLRenderTarget(this.width,this.height);return e.wrapS=this.wrapS,e.wrapT=this.wrapT,e.magFilter=this.magFilter,e.minFilter=this.minFilter,e.anisotropy=this.anisotropy,e.offset.copy(this.offset),e.repeat.copy(this.repeat),e.format=this.format,e.type=this.type,e.depthBuffer=this.depthBuffer,e.stencilBuffer=this.stencilBuffer,e.generateMipmaps=this.generateMipmaps,e.shareDepthFrom=this.shareDepthFrom,e},dispose:function(){this.dispatchEvent({type:"dispose"})}},Ht.EventDispatcher.prototype.apply(Ht.WebGLRenderTarget.prototype),Ht.WebGLRenderTargetCube=function(e,t,r){Ht.WebGLRenderTarget.call(this,e,t,r),this.activeCubeFace=0},Ht.WebGLRenderTargetCube.prototype=Object.create(Ht.WebGLRenderTarget.prototype),Ht.WebGLExtensions=function(e){var t={};this.get=function(r){if(void 0!==t[r])return t[r];var n;switch(r){case"OES_texture_float":n=e.getExtension("OES_texture_float");break;case"OES_texture_float_linear":n=e.getExtension("OES_texture_float_linear");break;case"OES_standard_derivatives":n=e.getExtension("OES_standard_derivatives");break;case"EXT_texture_filter_anisotropic":n=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":n=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":n=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;case"OES_element_index_uint":n=e.getExtension("OES_element_index_uint");break;case"EXT_blend_minmax":n=e.getExtension("EXT_blend_minmax");break;case"EXT_frag_depth":n=e.getExtension("EXT_frag_depth")}return null===n&&console.log("THREE.WebGLRenderer: "+r+" extension not supported."),t[r]=n}},Ht.WebGLProgram=(rt=0,function(e,t,r,n){var i=e,o=i.context,a=r.defines,s=r.__webglShader.uniforms,l=r.attributes,h=r.__webglShader.vertexShader,c=r.__webglShader.fragmentShader,u=r.index0AttributeName;void 0===u&&!0===n.morphTargets&&(u="position");var d="SHADOWMAP_TYPE_BASIC";n.shadowMapType===Ht.PCFShadowMap?d="SHADOWMAP_TYPE_PCF":n.shadowMapType===Ht.PCFSoftShadowMap&&(d="SHADOWMAP_TYPE_PCF_SOFT");var f,p,m=function(e){var t,r,n=[];for(var i in e)!1!==(t=e[i])&&(r="#define "+i+" "+t,n.push(r));return n.join("\n")}(a),g=o.createProgram();p=r instanceof Ht.RawShaderMaterial?f="":(f=["precision "+n.precision+" float;","precision "+n.precision+" int;",m,n.supportsVertexTextures?"#define VERTEX_TEXTURES":"",i.gammaInput?"#define GAMMA_INPUT":"",i.gammaOutput?"#define GAMMA_OUTPUT":"","#define MAX_DIR_LIGHTS "+n.maxDirLights,"#define MAX_POINT_LIGHTS "+n.maxPointLights,"#define MAX_SPOT_LIGHTS "+n.maxSpotLights,"#define MAX_HEMI_LIGHTS "+n.maxHemiLights,"#define MAX_SHADOWS "+n.maxShadows,"#define MAX_BONES "+n.maxBones,n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.lightMap?"#define USE_LIGHTMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.vertexColors?"#define USE_COLOR":"",n.skinning?"#define USE_SKINNING":"",n.useVertexTexture?"#define BONE_TEXTURE":"",n.morphTargets?"#define USE_MORPHTARGETS":"",n.morphNormals?"#define USE_MORPHNORMALS":"",n.wrapAround?"#define WRAP_AROUND":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+d:"",n.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",n.shadowMapCascade?"#define SHADOWMAP_CASCADE":"",n.sizeAttenuation?"#define USE_SIZEATTENUATION":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","attribute vec2 uv2;","#ifdef USE_COLOR","\tattribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif",""].join("\n"),["precision "+n.precision+" float;","precision "+n.precision+" int;",n.bumpMap||n.normalMap?"#extension GL_OES_standard_derivatives : enable":"",m,"#define MAX_DIR_LIGHTS "+n.maxDirLights,"#define MAX_POINT_LIGHTS "+n.maxPointLights,"#define MAX_SPOT_LIGHTS "+n.maxSpotLights,"#define MAX_HEMI_LIGHTS "+n.maxHemiLights,"#define MAX_SHADOWS "+n.maxShadows,n.alphaTest?"#define ALPHATEST "+n.alphaTest:"",i.gammaInput?"#define GAMMA_INPUT":"",i.gammaOutput?"#define GAMMA_OUTPUT":"",n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.lightMap?"#define USE_LIGHTMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.vertexColors?"#define USE_COLOR":"",n.metal?"#define METAL":"",n.wrapAround?"#define WRAP_AROUND":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+d:"",n.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",n.shadowMapCascade?"#define SHADOWMAP_CASCADE":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;",""].join("\n"));var v=new Ht.WebGLShader(o,o.VERTEX_SHADER,f+h),y=new Ht.WebGLShader(o,o.FRAGMENT_SHADER,p+c);o.attachShader(g,v),o.attachShader(g,y),void 0!==u&&o.bindAttribLocation(g,0,u),o.linkProgram(g),!1===o.getProgramParameter(g,o.LINK_STATUS)&&(console.error("THREE.WebGLProgram: Could not initialise shader."),console.error("gl.VALIDATE_STATUS",o.getProgramParameter(g,o.VALIDATE_STATUS)),console.error("gl.getError()",o.getError())),""!==o.getProgramInfoLog(g)&&console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",o.getProgramInfoLog(g)),o.deleteShader(v),o.deleteShader(y);var x=["viewMatrix","modelViewMatrix","projectionMatrix","normalMatrix","modelMatrix","cameraPosition","morphTargetInfluences","bindMatrix","bindMatrixInverse"];for(var b in n.useVertexTexture?(x.push("boneTexture"),x.push("boneTextureWidth"),x.push("boneTextureHeight")):x.push("boneGlobalMatrices"),n.logarithmicDepthBuffer&&x.push("logDepthBufFC"),s)x.push(b);this.uniforms=function(e,t,r){for(var n={},i=0,o=r.length;i<o;i++){var a=r[i];n[a]=e.getUniformLocation(t,a)}return n}(o,g,x),x=["position","normal","uv","uv2","tangent","color","skinIndex","skinWeight","lineDistance"];for(var _=0;_<n.maxMorphTargets;_++)x.push("morphTarget"+_);for(_=0;_<n.maxMorphNormals;_++)x.push("morphNormal"+_);for(var w in l)x.push(w);return this.attributes=function(e,t,r){for(var n={},i=0,o=r.length;i<o;i++){var a=r[i];n[a]=e.getAttribLocation(t,a)}return n}(o,g,x),this.attributesKeys=Object.keys(this.attributes),this.id=rt++,this.code=t,this.usedTimes=1,this.program=g,this.vertexShader=v,this.fragmentShader=y,this}),Ht.WebGLShader=function(e,t,r){var n=e.createShader(t);return e.shaderSource(n,r),e.compileShader(n),!1===e.getShaderParameter(n,e.COMPILE_STATUS)&&console.error("THREE.WebGLShader: Shader couldn't compile."),""!==e.getShaderInfoLog(n)&&(console.warn("THREE.WebGLShader: gl.getShaderInfoLog()",e.getShaderInfoLog(n)),console.warn(function(e){for(var t=e.split("\n"),r=0;r<t.length;r++)t[r]=r+1+": "+t[r];return t.join("\n")}(r))),n},Ht.LensFlarePlugin=function(e,t){var r,n,i,o,a,s,l,h,c=e.context;this.render=function(u,d,f,p){if(0!==t.length){var m=new Ht.Vector3,g=p/f,v=.5*f,y=.5*p,x=16/p,b=new Ht.Vector2(x*g,x),_=new Ht.Vector3(1,1,0),w=new Ht.Vector2(1,1);void 0===i&&function(){var t,u,d,f,p,m=new Float32Array([-1,-1,0,0,1,-1,1,0,1,1,1,1,-1,1,0,1]),g=new Uint16Array([0,1,2,0,2,3]);r=c.createBuffer(),n=c.createBuffer(),c.bindBuffer(c.ARRAY_BUFFER,r),c.bufferData(c.ARRAY_BUFFER,m,c.STATIC_DRAW),c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,n),c.bufferData(c.ELEMENT_ARRAY_BUFFER,g,c.STATIC_DRAW),l=c.createTexture(),h=c.createTexture(),c.bindTexture(c.TEXTURE_2D,l),c.texImage2D(c.TEXTURE_2D,0,c.RGB,16,16,0,c.RGB,c.UNSIGNED_BYTE,null),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,c.CLAMP_TO_EDGE),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,c.CLAMP_TO_EDGE),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,c.NEAREST),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,c.NEAREST),c.bindTexture(c.TEXTURE_2D,h),c.texImage2D(c.TEXTURE_2D,0,c.RGBA,16,16,0,c.RGBA,c.UNSIGNED_BYTE,null),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,c.CLAMP_TO_EDGE),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,c.CLAMP_TO_EDGE),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,c.NEAREST),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,c.NEAREST),t=(s=0<c.getParameter(c.MAX_VERTEX_TEXTURE_IMAGE_UNITS))?{vertexShader:["uniform lowp int renderType;","uniform vec3 screenPosition;","uniform vec2 scale;","uniform float rotation;","uniform sampler2D occlusionMap;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","varying float vVisibility;","void main() {","vUV = uv;","vec2 pos = position;","if( renderType == 2 ) {","vec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.1, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.5 ) );","vVisibility =        visibility.r / 9.0;","vVisibility *= 1.0 - visibility.g / 9.0;","vVisibility *=       visibility.b / 9.0;","vVisibility *= 1.0 - visibility.a / 9.0;","pos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;","pos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;","}","gl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );","}"].join("\n"),fragmentShader:["uniform lowp int renderType;","uniform sampler2D map;","uniform float opacity;","uniform vec3 color;","varying vec2 vUV;","varying float vVisibility;","void main() {","if( renderType == 0 ) {","gl_FragColor = vec4( 1.0, 0.0, 1.0, 0.0 );","} else if( renderType == 1 ) {","gl_FragColor = texture2D( map, vUV );","} else {","vec4 texture = texture2D( map, vUV );","texture.a *= opacity * vVisibility;","gl_FragColor = texture;","gl_FragColor.rgb *= color;","}","}"].join("\n")}:{vertexShader:["uniform lowp int renderType;","uniform vec3 screenPosition;","uniform vec2 scale;","uniform float rotation;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","void main() {","vUV = uv;","vec2 pos = position;","if( renderType == 2 ) {","pos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;","pos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;","}","gl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );","}"].join("\n"),fragmentShader:["precision mediump float;","uniform lowp int renderType;","uniform sampler2D map;","uniform sampler2D occlusionMap;","uniform float opacity;","uniform vec3 color;","varying vec2 vUV;","void main() {","if( renderType == 0 ) {","gl_FragColor = vec4( texture2D( map, vUV ).rgb, 0.0 );","} else if( renderType == 1 ) {","gl_FragColor = texture2D( map, vUV );","} else {","float visibility = texture2D( occlusionMap, vec2( 0.5, 0.1 ) ).a;","visibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) ).a;","visibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) ).a;","visibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) ).a;","visibility = ( 1.0 - visibility / 4.0 );","vec4 texture = texture2D( map, vUV );","texture.a *= opacity * visibility;","gl_FragColor = texture;","gl_FragColor.rgb *= color;","}","}"].join("\n")},u=c.createProgram(),d=c.createShader(c.FRAGMENT_SHADER),f=c.createShader(c.VERTEX_SHADER),p="precision "+e.getPrecision()+" float;\n",c.shaderSource(d,p+t.fragmentShader),c.shaderSource(f,p+t.vertexShader),c.compileShader(d),c.compileShader(f),c.attachShader(u,d),c.attachShader(u,f),c.linkProgram(u),i=u,o={vertex:c.getAttribLocation(i,"position"),uv:c.getAttribLocation(i,"uv")},a={renderType:c.getUniformLocation(i,"renderType"),map:c.getUniformLocation(i,"map"),occlusionMap:c.getUniformLocation(i,"occlusionMap"),opacity:c.getUniformLocation(i,"opacity"),color:c.getUniformLocation(i,"color"),scale:c.getUniformLocation(i,"scale"),rotation:c.getUniformLocation(i,"rotation"),screenPosition:c.getUniformLocation(i,"screenPosition")}}(),c.useProgram(i),c.enableVertexAttribArray(o.vertex),c.enableVertexAttribArray(o.uv),c.uniform1i(a.occlusionMap,0),c.uniform1i(a.map,1),c.bindBuffer(c.ARRAY_BUFFER,r),c.vertexAttribPointer(o.vertex,2,c.FLOAT,!1,16,0),c.vertexAttribPointer(o.uv,2,c.FLOAT,!1,16,8),c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,n),c.disable(c.CULL_FACE),c.depthMask(!1);for(var M=0,S=t.length;M<S;M++){x=16/p,b.set(x*g,x);var T=t[M];if(m.set(T.matrixWorld.elements[12],T.matrixWorld.elements[13],T.matrixWorld.elements[14]),m.applyMatrix4(d.matrixWorldInverse),m.applyProjection(d.projectionMatrix),_.copy(m),w.x=_.x*v+v,w.y=_.y*y+y,s||0<w.x&&w.x<f&&0<w.y&&w.y<p){c.activeTexture(c.TEXTURE1),c.bindTexture(c.TEXTURE_2D,l),c.copyTexImage2D(c.TEXTURE_2D,0,c.RGB,w.x-8,w.y-8,16,16,0),c.uniform1i(a.renderType,0),c.uniform2f(a.scale,b.x,b.y),c.uniform3f(a.screenPosition,_.x,_.y,_.z),c.disable(c.BLEND),c.enable(c.DEPTH_TEST),c.drawElements(c.TRIANGLES,6,c.UNSIGNED_SHORT,0),c.activeTexture(c.TEXTURE0),c.bindTexture(c.TEXTURE_2D,h),c.copyTexImage2D(c.TEXTURE_2D,0,c.RGBA,w.x-8,w.y-8,16,16,0),c.uniform1i(a.renderType,1),c.disable(c.DEPTH_TEST),c.activeTexture(c.TEXTURE1),c.bindTexture(c.TEXTURE_2D,l),c.drawElements(c.TRIANGLES,6,c.UNSIGNED_SHORT,0),T.positionScreen.copy(_),T.customUpdateCallback?T.customUpdateCallback(T):T.updateLensFlares(),c.uniform1i(a.renderType,2),c.enable(c.BLEND);for(var C=0,E=T.lensFlares.length;C<E;C++){var A=T.lensFlares[C];.001<A.opacity&&.001<A.scale&&(_.x=A.x,_.y=A.y,_.z=A.z,x=A.size*A.scale/p,b.x=x*g,b.y=x,c.uniform3f(a.screenPosition,_.x,_.y,_.z),c.uniform2f(a.scale,b.x,b.y),c.uniform1f(a.rotation,A.rotation),c.uniform1f(a.opacity,A.opacity),c.uniform3f(a.color,A.color.r,A.color.g,A.color.b),e.setBlending(A.blending,A.blendEquation,A.blendSrc,A.blendDst),e.setTexture(A.texture,1),c.drawElements(c.TRIANGLES,6,c.UNSIGNED_SHORT,0))}}}c.enable(c.CULL_FACE),c.enable(c.DEPTH_TEST),c.depthMask(!0),e.resetGLState()}}},Ht.ShadowMapPlugin=function(e,t,r,n){var i,o,a,s,l=e.context,h=new Ht.Frustum,c=new Ht.Matrix4,u=new Ht.Vector3,d=new Ht.Vector3,f=new Ht.Vector3,p=[],m=Ht.ShaderLib.depthRGBA,g=Ht.UniformsUtils.clone(m.uniforms);function v(e,t,n){if(t.visible){var i=r[t.id];if(i&&t.castShadow&&(!1===t.frustumCulled||!0===h.intersectsObject(t)))for(var o=0,a=i.length;o<a;o++){var s=i[o];t._modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,t.matrixWorld),p.push(s)}for(o=0,a=t.children.length;o<a;o++)v(e,t.children[o],n)}}function y(e,t){var r=new Ht.DirectionalLight;r.isVirtual=!0,r.onlyShadow=!0,r.castShadow=!0,r.shadowCameraNear=e.shadowCameraNear,r.shadowCameraFar=e.shadowCameraFar,r.shadowCameraLeft=e.shadowCameraLeft,r.shadowCameraRight=e.shadowCameraRight,r.shadowCameraBottom=e.shadowCameraBottom,r.shadowCameraTop=e.shadowCameraTop,r.shadowCameraVisible=e.shadowCameraVisible,r.shadowDarkness=e.shadowDarkness,r.shadowBias=e.shadowCascadeBias[t],r.shadowMapWidth=e.shadowCascadeWidth[t],r.shadowMapHeight=e.shadowCascadeHeight[t],r.pointsWorld=[],r.pointsFrustum=[];for(var n=r.pointsWorld,i=r.pointsFrustum,o=0;o<8;o++)n[o]=new Ht.Vector3,i[o]=new Ht.Vector3;var a=e.shadowCascadeNearZ[t],s=e.shadowCascadeFarZ[t];return i[0].set(-1,-1,a),i[1].set(1,-1,a),i[2].set(-1,1,a),i[3].set(1,1,a),i[4].set(-1,-1,s),i[5].set(1,-1,s),i[6].set(-1,1,s),i[7].set(1,1,s),r}function x(e,t){var r=e.shadowCascadeArray[t];r.position.copy(e.position),r.target.position.copy(e.target.position),r.lookAt(r.target),r.shadowCameraVisible=e.shadowCameraVisible,r.shadowDarkness=e.shadowDarkness,r.shadowBias=e.shadowCascadeBias[t];var n=e.shadowCascadeNearZ[t],i=e.shadowCascadeFarZ[t],o=r.pointsFrustum;o[0].z=n,o[1].z=n,o[2].z=n,o[3].z=n,o[4].z=i,o[5].z=i,o[6].z=i,o[7].z=i}function b(e,t){var r=t.shadowCamera,n=t.pointsFrustum,i=t.pointsWorld;u.set(1/0,1/0,1/0),d.set(-1/0,-1/0,-1/0);for(var o=0;o<8;o++){var a=i[o];a.copy(n[o]),a.unproject(e),a.applyMatrix4(r.matrixWorldInverse),a.x<u.x&&(u.x=a.x),a.x>d.x&&(d.x=a.x),a.y<u.y&&(u.y=a.y),a.y>d.y&&(d.y=a.y),a.z<u.z&&(u.z=a.z),a.z>d.z&&(d.z=a.z)}r.left=u.x,r.right=d.x,r.top=d.y,r.bottom=u.y,r.updateProjectionMatrix()}i=new Ht.ShaderMaterial({uniforms:g,vertexShader:m.vertexShader,fragmentShader:m.fragmentShader}),o=new Ht.ShaderMaterial({uniforms:g,vertexShader:m.vertexShader,fragmentShader:m.fragmentShader,morphTargets:!0}),a=new Ht.ShaderMaterial({uniforms:g,vertexShader:m.vertexShader,fragmentShader:m.fragmentShader,skinning:!0}),s=new Ht.ShaderMaterial({uniforms:g,vertexShader:m.vertexShader,fragmentShader:m.fragmentShader,morphTargets:!0,skinning:!0}),i._shadowPass=!0,o._shadowPass=!0,a._shadowPass=!0,s._shadowPass=!0,this.render=function(r,u){if(!1!==e.shadowMapEnabled){var d,m,g,_,w,M,S,T,C,E,A,L,P,D,R=[],k=0;for(l.clearColor(1,1,1,1),l.disable(l.BLEND),l.enable(l.CULL_FACE),l.frontFace(l.CCW),e.shadowMapCullFace===Ht.CullFaceFront?l.cullFace(l.FRONT):l.cullFace(l.BACK),e.setDepthTest(!0),d=0,m=t.length;d<m;d++)if((P=t[d]).castShadow)if(P instanceof Ht.DirectionalLight&&P.shadowCascade)for(w=0;w<P.shadowCascadeCount;w++){var F;if(P.shadowCascadeArray[w])F=P.shadowCascadeArray[w];else{(F=y(P,w)).originalCamera=u;var U=new Ht.Gyroscope;U.position.copy(P.shadowCascadeOffset),U.add(F),U.add(F.target),u.add(U),P.shadowCascadeArray[w]=F,console.log("Created virtualLight",F)}x(P,w),R[k]=F,k++}else R[k]=P,k++;for(d=0,m=R.length;d<m;d++){if(!(P=R[d]).shadowMap){var N=Ht.LinearFilter;e.shadowMapType===Ht.PCFSoftShadowMap&&(N=Ht.NearestFilter);var B={minFilter:N,magFilter:N,format:Ht.RGBAFormat};P.shadowMap=new Ht.WebGLRenderTarget(P.shadowMapWidth,P.shadowMapHeight,B),P.shadowMapSize=new Ht.Vector2(P.shadowMapWidth,P.shadowMapHeight),P.shadowMatrix=new Ht.Matrix4}if(!P.shadowCamera){if(P instanceof Ht.SpotLight)P.shadowCamera=new Ht.PerspectiveCamera(P.shadowCameraFov,P.shadowMapWidth/P.shadowMapHeight,P.shadowCameraNear,P.shadowCameraFar);else{if(!(P instanceof Ht.DirectionalLight)){console.error("Unsupported light type for shadow");continue}P.shadowCamera=new Ht.OrthographicCamera(P.shadowCameraLeft,P.shadowCameraRight,P.shadowCameraTop,P.shadowCameraBottom,P.shadowCameraNear,P.shadowCameraFar)}r.add(P.shadowCamera),!0===r.autoUpdate&&r.updateMatrixWorld()}var V,z,O;for(P.shadowCameraVisible&&!P.cameraHelper&&(P.cameraHelper=new Ht.CameraHelper(P.shadowCamera),r.add(P.cameraHelper)),P.isVirtual&&F.originalCamera==u&&b(u,P),M=P.shadowMap,S=P.shadowMatrix,(T=P.shadowCamera).position.setFromMatrixPosition(P.matrixWorld),f.setFromMatrixPosition(P.target.matrixWorld),T.lookAt(f),T.updateMatrixWorld(),T.matrixWorldInverse.getInverse(T.matrixWorld),P.cameraHelper&&(P.cameraHelper.visible=P.shadowCameraVisible),P.shadowCameraVisible&&P.cameraHelper.update(),S.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),S.multiply(T.projectionMatrix),S.multiply(T.matrixWorldInverse),c.multiplyMatrices(T.projectionMatrix,T.matrixWorldInverse),h.setFromMatrix(c),e.setRenderTarget(M),e.clear(),p.length=0,v(r,r,T),g=0,_=p.length;g<_;g++)L=(A=p[g]).object,C=A.buffer,V=(D=L).material instanceof Ht.MeshFaceMaterial?D.material.materials[0]:D.material,z=void 0!==L.geometry.morphTargets&&0<L.geometry.morphTargets.length&&V.morphTargets,O=L instanceof Ht.SkinnedMesh&&V.skinning,E=L.customDepthMaterial?L.customDepthMaterial:O?z?s:a:z?o:i,e.setMaterialFaces(V),C instanceof Ht.BufferGeometry?e.renderBufferDirect(T,t,null,E,C,L):e.renderBuffer(T,t,null,E,C,L);for(g=0,_=n.length;g<_;g++)(L=(A=n[g]).object).visible&&L.castShadow&&(L._modelViewMatrix.multiplyMatrices(T.matrixWorldInverse,L.matrixWorld),e.renderImmediateObject(T,t,null,i,L))}var I=e.getClearColor(),H=e.getClearAlpha();l.clearColor(I.r,I.g,I.b,H),l.enable(l.BLEND),e.shadowMapCullFace===Ht.CullFaceFront&&l.cullFace(l.BACK),e.resetGLState()}}},Ht.SpritePlugin=function(e,t){var r,n,i,o,a,s,l=e.context;function h(e,t){return e.z!==t.z?t.z-e.z:t.id-e.id}this.render=function(c,u){if(0!==t.length){void 0===i&&function(){var t,h,c,u=new Float32Array([-.5,-.5,0,0,.5,-.5,1,0,.5,.5,1,1,-.5,.5,0,1]),d=new Uint16Array([0,1,2,0,2,3]);r=l.createBuffer(),n=l.createBuffer(),l.bindBuffer(l.ARRAY_BUFFER,r),l.bufferData(l.ARRAY_BUFFER,u,l.STATIC_DRAW),l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,n),l.bufferData(l.ELEMENT_ARRAY_BUFFER,d,l.STATIC_DRAW),t=l.createProgram(),h=l.createShader(l.VERTEX_SHADER),c=l.createShader(l.FRAGMENT_SHADER),l.shaderSource(h,["precision "+e.getPrecision()+" float;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform float rotation;","uniform vec2 scale;","uniform vec2 uvOffset;","uniform vec2 uvScale;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","void main() {","vUV = uvOffset + uv * uvScale;","vec2 alignedPosition = position * scale;","vec2 rotatedPosition;","rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;","rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;","vec4 finalPosition;","finalPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );","finalPosition.xy += rotatedPosition;","finalPosition = projectionMatrix * finalPosition;","gl_Position = finalPosition;","}"].join("\n")),l.shaderSource(c,["precision "+e.getPrecision()+" float;","uniform vec3 color;","uniform sampler2D map;","uniform float opacity;","uniform int fogType;","uniform vec3 fogColor;","uniform float fogDensity;","uniform float fogNear;","uniform float fogFar;","uniform float alphaTest;","varying vec2 vUV;","void main() {","vec4 texture = texture2D( map, vUV );","if ( texture.a < alphaTest ) discard;","gl_FragColor = vec4( color * texture.xyz, texture.a * opacity );","if ( fogType > 0 ) {","float depth = gl_FragCoord.z / gl_FragCoord.w;","float fogFactor = 0.0;","if ( fogType == 1 ) {","fogFactor = smoothstep( fogNear, fogFar, depth );","} else {","const float LOG2 = 1.442695;","float fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );","fogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );","}","gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );","}","}"].join("\n")),l.compileShader(h),l.compileShader(c),l.attachShader(t,h),l.attachShader(t,c),l.linkProgram(t),i=t,o={position:l.getAttribLocation(i,"position"),uv:l.getAttribLocation(i,"uv")},a={uvOffset:l.getUniformLocation(i,"uvOffset"),uvScale:l.getUniformLocation(i,"uvScale"),rotation:l.getUniformLocation(i,"rotation"),scale:l.getUniformLocation(i,"scale"),color:l.getUniformLocation(i,"color"),map:l.getUniformLocation(i,"map"),opacity:l.getUniformLocation(i,"opacity"),modelViewMatrix:l.getUniformLocation(i,"modelViewMatrix"),projectionMatrix:l.getUniformLocation(i,"projectionMatrix"),fogType:l.getUniformLocation(i,"fogType"),fogDensity:l.getUniformLocation(i,"fogDensity"),fogNear:l.getUniformLocation(i,"fogNear"),fogFar:l.getUniformLocation(i,"fogFar"),fogColor:l.getUniformLocation(i,"fogColor"),alphaTest:l.getUniformLocation(i,"alphaTest")};var f=document.createElement("canvas");f.width=8,f.height=8;var p=f.getContext("2d");p.fillStyle="white",p.fillRect(0,0,8,8),(s=new Ht.Texture(f)).needsUpdate=!0}(),l.useProgram(i),l.enableVertexAttribArray(o.position),l.enableVertexAttribArray(o.uv),l.disable(l.CULL_FACE),l.enable(l.BLEND),l.bindBuffer(l.ARRAY_BUFFER,r),l.vertexAttribPointer(o.position,2,l.FLOAT,!1,16,0),l.vertexAttribPointer(o.uv,2,l.FLOAT,!1,16,8),l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,n),l.uniformMatrix4fv(a.projectionMatrix,!1,u.projectionMatrix.elements),l.activeTexture(l.TEXTURE0),l.uniform1i(a.map,0);var d=0,f=0,p=c.fog;p?(l.uniform3f(a.fogColor,p.color.r,p.color.g,p.color.b),p instanceof Ht.Fog?(l.uniform1f(a.fogNear,p.near),l.uniform1f(a.fogFar,p.far),l.uniform1i(a.fogType,1),f=d=1):p instanceof Ht.FogExp2&&(l.uniform1f(a.fogDensity,p.density),l.uniform1i(a.fogType,2),f=d=2)):(l.uniform1i(a.fogType,0),f=d=0);for(var m=0,g=t.length;m<g;m++)(y=t[m])._modelViewMatrix.multiplyMatrices(u.matrixWorldInverse,y.matrixWorld),null===y.renderDepth?y.z=-y._modelViewMatrix.elements[14]:y.z=y.renderDepth;t.sort(h);var v=[];for(m=0,g=t.length;m<g;m++){var y,x=(y=t[m]).material;l.uniform1f(a.alphaTest,x.alphaTest),l.uniformMatrix4fv(a.modelViewMatrix,!1,y._modelViewMatrix.elements),v[0]=y.scale.x,v[1]=y.scale.y;var b=0;c.fog&&x.fog&&(b=f),d!==b&&(l.uniform1i(a.fogType,b),d=b),null!==x.map?(l.uniform2f(a.uvOffset,x.map.offset.x,x.map.offset.y),l.uniform2f(a.uvScale,x.map.repeat.x,x.map.repeat.y)):(l.uniform2f(a.uvOffset,0,0),l.uniform2f(a.uvScale,1,1)),l.uniform1f(a.opacity,x.opacity),l.uniform3f(a.color,x.color.r,x.color.g,x.color.b),l.uniform1f(a.rotation,x.rotation),l.uniform2fv(a.scale,v),e.setBlending(x.blending,x.blendEquation,x.blendSrc,x.blendDst),e.setDepthTest(x.depthTest),e.setDepthWrite(x.depthWrite),x.map&&x.map.image&&x.map.image.width?e.setTexture(x.map,0):e.setTexture(s,0),l.drawElements(l.TRIANGLES,6,l.UNSIGNED_SHORT,0)}l.enable(l.CULL_FACE),e.resetGLState()}}},Ht.GeometryUtils={merge:function(e,t,r){var n;console.warn("THREE.GeometryUtils: .merge() has been moved to Geometry. Use geometry.merge( geometry2, matrix, materialIndexOffset ) instead."),t instanceof Ht.Mesh&&(t.matrixAutoUpdate&&t.updateMatrix(),n=t.matrix,t=t.geometry),e.merge(t,n,r)},center:function(e){return console.warn("THREE.GeometryUtils: .center() has been moved to Geometry. Use geometry.center() instead."),e.center()}},Ht.ImageUtils={crossOrigin:void 0,loadTexture:function(e,t,r,n){var i=new Ht.ImageLoader;i.crossOrigin=this.crossOrigin;var o=new Ht.Texture(void 0,t);return i.load(e,function(e){o.image=e,o.needsUpdate=!0,r&&r(o)},void 0,function(e){n&&n(e)}),o.sourceFile=e,o},loadTextureCube:function(e,t,r,n){var i=new Ht.ImageLoader;i.crossOrigin=this.crossOrigin;var o=new Ht.CubeTexture([],t);o.flipY=!1;for(var a=0,s=function(t){i.load(e[t],function(e){o.images[t]=e,6===(a+=1)&&(o.needsUpdate=!0,r&&r(o))})},l=0,h=e.length;l<h;++l)s(l);return o},loadCompressedTexture:function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},loadCompressedTextureCube:function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")},getNormalMap:function(e,t){var r=function(e,t){return[e[0]-t[0],e[1]-t[1],e[2]-t[2]]};t|=1;var n=e.width,i=e.height,o=document.createElement("canvas");o.width=n,o.height=i;var a=o.getContext("2d");a.drawImage(e,0,0);for(var s,l,h,c,u=a.getImageData(0,0,n,i).data,d=a.createImageData(n,i),f=d.data,p=0;p<n;p++)for(var m=0;m<i;m++){var g=m-1<0?0:m-1,v=i-1<m+1?i-1:m+1,y=p-1<0?0:p-1,x=n-1<p+1?n-1:p+1,b=[],_=[0,0,u[4*(m*n+p)]/255*t];b.push([-1,0,u[4*(m*n+y)]/255*t]),b.push([-1,-1,u[4*(g*n+y)]/255*t]),b.push([0,-1,u[4*(g*n+p)]/255*t]),b.push([1,-1,u[4*(g*n+x)]/255*t]),b.push([1,0,u[4*(m*n+x)]/255*t]),b.push([1,1,u[4*(v*n+x)]/255*t]),b.push([0,1,u[4*(v*n+p)]/255*t]),b.push([-1,1,u[4*(v*n+y)]/255*t]);for(var w=[],M=b.length,S=0;S<M;S++){var T=b[S],C=b[(S+1)%M];T=r(T,_),C=r(C,_),w.push((c=C,s=[(h=T)[1]*c[2]-h[2]*c[1],h[2]*c[0]-h[0]*c[2],h[0]*c[1]-h[1]*c[0]],l=Math.sqrt(s[0]*s[0]+s[1]*s[1]+s[2]*s[2]),[s[0]/l,s[1]/l,s[2]/l]))}var E=[0,0,0];for(S=0;S<w.length;S++)E[0]+=w[S][0],E[1]+=w[S][1],E[2]+=w[S][2];E[0]/=w.length,E[1]/=w.length,E[2]/=w.length;var A=4*(m*n+p);f[A]=(E[0]+1)/2*255|0,f[A+1]=(E[1]+1)/2*255|0,f[A+2]=255*E[2]|0,f[A+3]=255}return a.putImageData(d,0,0),o},generateDataTexture:function(e,t,r){for(var n=e*t,i=new Uint8Array(3*n),o=Math.floor(255*r.r),a=Math.floor(255*r.g),s=Math.floor(255*r.b),l=0;l<n;l++)i[3*l]=o,i[3*l+1]=a,i[3*l+2]=s;var h=new Ht.DataTexture(i,e,t,Ht.RGBFormat);return h.needsUpdate=!0,h}},Ht.SceneUtils={createMultiMaterialObject:function(e,t){for(var r=new Ht.Object3D,n=0,i=t.length;n<i;n++)r.add(new Ht.Mesh(e,t[n]));return r},detach:function(e,t,r){e.applyMatrix(t.matrixWorld),t.remove(e),r.add(e)},attach:function(e,t,r){var n=new Ht.Matrix4;n.getInverse(r.matrixWorld),e.applyMatrix(n),t.remove(e),r.add(e)}},Ht.FontUtils={faces:{},face:"helvetiker",weight:"normal",style:"normal",size:150,divisions:10,getFace:function(){try{return this.faces[this.face][this.weight][this.style]}catch(e){throw"The font "+this.face+" with "+this.weight+" weight and "+this.style+" style is missing."}},loadFace:function(e){var t=e.familyName.toLowerCase();return this.faces[t]=this.faces[t]||{},this.faces[t][e.cssFontWeight]=this.faces[t][e.cssFontWeight]||{},this.faces[t][e.cssFontWeight][e.cssFontStyle]=e,this.faces[t][e.cssFontWeight][e.cssFontStyle]=e,e},drawText:function(e){var t,r=this.getFace(),n=this.size/r.resolution,i=0,o=String(e).split(""),a=o.length,s=[];for(t=0;t<a;t++){var l=new Ht.Path,h=this.extractGlyphPoints(o[t],r,n,i,l);i+=h.offset,s.push(h.path)}return{paths:s,offset:i/2}},extractGlyphPoints:function(e,t,r,n,i){var o,a,s,l,h,c,u,d,f,p,m,g,v,y,x,b,_,w,M=[],S=t.glyphs[e]||t.glyphs["?"];if(S){if(S.o)for(h=(l=S._cachedOutline||(S._cachedOutline=S.o.split(" "))).length,u=c=r,o=0;o<h;)switch(l[o++]){case"m":d=l[o++]*c+n,f=l[o++]*u,i.moveTo(d,f);break;case"l":d=l[o++]*c+n,f=l[o++]*u,i.lineTo(d,f);break;case"q":if(p=l[o++]*c+n,m=l[o++]*u,y=l[o++]*c+n,x=l[o++]*u,i.quadraticCurveTo(y,x,p,m),w=M[M.length-1])for(g=w.x,v=w.y,a=1,s=this.divisions;a<=s;a++){var T=a/s;Ht.Shape.Utils.b2(T,g,y,p),Ht.Shape.Utils.b2(T,v,x,m)}break;case"b":if(p=l[o++]*c+n,m=l[o++]*u,y=l[o++]*c+n,x=l[o++]*u,b=l[o++]*c+n,_=l[o++]*u,i.bezierCurveTo(y,x,b,_,p,m),w=M[M.length-1])for(g=w.x,v=w.y,a=1,s=this.divisions;a<=s;a++)T=a/s,Ht.Shape.Utils.b3(T,g,y,b,p),Ht.Shape.Utils.b3(T,v,x,_,m)}return{offset:S.ha*r,path:i}}}},Ht.FontUtils.generateShapes=function(e,t){var r=void 0!==(t=t||{}).size?t.size:100,n=void 0!==t.curveSegments?t.curveSegments:4,i=void 0!==t.font?t.font:"helvetiker",o=void 0!==t.weight?t.weight:"normal",a=void 0!==t.style?t.style:"normal";Ht.FontUtils.size=r,Ht.FontUtils.divisions=n,Ht.FontUtils.face=i,Ht.FontUtils.weight=o,Ht.FontUtils.style=a;for(var s=Ht.FontUtils.drawText(e).paths,l=[],h=0,c=s.length;h<c;h++)Array.prototype.push.apply(l,s[h].toShapes());return l},nt=Ht.FontUtils,it=function(e){for(var t=e.length,r=0,n=t-1,i=0;i<t;n=i++)r+=e[n].x*e[i].y-e[i].x*e[n].y;return.5*r},ot=function(e,t,r,n,i,o){var a,s,l,h,c,u,d,f,p,m,g,v,y,x,b;if(s=e[o[t]].x,l=e[o[t]].y,h=e[o[r]].x,c=e[o[r]].y,u=e[o[n]].x,(h-s)*((d=e[o[n]].y)-l)-(c-l)*(u-s)<1e-10)return!1;for(m=u-h,g=d-c,v=s-u,y=l-d,x=h-s,b=c-l,a=0;a<i;a++)if(f=e[o[a]].x,p=e[o[a]].y,!(f===s&&p===l||f===h&&p===c||f===u&&p===d)&&-1e-10<=m*(p-c)-g*(f-h)&&-1e-10<=v*(p-d)-y*(f-u)&&-1e-10<=x*(p-l)-b*(f-s))return!1;return!0},nt.Triangulate=function(e,t){var r=e.length;if(r<3)return null;var n,i,o,a=[],s=[],l=[];if(0<it(e))for(i=0;i<r;i++)s[i]=i;else for(i=0;i<r;i++)s[i]=r-1-i;var h=r,c=2*h;for(i=h-1;2<h;){if(c--<=0)return console.log("Warning, unable to triangulate polygon!"),t?l:a;if(h<=(n=i)&&(n=0),h<=(i=n+1)&&(i=0),h<=(o=i+1)&&(o=0),ot(e,n,i,o,h,s)){var u,d,f,p,m;for(u=s[n],d=s[i],f=s[o],a.push([e[u],e[d],e[f]]),l.push([s[n],s[i],s[o]]),m=(p=i)+1;m<h;p++,m++)s[p]=s[m];c=2*--h}}return t?l:a},nt.Triangulate.area=it,self._typeface_js={faces:Ht.FontUtils.faces,loadFace:Ht.FontUtils.loadFace},Ht.typeface_js=self._typeface_js,Ht.Audio=function(e){Ht.Object3D.call(this),this.type="Audio",this.context=e.context,this.source=this.context.createBufferSource(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.panner=this.context.createPanner(),this.panner.connect(this.gain)},Ht.Audio.prototype=Object.create(Ht.Object3D.prototype),Ht.Audio.prototype.load=function(e){var t=this,r=new XMLHttpRequest;return r.open("GET",e,!0),r.responseType="arraybuffer",r.onload=function(e){t.context.decodeAudioData(this.response,function(e){t.source.buffer=e,t.source.connect(t.panner),t.source.start(0)})},r.send(),this},Ht.Audio.prototype.setLoop=function(e){this.source.loop=e},Ht.Audio.prototype.setRefDistance=function(e){this.panner.refDistance=e},Ht.Audio.prototype.setRolloffFactor=function(e){this.panner.rolloffFactor=e},Ht.Audio.prototype.updateMatrixWorld=(at=new Ht.Vector3,function(e){Ht.Object3D.prototype.updateMatrixWorld.call(this,e),at.setFromMatrixPosition(this.matrixWorld),this.panner.setPosition(at.x,at.y,at.z)}),Ht.AudioListener=function(){Ht.Object3D.call(this),this.type="AudioListener",this.context=new(window.AudioContext||window.webkitAudioContext)},Ht.AudioListener.prototype=Object.create(Ht.Object3D.prototype),Ht.AudioListener.prototype.updateMatrixWorld=(st=new Ht.Vector3,lt=new Ht.Quaternion,ht=new Ht.Vector3,ct=new Ht.Vector3,ut=new Ht.Vector3,dt=new Ht.Vector3,function(e){Ht.Object3D.prototype.updateMatrixWorld.call(this,e);var t=this.context.listener;this.matrixWorld.decompose(st,lt,ht),ct.set(0,0,-1).applyQuaternion(lt),ut.subVectors(st,dt),t.setPosition(st.x,st.y,st.z),t.setOrientation(ct.x,ct.y,ct.z,this.up.x,this.up.y,this.up.z),t.setVelocity(ut.x,ut.y,ut.z),dt.copy(st)}),Ht.Curve=function(){},Ht.Curve.prototype.getPoint=function(e){return console.log("Warning, getPoint() not implemented!"),null},Ht.Curve.prototype.getPointAt=function(e){var t=this.getUtoTmapping(e);return this.getPoint(t)},Ht.Curve.prototype.getPoints=function(e){e||(e=5);var t,r=[];for(t=0;t<=e;t++)r.push(this.getPoint(t/e));return r},Ht.Curve.prototype.getSpacedPoints=function(e){e||(e=5);var t,r=[];for(t=0;t<=e;t++)r.push(this.getPointAt(t/e));return r},Ht.Curve.prototype.getLength=function(){var e=this.getLengths();return e[e.length-1]},Ht.Curve.prototype.getLengths=function(e){if(e||(e=this.__arcLengthDivisions?this.__arcLengthDivisions:200),this.cacheArcLengths&&this.cacheArcLengths.length==e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var t,r,n=[],i=this.getPoint(0),o=0;for(n.push(0),r=1;r<=e;r++)o+=(t=this.getPoint(r/e)).distanceTo(i),n.push(o),i=t;return this.cacheArcLengths=n},Ht.Curve.prototype.updateArcLengths=function(){this.needsUpdate=!0,this.getLengths()},Ht.Curve.prototype.getUtoTmapping=function(e,t){var r,n=this.getLengths(),i=0,o=n.length;r=t||e*n[o-1];for(var a,s=0,l=o-1;s<=l;)if((a=n[i=Math.floor(s+(l-s)/2)]-r)<0)s=i+1;else{if(!(0<a)){l=i;break}l=i-1}if(n[i=l]==r)return i/(o-1);var h=n[i];return(i+(r-h)/(n[i+1]-h))/(o-1)},Ht.Curve.prototype.getTangent=function(e){var t=e-1e-4,r=e+1e-4;t<0&&(t=0),1<r&&(r=1);var n=this.getPoint(t);return this.getPoint(r).clone().sub(n).normalize()},Ht.Curve.prototype.getTangentAt=function(e){var t=this.getUtoTmapping(e);return this.getTangent(t)},Ht.Curve.Utils={tangentQuadraticBezier:function(e,t,r,n){return 2*(1-e)*(r-t)+2*e*(n-r)},tangentCubicBezier:function(e,t,r,n,i){return-3*t*(1-e)*(1-e)+3*r*(1-e)*(1-e)-6*e*r*(1-e)+6*e*n*(1-e)-3*e*e*n+3*e*e*i},tangentSpline:function(e,t,r,n,i){return 6*e*e-6*e+(3*e*e-4*e+1)+(-6*e*e+6*e)+(3*e*e-2*e)},interpolate:function(e,t,r,n,i){var o=.5*(r-e),a=.5*(n-t),s=i*i;return(2*t-2*r+o+a)*(i*s)+(-3*t+3*r-2*o-a)*s+o*i+t}},Ht.Curve.create=function(e,t){return e.prototype=Object.create(Ht.Curve.prototype),e.prototype.getPoint=t,e},Ht.CurvePath=function(){this.curves=[],this.bends=[],this.autoClose=!1},Ht.CurvePath.prototype=Object.create(Ht.Curve.prototype),Ht.CurvePath.prototype.add=function(e){this.curves.push(e)},Ht.CurvePath.prototype.checkConnection=function(){},Ht.CurvePath.prototype.closePath=function(){var e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new Ht.LineCurve(t,e))},Ht.CurvePath.prototype.getPoint=function(e){for(var t,r=e*this.getLength(),n=this.getCurveLengths(),i=0;i<n.length;){if(n[i]>=r){var o=1-(n[i]-r)/(t=this.curves[i]).getLength();return t.getPointAt(o)}i++}return null},Ht.CurvePath.prototype.getLength=function(){var e=this.getCurveLengths();return e[e.length-1]},Ht.CurvePath.prototype.getCurveLengths=function(){if(this.cacheLengths&&this.cacheLengths.length==this.curves.length)return this.cacheLengths;var e,t=[],r=0,n=this.curves.length;for(e=0;e<n;e++)r+=this.curves[e].getLength(),t.push(r);return this.cacheLengths=t},Ht.CurvePath.prototype.getBoundingBox=function(){var e,t,r,n,i,o,a,s,l,h,c=this.getPoints();e=t=Number.NEGATIVE_INFINITY,n=i=Number.POSITIVE_INFINITY;var u=c[0]instanceof Ht.Vector3;for(h=u?new Ht.Vector3:new Ht.Vector2,s=0,l=c.length;s<l;s++)(a=c[s]).x>e?e=a.x:a.x<n&&(n=a.x),a.y>t?t=a.y:a.y<i&&(i=a.y),u&&(a.z>r?r=a.z:a.z<o&&(o=a.z)),h.add(a);var d={minX:n,minY:i,maxX:e,maxY:t};return u&&(d.maxZ=r,d.minZ=o),d},Ht.CurvePath.prototype.createPointsGeometry=function(e){var t=this.getPoints(e,!0);return this.createGeometry(t)},Ht.CurvePath.prototype.createSpacedPointsGeometry=function(e){var t=this.getSpacedPoints(e,!0);return this.createGeometry(t)},Ht.CurvePath.prototype.createGeometry=function(e){for(var t=new Ht.Geometry,r=0;r<e.length;r++)t.vertices.push(new Ht.Vector3(e[r].x,e[r].y,e[r].z||0));return t},Ht.CurvePath.prototype.addWrapPath=function(e){this.bends.push(e)},Ht.CurvePath.prototype.getTransformedPoints=function(e,t){var r,n,i=this.getPoints(e);for(t||(t=this.bends),r=0,n=t.length;r<n;r++)i=this.getWrapPoints(i,t[r]);return i},Ht.CurvePath.prototype.getTransformedSpacedPoints=function(e,t){var r,n,i=this.getSpacedPoints(e);for(t||(t=this.bends),r=0,n=t.length;r<n;r++)i=this.getWrapPoints(i,t[r]);return i},Ht.CurvePath.prototype.getWrapPoints=function(e,t){var r,n,i,o,a,s,l=this.getBoundingBox();for(r=0,n=e.length;r<n;r++){o=(i=e[r]).x,a=i.y,s=o/l.maxX,s=t.getUtoTmapping(s,o);var h=t.getPoint(s),c=t.getTangent(s);c.set(-c.y,c.x).multiplyScalar(a),i.x=h.x+c.x,i.y=h.y+c.y}return e},Ht.Gyroscope=function(){Ht.Object3D.call(this)},Ht.Gyroscope.prototype=Object.create(Ht.Object3D.prototype),Ht.Gyroscope.prototype.updateMatrixWorld=(ft=new Ht.Vector3,pt=new Ht.Quaternion,mt=new Ht.Vector3,gt=new Ht.Vector3,vt=new Ht.Quaternion,yt=new Ht.Vector3,function(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.parent?(this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorld.decompose(gt,vt,yt),this.matrix.decompose(ft,pt,mt),this.matrixWorld.compose(gt,pt,yt)):this.matrixWorld.copy(this.matrix),e=!(this.matrixWorldNeedsUpdate=!1));for(var t=0,r=this.children.length;t<r;t++)this.children[t].updateMatrixWorld(e)}),Ht.Path=function(e){Ht.CurvePath.call(this),this.actions=[],e&&this.fromPoints(e)},Ht.Path.prototype=Object.create(Ht.CurvePath.prototype),Ht.PathActions={MOVE_TO:"moveTo",LINE_TO:"lineTo",QUADRATIC_CURVE_TO:"quadraticCurveTo",BEZIER_CURVE_TO:"bezierCurveTo",CSPLINE_THRU:"splineThru",ARC:"arc",ELLIPSE:"ellipse"},Ht.Path.prototype.fromPoints=function(e){this.moveTo(e[0].x,e[0].y);for(var t=1,r=e.length;t<r;t++)this.lineTo(e[t].x,e[t].y)},Ht.Path.prototype.moveTo=function(e,t){var r=Array.prototype.slice.call(arguments);this.actions.push({action:Ht.PathActions.MOVE_TO,args:r})},Ht.Path.prototype.lineTo=function(e,t){var r=Array.prototype.slice.call(arguments),n=this.actions[this.actions.length-1].args,i=n[n.length-2],o=n[n.length-1],a=new Ht.LineCurve(new Ht.Vector2(i,o),new Ht.Vector2(e,t));this.curves.push(a),this.actions.push({action:Ht.PathActions.LINE_TO,args:r})},Ht.Path.prototype.quadraticCurveTo=function(e,t,r,n){var i=Array.prototype.slice.call(arguments),o=this.actions[this.actions.length-1].args,a=o[o.length-2],s=o[o.length-1],l=new Ht.QuadraticBezierCurve(new Ht.Vector2(a,s),new Ht.Vector2(e,t),new Ht.Vector2(r,n));this.curves.push(l),this.actions.push({action:Ht.PathActions.QUADRATIC_CURVE_TO,args:i})},Ht.Path.prototype.bezierCurveTo=function(e,t,r,n,i,o){var a=Array.prototype.slice.call(arguments),s=this.actions[this.actions.length-1].args,l=s[s.length-2],h=s[s.length-1],c=new Ht.CubicBezierCurve(new Ht.Vector2(l,h),new Ht.Vector2(e,t),new Ht.Vector2(r,n),new Ht.Vector2(i,o));this.curves.push(c),this.actions.push({action:Ht.PathActions.BEZIER_CURVE_TO,args:a})},Ht.Path.prototype.splineThru=function(e){var t=Array.prototype.slice.call(arguments),r=this.actions[this.actions.length-1].args,n=r[r.length-2],i=r[r.length-1],o=[new Ht.Vector2(n,i)];Array.prototype.push.apply(o,e);var a=new Ht.SplineCurve(o);this.curves.push(a),this.actions.push({action:Ht.PathActions.CSPLINE_THRU,args:t})},Ht.Path.prototype.arc=function(e,t,r,n,i,o){var a=this.actions[this.actions.length-1].args,s=a[a.length-2],l=a[a.length-1];this.absarc(e+s,t+l,r,n,i,o)},Ht.Path.prototype.absarc=function(e,t,r,n,i,o){this.absellipse(e,t,r,r,n,i,o)},Ht.Path.prototype.ellipse=function(e,t,r,n,i,o,a){var s=this.actions[this.actions.length-1].args,l=s[s.length-2],h=s[s.length-1];this.absellipse(e+l,t+h,r,n,i,o,a)},Ht.Path.prototype.absellipse=function(e,t,r,n,i,o,a){var s=Array.prototype.slice.call(arguments),l=new Ht.EllipseCurve(e,t,r,n,i,o,a);this.curves.push(l);var h=l.getPoint(1);s.push(h.x),s.push(h.y),this.actions.push({action:Ht.PathActions.ELLIPSE,args:s})},Ht.Path.prototype.getSpacedPoints=function(e,t){e||(e=40);for(var r=[],n=0;n<e;n++)r.push(this.getPoint(n/e));return r},Ht.Path.prototype.getPoints=function(e,t){if(this.useSpacedPoints)return console.log("tata"),this.getSpacedPoints(e,t);e=e||12;var r,n,i,o,a,s,l,h,c,u,d,f,p,m,g,v,y,x,b=[];for(r=0,n=this.actions.length;r<n;r++)switch(o=(i=this.actions[r]).action,a=i.args,o){case Ht.PathActions.MOVE_TO:case Ht.PathActions.LINE_TO:b.push(new Ht.Vector2(a[0],a[1]));break;case Ht.PathActions.QUADRATIC_CURVE_TO:for(s=a[2],l=a[3],u=a[0],d=a[1],p=0<b.length?(f=(m=b[b.length-1]).x,m.y):(f=(m=this.actions[r-1].args)[m.length-2],m[m.length-1]),g=1;g<=e;g++)v=g/e,y=Ht.Shape.Utils.b2(v,f,u,s),x=Ht.Shape.Utils.b2(v,p,d,l),b.push(new Ht.Vector2(y,x));break;case Ht.PathActions.BEZIER_CURVE_TO:for(s=a[4],l=a[5],u=a[0],d=a[1],h=a[2],c=a[3],p=0<b.length?(f=(m=b[b.length-1]).x,m.y):(f=(m=this.actions[r-1].args)[m.length-2],m[m.length-1]),g=1;g<=e;g++)v=g/e,y=Ht.Shape.Utils.b3(v,f,u,h,s),x=Ht.Shape.Utils.b3(v,p,d,c,l),b.push(new Ht.Vector2(y,x));break;case Ht.PathActions.CSPLINE_THRU:m=this.actions[r-1].args;var _=[new Ht.Vector2(m[m.length-2],m[m.length-1])],w=e*a[0].length;_=_.concat(a[0]);var M=new Ht.SplineCurve(_);for(g=1;g<=w;g++)b.push(M.getPointAt(g/w));break;case Ht.PathActions.ARC:var S=a[0],T=a[1],C=a[2],E=a[3],A=a[4],L=!!a[5],P=A-E,D=2*e;for(g=1;g<=D;g++)v=g/D,L||(v=1-v),R=E+v*P,y=S+C*Math.cos(R),x=T+C*Math.sin(R),b.push(new Ht.Vector2(y,x));break;case Ht.PathActions.ELLIPSE:S=a[0],T=a[1];var R,k=a[2],F=a[3];for(E=a[4],A=a[5],L=!!a[6],P=A-E,D=2*e,g=1;g<=D;g++)v=g/D,L||(v=1-v),R=E+v*P,y=S+k*Math.cos(R),x=T+F*Math.sin(R),b.push(new Ht.Vector2(y,x))}var U=b[b.length-1];return Math.abs(U.x-b[0].x)<1e-10&&Math.abs(U.y-b[0].y)<1e-10&&b.splice(b.length-1,1),t&&b.push(b[0]),b},Ht.Path.prototype.toShapes=function(e,t){function r(e){for(var t=[],r=0,n=e.length;r<n;r++){var i=e[r],o=new Ht.Shape;o.actions=i.actions,o.curves=i.curves,t.push(o)}return t}function n(e,t){for(var r=t.length,n=!1,i=r-1,o=0;o<r;i=o++){var a=t[i],s=t[o],l=s.x-a.x,h=s.y-a.y;if(1e-10<Math.abs(h)){if(h<0&&(a=t[o],l=-l,s=t[i],h=-h),e.y<a.y||e.y>s.y)continue;if(e.y==a.y){if(e.x==a.x)return!0}else{var c=h*(e.x-a.x)-l*(e.y-a.y);if(0==c)return!0;if(c<0)continue;n=!n}}else{if(e.y!=a.y)continue;if(s.x<=e.x&&e.x<=a.x||a.x<=e.x&&e.x<=s.x)return!0}}return n}var i=function(e){var t,r,n,i,o,a=[],s=new Ht.Path;for(t=0,r=e.length;t<r;t++)o=(n=e[t]).args,(i=n.action)==Ht.PathActions.MOVE_TO&&0!=s.actions.length&&(a.push(s),s=new Ht.Path),s[i].apply(s,o);return 0!=s.actions.length&&a.push(s),a}(this.actions);if(0==i.length)return[];if(!0===t)return r(i);var o,a,s,l=[];if(1==i.length)return a=i[0],(s=new Ht.Shape).actions=a.actions,s.curves=a.curves,l.push(s),l;var h=!Ht.Shape.Utils.isClockWise(i[0].getPoints());h=e?!h:h;var c,u,d,f,p,m,g=[],v=[],y=[],x=0;for(v[x]=void 0,y[x]=[],u=0,d=i.length;u<d;u++)c=(a=i[u]).getPoints(),o=Ht.Shape.Utils.isClockWise(c),(o=e?!o:o)?(!h&&v[x]&&x++,v[x]={s:new Ht.Shape,p:c},v[x].s.actions=a.actions,v[x].s.curves=a.curves,h&&x++,y[x]=[]):y[x].push({h:a,p:c[0]});if(!v[0])return r(i);if(1<v.length){for(var b=!1,_=[],w=0,M=v.length;w<M;w++)g[w]=[];for(w=0,M=v.length;w<M;w++){v[w];for(var S=y[w],T=0;T<S.length;T++){for(var C=S[T],E=!0,A=0;A<v.length;A++)n(C.p,v[A].p)&&(w!=A&&_.push({froms:w,tos:A,hole:T}),E?(E=!1,g[A].push(C)):b=!0);E&&g[w].push(C)}}0<_.length&&(b||(y=g))}for(u=0,d=v.length;u<d;u++)for(s=v[u].s,l.push(s),p=0,m=(f=y[u]).length;p<m;p++)s.holes.push(f[p].h);return l},Ht.Shape=function(){Ht.Path.apply(this,arguments),this.holes=[]},Ht.Shape.prototype=Object.create(Ht.Path.prototype),Ht.Shape.prototype.extrude=function(e){return new Ht.ExtrudeGeometry(this,e)},Ht.Shape.prototype.makeGeometry=function(e){return new Ht.ShapeGeometry(this,e)},Ht.Shape.prototype.getPointsHoles=function(e){var t,r=this.holes.length,n=[];for(t=0;t<r;t++)n[t]=this.holes[t].getTransformedPoints(e,this.bends);return n},Ht.Shape.prototype.getSpacedPointsHoles=function(e){var t,r=this.holes.length,n=[];for(t=0;t<r;t++)n[t]=this.holes[t].getTransformedSpacedPoints(e,this.bends);return n},Ht.Shape.prototype.extractAllPoints=function(e){return{shape:this.getTransformedPoints(e),holes:this.getPointsHoles(e)}},Ht.Shape.prototype.extractPoints=function(e){return this.useSpacedPoints?this.extractAllSpacedPoints(e):this.extractAllPoints(e)},Ht.Shape.prototype.extractAllSpacedPoints=function(e){return{shape:this.getTransformedSpacedPoints(e),holes:this.getSpacedPointsHoles(e)}},Ht.Shape.Utils={triangulateShape:function(e,t){function r(e,t,r){return e.x!=t.x?e.x<t.x?e.x<=r.x&&r.x<=t.x:t.x<=r.x&&r.x<=e.x:e.y<t.y?e.y<=r.y&&r.y<=t.y:t.y<=r.y&&r.y<=e.y}function n(e,t,n,i,o){var a=t.x-e.x,s=t.y-e.y,l=i.x-n.x,h=i.y-n.y,c=e.x-n.x,u=e.y-n.y,d=s*l-a*h,f=s*c-a*u;if(1e-10<Math.abs(d)){var p;if(0<d){if(f<0||d<f)return[];if((p=h*c-l*u)<0||d<p)return[]}else{if(0<f||f<d)return[];if(0<(p=h*c-l*u)||p<d)return[]}if(0==p)return!o||0!=f&&f!=d?[e]:[];if(p==d)return!o||0!=f&&f!=d?[t]:[];if(0==f)return[n];if(f==d)return[i];var m=p/d;return[{x:e.x+m*a,y:e.y+m*s}]}if(0!=f||h*c!=l*u)return[];var g,v,y,x,b,_,w,M,S=0==a&&0==s,T=0==l&&0==h;return S&&T?e.x!=n.x||e.y!=n.y?[]:[e]:S?r(n,i,e)?[e]:[]:T?r(e,t,n)?[n]:[]:(M=0!=a?(x=e.x<t.x?(y=(g=e).x,(v=t).x):(y=(g=t).x,(v=e).x),n.x<i.x?(w=(b=n).x,(_=i).x):(w=(b=i).x,(_=n).x)):(x=e.y<t.y?(y=(g=e).y,(v=t).y):(y=(g=t).y,(v=e).y),n.y<i.y?(w=(b=n).y,(_=i).y):(w=(b=i).y,(_=n).y)),y<=w?x<w?[]:x==w?o?[]:[b]:x<=M?[b,v]:[b,_]:M<y?[]:y==M?o?[]:[g]:x<=M?[g,v]:[g,_])}function i(e,t,r,n){var i=t.x-e.x,o=t.y-e.y,a=r.x-e.x,s=r.y-e.y,l=n.x-e.x,h=n.y-e.y,c=i*s-o*a,u=i*h-o*l;if(1e-10<Math.abs(c)){var d=l*s-h*a;return 0<c?0<=u&&0<=d:0<=u||0<=d}return 0<u}for(var o,a,s,l,h,c,u={},d=e.concat(),f=0,p=t.length;f<p;f++)Array.prototype.push.apply(d,t[f]);for(o=0,a=d.length;o<a;o++)void 0!==u[h=d[o].x+":"+d[o].y]&&console.log("Duplicate point",h),u[h]=o;var m=function(e,t){var r,o=e.concat();function a(e,t){var n=o.length-1,a=e-1;a<0&&(a=n);var s=e+1;n<s&&(s=0);var l=i(o[e],o[a],o[s],r[t]);if(!l)return!1;var h=r.length-1,c=t-1;c<0&&(c=h);var u=t+1;return h<u&&(u=0),!!(l=i(r[t],r[c],r[u],o[e]))}function s(e,t){var r,i;for(r=0;r<o.length;r++)if(i=r+1,i%=o.length,0<n(e,t,o[r],o[i],!0).length)return!0;return!1}var l=[];function h(e,r){var i,o,a,s;for(i=0;i<l.length;i++)for(o=t[l[i]],a=0;a<o.length;a++)if(s=a+1,s%=o.length,0<n(e,r,o[a],o[s],!0).length)return!0;return!1}for(var c,u,d,f,p,m,g,v,y,x,b=[],_=0,w=t.length;_<w;_++)l.push(_);for(var M=0,S=2*l.length;0<l.length;){if(--S<0){console.log("Infinite Loop! Holes left:"+l.length+", Probably Hole outside Shape!");break}for(u=M;u<o.length;u++){for(d=o[u],c=-1,_=0;_<l.length;_++)if(p=l[_],void 0===b[m=d.x+":"+d.y+":"+p]){r=t[p];for(var T=0;T<r.length;T++)if(f=r[T],a(u,T)&&!s(d,f)&&!h(d,f)){c=T,l.splice(_,1),g=o.slice(0,u+1),v=o.slice(u),y=r.slice(c),x=r.slice(0,c+1),o=g.concat(y).concat(x).concat(v),M=u;break}if(0<=c)break;b[m]=!0}if(0<=c)break}}return o}(e,t),g=Ht.FontUtils.Triangulate(m,!1);for(o=0,a=g.length;o<a;o++)for(l=g[o],s=0;s<3;s++)void 0!==(c=u[h=l[s].x+":"+l[s].y])&&(l[s]=c);return g.concat()},isClockWise:function(e){return Ht.FontUtils.Triangulate.area(e)<0},b2p0:function(e,t){var r=1-e;return r*r*t},b2p1:function(e,t){return 2*(1-e)*e*t},b2p2:function(e,t){return e*e*t},b2:function(e,t,r,n){return this.b2p0(e,t)+this.b2p1(e,r)+this.b2p2(e,n)},b3p0:function(e,t){var r=1-e;return r*r*r*t},b3p1:function(e,t){var r=1-e;return 3*r*r*e*t},b3p2:function(e,t){return 3*(1-e)*e*e*t},b3p3:function(e,t){return e*e*e*t},b3:function(e,t,r,n,i){return this.b3p0(e,t)+this.b3p1(e,r)+this.b3p2(e,n)+this.b3p3(e,i)}},Ht.LineCurve=function(e,t){this.v1=e,this.v2=t},Ht.LineCurve.prototype=Object.create(Ht.Curve.prototype),Ht.LineCurve.prototype.getPoint=function(e){var t=this.v2.clone().sub(this.v1);return t.multiplyScalar(e).add(this.v1),t},Ht.LineCurve.prototype.getPointAt=function(e){return this.getPoint(e)},Ht.LineCurve.prototype.getTangent=function(e){return this.v2.clone().sub(this.v1).normalize()},Ht.QuadraticBezierCurve=function(e,t,r){this.v0=e,this.v1=t,this.v2=r},Ht.QuadraticBezierCurve.prototype=Object.create(Ht.Curve.prototype),Ht.QuadraticBezierCurve.prototype.getPoint=function(e){var t=new Ht.Vector2;return t.x=Ht.Shape.Utils.b2(e,this.v0.x,this.v1.x,this.v2.x),t.y=Ht.Shape.Utils.b2(e,this.v0.y,this.v1.y,this.v2.y),t},Ht.QuadraticBezierCurve.prototype.getTangent=function(e){var t=new Ht.Vector2;return t.x=Ht.Curve.Utils.tangentQuadraticBezier(e,this.v0.x,this.v1.x,this.v2.x),t.y=Ht.Curve.Utils.tangentQuadraticBezier(e,this.v0.y,this.v1.y,this.v2.y),t.normalize()},Ht.CubicBezierCurve=function(e,t,r,n){this.v0=e,this.v1=t,this.v2=r,this.v3=n},Ht.CubicBezierCurve.prototype=Object.create(Ht.Curve.prototype),Ht.CubicBezierCurve.prototype.getPoint=function(e){var t,r;return t=Ht.Shape.Utils.b3(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x),r=Ht.Shape.Utils.b3(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y),new Ht.Vector2(t,r)},Ht.CubicBezierCurve.prototype.getTangent=function(e){var t,r;t=Ht.Curve.Utils.tangentCubicBezier(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x),r=Ht.Curve.Utils.tangentCubicBezier(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y);var n=new Ht.Vector2(t,r);return n.normalize(),n},Ht.SplineCurve=function(e){this.points=null==e?[]:e},Ht.SplineCurve.prototype=Object.create(Ht.Curve.prototype),Ht.SplineCurve.prototype.getPoint=function(e){var t=this.points,r=(t.length-1)*e,n=Math.floor(r),i=r-n,o=t[0==n?n:n-1],a=t[n],s=t[n>t.length-2?t.length-1:n+1],l=t[n>t.length-3?t.length-1:n+2],h=new Ht.Vector2;return h.x=Ht.Curve.Utils.interpolate(o.x,a.x,s.x,l.x,i),h.y=Ht.Curve.Utils.interpolate(o.y,a.y,s.y,l.y,i),h},Ht.EllipseCurve=function(e,t,r,n,i,o,a){this.aX=e,this.aY=t,this.xRadius=r,this.yRadius=n,this.aStartAngle=i,this.aEndAngle=o,this.aClockwise=a},Ht.EllipseCurve.prototype=Object.create(Ht.Curve.prototype),Ht.EllipseCurve.prototype.getPoint=function(e){var t,r=this.aEndAngle-this.aStartAngle;r<0&&(r+=2*Math.PI),r>2*Math.PI&&(r-=2*Math.PI),t=!0===this.aClockwise?this.aEndAngle+(1-e)*(2*Math.PI-r):this.aStartAngle+e*r;var n=new Ht.Vector2;return n.x=this.aX+this.xRadius*Math.cos(t),n.y=this.aY+this.yRadius*Math.sin(t),n},Ht.ArcCurve=function(e,t,r,n,i,o){Ht.EllipseCurve.call(this,e,t,r,r,n,i,o)},Ht.ArcCurve.prototype=Object.create(Ht.EllipseCurve.prototype),Ht.LineCurve3=Ht.Curve.create(function(e,t){this.v1=e,this.v2=t},function(e){var t=new Ht.Vector3;return t.subVectors(this.v2,this.v1),t.multiplyScalar(e),t.add(this.v1),t}),Ht.QuadraticBezierCurve3=Ht.Curve.create(function(e,t,r){this.v0=e,this.v1=t,this.v2=r},function(e){var t=new Ht.Vector3;return t.x=Ht.Shape.Utils.b2(e,this.v0.x,this.v1.x,this.v2.x),t.y=Ht.Shape.Utils.b2(e,this.v0.y,this.v1.y,this.v2.y),t.z=Ht.Shape.Utils.b2(e,this.v0.z,this.v1.z,this.v2.z),t}),Ht.CubicBezierCurve3=Ht.Curve.create(function(e,t,r,n){this.v0=e,this.v1=t,this.v2=r,this.v3=n},function(e){var t=new Ht.Vector3;return t.x=Ht.Shape.Utils.b3(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x),t.y=Ht.Shape.Utils.b3(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y),t.z=Ht.Shape.Utils.b3(e,this.v0.z,this.v1.z,this.v2.z,this.v3.z),t}),Ht.SplineCurve3=Ht.Curve.create(function(e){this.points=null==e?[]:e},function(e){var t=this.points,r=(t.length-1)*e,n=Math.floor(r),i=r-n,o=t[0==n?n:n-1],a=t[n],s=t[n>t.length-2?t.length-1:n+1],l=t[n>t.length-3?t.length-1:n+2],h=new Ht.Vector3;return h.x=Ht.Curve.Utils.interpolate(o.x,a.x,s.x,l.x,i),h.y=Ht.Curve.Utils.interpolate(o.y,a.y,s.y,l.y,i),h.z=Ht.Curve.Utils.interpolate(o.z,a.z,s.z,l.z,i),h}),Ht.ClosedSplineCurve3=Ht.Curve.create(function(e){this.points=null==e?[]:e},function(e){var t=this.points,r=(t.length-0)*e,n=Math.floor(r),i=r-n,o=t[((n+=0<n?0:(Math.floor(Math.abs(n)/t.length)+1)*t.length)-1)%t.length],a=t[n%t.length],s=t[(n+1)%t.length],l=t[(n+2)%t.length],h=new Ht.Vector3;return h.x=Ht.Curve.Utils.interpolate(o.x,a.x,s.x,l.x,i),h.y=Ht.Curve.Utils.interpolate(o.y,a.y,s.y,l.y,i),h.z=Ht.Curve.Utils.interpolate(o.z,a.z,s.z,l.z,i),h}),Ht.AnimationHandler={LINEAR:0,CATMULLROM:1,CATMULLROM_FORWARD:2,add:function(){console.warn("THREE.AnimationHandler.add() has been deprecated.")},get:function(){console.warn("THREE.AnimationHandler.get() has been deprecated.")},remove:function(){console.warn("THREE.AnimationHandler.remove() has been deprecated.")},animations:[],init:function(e){if(!0!==e.initialized){for(var t=0;t<e.hierarchy.length;t++){for(var r=0;r<e.hierarchy[t].keys.length;r++)if(e.hierarchy[t].keys[r].time<0&&(e.hierarchy[t].keys[r].time=0),void 0!==e.hierarchy[t].keys[r].rot&&!(e.hierarchy[t].keys[r].rot instanceof Ht.Quaternion)){var n=e.hierarchy[t].keys[r].rot;e.hierarchy[t].keys[r].rot=(new Ht.Quaternion).fromArray(n)}if(e.hierarchy[t].keys.length&&void 0!==e.hierarchy[t].keys[0].morphTargets){var i={};for(r=0;r<e.hierarchy[t].keys.length;r++)for(var o=0;o<e.hierarchy[t].keys[r].morphTargets.length;o++)i[s=e.hierarchy[t].keys[r].morphTargets[o]]=-1;for(e.hierarchy[t].usedMorphTargets=i,r=0;r<e.hierarchy[t].keys.length;r++){var a={};for(var s in i){for(o=0;o<e.hierarchy[t].keys[r].morphTargets.length;o++)if(e.hierarchy[t].keys[r].morphTargets[o]===s){a[s]=e.hierarchy[t].keys[r].morphTargetsInfluences[o];break}o===e.hierarchy[t].keys[r].morphTargets.length&&(a[s]=0)}e.hierarchy[t].keys[r].morphTargetsInfluences=a}}for(r=1;r<e.hierarchy[t].keys.length;r++)e.hierarchy[t].keys[r].time===e.hierarchy[t].keys[r-1].time&&(e.hierarchy[t].keys.splice(r,1),r--);for(r=0;r<e.hierarchy[t].keys.length;r++)e.hierarchy[t].keys[r].index=r}return e.initialized=!0,e}},parse:function(e){var t=[];if(e instanceof Ht.SkinnedMesh)for(var r=0;r<e.skeleton.bones.length;r++)t.push(e.skeleton.bones[r]);else!function e(t,r){r.push(t);for(var n=0;n<t.children.length;n++)e(t.children[n],r)}(e,t);return t},play:function(e){-1===this.animations.indexOf(e)&&this.animations.push(e)},stop:function(e){var t=this.animations.indexOf(e);-1!==t&&this.animations.splice(t,1)},update:function(e){for(var t=0;t<this.animations.length;t++)this.animations[t].resetBlendWeights();for(t=0;t<this.animations.length;t++)this.animations[t].update(e)}},Ht.Animation=function(e,t){this.root=e,this.data=Ht.AnimationHandler.init(t),this.hierarchy=Ht.AnimationHandler.parse(e),this.currentTime=0,this.timeScale=1,this.isPlaying=!1,this.loop=!0,this.weight=0,this.interpolationType=Ht.AnimationHandler.LINEAR},Ht.Animation.prototype.keyTypes=["pos","rot","scl"],Ht.Animation.prototype.play=function(e,t){this.currentTime=void 0!==e?e:0,this.weight=void 0!==t?t:1,this.isPlaying=!0,this.reset(),Ht.AnimationHandler.play(this)},Ht.Animation.prototype.stop=function(){this.isPlaying=!1,Ht.AnimationHandler.stop(this)},Ht.Animation.prototype.reset=function(){for(var e=0,t=this.hierarchy.length;e<t;e++){var r=this.hierarchy[e];r.matrixAutoUpdate=!0,void 0===r.animationCache&&(r.animationCache={animations:{},blending:{positionWeight:0,quaternionWeight:0,scaleWeight:0}}),void 0===r.animationCache.animations[this.data.name]&&(r.animationCache.animations[this.data.name]={},r.animationCache.animations[this.data.name].prevKey={pos:0,rot:0,scl:0},r.animationCache.animations[this.data.name].nextKey={pos:0,rot:0,scl:0},r.animationCache.animations[this.data.name].originalMatrix=r.matrix);for(var n=r.animationCache.animations[this.data.name],i=0;i<3;i++){for(var o=this.keyTypes[i],a=this.data.hierarchy[e].keys[0],s=this.getNextKeyWith(o,e,1);s.time<this.currentTime&&s.index>a.index;)a=s,s=this.getNextKeyWith(o,e,s.index+1);n.prevKey[o]=a,n.nextKey[o]=s}}},Ht.Animation.prototype.resetBlendWeights=function(){for(var e=0,t=this.hierarchy.length;e<t;e++){var r=this.hierarchy[e];void 0!==r.animationCache&&(r.animationCache.blending.positionWeight=0,r.animationCache.blending.quaternionWeight=0,r.animationCache.blending.scaleWeight=0)}},Ht.Animation.prototype.update=(xt=[],bt=new Ht.Vector3,_t=new Ht.Vector3,wt=new Ht.Quaternion,Mt=function(e,t){var r,n,i,o,a,s,l,h,c,u=[],d=[];return i=(r=(e.length-1)*t)-(n=Math.floor(r)),u[0]=0===n?n:n-1,u[1]=n,u[2]=n>e.length-2?n:n+1,u[3]=n>e.length-3?n:n+2,s=e[u[0]],l=e[u[1]],h=e[u[2]],c=e[u[3]],a=i*(o=i*i),d[0]=St(s[0],l[0],h[0],c[0],i,o,a),d[1]=St(s[1],l[1],h[1],c[1],i,o,a),d[2]=St(s[2],l[2],h[2],c[2],i,o,a),d},St=function(e,t,r,n,i,o,a){var s=.5*(r-e),l=.5*(n-t);return(2*(t-r)+s+l)*a+(-3*(t-r)-2*s-l)*o+s*i+t},function(e){if(!1!==this.isPlaying&&(this.currentTime+=e*this.timeScale,0!==this.weight)){var t=this.data.length;if(this.currentTime>t||this.currentTime<0){if(!this.loop)return void this.stop();this.currentTime%=t,this.currentTime<0&&(this.currentTime+=t),this.reset()}for(var r=0,n=this.hierarchy.length;r<n;r++)for(var i=this.hierarchy[r],o=i.animationCache.animations[this.data.name],a=i.animationCache.blending,s=0;s<3;s++){var l=this.keyTypes[s],h=o.prevKey[l],c=o.nextKey[l];if(0<this.timeScale&&c.time<=this.currentTime||this.timeScale<0&&h.time>=this.currentTime){for(h=this.data.hierarchy[r].keys[0],c=this.getNextKeyWith(l,r,1);c.time<this.currentTime&&c.index>h.index;)h=c,c=this.getNextKeyWith(l,r,c.index+1);o.prevKey[l]=h,o.nextKey[l]=c}i.matrixAutoUpdate=!0,i.matrixWorldNeedsUpdate=!0;var u=(this.currentTime-h.time)/(c.time-h.time),d=h[l],f=c[l];if(u<0&&(u=0),1<u&&(u=1),"pos"===l){if(this.interpolationType===Ht.AnimationHandler.LINEAR){_t.x=d[0]+(f[0]-d[0])*u,_t.y=d[1]+(f[1]-d[1])*u,_t.z=d[2]+(f[2]-d[2])*u;var p=this.weight/(this.weight+a.positionWeight);i.position.lerp(_t,p),a.positionWeight+=this.weight}else if(this.interpolationType===Ht.AnimationHandler.CATMULLROM||this.interpolationType===Ht.AnimationHandler.CATMULLROM_FORWARD){xt[0]=this.getPrevKeyWith("pos",r,h.index-1).pos,xt[1]=d,xt[2]=f,xt[3]=this.getNextKeyWith("pos",r,c.index+1).pos;var m=Mt(xt,u=.33*u+.33);p=this.weight/(this.weight+a.positionWeight),a.positionWeight+=this.weight;var g=i.position;if(g.x=g.x+(m[0]-g.x)*p,g.y=g.y+(m[1]-g.y)*p,g.z=g.z+(m[2]-g.z)*p,this.interpolationType===Ht.AnimationHandler.CATMULLROM_FORWARD){var v=Mt(xt,1.01*u);bt.set(v[0],v[1],v[2]),bt.sub(g),bt.y=0,bt.normalize();var y=Math.atan2(bt.x,bt.z);i.rotation.set(0,y,0)}}}else"rot"===l?(Ht.Quaternion.slerp(d,f,wt,u),0===a.quaternionWeight?(i.quaternion.copy(wt),a.quaternionWeight=this.weight):(p=this.weight/(this.weight+a.quaternionWeight),Ht.Quaternion.slerp(i.quaternion,wt,i.quaternion,p),a.quaternionWeight+=this.weight)):"scl"===l&&(_t.x=d[0]+(f[0]-d[0])*u,_t.y=d[1]+(f[1]-d[1])*u,_t.z=d[2]+(f[2]-d[2])*u,p=this.weight/(this.weight+a.scaleWeight),i.scale.lerp(_t,p),a.scaleWeight+=this.weight)}return!0}}),Ht.Animation.prototype.getNextKeyWith=function(e,t,r){var n=this.data.hierarchy[t].keys;for(this.interpolationType===Ht.AnimationHandler.CATMULLROM||this.interpolationType===Ht.AnimationHandler.CATMULLROM_FORWARD?r=r<n.length-1?r:n.length-1:r%=n.length;r<n.length;r++)if(void 0!==n[r][e])return n[r];return this.data.hierarchy[t].keys[0]},Ht.Animation.prototype.getPrevKeyWith=function(e,t,r){var n=this.data.hierarchy[t].keys;for(r=this.interpolationType===Ht.AnimationHandler.CATMULLROM||this.interpolationType===Ht.AnimationHandler.CATMULLROM_FORWARD?0<r?r:0:0<=r?r:r+n.length;0<=r;r--)if(void 0!==n[r][e])return n[r];return this.data.hierarchy[t].keys[n.length-1]},Ht.KeyFrameAnimation=function(e){this.root=e.node,this.data=Ht.AnimationHandler.init(e),this.hierarchy=Ht.AnimationHandler.parse(this.root),this.currentTime=0,this.timeScale=.001,this.isPlaying=!1,this.isPaused=!0,this.loop=!0;for(var t=0,r=this.hierarchy.length;t<r;t++){var n=this.data.hierarchy[t].keys,i=this.data.hierarchy[t].sids,o=this.hierarchy[t];if(n.length&&i){for(var a=0;a<i.length;a++){var s=i[a],l=this.getNextKeyWith(s,t,0);l&&l.apply(s)}o.matrixAutoUpdate=!1,this.data.hierarchy[t].node.updateMatrix(),o.matrixWorldNeedsUpdate=!0}}},Ht.KeyFrameAnimation.prototype.play=function(e){if(this.currentTime=void 0!==e?e:0,!1===this.isPlaying){this.isPlaying=!0;var t,r,n,i=this.hierarchy.length;for(t=0;t<i;t++){r=this.hierarchy[t],void 0===(n=this.data.hierarchy[t]).animationCache&&(n.animationCache={},n.animationCache.prevKey=null,n.animationCache.nextKey=null,n.animationCache.originalMatrix=r.matrix);var o=this.data.hierarchy[t].keys;o.length&&(n.animationCache.prevKey=o[0],n.animationCache.nextKey=o[1],this.startTime=Math.min(o[0].time,this.startTime),this.endTime=Math.max(o[o.length-1].time,this.endTime))}this.update(0)}this.isPaused=!1,Ht.AnimationHandler.play(this)},Ht.KeyFrameAnimation.prototype.stop=function(){this.isPlaying=!1,this.isPaused=!1,Ht.AnimationHandler.stop(this);for(var e=0;e<this.data.hierarchy.length;e++){var t=this.hierarchy[e],r=this.data.hierarchy[e];if(void 0!==r.animationCache){var n=r.animationCache.originalMatrix;n.copy(t.matrix),t.matrix=n,delete r.animationCache}}},Ht.KeyFrameAnimation.prototype.update=function(e){if(!1!==this.isPlaying){this.currentTime+=e*this.timeScale;var t=this.data.length;!0===this.loop&&this.currentTime>t&&(this.currentTime%=t),this.currentTime=Math.min(this.currentTime,t);for(var r=0,n=this.hierarchy.length;r<n;r++){var i=this.hierarchy[r],o=this.data.hierarchy[r],a=o.keys,s=o.animationCache;if(a.length){var l=s.prevKey,h=s.nextKey;if(h.time<=this.currentTime){for(;h.time<this.currentTime&&h.index>l.index;)h=a[(l=h).index+1];s.prevKey=l,s.nextKey=h}h.time>=this.currentTime?l.interpolate(h,this.currentTime):l.interpolate(h,h.time),this.data.hierarchy[r].node.updateMatrix(),i.matrixWorldNeedsUpdate=!0}}}},Ht.KeyFrameAnimation.prototype.getNextKeyWith=function(e,t,r){var n=this.data.hierarchy[t].keys;for(r%=n.length;r<n.length;r++)if(n[r].hasTarget(e))return n[r];return n[0]},Ht.KeyFrameAnimation.prototype.getPrevKeyWith=function(e,t,r){var n=this.data.hierarchy[t].keys;for(r=0<=r?r:r+n.length;0<=r;r--)if(n[r].hasTarget(e))return n[r];return n[n.length-1]},Ht.MorphAnimation=function(e){this.mesh=e,this.frames=e.morphTargetInfluences.length,this.currentTime=0,this.duration=1e3,this.loop=!0,this.isPlaying=!1},Ht.MorphAnimation.prototype={play:function(){this.isPlaying=!0},pause:function(){this.isPlaying=!1},update:(Tt=0,Ct=0,function(e){if(!1!==this.isPlaying){this.currentTime+=e,!0===this.loop&&this.currentTime>this.duration&&(this.currentTime%=this.duration),this.currentTime=Math.min(this.currentTime,this.duration);var t=this.duration/this.frames,r=Math.floor(this.currentTime/t);r!=Ct&&(this.mesh.morphTargetInfluences[Tt]=0,this.mesh.morphTargetInfluences[Ct]=1,this.mesh.morphTargetInfluences[r]=0,Tt=Ct,Ct=r),this.mesh.morphTargetInfluences[r]=this.currentTime%t/t,this.mesh.morphTargetInfluences[Tt]=1-this.mesh.morphTargetInfluences[r]}})},Ht.BoxGeometry=function(e,t,r,n,i,o){Ht.Geometry.call(this),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:r,widthSegments:n,heightSegments:i,depthSegments:o},this.widthSegments=n||1,this.heightSegments=i||1,this.depthSegments=o||1;var a=this,s=e/2,l=t/2,h=r/2;function c(e,t,r,n,i,o,s,l){var h,c,u,d=a.widthSegments,f=a.heightSegments,p=i/2,m=o/2,g=a.vertices.length;"x"===e&&"y"===t||"y"===e&&"x"===t?h="z":"x"===e&&"z"===t||"z"===e&&"x"===t?(h="y",f=a.depthSegments):("z"===e&&"y"===t||"y"===e&&"z"===t)&&(h="x",d=a.depthSegments);var v=d+1,y=f+1,x=i/d,b=o/f,_=new Ht.Vector3;for(_[h]=0<s?1:-1,u=0;u<y;u++)for(c=0;c<v;c++){var w=new Ht.Vector3;w[e]=(c*x-p)*r,w[t]=(u*b-m)*n,w[h]=s,a.vertices.push(w)}for(u=0;u<f;u++)for(c=0;c<d;c++){var M=c+v*u,S=c+v*(u+1),T=c+1+v*(u+1),C=c+1+v*u,E=new Ht.Vector2(c/d,1-u/f),A=new Ht.Vector2(c/d,1-(u+1)/f),L=new Ht.Vector2((c+1)/d,1-(u+1)/f),P=new Ht.Vector2((c+1)/d,1-u/f),D=new Ht.Face3(M+g,S+g,C+g);D.normal.copy(_),D.vertexNormals.push(_.clone(),_.clone(),_.clone()),D.materialIndex=l,a.faces.push(D),a.faceVertexUvs[0].push([E,A,P]),(D=new Ht.Face3(S+g,T+g,C+g)).normal.copy(_),D.vertexNormals.push(_.clone(),_.clone(),_.clone()),D.materialIndex=l,a.faces.push(D),a.faceVertexUvs[0].push([A.clone(),L,P.clone()])}}c("z","y",-1,-1,r,t,s,0),c("z","y",1,-1,r,t,-s,1),c("x","z",1,1,e,r,l,2),c("x","z",1,-1,e,r,-l,3),c("x","y",1,-1,e,t,h,4),c("x","y",-1,-1,e,t,-h,5),this.mergeVertices()},Ht.BoxGeometry.prototype=Object.create(Ht.Geometry.prototype),Ht.CircleGeometry=function(e,t,r,n){Ht.Geometry.call(this),this.type="CircleGeometry",this.parameters={radius:e,segments:t,thetaStart:r,thetaLength:n},e=e||50,t=void 0!==t?Math.max(3,t):8,r=void 0!==r?r:0,n=void 0!==n?n:2*Math.PI;var i,o=[],a=new Ht.Vector3,s=new Ht.Vector2(.5,.5);for(this.vertices.push(a),o.push(s),i=0;i<=t;i++){var l=new Ht.Vector3,h=r+i/t*n;l.x=e*Math.cos(h),l.y=e*Math.sin(h),this.vertices.push(l),o.push(new Ht.Vector2((l.x/e+1)/2,(l.y/e+1)/2))}var c=new Ht.Vector3(0,0,1);for(i=1;i<=t;i++)this.faces.push(new Ht.Face3(i,i+1,0,[c.clone(),c.clone(),c.clone()])),this.faceVertexUvs[0].push([o[i].clone(),o[i+1].clone(),s.clone()]);this.computeFaceNormals(),this.boundingSphere=new Ht.Sphere(new Ht.Vector3,e)},Ht.CircleGeometry.prototype=Object.create(Ht.Geometry.prototype),Ht.CubeGeometry=function(e,t,r,n,i,o){return console.warn("THREE.CubeGeometry has been renamed to THREE.BoxGeometry."),new Ht.BoxGeometry(e,t,r,n,i,o)},Ht.CylinderGeometry=function(e,t,r,n,i,o){Ht.Geometry.call(this),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:r,radialSegments:n,heightSegments:i,openEnded:o},e=void 0!==e?e:20,t=void 0!==t?t:20,n=n||8,i=i||1,o=void 0!==o&&o;var a,s,l=(r=void 0!==r?r:100)/2,h=[],c=[];for(s=0;s<=i;s++){var u=[],d=[],f=s/i,p=f*(t-e)+e;for(a=0;a<=n;a++){var m=a/n,g=new Ht.Vector3;g.x=p*Math.sin(m*Math.PI*2),g.y=-f*r+l,g.z=p*Math.cos(m*Math.PI*2),this.vertices.push(g),u.push(this.vertices.length-1),d.push(new Ht.Vector2(m,1-f))}h.push(u),c.push(d)}var v,y,x=(t-e)/r;for(a=0;a<n;a++)for(y=0!==e?(v=this.vertices[h[0][a]].clone(),this.vertices[h[0][a+1]].clone()):(v=this.vertices[h[1][a]].clone(),this.vertices[h[1][a+1]].clone()),v.setY(Math.sqrt(v.x*v.x+v.z*v.z)*x).normalize(),y.setY(Math.sqrt(y.x*y.x+y.z*y.z)*x).normalize(),s=0;s<i;s++){var b=h[s][a],_=h[s+1][a],w=h[s+1][a+1],M=h[s][a+1],S=v.clone(),T=v.clone(),C=y.clone(),E=y.clone(),A=c[s][a].clone(),L=c[s+1][a].clone(),P=c[s+1][a+1].clone(),D=c[s][a+1].clone();this.faces.push(new Ht.Face3(b,_,M,[S,T,E])),this.faceVertexUvs[0].push([A,L,D]),this.faces.push(new Ht.Face3(_,w,M,[T.clone(),C,E.clone()])),this.faceVertexUvs[0].push([L.clone(),P,D.clone()])}if(!1===o&&0<e)for(this.vertices.push(new Ht.Vector3(0,l,0)),a=0;a<n;a++)b=h[0][a],_=h[0][a+1],w=this.vertices.length-1,S=new Ht.Vector3(0,1,0),T=new Ht.Vector3(0,1,0),C=new Ht.Vector3(0,1,0),A=c[0][a].clone(),L=c[0][a+1].clone(),P=new Ht.Vector2(L.x,0),this.faces.push(new Ht.Face3(b,_,w,[S,T,C])),this.faceVertexUvs[0].push([A,L,P]);if(!1===o&&0<t)for(this.vertices.push(new Ht.Vector3(0,-l,0)),a=0;a<n;a++)b=h[s][a+1],_=h[s][a],w=this.vertices.length-1,S=new Ht.Vector3(0,-1,0),T=new Ht.Vector3(0,-1,0),C=new Ht.Vector3(0,-1,0),A=c[s][a+1].clone(),L=c[s][a].clone(),P=new Ht.Vector2(L.x,1),this.faces.push(new Ht.Face3(b,_,w,[S,T,C])),this.faceVertexUvs[0].push([A,L,P]);this.computeFaceNormals()},Ht.CylinderGeometry.prototype=Object.create(Ht.Geometry.prototype),Ht.ExtrudeGeometry=function(e,t){void 0!==e?(Ht.Geometry.call(this),this.type="ExtrudeGeometry",e=e instanceof Array?e:[e],this.addShapeList(e,t),this.computeFaceNormals()):e=[]},Ht.ExtrudeGeometry.prototype=Object.create(Ht.Geometry.prototype),Ht.ExtrudeGeometry.prototype.addShapeList=function(e,t){for(var r=e.length,n=0;n<r;n++){var i=e[n];this.addShape(i,t)}},Ht.ExtrudeGeometry.prototype.addShape=function(e,t){var r,n,i,o,a,s,l,h,c=void 0!==t.amount?t.amount:100,u=void 0!==t.bevelThickness?t.bevelThickness:6,d=void 0!==t.bevelSize?t.bevelSize:u-2,f=void 0!==t.bevelSegments?t.bevelSegments:3,p=void 0===t.bevelEnabled||t.bevelEnabled,m=void 0!==t.curveSegments?t.curveSegments:12,g=void 0!==t.steps?t.steps:1,v=t.extrudePath,y=!1,x=t.material,b=t.extrudeMaterial,_=void 0!==t.UVGenerator?t.UVGenerator:Ht.ExtrudeGeometry.WorldUVGenerator;v&&(r=v.getSpacedPoints(g),p=!(y=!0),n=void 0!==t.frames?t.frames:new Ht.TubeGeometry.FrenetFrames(v,g,!1),i=new Ht.Vector3,o=new Ht.Vector3,a=new Ht.Vector3),p||(d=u=f=0);var w=this,M=this.vertices.length,S=e.extractPoints(m),T=S.shape,C=S.holes,E=!Ht.Shape.Utils.isClockWise(T);if(E){for(T=T.reverse(),l=0,h=C.length;l<h;l++)s=C[l],Ht.Shape.Utils.isClockWise(s)&&(C[l]=s.reverse());E=!1}var A=Ht.Shape.Utils.triangulateShape(T,C),L=T;for(l=0,h=C.length;l<h;l++)s=C[l],T=T.concat(s);function P(e,t,r){return t||console.log("die"),t.clone().multiplyScalar(r).add(e)}var D,R,k,F,U,N,B=T.length,V=A.length;function z(e,t,r){var n,i,o=1,a=e.x-t.x,s=e.y-t.y,l=r.x-e.x,h=r.y-e.y,c=a*a+s*s,u=a*h-s*l;if(1e-10<Math.abs(u)){var d=Math.sqrt(c),f=Math.sqrt(l*l+h*h),p=t.x-s/d,m=t.y+a/d,g=((r.x-h/f-p)*h-(r.y+l/f-m)*l)/(a*h-s*l),v=(n=p+a*g-e.x)*n+(i=m+s*g-e.y)*i;if(v<=2)return new Ht.Vector2(n,i);o=Math.sqrt(v/2)}else{var y=!1;1e-10<a?1e-10<l&&(y=!0):a<-1e-10?l<-1e-10&&(y=!0):Math.sign(s)==Math.sign(h)&&(y=!0),o=y?(n=-s,i=a,Math.sqrt(c)):(n=a,i=s,Math.sqrt(c/2))}return new Ht.Vector2(n/o,i/o)}L.length,Math.PI;for(var O=[],I=0,H=L.length,G=H-1,W=I+1;I<H;I++,G++,W++)G===H&&(G=0),W===H&&(W=0),L[I],L[G],L[W],O[I]=z(L[I],L[G],L[W]);var j,X,q=[],Y=O.concat();for(l=0,h=C.length;l<h;l++){for(s=C[l],j=[],I=0,G=(H=s.length)-1,W=I+1;I<H;I++,G++,W++)G===H&&(G=0),W===H&&(W=0),j[I]=z(s[I],s[G],s[W]);q.push(j),Y=Y.concat(j)}for(D=0;D<f;D++){for(F=u*(1-(k=D/f)),R=d*Math.sin(k*Math.PI/2),I=0,H=L.length;I<H;I++)Q((U=P(L[I],O[I],R)).x,U.y,-F);for(l=0,h=C.length;l<h;l++)for(s=C[l],j=q[l],I=0,H=s.length;I<H;I++)Q((U=P(s[I],j[I],R)).x,U.y,-F)}for(R=d,I=0;I<B;I++)U=p?P(T[I],Y[I],R):T[I],y?(o.copy(n.normals[0]).multiplyScalar(U.x),i.copy(n.binormals[0]).multiplyScalar(U.y),a.copy(r[0]).add(o).add(i),Q(a.x,a.y,a.z)):Q(U.x,U.y,0);for(X=1;X<=g;X++)for(I=0;I<B;I++)U=p?P(T[I],Y[I],R):T[I],y?(o.copy(n.normals[X]).multiplyScalar(U.x),i.copy(n.binormals[X]).multiplyScalar(U.y),a.copy(r[X]).add(o).add(i),Q(a.x,a.y,a.z)):Q(U.x,U.y,c/g*X);for(D=f-1;0<=D;D--){for(F=u*(1-(k=D/f)),R=d*Math.sin(k*Math.PI/2),I=0,H=L.length;I<H;I++)Q((U=P(L[I],O[I],R)).x,U.y,c+F);for(l=0,h=C.length;l<h;l++)for(s=C[l],j=q[l],I=0,H=s.length;I<H;I++)U=P(s[I],j[I],R),y?Q(U.x,U.y+r[g-1].y,r[g-1].x+F):Q(U.x,U.y,c+F)}function K(e,t){var r,n;for(I=e.length;0<=--I;){(n=(r=I)-1)<0&&(n=e.length-1);var i=0,o=g+2*f;for(i=0;i<o;i++){var a=B*i,s=B*(i+1);$(t+r+a,t+n+a,t+n+s,t+r+s,e,i,o,r,n)}}}function Q(e,t,r){w.vertices.push(new Ht.Vector3(e,t,r))}function Z(e,t,r){e+=M,t+=M,r+=M,w.faces.push(new Ht.Face3(e,t,r,null,null,x));var n=_.generateTopUV(w,e,t,r);w.faceVertexUvs[0].push(n)}function $(e,t,r,n,i,o,a,s,l){e+=M,t+=M,r+=M,n+=M,w.faces.push(new Ht.Face3(e,t,n,null,null,b)),w.faces.push(new Ht.Face3(t,r,n,null,null,b));var h=_.generateSideWallUV(w,e,t,r,n);w.faceVertexUvs[0].push([h[0],h[1],h[3]]),w.faceVertexUvs[0].push([h[1],h[2],h[3]])}!function(){if(p){var e=0,t=B*e;for(I=0;I<V;I++)Z((N=A[I])[2]+t,N[1]+t,N[0]+t);for(t=B*(e=g+2*f),I=0;I<V;I++)Z((N=A[I])[0]+t,N[1]+t,N[2]+t)}else{for(I=0;I<V;I++)Z((N=A[I])[2],N[1],N[0]);for(I=0;I<V;I++)Z((N=A[I])[0]+B*g,N[1]+B*g,N[2]+B*g)}}(),function(){var e=0;for(K(L,e),e+=L.length,l=0,h=C.length;l<h;l++)K(s=C[l],e),e+=s.length}()},Ht.ExtrudeGeometry.WorldUVGenerator={generateTopUV:function(e,t,r,n){var i=e.vertices,o=i[t],a=i[r],s=i[n];return[new Ht.Vector2(o.x,o.y),new Ht.Vector2(a.x,a.y),new Ht.Vector2(s.x,s.y)]},generateSideWallUV:function(e,t,r,n,i){var o=e.vertices,a=o[t],s=o[r],l=o[n],h=o[i];return Math.abs(a.y-s.y)<.01?[new Ht.Vector2(a.x,1-a.z),new Ht.Vector2(s.x,1-s.z),new Ht.Vector2(l.x,1-l.z),new Ht.Vector2(h.x,1-h.z)]:[new Ht.Vector2(a.y,1-a.z),new Ht.Vector2(s.y,1-s.z),new Ht.Vector2(l.y,1-l.z),new Ht.Vector2(h.y,1-h.z)]}},Ht.ShapeGeometry=function(e,t){Ht.Geometry.call(this),this.type="ShapeGeometry",e instanceof Array==0&&(e=[e]),this.addShapeList(e,t),this.computeFaceNormals()},Ht.ShapeGeometry.prototype=Object.create(Ht.Geometry.prototype),Ht.ShapeGeometry.prototype.addShapeList=function(e,t){for(var r=0,n=e.length;r<n;r++)this.addShape(e[r],t);return this},Ht.ShapeGeometry.prototype.addShape=function(e,t){void 0===t&&(t={});var r,n,i,o=void 0!==t.curveSegments?t.curveSegments:12,a=t.material,s=void 0===t.UVGenerator?Ht.ExtrudeGeometry.WorldUVGenerator:t.UVGenerator,l=this.vertices.length,h=e.extractPoints(o),c=h.shape,u=h.holes,d=!Ht.Shape.Utils.isClockWise(c);if(d){for(c=c.reverse(),r=0,n=u.length;r<n;r++)i=u[r],Ht.Shape.Utils.isClockWise(i)&&(u[r]=i.reverse());d=!1}var f=Ht.Shape.Utils.triangulateShape(c,u),p=c;for(r=0,n=u.length;r<n;r++)i=u[r],c=c.concat(i);var m,g,v=c.length,y=f.length;for(p.length,r=0;r<v;r++)m=c[r],this.vertices.push(new Ht.Vector3(m.x,m.y,0));for(r=0;r<y;r++){var x=(g=f[r])[0]+l,b=g[1]+l,_=g[2]+l;this.faces.push(new Ht.Face3(x,b,_,null,null,a)),this.faceVertexUvs[0].push(s.generateTopUV(this,x,b,_))}},Ht.LatheGeometry=function(e,t,r,n){Ht.Geometry.call(this),this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:r,phiLength:n},t=t||12,r=r||0,n=n||2*Math.PI;for(var i=1/(e.length-1),o=1/t,a=0,s=t;a<=s;a++)for(var l=r+a*o*n,h=Math.cos(l),c=Math.sin(l),u=0,d=e.length;u<d;u++){var f=e[u],p=new Ht.Vector3;p.x=h*f.x-c*f.y,p.y=c*f.x+h*f.y,p.z=f.z,this.vertices.push(p)}var m=e.length;for(a=0,s=t;a<s;a++)for(u=0,d=e.length-1;u<d;u++){var g=u+m*a,v=g,y=g+m,x=(h=g+1+m,g+1),b=a*o,_=u*i,w=b+o,M=_+i;this.faces.push(new Ht.Face3(v,y,x)),this.faceVertexUvs[0].push([new Ht.Vector2(b,_),new Ht.Vector2(w,_),new Ht.Vector2(b,M)]),this.faces.push(new Ht.Face3(y,h,x)),this.faceVertexUvs[0].push([new Ht.Vector2(w,_),new Ht.Vector2(w,M),new Ht.Vector2(b,M)])}this.mergeVertices(),this.computeFaceNormals(),this.computeVertexNormals()},Ht.LatheGeometry.prototype=Object.create(Ht.Geometry.prototype),Ht.PlaneGeometry=function(e,t,r,n){console.info("THREE.PlaneGeometry: Consider using THREE.PlaneBufferGeometry for lower memory footprint."),Ht.Geometry.call(this),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:r,heightSegments:n},this.fromBufferGeometry(new Ht.PlaneBufferGeometry(e,t,r,n))},Ht.PlaneGeometry.prototype=Object.create(Ht.Geometry.prototype),Ht.PlaneBufferGeometry=function(e,t,r,n){Ht.BufferGeometry.call(this),this.type="PlaneBufferGeometry",this.parameters={width:e,height:t,widthSegments:r,heightSegments:n};for(var i=e/2,o=t/2,a=r||1,s=n||1,l=a+1,h=s+1,c=e/a,u=t/s,d=new Float32Array(l*h*3),f=new Float32Array(l*h*3),p=new Float32Array(l*h*2),m=0,g=0,v=0;v<h;v++)for(var y=v*u-o,x=0;x<l;x++){var b=x*c-i;d[m]=b,d[m+1]=-y,f[m+2]=1,p[g]=x/a,p[g+1]=1-v/s,m+=3,g+=2}m=0;var _=new(65535<d.length/3?Uint32Array:Uint16Array)(a*s*6);for(v=0;v<s;v++)for(x=0;x<a;x++){var w=x+l*v,M=x+l*(v+1),S=x+1+l*(v+1),T=x+1+l*v;_[m]=w,_[m+1]=M,_[m+2]=T,_[m+3]=M,_[m+4]=S,_[m+5]=T,m+=6}this.addAttribute("index",new Ht.BufferAttribute(_,1)),this.addAttribute("position",new Ht.BufferAttribute(d,3)),this.addAttribute("normal",new Ht.BufferAttribute(f,3)),this.addAttribute("uv",new Ht.BufferAttribute(p,2))},Ht.PlaneBufferGeometry.prototype=Object.create(Ht.BufferGeometry.prototype),Ht.RingGeometry=function(e,t,r,n,i,o){Ht.Geometry.call(this),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:r,phiSegments:n,thetaStart:i,thetaLength:o},e=e||0,t=t||50,i=void 0!==i?i:0,o=void 0!==o?o:2*Math.PI,r=void 0!==r?Math.max(3,r):8;var a,s,l=[],h=e,c=(t-e)/(n=void 0!==n?Math.max(1,n):8);for(a=0;a<n+1;a++){for(s=0;s<r+1;s++){var u=new Ht.Vector3,d=i+s/r*o;u.x=h*Math.cos(d),u.y=h*Math.sin(d),this.vertices.push(u),l.push(new Ht.Vector2((u.x/t+1)/2,(u.y/t+1)/2))}h+=c}var f=new Ht.Vector3(0,0,1);for(a=0;a<n;a++){var p=a*(r+1);for(s=0;s<r;s++){var m=d=s+p,g=d+r+1,v=d+r+2;this.faces.push(new Ht.Face3(m,g,v,[f.clone(),f.clone(),f.clone()])),this.faceVertexUvs[0].push([l[m].clone(),l[g].clone(),l[v].clone()]),g=(m=d)+r+2,v=d+1,this.faces.push(new Ht.Face3(m,g,v,[f.clone(),f.clone(),f.clone()])),this.faceVertexUvs[0].push([l[m].clone(),l[g].clone(),l[v].clone()])}}this.computeFaceNormals(),this.boundingSphere=new Ht.Sphere(new Ht.Vector3,h)},Ht.RingGeometry.prototype=Object.create(Ht.Geometry.prototype),Ht.SphereGeometry=function(e,t,r,n,i,o,a){Ht.Geometry.call(this),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:r,phiStart:n,phiLength:i,thetaStart:o,thetaLength:a},e=e||50,t=Math.max(3,Math.floor(t)||8),r=Math.max(2,Math.floor(r)||6),n=void 0!==n?n:0,i=void 0!==i?i:2*Math.PI,o=void 0!==o?o:0,a=void 0!==a?a:Math.PI;var s,l,h=[],c=[];for(l=0;l<=r;l++){var u=[],d=[];for(s=0;s<=t;s++){var f=s/t,p=l/r,m=new Ht.Vector3;m.x=-e*Math.cos(n+f*i)*Math.sin(o+p*a),m.y=e*Math.cos(o+p*a),m.z=e*Math.sin(n+f*i)*Math.sin(o+p*a),this.vertices.push(m),u.push(this.vertices.length-1),d.push(new Ht.Vector2(f,1-p))}h.push(u),c.push(d)}for(l=0;l<r;l++)for(s=0;s<t;s++){var g=h[l][s+1],v=h[l][s],y=h[l+1][s],x=h[l+1][s+1],b=this.vertices[g].clone().normalize(),_=this.vertices[v].clone().normalize(),w=this.vertices[y].clone().normalize(),M=this.vertices[x].clone().normalize(),S=c[l][s+1].clone(),T=c[l][s].clone(),C=c[l+1][s].clone(),E=c[l+1][s+1].clone();Math.abs(this.vertices[g].y)===e?(S.x=(S.x+T.x)/2,this.faces.push(new Ht.Face3(g,y,x,[b,w,M])),this.faceVertexUvs[0].push([S,C,E])):Math.abs(this.vertices[y].y)===e?(C.x=(C.x+E.x)/2,this.faces.push(new Ht.Face3(g,v,y,[b,_,w])),this.faceVertexUvs[0].push([S,T,C])):(this.faces.push(new Ht.Face3(g,v,x,[b,_,M])),this.faceVertexUvs[0].push([S,T,E]),this.faces.push(new Ht.Face3(v,y,x,[_.clone(),w,M.clone()])),this.faceVertexUvs[0].push([T.clone(),C,E.clone()]))}this.computeFaceNormals(),this.boundingSphere=new Ht.Sphere(new Ht.Vector3,e)},Ht.SphereGeometry.prototype=Object.create(Ht.Geometry.prototype),Ht.TextGeometry=function(e,t){t=t||{};var r=Ht.FontUtils.generateShapes(e,t);t.amount=void 0!==t.height?t.height:50,void 0===t.bevelThickness&&(t.bevelThickness=10),void 0===t.bevelSize&&(t.bevelSize=8),void 0===t.bevelEnabled&&(t.bevelEnabled=!1),Ht.ExtrudeGeometry.call(this,r,t),this.type="TextGeometry"},Ht.TextGeometry.prototype=Object.create(Ht.ExtrudeGeometry.prototype),Ht.TorusGeometry=function(e,t,r,n,i){Ht.Geometry.call(this),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:r,tubularSegments:n,arc:i},e=e||100,t=t||40,r=r||8,n=n||6,i=i||2*Math.PI;for(var o=new Ht.Vector3,a=[],s=[],l=0;l<=r;l++)for(var h=0;h<=n;h++){var c=h/n*i,u=l/r*Math.PI*2;o.x=e*Math.cos(c),o.y=e*Math.sin(c);var d=new Ht.Vector3;d.x=(e+t*Math.cos(u))*Math.cos(c),d.y=(e+t*Math.cos(u))*Math.sin(c),d.z=t*Math.sin(u),this.vertices.push(d),a.push(new Ht.Vector2(h/n,l/r)),s.push(d.clone().sub(o).normalize())}for(l=1;l<=r;l++)for(h=1;h<=n;h++){var f=(n+1)*l+h-1,p=(n+1)*(l-1)+h-1,m=(n+1)*(l-1)+h,g=(n+1)*l+h,v=new Ht.Face3(f,p,g,[s[f].clone(),s[p].clone(),s[g].clone()]);this.faces.push(v),this.faceVertexUvs[0].push([a[f].clone(),a[p].clone(),a[g].clone()]),v=new Ht.Face3(p,m,g,[s[p].clone(),s[m].clone(),s[g].clone()]),this.faces.push(v),this.faceVertexUvs[0].push([a[p].clone(),a[m].clone(),a[g].clone()])}this.computeFaceNormals()},Ht.TorusGeometry.prototype=Object.create(Ht.Geometry.prototype),Ht.TorusKnotGeometry=function(e,t,r,n,i,o,a){Ht.Geometry.call(this),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,radialSegments:r,tubularSegments:n,p:i,q:o,heightScale:a},e=e||100,t=t||40,r=r||64,n=n||8,i=i||2,o=o||3,a=a||1;for(var s=new Array(r),l=new Ht.Vector3,h=new Ht.Vector3,c=new Ht.Vector3,u=0;u<r;++u){s[u]=new Array(n);var d=u/r*2*i*Math.PI,f=P(d,o,i,e,a),p=P(d+.01,o,i,e,a);l.subVectors(p,f),h.addVectors(p,f),c.crossVectors(l,h),h.crossVectors(c,l),c.normalize(),h.normalize();for(var m=0;m<n;++m){var g=m/n*2*Math.PI,v=-t*Math.cos(g),y=t*Math.sin(g),x=new Ht.Vector3;x.x=f.x+v*h.x+y*c.x,x.y=f.y+v*h.y+y*c.y,x.z=f.z+v*h.z+y*c.z,s[u][m]=this.vertices.push(x)-1}}for(u=0;u<r;++u)for(m=0;m<n;++m){var b=(u+1)%r,_=(m+1)%n,w=s[u][m],M=s[b][m],S=s[b][_],T=s[u][_],C=new Ht.Vector2(u/r,m/n),E=new Ht.Vector2((u+1)/r,m/n),A=new Ht.Vector2((u+1)/r,(m+1)/n),L=new Ht.Vector2(u/r,(m+1)/n);this.faces.push(new Ht.Face3(w,M,T)),this.faceVertexUvs[0].push([C,E,L]),this.faces.push(new Ht.Face3(M,S,T)),this.faceVertexUvs[0].push([E.clone(),A,L.clone()])}function P(e,t,r,n,i){var o=Math.cos(e),a=Math.sin(e),s=t/r*e,l=Math.cos(s),h=n*(2+l)*.5*o,c=n*(2+l)*a*.5,u=i*n*Math.sin(s)*.5;return new Ht.Vector3(h,c,u)}this.computeFaceNormals(),this.computeVertexNormals()},Ht.TorusKnotGeometry.prototype=Object.create(Ht.Geometry.prototype),Ht.TubeGeometry=function(e,t,r,n,i){Ht.Geometry.call(this),this.type="TubeGeometry",this.parameters={path:e,segments:t,radius:r,radialSegments:n,closed:i},r=r||1,n=n||8,i=i||!1;var o,a,s,l,h,c,u,d,f,p,m,g,v,y,x,b,_,w,M,S,T,C,E=[],A=(t=t||64)+1,L=new Ht.Vector3,P=new Ht.TubeGeometry.FrenetFrames(e,t,i),D=P.tangents,R=P.normals,k=P.binormals;for(this.tangents=D,this.normals=R,this.binormals=k,d=0;d<A;d++)for(E[d]=[],s=d/(A-1),u=e.getPointAt(s),D[d],o=R[d],a=k[d],f=0;f<n;f++)l=f/n*2*Math.PI,h=-r*Math.cos(l),c=r*Math.sin(l),L.copy(u),L.x+=h*o.x+c*a.x,L.y+=h*o.y+c*a.y,L.z+=h*o.z+c*a.z,E[d][f]=(S=L.x,T=L.y,C=L.z,this.vertices.push(new Ht.Vector3(S,T,C))-1);for(d=0;d<t;d++)for(f=0;f<n;f++)p=i?(d+1)%t:d+1,m=(f+1)%n,g=E[d][f],v=E[p][f],y=E[p][m],x=E[d][m],b=new Ht.Vector2(d/t,f/n),_=new Ht.Vector2((d+1)/t,f/n),w=new Ht.Vector2((d+1)/t,(f+1)/n),M=new Ht.Vector2(d/t,(f+1)/n),this.faces.push(new Ht.Face3(g,v,x)),this.faceVertexUvs[0].push([b,_,M]),this.faces.push(new Ht.Face3(v,y,x)),this.faceVertexUvs[0].push([_.clone(),w,M.clone()]);this.computeFaceNormals(),this.computeVertexNormals()},Ht.TubeGeometry.prototype=Object.create(Ht.Geometry.prototype),Ht.TubeGeometry.FrenetFrames=function(e,t,r){new Ht.Vector3;var n,i,o,a,s,l,h,c=new Ht.Vector3,u=(new Ht.Vector3,[]),d=[],f=[],p=new Ht.Vector3,m=new Ht.Matrix4,g=t+1;for(this.tangents=u,this.normals=d,this.binormals=f,l=0;l<g;l++)h=l/(g-1),u[l]=e.getTangentAt(h),u[l].normalize();for(d[0]=new Ht.Vector3,f[0]=new Ht.Vector3,i=Number.MAX_VALUE,o=Math.abs(u[0].x),a=Math.abs(u[0].y),s=Math.abs(u[0].z),o<=i&&(i=o,c.set(1,0,0)),a<=i&&(i=a,c.set(0,1,0)),s<=i&&c.set(0,0,1),p.crossVectors(u[0],c).normalize(),d[0].crossVectors(u[0],p),f[0].crossVectors(u[0],d[0]),l=1;l<g;l++)d[l]=d[l-1].clone(),f[l]=f[l-1].clone(),p.crossVectors(u[l-1],u[l]),1e-4<p.length()&&(p.normalize(),n=Math.acos(Ht.Math.clamp(u[l-1].dot(u[l]),-1,1)),d[l].applyMatrix4(m.makeRotationAxis(p,n))),f[l].crossVectors(u[l],d[l]);if(r)for(n=Math.acos(Ht.Math.clamp(d[0].dot(d[g-1]),-1,1)),n/=g-1,0<u[0].dot(p.crossVectors(d[0],d[g-1]))&&(n=-n),l=1;l<g;l++)d[l].applyMatrix4(m.makeRotationAxis(u[l],n*l)),f[l].crossVectors(u[l],d[l])},Ht.PolyhedronGeometry=function(e,t,r,n){Ht.Geometry.call(this),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:r,detail:n},r=r||1,n=n||0;for(var i=this,o=0,a=e.length;o<a;o+=3)b(new Ht.Vector3(e[o],e[o+1],e[o+2]));var s=this.vertices,l=[],h=(o=0,0);for(a=t.length;o<a;o+=3,h++){var c=s[t[o]],u=s[t[o+1]],d=s[t[o+2]];l[h]=new Ht.Face3(c.index,u.index,d.index,[c.clone(),u.clone(),d.clone()])}var f=new Ht.Vector3;for(o=0,a=l.length;o<a;o++)w(l[o],n);for(o=0,a=this.faceVertexUvs[0].length;o<a;o++){var p=this.faceVertexUvs[0][o],m=p[0].x,g=p[1].x,v=p[2].x,y=Math.max(m,Math.max(g,v)),x=Math.min(m,Math.min(g,v));.9<y&&x<.1&&(m<.2&&(p[0].x+=1),g<.2&&(p[1].x+=1),v<.2&&(p[2].x+=1))}for(o=0,a=this.vertices.length;o<a;o++)this.vertices[o].multiplyScalar(r);function b(e){var t=e.normalize().clone();t.index=i.vertices.push(t)-1;var r,n=M(e)/2/Math.PI+.5,o=(r=e,Math.atan2(-r.y,Math.sqrt(r.x*r.x+r.z*r.z))/Math.PI+.5);return t.uv=new Ht.Vector2(n,1-o),t}function _(e,t,r){var n=new Ht.Face3(e.index,t.index,r.index,[e.clone(),t.clone(),r.clone()]);i.faces.push(n),f.copy(e).add(t).add(r).divideScalar(3);var o=M(f);i.faceVertexUvs[0].push([S(e.uv,e,o),S(t.uv,t,o),S(r.uv,r,o)])}function w(e,t){for(var r=Math.pow(2,t),n=(Math.pow(4,t),b(i.vertices[e.a])),o=b(i.vertices[e.b]),a=b(i.vertices[e.c]),s=[],l=0;l<=r;l++){s[l]=[];for(var h=b(n.clone().lerp(a,l/r)),c=b(o.clone().lerp(a,l/r)),u=r-l,d=0;d<=u;d++)s[l][d]=0==d&&l==r?h:b(h.clone().lerp(c,d/u))}for(l=0;l<r;l++)for(d=0;d<2*(r-l)-1;d++){var f=Math.floor(d/2);d%2==0?_(s[l][f+1],s[l+1][f],s[l][f]):_(s[l][f+1],s[l+1][f+1],s[l+1][f])}}function M(e){return Math.atan2(e.z,-e.x)}function S(e,t,r){return r<0&&1===e.x&&(e=new Ht.Vector2(e.x-1,e.y)),0===t.x&&0===t.z&&(e=new Ht.Vector2(r/2/Math.PI+.5,e.y)),e.clone()}this.mergeVertices(),this.computeFaceNormals(),this.boundingSphere=new Ht.Sphere(new Ht.Vector3,r)},Ht.PolyhedronGeometry.prototype=Object.create(Ht.Geometry.prototype),Ht.DodecahedronGeometry=function(e,t){this.parameters={radius:e,detail:t};var r=(1+Math.sqrt(5))/2,n=1/r,i=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-n,-r,0,-n,r,0,n,-r,0,n,r,-n,-r,0,-n,r,0,n,-r,0,n,r,0,-r,0,-n,r,0,-n,-r,0,n,r,0,n];Ht.PolyhedronGeometry.call(this,i,[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],e,t)},Ht.DodecahedronGeometry.prototype=Object.create(Ht.Geometry.prototype),Ht.IcosahedronGeometry=function(e,t){var r=(1+Math.sqrt(5))/2,n=[-1,r,0,1,r,0,-1,-r,0,1,-r,0,0,-1,r,0,1,r,0,-1,-r,0,1,-r,r,0,-1,r,0,1,-r,0,-1,-r,0,1];Ht.PolyhedronGeometry.call(this,n,[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],e,t),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t}},Ht.IcosahedronGeometry.prototype=Object.create(Ht.Geometry.prototype),Ht.OctahedronGeometry=function(e,t){this.parameters={radius:e,detail:t},Ht.PolyhedronGeometry.call(this,[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],e,t),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t}},Ht.OctahedronGeometry.prototype=Object.create(Ht.Geometry.prototype),Ht.TetrahedronGeometry=function(e,t){Ht.PolyhedronGeometry.call(this,[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],e,t),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:t}},Ht.TetrahedronGeometry.prototype=Object.create(Ht.Geometry.prototype),Ht.ParametricGeometry=function(e,t,r){Ht.Geometry.call(this),this.type="ParametricGeometry",this.parameters={func:e,slices:t,stacks:r};var n,i,o,a,s,l,h,c,u,d,f,p,m=this.vertices,g=this.faces,v=this.faceVertexUvs[0],y=t+1;for(n=0;n<=r;n++)for(a=n/r,i=0;i<=t;i++)o=e(i/t,a),m.push(o);for(n=0;n<r;n++)for(i=0;i<t;i++)l=(s=n*y+i)+1,h=(n+1)*y+i+1,c=(n+1)*y+i,u=new Ht.Vector2(i/t,n/r),d=new Ht.Vector2((i+1)/t,n/r),f=new Ht.Vector2((i+1)/t,(n+1)/r),p=new Ht.Vector2(i/t,(n+1)/r),g.push(new Ht.Face3(s,l,c)),v.push([u,d,p]),g.push(new Ht.Face3(l,h,c)),v.push([d.clone(),f,p.clone()]);this.computeFaceNormals(),this.computeVertexNormals()},Ht.ParametricGeometry.prototype=Object.create(Ht.Geometry.prototype),Ht.AxisHelper=function(e){e=e||1;var t=new Float32Array([0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e]),r=new Float32Array([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1]),n=new Ht.BufferGeometry;n.addAttribute("position",new Ht.BufferAttribute(t,3)),n.addAttribute("color",new Ht.BufferAttribute(r,3));var i=new Ht.LineBasicMaterial({vertexColors:Ht.VertexColors});Ht.Line.call(this,n,i,Ht.LinePieces)},Ht.AxisHelper.prototype=Object.create(Ht.Line.prototype),Ht.ArrowHelper=function(){var e=new Ht.Geometry;e.vertices.push(new Ht.Vector3(0,0,0),new Ht.Vector3(0,1,0));var t=new Ht.CylinderGeometry(0,.5,1,5,1);return t.applyMatrix((new Ht.Matrix4).makeTranslation(0,-.5,0)),function(r,n,i,o,a,s){Ht.Object3D.call(this),void 0===o&&(o=16776960),void 0===i&&(i=1),void 0===a&&(a=.2*i),void 0===s&&(s=.2*a),this.position.copy(n),this.line=new Ht.Line(e,new Ht.LineBasicMaterial({color:o})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new Ht.Mesh(t,new Ht.MeshBasicMaterial({color:o})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(r),this.setLength(i,a,s)}}(),Ht.ArrowHelper.prototype=Object.create(Ht.Object3D.prototype),Ht.ArrowHelper.prototype.setDirection=(At=new Ht.Vector3,function(e){.99999<e.y?this.quaternion.set(0,0,0,1):e.y<-.99999?this.quaternion.set(1,0,0,0):(At.set(e.z,0,-e.x).normalize(),Et=Math.acos(e.y),this.quaternion.setFromAxisAngle(At,Et))}),Ht.ArrowHelper.prototype.setLength=function(e,t,r){void 0===t&&(t=.2*e),void 0===r&&(r=.2*t),this.line.scale.set(1,e,1),this.line.updateMatrix(),this.cone.scale.set(r,t,r),this.cone.position.y=e,this.cone.updateMatrix()},Ht.ArrowHelper.prototype.setColor=function(e){this.line.material.color.set(e),this.cone.material.color.set(e)},Ht.BoxHelper=function(e){var t=new Ht.BufferGeometry;t.addAttribute("position",new Ht.BufferAttribute(new Float32Array(72),3)),Ht.Line.call(this,t,new Ht.LineBasicMaterial({color:16776960}),Ht.LinePieces),void 0!==e&&this.update(e)},Ht.BoxHelper.prototype=Object.create(Ht.Line.prototype),Ht.BoxHelper.prototype.update=function(e){var t=e.geometry;null===t.boundingBox&&t.computeBoundingBox();var r=t.boundingBox.min,n=t.boundingBox.max,i=this.geometry.attributes.position.array;i[0]=n.x,i[1]=n.y,i[2]=n.z,i[3]=r.x,i[4]=n.y,i[5]=n.z,i[6]=r.x,i[7]=n.y,i[8]=n.z,i[9]=r.x,i[10]=r.y,i[11]=n.z,i[12]=r.x,i[13]=r.y,i[14]=n.z,i[15]=n.x,i[16]=r.y,i[17]=n.z,i[18]=n.x,i[19]=r.y,i[20]=n.z,i[21]=n.x,i[22]=n.y,i[23]=n.z,i[24]=n.x,i[25]=n.y,i[26]=r.z,i[27]=r.x,i[28]=n.y,i[29]=r.z,i[30]=r.x,i[31]=n.y,i[32]=r.z,i[33]=r.x,i[34]=r.y,i[35]=r.z,i[36]=r.x,i[37]=r.y,i[38]=r.z,i[39]=n.x,i[40]=r.y,i[41]=r.z,i[42]=n.x,i[43]=r.y,i[44]=r.z,i[45]=n.x,i[46]=n.y,i[47]=r.z,i[48]=n.x,i[49]=n.y,i[50]=n.z,i[51]=n.x,i[52]=n.y,i[53]=r.z,i[54]=r.x,i[55]=n.y,i[56]=n.z,i[57]=r.x,i[58]=n.y,i[59]=r.z,i[60]=r.x,i[61]=r.y,i[62]=n.z,i[63]=r.x,i[64]=r.y,i[65]=r.z,i[66]=n.x,i[67]=r.y,i[68]=n.z,i[69]=n.x,i[70]=r.y,i[71]=r.z,this.geometry.attributes.position.needsUpdate=!0,this.geometry.computeBoundingSphere(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1},Ht.BoundingBoxHelper=function(e,t){var r=void 0!==t?t:8947848;this.object=e,this.box=new Ht.Box3,Ht.Mesh.call(this,new Ht.BoxGeometry(1,1,1),new Ht.MeshBasicMaterial({color:r,wireframe:!0}))},Ht.BoundingBoxHelper.prototype=Object.create(Ht.Mesh.prototype),Ht.BoundingBoxHelper.prototype.update=function(){this.box.setFromObject(this.object),this.box.size(this.scale),this.box.center(this.position)},Ht.CameraHelper=function(e){var t=new Ht.Geometry,r=new Ht.LineBasicMaterial({color:16777215,vertexColors:Ht.FaceColors}),n={},i=16755200,o=16711680,a=3355443;function s(e,t,r){l(e,r),l(t,r)}function l(e,r){t.vertices.push(new Ht.Vector3),t.colors.push(new Ht.Color(r)),void 0===n[e]&&(n[e]=[]),n[e].push(t.vertices.length-1)}s("n1","n2",i),s("n2","n4",i),s("n4","n3",i),s("n3","n1",i),s("f1","f2",i),s("f2","f4",i),s("f4","f3",i),s("f3","f1",i),s("n1","f1",i),s("n2","f2",i),s("n3","f3",i),s("n4","f4",i),s("p","n1",o),s("p","n2",o),s("p","n3",o),s("p","n4",o),s("u1","u2",43775),s("u2","u3",43775),s("u3","u1",43775),s("c","t",16777215),s("p","c",a),s("cn1","cn2",a),s("cn3","cn4",a),s("cf1","cf2",a),s("cf3","cf4",a),Ht.Line.call(this,t,r,Ht.LinePieces),this.camera=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=n,this.update()},Ht.CameraHelper.prototype=Object.create(Ht.Line.prototype),Ht.CameraHelper.prototype.update=(Dt=new Ht.Vector3,Rt=new Ht.Camera,kt=function(e,t,r,n){Dt.set(t,r,n).unproject(Rt);var i=Pt[e];if(void 0!==i)for(var o=0,a=i.length;o<a;o++)Lt.vertices[i[o]].copy(Dt)},function(){Lt=this.geometry,Pt=this.pointMap,Rt.projectionMatrix.copy(this.camera.projectionMatrix),kt("c",0,0,-1),kt("t",0,0,1),kt("n1",-1,-1,-1),kt("n2",1,-1,-1),kt("n3",-1,1,-1),kt("n4",1,1,-1),kt("f1",-1,-1,1),kt("f2",1,-1,1),kt("f3",-1,1,1),kt("f4",1,1,1),kt("u1",.7,1.1,-1),kt("u2",-.7,1.1,-1),kt("u3",0,2,-1),kt("cf1",-1,0,1),kt("cf2",1,0,1),kt("cf3",0,-1,1),kt("cf4",0,1,1),kt("cn1",-1,0,-1),kt("cn2",1,0,-1),kt("cn3",0,-1,-1),kt("cn4",0,1,-1),Lt.verticesNeedUpdate=!0}),Ht.DirectionalLightHelper=function(e,t){Ht.Object3D.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,t=t||1;var r=new Ht.Geometry;r.vertices.push(new Ht.Vector3(-t,t,0),new Ht.Vector3(t,t,0),new Ht.Vector3(t,-t,0),new Ht.Vector3(-t,-t,0),new Ht.Vector3(-t,t,0));var n=new Ht.LineBasicMaterial({fog:!1});n.color.copy(this.light.color).multiplyScalar(this.light.intensity),this.lightPlane=new Ht.Line(r,n),this.add(this.lightPlane),(r=new Ht.Geometry).vertices.push(new Ht.Vector3,new Ht.Vector3),(n=new Ht.LineBasicMaterial({fog:!1})).color.copy(this.light.color).multiplyScalar(this.light.intensity),this.targetLine=new Ht.Line(r,n),this.add(this.targetLine),this.update()},Ht.DirectionalLightHelper.prototype=Object.create(Ht.Object3D.prototype),Ht.DirectionalLightHelper.prototype.dispose=function(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()},Ht.DirectionalLightHelper.prototype.update=(Ft=new Ht.Vector3,Ut=new Ht.Vector3,Nt=new Ht.Vector3,function(){Ft.setFromMatrixPosition(this.light.matrixWorld),Ut.setFromMatrixPosition(this.light.target.matrixWorld),Nt.subVectors(Ut,Ft),this.lightPlane.lookAt(Nt),this.lightPlane.material.color.copy(this.light.color).multiplyScalar(this.light.intensity),this.targetLine.geometry.vertices[1].copy(Nt),this.targetLine.geometry.verticesNeedUpdate=!0,this.targetLine.material.color.copy(this.lightPlane.material.color)}),Ht.EdgesHelper=function(e,t){var r=void 0!==t?t:16777215,n=[0,0],i={},o=function(e,t){return e-t},a=["a","b","c"],s=new Ht.BufferGeometry,l=e.geometry.clone();l.mergeVertices(),l.computeFaceNormals();for(var h=l.vertices,c=l.faces,u=0,d=0,f=c.length;d<f;d++)for(var p=c[d],m=0;m<3;m++)n[0]=p[a[m]],n[1]=p[a[(m+1)%3]],n.sort(o),void 0===i[y=n.toString()]?(i[y]={vert1:n[0],vert2:n[1],face1:d,face2:void 0},u++):i[y].face2=d;var g=new Float32Array(2*u*3),v=0;for(var y in i){var x=i[y];if(void 0===x.face2||c[x.face1].normal.dot(c[x.face2].normal)<.9999){var b=h[x.vert1];g[v++]=b.x,g[v++]=b.y,g[v++]=b.z,b=h[x.vert2],g[v++]=b.x,g[v++]=b.y,g[v++]=b.z}}s.addAttribute("position",new Ht.BufferAttribute(g,3)),Ht.Line.call(this,s,new Ht.LineBasicMaterial({color:r}),Ht.LinePieces),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1},Ht.EdgesHelper.prototype=Object.create(Ht.Line.prototype),Ht.FaceNormalsHelper=function(e,t,r,n){this.object=e,this.size=void 0!==t?t:1;for(var i=void 0!==r?r:16776960,o=void 0!==n?n:1,a=new Ht.Geometry,s=0,l=this.object.geometry.faces.length;s<l;s++)a.vertices.push(new Ht.Vector3,new Ht.Vector3);Ht.Line.call(this,a,new Ht.LineBasicMaterial({color:i,linewidth:o}),Ht.LinePieces),this.matrixAutoUpdate=!1,this.normalMatrix=new Ht.Matrix3,this.update()},Ht.FaceNormalsHelper.prototype=Object.create(Ht.Line.prototype),Ht.FaceNormalsHelper.prototype.update=function(){var e=this.geometry.vertices,t=this.object,r=t.geometry.vertices,n=t.geometry.faces,i=t.matrixWorld;t.updateMatrixWorld(!0),this.normalMatrix.getNormalMatrix(i);for(var o=0,a=0,s=n.length;o<s;o++,a+=2){var l=n[o];e[a].copy(r[l.a]).add(r[l.b]).add(r[l.c]).divideScalar(3).applyMatrix4(i),e[a+1].copy(l.normal).applyMatrix3(this.normalMatrix).normalize().multiplyScalar(this.size).add(e[a])}return this.geometry.verticesNeedUpdate=!0,this},Ht.GridHelper=function(e,t){var r=new Ht.Geometry,n=new Ht.LineBasicMaterial({vertexColors:Ht.VertexColors});this.color1=new Ht.Color(4473924),this.color2=new Ht.Color(8947848);for(var i=-e;i<=e;i+=t){r.vertices.push(new Ht.Vector3(-e,0,i),new Ht.Vector3(e,0,i),new Ht.Vector3(i,0,-e),new Ht.Vector3(i,0,e));var o=0===i?this.color1:this.color2;r.colors.push(o,o,o,o)}Ht.Line.call(this,r,n,Ht.LinePieces)},Ht.GridHelper.prototype=Object.create(Ht.Line.prototype),Ht.GridHelper.prototype.setColors=function(e,t){this.color1.set(e),this.color2.set(t),this.geometry.colorsNeedUpdate=!0},Ht.HemisphereLightHelper=function(e,t,r,n){Ht.Object3D.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.colors=[new Ht.Color,new Ht.Color];var i=new Ht.SphereGeometry(t,4,2);i.applyMatrix((new Ht.Matrix4).makeRotationX(-Math.PI/2));for(var o=0;o<8;o++)i.faces[o].color=this.colors[o<4?0:1];var a=new Ht.MeshBasicMaterial({vertexColors:Ht.FaceColors,wireframe:!0});this.lightSphere=new Ht.Mesh(i,a),this.add(this.lightSphere),this.update()},Ht.HemisphereLightHelper.prototype=Object.create(Ht.Object3D.prototype),Ht.HemisphereLightHelper.prototype.dispose=function(){this.lightSphere.geometry.dispose(),this.lightSphere.material.dispose()},Ht.HemisphereLightHelper.prototype.update=(Bt=new Ht.Vector3,function(){this.colors[0].copy(this.light.color).multiplyScalar(this.light.intensity),this.colors[1].copy(this.light.groundColor).multiplyScalar(this.light.intensity),this.lightSphere.lookAt(Bt.setFromMatrixPosition(this.light.matrixWorld).negate()),this.lightSphere.geometry.colorsNeedUpdate=!0}),Ht.PointLightHelper=function(e,t){this.light=e,this.light.updateMatrixWorld();var r=new Ht.SphereGeometry(t,4,2),n=new Ht.MeshBasicMaterial({wireframe:!0,fog:!1});n.color.copy(this.light.color).multiplyScalar(this.light.intensity),Ht.Mesh.call(this,r,n),this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1},Ht.PointLightHelper.prototype=Object.create(Ht.Mesh.prototype),Ht.PointLightHelper.prototype.dispose=function(){this.geometry.dispose(),this.material.dispose()},Ht.PointLightHelper.prototype.update=function(){this.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)},Ht.SkeletonHelper=function(e){this.bones=this.getBoneList(e);for(var t=new Ht.Geometry,r=0;r<this.bones.length;r++)this.bones[r].parent instanceof Ht.Bone&&(t.vertices.push(new Ht.Vector3),t.vertices.push(new Ht.Vector3),t.colors.push(new Ht.Color(0,0,1)),t.colors.push(new Ht.Color(0,1,0)));var n=new Ht.LineBasicMaterial({vertexColors:Ht.VertexColors,depthTest:!1,depthWrite:!1,transparent:!0});Ht.Line.call(this,t,n,Ht.LinePieces),this.root=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.update()},Ht.SkeletonHelper.prototype=Object.create(Ht.Line.prototype),Ht.SkeletonHelper.prototype.getBoneList=function(e){var t=[];e instanceof Ht.Bone&&t.push(e);for(var r=0;r<e.children.length;r++)t.push.apply(t,this.getBoneList(e.children[r]));return t},Ht.SkeletonHelper.prototype.update=function(){for(var e=this.geometry,t=(new Ht.Matrix4).getInverse(this.root.matrixWorld),r=new Ht.Matrix4,n=0,i=0;i<this.bones.length;i++){var o=this.bones[i];o.parent instanceof Ht.Bone&&(r.multiplyMatrices(t,o.matrixWorld),e.vertices[n].setFromMatrixPosition(r),r.multiplyMatrices(t,o.parent.matrixWorld),e.vertices[n+1].setFromMatrixPosition(r),n+=2)}e.verticesNeedUpdate=!0,e.computeBoundingSphere()},Ht.SpotLightHelper=function(e){Ht.Object3D.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1;var t=new Ht.CylinderGeometry(0,1,1,8,1,!0);t.applyMatrix((new Ht.Matrix4).makeTranslation(0,-.5,0)),t.applyMatrix((new Ht.Matrix4).makeRotationX(-Math.PI/2));var r=new Ht.MeshBasicMaterial({wireframe:!0,fog:!1});this.cone=new Ht.Mesh(t,r),this.add(this.cone),this.update()},Ht.SpotLightHelper.prototype=Object.create(Ht.Object3D.prototype),Ht.SpotLightHelper.prototype.dispose=function(){this.cone.geometry.dispose(),this.cone.material.dispose()},Ht.SpotLightHelper.prototype.update=(Vt=new Ht.Vector3,zt=new Ht.Vector3,function(){var e=this.light.distance?this.light.distance:1e4,t=e*Math.tan(this.light.angle);this.cone.scale.set(t,t,e),Vt.setFromMatrixPosition(this.light.matrixWorld),zt.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(zt.sub(Vt)),this.cone.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)}),Ht.VertexNormalsHelper=function(e,t,r,n){this.object=e,this.size=void 0!==t?t:1;for(var i=void 0!==r?r:16711680,o=void 0!==n?n:1,a=new Ht.Geometry,s=(e.geometry.vertices,e.geometry.faces),l=0,h=s.length;l<h;l++)for(var c=0,u=s[l].vertexNormals.length;c<u;c++)a.vertices.push(new Ht.Vector3,new Ht.Vector3);Ht.Line.call(this,a,new Ht.LineBasicMaterial({color:i,linewidth:o}),Ht.LinePieces),this.matrixAutoUpdate=!1,this.normalMatrix=new Ht.Matrix3,this.update()},Ht.VertexNormalsHelper.prototype=Object.create(Ht.Line.prototype),Ht.VertexNormalsHelper.prototype.update=(Ot=new Ht.Vector3,function(e){var t=["a","b","c","d"];this.object.updateMatrixWorld(!0),this.normalMatrix.getNormalMatrix(this.object.matrixWorld);for(var r=this.geometry.vertices,n=this.object.geometry.vertices,i=this.object.geometry.faces,o=this.object.matrixWorld,a=0,s=0,l=i.length;s<l;s++)for(var h=i[s],c=0,u=h.vertexNormals.length;c<u;c++){var d=n[h[t[c]]],f=h.vertexNormals[c];r[a].copy(d).applyMatrix4(o),Ot.copy(f).applyMatrix3(this.normalMatrix).normalize().multiplyScalar(this.size),Ot.add(r[a]),r[a+=1].copy(Ot),a+=1}return this.geometry.verticesNeedUpdate=!0,this}),Ht.VertexTangentsHelper=function(e,t,r,n){this.object=e,this.size=void 0!==t?t:1;for(var i=void 0!==r?r:255,o=void 0!==n?n:1,a=new Ht.Geometry,s=(e.geometry.vertices,e.geometry.faces),l=0,h=s.length;l<h;l++)for(var c=0,u=s[l].vertexTangents.length;c<u;c++)a.vertices.push(new Ht.Vector3),a.vertices.push(new Ht.Vector3);Ht.Line.call(this,a,new Ht.LineBasicMaterial({color:i,linewidth:o}),Ht.LinePieces),this.matrixAutoUpdate=!1,this.update()},Ht.VertexTangentsHelper.prototype=Object.create(Ht.Line.prototype),Ht.VertexTangentsHelper.prototype.update=(It=new Ht.Vector3,function(e){var t=["a","b","c","d"];this.object.updateMatrixWorld(!0);for(var r=this.geometry.vertices,n=this.object.geometry.vertices,i=this.object.geometry.faces,o=this.object.matrixWorld,a=0,s=0,l=i.length;s<l;s++)for(var h=i[s],c=0,u=h.vertexTangents.length;c<u;c++){var d=n[h[t[c]]],f=h.vertexTangents[c];r[a].copy(d).applyMatrix4(o),It.copy(f).transformDirection(o).multiplyScalar(this.size),It.add(r[a]),r[a+=1].copy(It),a+=1}return this.geometry.verticesNeedUpdate=!0,this}),Ht.WireframeHelper=function(e,t){var r=void 0!==t?t:16777215,n=[0,0],i={},o=function(e,t){return e-t},a=["a","b","c"],s=new Ht.BufferGeometry;if(e.geometry instanceof Ht.Geometry){for(var l=e.geometry.vertices,h=e.geometry.faces,c=0,u=new Uint32Array(6*h.length),d=0,f=h.length;d<f;d++)for(var p=h[d],m=0;m<3;m++)n[0]=p[a[m]],n[1]=p[a[(m+1)%3]],n.sort(o),void 0===i[C=n.toString()]&&(u[2*c]=n[0],u[2*c+1]=n[1],i[C]=!0,c++);var g=new Float32Array(2*c*3);for(d=0,f=c;d<f;d++)for(m=0;m<2;m++){var v=l[u[2*d+m]];g[0+(S=6*d+3*m)]=v.x,g[S+1]=v.y,g[S+2]=v.z}s.addAttribute("position",new Ht.BufferAttribute(g,3))}else if(e.geometry instanceof Ht.BufferGeometry)if(void 0!==e.geometry.attributes.index){l=e.geometry.attributes.position.array;var y=e.geometry.attributes.index.array,x=e.geometry.drawcalls;c=0,0===x.length&&(x=[{count:y.length,index:0,start:0}]),u=new Uint32Array(2*y.length);for(var b=0,_=x.length;b<_;++b)for(var w=x[b].start,M=x[b].count,S=x[b].index,T=(d=w,w+M);d<T;d+=3)for(m=0;m<3;m++){var C;n[0]=S+y[d+m],n[1]=S+y[d+(m+1)%3],n.sort(o),void 0===i[C=n.toString()]&&(u[2*c]=n[0],u[2*c+1]=n[1],i[C]=!0,c++)}for(g=new Float32Array(2*c*3),d=0,f=c;d<f;d++)for(m=0;m<2;m++){S=6*d+3*m;var E=3*u[2*d+m];g[S+0]=l[E],g[S+1]=l[E+1],g[S+2]=l[E+2]}s.addAttribute("position",new Ht.BufferAttribute(g,3))}else{var A=(c=(l=e.geometry.attributes.position.array).length/3)/3;for(g=new Float32Array(2*c*3),d=0,f=A;d<f;d++)for(m=0;m<3;m++){var L=9*d+3*m;g[0+(S=18*d+6*m)]=l[L],g[S+1]=l[L+1],g[S+2]=l[L+2],E=9*d+(m+1)%3*3,g[S+3]=l[E],g[S+4]=l[E+1],g[S+5]=l[E+2]}s.addAttribute("position",new Ht.BufferAttribute(g,3))}Ht.Line.call(this,s,new Ht.LineBasicMaterial({color:r}),Ht.LinePieces),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1},Ht.WireframeHelper.prototype=Object.create(Ht.Line.prototype),Ht.ImmediateRenderObject=function(){Ht.Object3D.call(this),this.render=function(e){}},Ht.ImmediateRenderObject.prototype=Object.create(Ht.Object3D.prototype),Ht.MorphBlendMesh=function(e,t){Ht.Mesh.call(this,e,t),this.animationsMap={},this.animationsList=[];var r=this.geometry.morphTargets.length,n=r-1,i=r/1;this.createAnimation("__default",0,n,i),this.setAnimationWeight("__default",1)},Ht.MorphBlendMesh.prototype=Object.create(Ht.Mesh.prototype),Ht.MorphBlendMesh.prototype.createAnimation=function(e,t,r,n){var i={startFrame:t,endFrame:r,length:r-t+1,fps:n,duration:(r-t)/n,lastFrame:0,currentFrame:0,active:!1,time:0,direction:1,weight:1,directionBackwards:!1,mirroredLoop:!1};this.animationsMap[e]=i,this.animationsList.push(i)},Ht.MorphBlendMesh.prototype.autoCreateAnimations=function(e){for(var t,r=/([a-z]+)_?(\d+)/,n={},i=this.geometry,o=0,a=i.morphTargets.length;o<a;o++){var s=i.morphTargets[o].name.match(r);if(s&&1<s.length){var l=s[1];s[2],n[l]||(n[l]={start:1/0,end:-1/0}),o<(h=n[l]).start&&(h.start=o),o>h.end&&(h.end=o),t||(t=l)}}for(var l in n){var h=n[l];this.createAnimation(l,h.start,h.end,e)}this.firstAnimation=t},Ht.MorphBlendMesh.prototype.setAnimationDirectionForward=function(e){var t=this.animationsMap[e];t&&(t.direction=1,t.directionBackwards=!1)},Ht.MorphBlendMesh.prototype.setAnimationDirectionBackward=function(e){var t=this.animationsMap[e];t&&(t.direction=-1,t.directionBackwards=!0)},Ht.MorphBlendMesh.prototype.setAnimationFPS=function(e,t){var r=this.animationsMap[e];r&&(r.fps=t,r.duration=(r.end-r.start)/r.fps)},Ht.MorphBlendMesh.prototype.setAnimationDuration=function(e,t){var r=this.animationsMap[e];r&&(r.duration=t,r.fps=(r.end-r.start)/r.duration)},Ht.MorphBlendMesh.prototype.setAnimationWeight=function(e,t){var r=this.animationsMap[e];r&&(r.weight=t)},Ht.MorphBlendMesh.prototype.setAnimationTime=function(e,t){var r=this.animationsMap[e];r&&(r.time=t)},Ht.MorphBlendMesh.prototype.getAnimationTime=function(e){var t=0,r=this.animationsMap[e];return r&&(t=r.time),t},Ht.MorphBlendMesh.prototype.getAnimationDuration=function(e){var t=-1,r=this.animationsMap[e];return r&&(t=r.duration),t},Ht.MorphBlendMesh.prototype.playAnimation=function(e){var t=this.animationsMap[e];t?(t.time=0,t.active=!0):console.warn("animation["+e+"] undefined")},Ht.MorphBlendMesh.prototype.stopAnimation=function(e){var t=this.animationsMap[e];t&&(t.active=!1)},Ht.MorphBlendMesh.prototype.update=function(e){for(var t=0,r=this.animationsList.length;t<r;t++){var n=this.animationsList[t];if(n.active){var i=n.duration/n.length;n.time+=n.direction*e,n.mirroredLoop?(n.time>n.duration||n.time<0)&&(n.direction*=-1,n.time>n.duration&&(n.time=n.duration,n.directionBackwards=!0),n.time<0&&(n.time=0,n.directionBackwards=!1)):(n.time=n.time%n.duration,n.time<0&&(n.time+=n.duration));var o=n.startFrame+Ht.Math.clamp(Math.floor(n.time/i),0,n.length-1),a=n.weight;o!==n.currentFrame&&(this.morphTargetInfluences[n.lastFrame]=0,this.morphTargetInfluences[n.currentFrame]=1*a,this.morphTargetInfluences[o]=0,n.lastFrame=n.currentFrame,n.currentFrame=o);var s=n.time%i/i;n.directionBackwards&&(s=1-s),this.morphTargetInfluences[n.currentFrame]=s*a,this.morphTargetInfluences[n.lastFrame]=(1-s)*a}}},e.exports=Ht}).call(this,r(1)(e))},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t,r){r(3);var n=r(8),i=r(0),o=r(9).default,a=r(10).default;n(function(){var e=new i.Scene,t=new i.PerspectiveCamera(45,window.innerWidth/window.innerHeight,.1,1e3),r=new i.WebGLRenderer;r.setClearColor(new i.Color(15658734,1)),r.setSize(window.innerWidth,window.innerHeight),r.shadowMapEnabled=!0;var s,l=((s=new o).setMode(0),s.domElement.style.position="absolute",s.domElement.style.left="0px",s.domElement.style.top="0px",n("#Stats-output").append(s.domElement),s),h=[new i.Vector3(1,3,1),new i.Vector3(1,3,-1),new i.Vector3(1,-1,1),new i.Vector3(1,-1,-1),new i.Vector3(-1,3,-1),new i.Vector3(-1,3,1),new i.Vector3(-1,-1,-1),new i.Vector3(-1,-1,1)],c=[new i.Face3(0,2,1),new i.Face3(2,3,1),new i.Face3(4,6,5),new i.Face3(6,7,5),new i.Face3(4,5,1),new i.Face3(5,0,1),new i.Face3(7,6,2),new i.Face3(6,3,2),new i.Face3(5,7,0),new i.Face3(7,2,0),new i.Face3(1,3,4),new i.Face3(3,6,4)],u=new i.Geometry;u.vertices=h,u.faces=c,u.computeFaceNormals();var d=[new i.MeshLambertMaterial({opacity:.6,color:4521796,transparent:!0}),new i.MeshBasicMaterial({color:0,wireframe:!0})],f=i.SceneUtils.createMultiMaterialObject(u,d);function p(e,t,r){return new function(){this.x=e,this.y=t,this.z=r}}f.children.forEach(function(e){e.castShadow=!0}),e.add(f);var m=[];m.push(p(3,5,3)),m.push(p(3,5,0)),m.push(p(3,0,3)),m.push(p(3,0,0)),m.push(p(0,5,0)),m.push(p(0,5,3)),m.push(p(0,0,0)),m.push(p(0,0,3));var g=new a.GUI;g.add({clone:function(){var t=f.children[0].geometry.clone(),r=[new i.MeshLambertMaterial({opacity:.6,color:16729343,transparent:!0}),new i.MeshBasicMaterial({color:0,wireframe:!0})],n=i.SceneUtils.createMultiMaterialObject(t,r);n.children.forEach(function(e){e.castShadow=!0}),n.translateX(5),n.translateZ(5),n.name="clone",e.remove(e.getObjectByName("clone")),e.add(n)}},"clone");for(var v=0;v<m.length;v++)f1=g.addFolder("Vertices"+(v+1)),f1.add(m[v],"x",-10,10),f1.add(m[v],"y",-10,10),f1.add(m[v],"z",-10,10);var y=new i.PlaneGeometry(60,40,1,1),x=new i.MeshLambertMaterial({color:16777215}),b=new i.Mesh(y,x);b.rotation.x=-.5*Math.PI,b.position.x=0,b.position.y=0,b.position.z=0,b.receiveShadow=!0,e.add(b);var _=new i.SpotLight(16777215);_.position.set(-40,60,-10),_.castShadow=!0,e.add(_);var w=new i.AmbientLight(789516);e.add(w),t.position.x=-20,t.position.y=25,t.position.z=20,t.lookAt(e.position),e.add(t),n("#WebGL-output").append(r.domElement),function n(){l.update();for(var o=[],a=0;a<m.length;a++)o.push(new i.Vector3(m[a].x,m[a].y,m[a].z));f.children.forEach(function(e){e.geometry.vertices=o,e.geometry.verticesNeedUpdate=!0,e.geometry.computeFaceNormals()}),requestAnimationFrame(n),r.render(e,t)}()})},function(e,t,r){var n=r(4);"string"==typeof n&&(n=[[e.i,n,""]]);r(6)(n,{hmr:!0,transform:void 0,insertInto:void 0}),n.locals&&(e.exports=n.locals)},function(e,t,r){(e.exports=r(5)(!1)).push([e.i,"body,html{\n\tmargin:0;\n\theight: 100%;\n}",""])},function(e,t){e.exports=function(e){var t=[];return t.toString=function(){return this.map(function(t){var r=function(e,t){var r,n=e[1]||"",i=e[3];if(!i)return n;if(t&&"function"==typeof btoa){var o=(r=i,"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(r))))+" */"),a=i.sources.map(function(e){return"/*# sourceURL="+i.sourceRoot+e+" */"});return[n].concat(a).concat([o]).join("\n")}return[n].join("\n")}(t,e);return t[2]?"@media "+t[2]+"{"+r+"}":r}).join("")},t.i=function(e,r){"string"==typeof e&&(e=[[null,e,""]]);for(var n={},i=0;i<this.length;i++){var o=this[i][0];"number"==typeof o&&(n[o]=!0)}for(i=0;i<e.length;i++){var a=e[i];"number"==typeof a[0]&&n[a[0]]||(r&&!a[2]?a[2]=r:r&&(a[2]="("+a[2]+") and ("+r+")"),t.push(a))}},t}},function(e,t,r){var n,i,o,a={},s=(n=function(){return window&&document&&document.all&&!window.atob},function(){return void 0===i&&(i=n.apply(this,arguments)),i}),l=(o={},function(e,t){if("function"==typeof e)return e();if(void 0===o[e]){var r=function(e,t){return t?t.querySelector(e):document.querySelector(e)}.call(this,e,t);if(window.HTMLIFrameElement&&r instanceof window.HTMLIFrameElement)try{r=r.contentDocument.head}catch(e){r=null}o[e]=r}return o[e]}),h=null,c=0,u=[],d=r(7);function f(e,t){for(var r=0;r<e.length;r++){var n=e[r],i=a[n.id];if(i){i.refs++;for(var o=0;o<i.parts.length;o++)i.parts[o](n.parts[o]);for(;o<n.parts.length;o++)i.parts.push(x(n.parts[o],t))}else{var s=[];for(o=0;o<n.parts.length;o++)s.push(x(n.parts[o],t));a[n.id]={id:n.id,refs:1,parts:s}}}}function p(e,t){for(var r=[],n={},i=0;i<e.length;i++){var o=e[i],a=t.base?o[0]+t.base:o[0],s={css:o[1],media:o[2],sourceMap:o[3]};n[a]?n[a].parts.push(s):r.push(n[a]={id:a,parts:[s]})}return r}function m(e,t){var r=l(e.insertInto);if(!r)throw new Error("Couldn't find a style target. This probably means that the value for the 'insertInto' parameter is invalid.");var n=u[u.length-1];if("top"===e.insertAt)n?n.nextSibling?r.insertBefore(t,n.nextSibling):r.appendChild(t):r.insertBefore(t,r.firstChild),u.push(t);else if("bottom"===e.insertAt)r.appendChild(t);else{if("object"!=typeof e.insertAt||!e.insertAt.before)throw new Error("[Style Loader]\n\n Invalid value for parameter 'insertAt' ('options.insertAt') found.\n Must be 'top', 'bottom', or Object.\n (https://github.com/webpack-contrib/style-loader#insertat)\n");var i=l(e.insertAt.before,r);r.insertBefore(t,i)}}function g(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e);var t=u.indexOf(e);0<=t&&u.splice(t,1)}function v(e){var t=document.createElement("style");if(void 0===e.attrs.type&&(e.attrs.type="text/css"),void 0===e.attrs.nonce){var n=r.nc;n&&(e.attrs.nonce=n)}return y(t,e.attrs),m(e,t),t}function y(e,t){Object.keys(t).forEach(function(r){e.setAttribute(r,t[r])})}function x(e,t){var r,n,i,o,a,s;if(t.transform&&e.css){if(!(o="function"==typeof t.transform?t.transform(e.css):t.transform.default(e.css)))return function(){};e.css=o}if(t.singleton){var l=c++;r=h||(h=v(t)),n=w.bind(null,r,l,!1),i=w.bind(null,r,l,!0)}else i=e.sourceMap&&"function"==typeof URL&&"function"==typeof URL.createObjectURL&&"function"==typeof URL.revokeObjectURL&&"function"==typeof Blob&&"function"==typeof btoa?(a=t,s=document.createElement("link"),void 0===a.attrs.type&&(a.attrs.type="text/css"),a.attrs.rel="stylesheet",y(s,a.attrs),m(a,s),n=function(e,t,r){var n=r.css,i=r.sourceMap,o=void 0===t.convertToAbsoluteUrls&&i;(t.convertToAbsoluteUrls||o)&&(n=d(n)),i&&(n+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(i))))+" */");var a=new Blob([n],{type:"text/css"}),s=e.href;e.href=URL.createObjectURL(a),s&&URL.revokeObjectURL(s)}.bind(null,r=s,t),function(){g(r),r.href&&URL.revokeObjectURL(r.href)}):(r=v(t),n=function(e,t){var r=t.css,n=t.media;if(n&&e.setAttribute("media",n),e.styleSheet)e.styleSheet.cssText=r;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(r))}}.bind(null,r),function(){g(r)});return n(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;n(e=t)}else i()}}e.exports=function(e,t){if("undefined"!=typeof DEBUG&&DEBUG&&"object"!=typeof document)throw new Error("The style-loader cannot be used in a non-browser environment");(t=t||{}).attrs="object"==typeof t.attrs?t.attrs:{},t.singleton||"boolean"==typeof t.singleton||(t.singleton=s()),t.insertInto||(t.insertInto="head"),t.insertAt||(t.insertAt="bottom");var r=p(e,t);return f(r,t),function(e){for(var n=[],i=0;i<r.length;i++){var o=r[i];(s=a[o.id]).refs--,n.push(s)}for(e&&f(p(e,t),t),i=0;i<n.length;i++){var s;if(0===(s=n[i]).refs){for(var l=0;l<s.parts.length;l++)s.parts[l]();delete a[s.id]}}}};var b,_=(b=[],function(e,t){return b[e]=t,b.filter(Boolean).join("\n")});function w(e,t,r,n){var i=r?"":n.css;if(e.styleSheet)e.styleSheet.cssText=_(t,i);else{var o=document.createTextNode(i),a=e.childNodes;a[t]&&e.removeChild(a[t]),a.length?e.insertBefore(o,a[t]):e.appendChild(o)}}},function(e,t){e.exports=function(e){var t="undefined"!=typeof window&&window.location;if(!t)throw new Error("fixUrls requires window.location");if(!e||"string"!=typeof e)return e;var r=t.protocol+"//"+t.host,n=r+t.pathname.replace(/\/[^\/]*$/,"/");return e.replace(/url\s*\(((?:[^)(]|\((?:[^)(]+|\([^)(]*\))*\))*)\)/gi,function(e,t){var i,o=t.trim().replace(/^"(.*)"$/,function(e,t){return t}).replace(/^'(.*)'$/,function(e,t){return t});return/^(#|data:|http:\/\/|https:\/\/|file:\/\/\/|\s*$)/i.test(o)?e:(i=0===o.indexOf("//")?o:0===o.indexOf("/")?r+o:n+o.replace(/^\.\//,""),"url("+JSON.stringify(i)+")")})}},function(e,t,r){var n;
/*!
 * jQuery JavaScript Library v3.3.1
 * https://jquery.com/
 *
 * Includes Sizzle.js
 * https://sizzlejs.com/
 *
 * Copyright JS Foundation and other contributors
 * Released under the MIT license
 * https://jquery.org/license
 *
 * Date: 2018-01-20T17:24Z
 */
/*!
 * jQuery JavaScript Library v3.3.1
 * https://jquery.com/
 *
 * Includes Sizzle.js
 * https://sizzlejs.com/
 *
 * Copyright JS Foundation and other contributors
 * Released under the MIT license
 * https://jquery.org/license
 *
 * Date: 2018-01-20T17:24Z
 */!function(t,r){"use strict";"object"==typeof e&&"object"==typeof e.exports?e.exports=t.document?r(t,!0):function(e){if(!e.document)throw new Error("jQuery requires a window with a document");return r(e)}:r(t)}("undefined"!=typeof window?window:this,function(r,i){"use strict";var o=[],a=r.document,s=Object.getPrototypeOf,l=o.slice,h=o.concat,c=o.push,u=o.indexOf,d={},f=d.toString,p=d.hasOwnProperty,m=p.toString,g=m.call(Object),v={},y=function(e){return"function"==typeof e&&"number"!=typeof e.nodeType},x=function(e){return null!=e&&e===e.window},b={type:!0,src:!0,noModule:!0};function _(e,t,r){var n,i=(t=t||a).createElement("script");if(i.text=e,r)for(n in b)r[n]&&(i[n]=r[n]);t.head.appendChild(i).parentNode.removeChild(i)}function w(e){return null==e?e+"":"object"==typeof e||"function"==typeof e?d[f.call(e)]||"object":typeof e}var M=function(e,t){return new M.fn.init(e,t)},S=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g;function T(e){var t=!!e&&"length"in e&&e.length,r=w(e);return!y(e)&&!x(e)&&("array"===r||0===t||"number"==typeof t&&0<t&&t-1 in e)}M.fn=M.prototype={jquery:"3.3.1",constructor:M,length:0,toArray:function(){return l.call(this)},get:function(e){return null==e?l.call(this):e<0?this[e+this.length]:this[e]},pushStack:function(e){var t=M.merge(this.constructor(),e);return t.prevObject=this,t},each:function(e){return M.each(this,e)},map:function(e){return this.pushStack(M.map(this,function(t,r){return e.call(t,r,t)}))},slice:function(){return this.pushStack(l.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(e){var t=this.length,r=+e+(e<0?t:0);return this.pushStack(0<=r&&r<t?[this[r]]:[])},end:function(){return this.prevObject||this.constructor()},push:c,sort:o.sort,splice:o.splice},M.extend=M.fn.extend=function(){var e,t,r,n,i,o,a=arguments[0]||{},s=1,l=arguments.length,h=!1;for("boolean"==typeof a&&(h=a,a=arguments[s]||{},s++),"object"==typeof a||y(a)||(a={}),s===l&&(a=this,s--);s<l;s++)if(null!=(e=arguments[s]))for(t in e)r=a[t],a!==(n=e[t])&&(h&&n&&(M.isPlainObject(n)||(i=Array.isArray(n)))?(o=i?(i=!1,r&&Array.isArray(r)?r:[]):r&&M.isPlainObject(r)?r:{},a[t]=M.extend(h,o,n)):void 0!==n&&(a[t]=n));return a},M.extend({expando:"jQuery"+("3.3.1"+Math.random()).replace(/\D/g,""),isReady:!0,error:function(e){throw new Error(e)},noop:function(){},isPlainObject:function(e){var t,r;return!(!e||"[object Object]"!==f.call(e)||(t=s(e))&&("function"!=typeof(r=p.call(t,"constructor")&&t.constructor)||m.call(r)!==g))},isEmptyObject:function(e){var t;for(t in e)return!1;return!0},globalEval:function(e){_(e)},each:function(e,t){var r,n=0;if(T(e))for(r=e.length;n<r&&!1!==t.call(e[n],n,e[n]);n++);else for(n in e)if(!1===t.call(e[n],n,e[n]))break;return e},trim:function(e){return null==e?"":(e+"").replace(S,"")},makeArray:function(e,t){var r=t||[];return null!=e&&(T(Object(e))?M.merge(r,"string"==typeof e?[e]:e):c.call(r,e)),r},inArray:function(e,t,r){return null==t?-1:u.call(t,e,r)},merge:function(e,t){for(var r=+t.length,n=0,i=e.length;n<r;n++)e[i++]=t[n];return e.length=i,e},grep:function(e,t,r){for(var n=[],i=0,o=e.length,a=!r;i<o;i++)!t(e[i],i)!==a&&n.push(e[i]);return n},map:function(e,t,r){var n,i,o=0,a=[];if(T(e))for(n=e.length;o<n;o++)null!=(i=t(e[o],o,r))&&a.push(i);else for(o in e)null!=(i=t(e[o],o,r))&&a.push(i);return h.apply([],a)},guid:1,support:v}),"function"==typeof Symbol&&(M.fn[Symbol.iterator]=o[Symbol.iterator]),M.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),function(e,t){d["[object "+t+"]"]=t.toLowerCase()});var C=
/*!
 * Sizzle CSS Selector Engine v2.3.3
 * https://sizzlejs.com/
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license
 * http://jquery.org/license
 *
 * Date: 2016-08-08
 */
function(e){var t,r,n,i,o,a,s,l,h,c,u,d,f,p,m,g,v,y,x,b="sizzle"+1*new Date,_=e.document,w=0,M=0,S=ae(),T=ae(),C=ae(),E=function(e,t){return e===t&&(u=!0),0},A={}.hasOwnProperty,L=[],P=L.pop,D=L.push,R=L.push,k=L.slice,F=function(e,t){for(var r=0,n=e.length;r<n;r++)if(e[r]===t)return r;return-1},U="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",N="[\\x20\\t\\r\\n\\f]",B="(?:\\\\.|[\\w-]|[^\0-\\xa0])+",V="\\["+N+"*("+B+")(?:"+N+"*([*^$|!~]?=)"+N+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+B+"))|)"+N+"*\\]",z=":("+B+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+V+")*)|.*)\\)|)",O=new RegExp(N+"+","g"),I=new RegExp("^"+N+"+|((?:^|[^\\\\])(?:\\\\.)*)"+N+"+$","g"),H=new RegExp("^"+N+"*,"+N+"*"),G=new RegExp("^"+N+"*([>+~]|"+N+")"+N+"*"),W=new RegExp("="+N+"*([^\\]'\"]*?)"+N+"*\\]","g"),j=new RegExp(z),X=new RegExp("^"+B+"$"),q={ID:new RegExp("^#("+B+")"),CLASS:new RegExp("^\\.("+B+")"),TAG:new RegExp("^("+B+"|[*])"),ATTR:new RegExp("^"+V),PSEUDO:new RegExp("^"+z),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+N+"*(even|odd|(([+-]|)(\\d*)n|)"+N+"*(?:([+-]|)"+N+"*(\\d+)|))"+N+"*\\)|)","i"),bool:new RegExp("^(?:"+U+")$","i"),needsContext:new RegExp("^"+N+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+N+"*((?:-\\d)?\\d*)"+N+"*\\)|)(?=[^-]|$)","i")},Y=/^(?:input|select|textarea|button)$/i,K=/^h\d$/i,Q=/^[^{]+\{\s*\[native \w/,Z=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,$=/[+~]/,J=new RegExp("\\\\([\\da-f]{1,6}"+N+"?|("+N+")|.)","ig"),ee=function(e,t,r){var n="0x"+t-65536;return n!=n||r?t:n<0?String.fromCharCode(n+65536):String.fromCharCode(n>>10|55296,1023&n|56320)},te=/([\0-\x1f\x7f]|^-?\d)|^-$|[^\0-\x1f\x7f-\uFFFF\w-]/g,re=function(e,t){return t?"\0"===e?"�":e.slice(0,-1)+"\\"+e.charCodeAt(e.length-1).toString(16)+" ":"\\"+e},ne=function(){d()},ie=ye(function(e){return!0===e.disabled&&("form"in e||"label"in e)},{dir:"parentNode",next:"legend"});try{R.apply(L=k.call(_.childNodes),_.childNodes),L[_.childNodes.length].nodeType}catch(t){R={apply:L.length?function(e,t){D.apply(e,k.call(t))}:function(e,t){for(var r=e.length,n=0;e[r++]=t[n++];);e.length=r-1}}}function oe(e,t,n,i){var o,s,h,c,u,p,v,y=t&&t.ownerDocument,w=t?t.nodeType:9;if(n=n||[],"string"!=typeof e||!e||1!==w&&9!==w&&11!==w)return n;if(!i&&((t?t.ownerDocument||t:_)!==f&&d(t),t=t||f,m)){if(11!==w&&(u=Z.exec(e)))if(o=u[1]){if(9===w){if(!(h=t.getElementById(o)))return n;if(h.id===o)return n.push(h),n}else if(y&&(h=y.getElementById(o))&&x(t,h)&&h.id===o)return n.push(h),n}else{if(u[2])return R.apply(n,t.getElementsByTagName(e)),n;if((o=u[3])&&r.getElementsByClassName&&t.getElementsByClassName)return R.apply(n,t.getElementsByClassName(o)),n}if(r.qsa&&!C[e+" "]&&(!g||!g.test(e))){if(1!==w)y=t,v=e;else if("object"!==t.nodeName.toLowerCase()){for((c=t.getAttribute("id"))?c=c.replace(te,re):t.setAttribute("id",c=b),s=(p=a(e)).length;s--;)p[s]="#"+c+" "+ve(p[s]);v=p.join(","),y=$.test(e)&&me(t.parentNode)||t}if(v)try{return R.apply(n,y.querySelectorAll(v)),n}catch(e){}finally{c===b&&t.removeAttribute("id")}}}return l(e.replace(I,"$1"),t,n,i)}function ae(){var e=[];return function t(r,i){return e.push(r+" ")>n.cacheLength&&delete t[e.shift()],t[r+" "]=i}}function se(e){return e[b]=!0,e}function le(e){var t=f.createElement("fieldset");try{return!!e(t)}catch(e){return!1}finally{t.parentNode&&t.parentNode.removeChild(t),t=null}}function he(e,t){for(var r=e.split("|"),i=r.length;i--;)n.attrHandle[r[i]]=t}function ce(e,t){var r=t&&e,n=r&&1===e.nodeType&&1===t.nodeType&&e.sourceIndex-t.sourceIndex;if(n)return n;if(r)for(;r=r.nextSibling;)if(r===t)return-1;return e?1:-1}function ue(e){return function(t){return"input"===t.nodeName.toLowerCase()&&t.type===e}}function de(e){return function(t){var r=t.nodeName.toLowerCase();return("input"===r||"button"===r)&&t.type===e}}function fe(e){return function(t){return"form"in t?t.parentNode&&!1===t.disabled?"label"in t?"label"in t.parentNode?t.parentNode.disabled===e:t.disabled===e:t.isDisabled===e||t.isDisabled!==!e&&ie(t)===e:t.disabled===e:"label"in t&&t.disabled===e}}function pe(e){return se(function(t){return t=+t,se(function(r,n){for(var i,o=e([],r.length,t),a=o.length;a--;)r[i=o[a]]&&(r[i]=!(n[i]=r[i]))})})}function me(e){return e&&void 0!==e.getElementsByTagName&&e}for(t in r=oe.support={},o=oe.isXML=function(e){var t=e&&(e.ownerDocument||e).documentElement;return!!t&&"HTML"!==t.nodeName},d=oe.setDocument=function(e){var t,i,a=e?e.ownerDocument||e:_;return a!==f&&9===a.nodeType&&a.documentElement&&(p=(f=a).documentElement,m=!o(f),_!==f&&(i=f.defaultView)&&i.top!==i&&(i.addEventListener?i.addEventListener("unload",ne,!1):i.attachEvent&&i.attachEvent("onunload",ne)),r.attributes=le(function(e){return e.className="i",!e.getAttribute("className")}),r.getElementsByTagName=le(function(e){return e.appendChild(f.createComment("")),!e.getElementsByTagName("*").length}),r.getElementsByClassName=Q.test(f.getElementsByClassName),r.getById=le(function(e){return p.appendChild(e).id=b,!f.getElementsByName||!f.getElementsByName(b).length}),r.getById?(n.filter.ID=function(e){var t=e.replace(J,ee);return function(e){return e.getAttribute("id")===t}},n.find.ID=function(e,t){if(void 0!==t.getElementById&&m){var r=t.getElementById(e);return r?[r]:[]}}):(n.filter.ID=function(e){var t=e.replace(J,ee);return function(e){var r=void 0!==e.getAttributeNode&&e.getAttributeNode("id");return r&&r.value===t}},n.find.ID=function(e,t){if(void 0!==t.getElementById&&m){var r,n,i,o=t.getElementById(e);if(o){if((r=o.getAttributeNode("id"))&&r.value===e)return[o];for(i=t.getElementsByName(e),n=0;o=i[n++];)if((r=o.getAttributeNode("id"))&&r.value===e)return[o]}return[]}}),n.find.TAG=r.getElementsByTagName?function(e,t){return void 0!==t.getElementsByTagName?t.getElementsByTagName(e):r.qsa?t.querySelectorAll(e):void 0}:function(e,t){var r,n=[],i=0,o=t.getElementsByTagName(e);if("*"!==e)return o;for(;r=o[i++];)1===r.nodeType&&n.push(r);return n},n.find.CLASS=r.getElementsByClassName&&function(e,t){if(void 0!==t.getElementsByClassName&&m)return t.getElementsByClassName(e)},v=[],g=[],(r.qsa=Q.test(f.querySelectorAll))&&(le(function(e){p.appendChild(e).innerHTML="<a id='"+b+"'></a><select id='"+b+"-\r\\' msallowcapture=''><option selected=''></option></select>",e.querySelectorAll("[msallowcapture^='']").length&&g.push("[*^$]="+N+"*(?:''|\"\")"),e.querySelectorAll("[selected]").length||g.push("\\["+N+"*(?:value|"+U+")"),e.querySelectorAll("[id~="+b+"-]").length||g.push("~="),e.querySelectorAll(":checked").length||g.push(":checked"),e.querySelectorAll("a#"+b+"+*").length||g.push(".#.+[+~]")}),le(function(e){e.innerHTML="<a href='' disabled='disabled'></a><select disabled='disabled'><option/></select>";var t=f.createElement("input");t.setAttribute("type","hidden"),e.appendChild(t).setAttribute("name","D"),e.querySelectorAll("[name=d]").length&&g.push("name"+N+"*[*^$|!~]?="),2!==e.querySelectorAll(":enabled").length&&g.push(":enabled",":disabled"),p.appendChild(e).disabled=!0,2!==e.querySelectorAll(":disabled").length&&g.push(":enabled",":disabled"),e.querySelectorAll("*,:x"),g.push(",.*:")})),(r.matchesSelector=Q.test(y=p.matches||p.webkitMatchesSelector||p.mozMatchesSelector||p.oMatchesSelector||p.msMatchesSelector))&&le(function(e){r.disconnectedMatch=y.call(e,"*"),y.call(e,"[s!='']:x"),v.push("!=",z)}),g=g.length&&new RegExp(g.join("|")),v=v.length&&new RegExp(v.join("|")),t=Q.test(p.compareDocumentPosition),x=t||Q.test(p.contains)?function(e,t){var r=9===e.nodeType?e.documentElement:e,n=t&&t.parentNode;return e===n||!(!n||1!==n.nodeType||!(r.contains?r.contains(n):e.compareDocumentPosition&&16&e.compareDocumentPosition(n)))}:function(e,t){if(t)for(;t=t.parentNode;)if(t===e)return!0;return!1},E=t?function(e,t){if(e===t)return u=!0,0;var n=!e.compareDocumentPosition-!t.compareDocumentPosition;return n||(1&(n=(e.ownerDocument||e)===(t.ownerDocument||t)?e.compareDocumentPosition(t):1)||!r.sortDetached&&t.compareDocumentPosition(e)===n?e===f||e.ownerDocument===_&&x(_,e)?-1:t===f||t.ownerDocument===_&&x(_,t)?1:c?F(c,e)-F(c,t):0:4&n?-1:1)}:function(e,t){if(e===t)return u=!0,0;var r,n=0,i=e.parentNode,o=t.parentNode,a=[e],s=[t];if(!i||!o)return e===f?-1:t===f?1:i?-1:o?1:c?F(c,e)-F(c,t):0;if(i===o)return ce(e,t);for(r=e;r=r.parentNode;)a.unshift(r);for(r=t;r=r.parentNode;)s.unshift(r);for(;a[n]===s[n];)n++;return n?ce(a[n],s[n]):a[n]===_?-1:s[n]===_?1:0}),f},oe.matches=function(e,t){return oe(e,null,null,t)},oe.matchesSelector=function(e,t){if((e.ownerDocument||e)!==f&&d(e),t=t.replace(W,"='$1']"),r.matchesSelector&&m&&!C[t+" "]&&(!v||!v.test(t))&&(!g||!g.test(t)))try{var n=y.call(e,t);if(n||r.disconnectedMatch||e.document&&11!==e.document.nodeType)return n}catch(e){}return 0<oe(t,f,null,[e]).length},oe.contains=function(e,t){return(e.ownerDocument||e)!==f&&d(e),x(e,t)},oe.attr=function(e,t){(e.ownerDocument||e)!==f&&d(e);var i=n.attrHandle[t.toLowerCase()],o=i&&A.call(n.attrHandle,t.toLowerCase())?i(e,t,!m):void 0;return void 0!==o?o:r.attributes||!m?e.getAttribute(t):(o=e.getAttributeNode(t))&&o.specified?o.value:null},oe.escape=function(e){return(e+"").replace(te,re)},oe.error=function(e){throw new Error("Syntax error, unrecognized expression: "+e)},oe.uniqueSort=function(e){var t,n=[],i=0,o=0;if(u=!r.detectDuplicates,c=!r.sortStable&&e.slice(0),e.sort(E),u){for(;t=e[o++];)t===e[o]&&(i=n.push(o));for(;i--;)e.splice(n[i],1)}return c=null,e},i=oe.getText=function(e){var t,r="",n=0,o=e.nodeType;if(o){if(1===o||9===o||11===o){if("string"==typeof e.textContent)return e.textContent;for(e=e.firstChild;e;e=e.nextSibling)r+=i(e)}else if(3===o||4===o)return e.nodeValue}else for(;t=e[n++];)r+=i(t);return r},(n=oe.selectors={cacheLength:50,createPseudo:se,match:q,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(J,ee),e[3]=(e[3]||e[4]||e[5]||"").replace(J,ee),"~="===e[2]&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),"nth"===e[1].slice(0,3)?(e[3]||oe.error(e[0]),e[4]=+(e[4]?e[5]+(e[6]||1):2*("even"===e[3]||"odd"===e[3])),e[5]=+(e[7]+e[8]||"odd"===e[3])):e[3]&&oe.error(e[0]),e},PSEUDO:function(e){var t,r=!e[6]&&e[2];return q.CHILD.test(e[0])?null:(e[3]?e[2]=e[4]||e[5]||"":r&&j.test(r)&&(t=a(r,!0))&&(t=r.indexOf(")",r.length-t)-r.length)&&(e[0]=e[0].slice(0,t),e[2]=r.slice(0,t)),e.slice(0,3))}},filter:{TAG:function(e){var t=e.replace(J,ee).toLowerCase();return"*"===e?function(){return!0}:function(e){return e.nodeName&&e.nodeName.toLowerCase()===t}},CLASS:function(e){var t=S[e+" "];return t||(t=new RegExp("(^|"+N+")"+e+"("+N+"|$)"))&&S(e,function(e){return t.test("string"==typeof e.className&&e.className||void 0!==e.getAttribute&&e.getAttribute("class")||"")})},ATTR:function(e,t,r){return function(n){var i=oe.attr(n,e);return null==i?"!="===t:!t||(i+="","="===t?i===r:"!="===t?i!==r:"^="===t?r&&0===i.indexOf(r):"*="===t?r&&-1<i.indexOf(r):"$="===t?r&&i.slice(-r.length)===r:"~="===t?-1<(" "+i.replace(O," ")+" ").indexOf(r):"|="===t&&(i===r||i.slice(0,r.length+1)===r+"-"))}},CHILD:function(e,t,r,n,i){var o="nth"!==e.slice(0,3),a="last"!==e.slice(-4),s="of-type"===t;return 1===n&&0===i?function(e){return!!e.parentNode}:function(t,r,l){var h,c,u,d,f,p,m=o!==a?"nextSibling":"previousSibling",g=t.parentNode,v=s&&t.nodeName.toLowerCase(),y=!l&&!s,x=!1;if(g){if(o){for(;m;){for(d=t;d=d[m];)if(s?d.nodeName.toLowerCase()===v:1===d.nodeType)return!1;p=m="only"===e&&!p&&"nextSibling"}return!0}if(p=[a?g.firstChild:g.lastChild],a&&y){for(x=(f=(h=(c=(u=(d=g)[b]||(d[b]={}))[d.uniqueID]||(u[d.uniqueID]={}))[e]||[])[0]===w&&h[1])&&h[2],d=f&&g.childNodes[f];d=++f&&d&&d[m]||(x=f=0)||p.pop();)if(1===d.nodeType&&++x&&d===t){c[e]=[w,f,x];break}}else if(y&&(x=f=(h=(c=(u=(d=t)[b]||(d[b]={}))[d.uniqueID]||(u[d.uniqueID]={}))[e]||[])[0]===w&&h[1]),!1===x)for(;(d=++f&&d&&d[m]||(x=f=0)||p.pop())&&((s?d.nodeName.toLowerCase()!==v:1!==d.nodeType)||!++x||(y&&((c=(u=d[b]||(d[b]={}))[d.uniqueID]||(u[d.uniqueID]={}))[e]=[w,x]),d!==t)););return(x-=i)===n||x%n==0&&0<=x/n}}},PSEUDO:function(e,t){var r,i=n.pseudos[e]||n.setFilters[e.toLowerCase()]||oe.error("unsupported pseudo: "+e);return i[b]?i(t):1<i.length?(r=[e,e,"",t],n.setFilters.hasOwnProperty(e.toLowerCase())?se(function(e,r){for(var n,o=i(e,t),a=o.length;a--;)e[n=F(e,o[a])]=!(r[n]=o[a])}):function(e){return i(e,0,r)}):i}},pseudos:{not:se(function(e){var t=[],r=[],n=s(e.replace(I,"$1"));return n[b]?se(function(e,t,r,i){for(var o,a=n(e,null,i,[]),s=e.length;s--;)(o=a[s])&&(e[s]=!(t[s]=o))}):function(e,i,o){return t[0]=e,n(t,null,o,r),t[0]=null,!r.pop()}}),has:se(function(e){return function(t){return 0<oe(e,t).length}}),contains:se(function(e){return e=e.replace(J,ee),function(t){return-1<(t.textContent||t.innerText||i(t)).indexOf(e)}}),lang:se(function(e){return X.test(e||"")||oe.error("unsupported lang: "+e),e=e.replace(J,ee).toLowerCase(),function(t){var r;do{if(r=m?t.lang:t.getAttribute("xml:lang")||t.getAttribute("lang"))return(r=r.toLowerCase())===e||0===r.indexOf(e+"-")}while((t=t.parentNode)&&1===t.nodeType);return!1}}),target:function(t){var r=e.location&&e.location.hash;return r&&r.slice(1)===t.id},root:function(e){return e===p},focus:function(e){return e===f.activeElement&&(!f.hasFocus||f.hasFocus())&&!!(e.type||e.href||~e.tabIndex)},enabled:fe(!1),disabled:fe(!0),checked:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&!!e.checked||"option"===t&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,!0===e.selected},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeType<6)return!1;return!0},parent:function(e){return!n.pseudos.empty(e)},header:function(e){return K.test(e.nodeName)},input:function(e){return Y.test(e.nodeName)},button:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&"button"===e.type||"button"===t},text:function(e){var t;return"input"===e.nodeName.toLowerCase()&&"text"===e.type&&(null==(t=e.getAttribute("type"))||"text"===t.toLowerCase())},first:pe(function(){return[0]}),last:pe(function(e,t){return[t-1]}),eq:pe(function(e,t,r){return[r<0?r+t:r]}),even:pe(function(e,t){for(var r=0;r<t;r+=2)e.push(r);return e}),odd:pe(function(e,t){for(var r=1;r<t;r+=2)e.push(r);return e}),lt:pe(function(e,t,r){for(var n=r<0?r+t:r;0<=--n;)e.push(n);return e}),gt:pe(function(e,t,r){for(var n=r<0?r+t:r;++n<t;)e.push(n);return e})}}).pseudos.nth=n.pseudos.eq,{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})n.pseudos[t]=ue(t);for(t in{submit:!0,reset:!0})n.pseudos[t]=de(t);function ge(){}function ve(e){for(var t=0,r=e.length,n="";t<r;t++)n+=e[t].value;return n}function ye(e,t,r){var n=t.dir,i=t.next,o=i||n,a=r&&"parentNode"===o,s=M++;return t.first?function(t,r,i){for(;t=t[n];)if(1===t.nodeType||a)return e(t,r,i);return!1}:function(t,r,l){var h,c,u,d=[w,s];if(l){for(;t=t[n];)if((1===t.nodeType||a)&&e(t,r,l))return!0}else for(;t=t[n];)if(1===t.nodeType||a)if(c=(u=t[b]||(t[b]={}))[t.uniqueID]||(u[t.uniqueID]={}),i&&i===t.nodeName.toLowerCase())t=t[n]||t;else{if((h=c[o])&&h[0]===w&&h[1]===s)return d[2]=h[2];if((c[o]=d)[2]=e(t,r,l))return!0}return!1}}function xe(e){return 1<e.length?function(t,r,n){for(var i=e.length;i--;)if(!e[i](t,r,n))return!1;return!0}:e[0]}function be(e,t,r,n,i){for(var o,a=[],s=0,l=e.length,h=null!=t;s<l;s++)(o=e[s])&&(r&&!r(o,n,i)||(a.push(o),h&&t.push(s)));return a}function _e(e,t,r,n,i,o){return n&&!n[b]&&(n=_e(n)),i&&!i[b]&&(i=_e(i,o)),se(function(o,a,s,l){var h,c,u,d=[],f=[],p=a.length,m=o||function(e,t,r){for(var n=0,i=t.length;n<i;n++)oe(e,t[n],r);return r}(t||"*",s.nodeType?[s]:s,[]),g=!e||!o&&t?m:be(m,d,e,s,l),v=r?i||(o?e:p||n)?[]:a:g;if(r&&r(g,v,s,l),n)for(h=be(v,f),n(h,[],s,l),c=h.length;c--;)(u=h[c])&&(v[f[c]]=!(g[f[c]]=u));if(o){if(i||e){if(i){for(h=[],c=v.length;c--;)(u=v[c])&&h.push(g[c]=u);i(null,v=[],h,l)}for(c=v.length;c--;)(u=v[c])&&-1<(h=i?F(o,u):d[c])&&(o[h]=!(a[h]=u))}}else v=be(v===a?v.splice(p,v.length):v),i?i(null,a,v,l):R.apply(a,v)})}function we(e){for(var t,r,i,o=e.length,a=n.relative[e[0].type],s=a||n.relative[" "],l=a?1:0,c=ye(function(e){return e===t},s,!0),u=ye(function(e){return-1<F(t,e)},s,!0),d=[function(e,r,n){var i=!a&&(n||r!==h)||((t=r).nodeType?c(e,r,n):u(e,r,n));return t=null,i}];l<o;l++)if(r=n.relative[e[l].type])d=[ye(xe(d),r)];else{if((r=n.filter[e[l].type].apply(null,e[l].matches))[b]){for(i=++l;i<o&&!n.relative[e[i].type];i++);return _e(1<l&&xe(d),1<l&&ve(e.slice(0,l-1).concat({value:" "===e[l-2].type?"*":""})).replace(I,"$1"),r,l<i&&we(e.slice(l,i)),i<o&&we(e=e.slice(i)),i<o&&ve(e))}d.push(r)}return xe(d)}return ge.prototype=n.filters=n.pseudos,n.setFilters=new ge,a=oe.tokenize=function(e,t){var r,i,o,a,s,l,h,c=T[e+" "];if(c)return t?0:c.slice(0);for(s=e,l=[],h=n.preFilter;s;){for(a in r&&!(i=H.exec(s))||(i&&(s=s.slice(i[0].length)||s),l.push(o=[])),r=!1,(i=G.exec(s))&&(r=i.shift(),o.push({value:r,type:i[0].replace(I," ")}),s=s.slice(r.length)),n.filter)!(i=q[a].exec(s))||h[a]&&!(i=h[a](i))||(r=i.shift(),o.push({value:r,type:a,matches:i}),s=s.slice(r.length));if(!r)break}return t?s.length:s?oe.error(e):T(e,l).slice(0)},s=oe.compile=function(e,t){var r,i,o,s,l,c,u=[],p=[],g=C[e+" "];if(!g){for(t||(t=a(e)),r=t.length;r--;)(g=we(t[r]))[b]?u.push(g):p.push(g);(g=C(e,(i=p,s=0<(o=u).length,l=0<i.length,c=function(e,t,r,a,c){var u,p,g,v=0,y="0",x=e&&[],b=[],_=h,M=e||l&&n.find.TAG("*",c),S=w+=null==_?1:Math.random()||.1,T=M.length;for(c&&(h=t===f||t||c);y!==T&&null!=(u=M[y]);y++){if(l&&u){for(p=0,t||u.ownerDocument===f||(d(u),r=!m);g=i[p++];)if(g(u,t||f,r)){a.push(u);break}c&&(w=S)}s&&((u=!g&&u)&&v--,e&&x.push(u))}if(v+=y,s&&y!==v){for(p=0;g=o[p++];)g(x,b,t,r);if(e){if(0<v)for(;y--;)x[y]||b[y]||(b[y]=P.call(a));b=be(b)}R.apply(a,b),c&&!e&&0<b.length&&1<v+o.length&&oe.uniqueSort(a)}return c&&(w=S,h=_),x},s?se(c):c))).selector=e}return g},l=oe.select=function(e,t,r,i){var o,l,h,c,u,d="function"==typeof e&&e,f=!i&&a(e=d.selector||e);if(r=r||[],1===f.length){if(2<(l=f[0]=f[0].slice(0)).length&&"ID"===(h=l[0]).type&&9===t.nodeType&&m&&n.relative[l[1].type]){if(!(t=(n.find.ID(h.matches[0].replace(J,ee),t)||[])[0]))return r;d&&(t=t.parentNode),e=e.slice(l.shift().value.length)}for(o=q.needsContext.test(e)?0:l.length;o--&&(h=l[o],!n.relative[c=h.type]);)if((u=n.find[c])&&(i=u(h.matches[0].replace(J,ee),$.test(l[0].type)&&me(t.parentNode)||t))){if(l.splice(o,1),!(e=i.length&&ve(l)))return R.apply(r,i),r;break}}return(d||s(e,f))(i,t,!m,r,!t||$.test(e)&&me(t.parentNode)||t),r},r.sortStable=b.split("").sort(E).join("")===b,r.detectDuplicates=!!u,d(),r.sortDetached=le(function(e){return 1&e.compareDocumentPosition(f.createElement("fieldset"))}),le(function(e){return e.innerHTML="<a href='#'></a>","#"===e.firstChild.getAttribute("href")})||he("type|href|height|width",function(e,t,r){if(!r)return e.getAttribute(t,"type"===t.toLowerCase()?1:2)}),r.attributes&&le(function(e){return e.innerHTML="<input/>",e.firstChild.setAttribute("value",""),""===e.firstChild.getAttribute("value")})||he("value",function(e,t,r){if(!r&&"input"===e.nodeName.toLowerCase())return e.defaultValue}),le(function(e){return null==e.getAttribute("disabled")})||he(U,function(e,t,r){var n;if(!r)return!0===e[t]?t.toLowerCase():(n=e.getAttributeNode(t))&&n.specified?n.value:null}),oe}(r);M.find=C,M.expr=C.selectors,M.expr[":"]=M.expr.pseudos,M.uniqueSort=M.unique=C.uniqueSort,M.text=C.getText,M.isXMLDoc=C.isXML,M.contains=C.contains,M.escapeSelector=C.escape;var E=function(e,t,r){for(var n=[],i=void 0!==r;(e=e[t])&&9!==e.nodeType;)if(1===e.nodeType){if(i&&M(e).is(r))break;n.push(e)}return n},A=function(e,t){for(var r=[];e;e=e.nextSibling)1===e.nodeType&&e!==t&&r.push(e);return r},L=M.expr.match.needsContext;function P(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()}var D=/^<([a-z][^\/\0>:\x20\t\r\n\f]*)[\x20\t\r\n\f]*\/?>(?:<\/\1>|)$/i;function R(e,t,r){return y(t)?M.grep(e,function(e,n){return!!t.call(e,n,e)!==r}):t.nodeType?M.grep(e,function(e){return e===t!==r}):"string"!=typeof t?M.grep(e,function(e){return-1<u.call(t,e)!==r}):M.filter(t,e,r)}M.filter=function(e,t,r){var n=t[0];return r&&(e=":not("+e+")"),1===t.length&&1===n.nodeType?M.find.matchesSelector(n,e)?[n]:[]:M.find.matches(e,M.grep(t,function(e){return 1===e.nodeType}))},M.fn.extend({find:function(e){var t,r,n=this.length,i=this;if("string"!=typeof e)return this.pushStack(M(e).filter(function(){for(t=0;t<n;t++)if(M.contains(i[t],this))return!0}));for(r=this.pushStack([]),t=0;t<n;t++)M.find(e,i[t],r);return 1<n?M.uniqueSort(r):r},filter:function(e){return this.pushStack(R(this,e||[],!1))},not:function(e){return this.pushStack(R(this,e||[],!0))},is:function(e){return!!R(this,"string"==typeof e&&L.test(e)?M(e):e||[],!1).length}});var k,F=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]+))$/;(M.fn.init=function(e,t,r){var n,i;if(!e)return this;if(r=r||k,"string"!=typeof e)return e.nodeType?(this[0]=e,this.length=1,this):y(e)?void 0!==r.ready?r.ready(e):e(M):M.makeArray(e,this);if(!(n="<"===e[0]&&">"===e[e.length-1]&&3<=e.length?[null,e,null]:F.exec(e))||!n[1]&&t)return!t||t.jquery?(t||r).find(e):this.constructor(t).find(e);if(n[1]){if(t=t instanceof M?t[0]:t,M.merge(this,M.parseHTML(n[1],t&&t.nodeType?t.ownerDocument||t:a,!0)),D.test(n[1])&&M.isPlainObject(t))for(n in t)y(this[n])?this[n](t[n]):this.attr(n,t[n]);return this}return(i=a.getElementById(n[2]))&&(this[0]=i,this.length=1),this}).prototype=M.fn,k=M(a);var U=/^(?:parents|prev(?:Until|All))/,N={children:!0,contents:!0,next:!0,prev:!0};function B(e,t){for(;(e=e[t])&&1!==e.nodeType;);return e}M.fn.extend({has:function(e){var t=M(e,this),r=t.length;return this.filter(function(){for(var e=0;e<r;e++)if(M.contains(this,t[e]))return!0})},closest:function(e,t){var r,n=0,i=this.length,o=[],a="string"!=typeof e&&M(e);if(!L.test(e))for(;n<i;n++)for(r=this[n];r&&r!==t;r=r.parentNode)if(r.nodeType<11&&(a?-1<a.index(r):1===r.nodeType&&M.find.matchesSelector(r,e))){o.push(r);break}return this.pushStack(1<o.length?M.uniqueSort(o):o)},index:function(e){return e?"string"==typeof e?u.call(M(e),this[0]):u.call(this,e.jquery?e[0]:e):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(e,t){return this.pushStack(M.uniqueSort(M.merge(this.get(),M(e,t))))},addBack:function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}}),M.each({parent:function(e){var t=e.parentNode;return t&&11!==t.nodeType?t:null},parents:function(e){return E(e,"parentNode")},parentsUntil:function(e,t,r){return E(e,"parentNode",r)},next:function(e){return B(e,"nextSibling")},prev:function(e){return B(e,"previousSibling")},nextAll:function(e){return E(e,"nextSibling")},prevAll:function(e){return E(e,"previousSibling")},nextUntil:function(e,t,r){return E(e,"nextSibling",r)},prevUntil:function(e,t,r){return E(e,"previousSibling",r)},siblings:function(e){return A((e.parentNode||{}).firstChild,e)},children:function(e){return A(e.firstChild)},contents:function(e){return P(e,"iframe")?e.contentDocument:(P(e,"template")&&(e=e.content||e),M.merge([],e.childNodes))}},function(e,t){M.fn[e]=function(r,n){var i=M.map(this,t,r);return"Until"!==e.slice(-5)&&(n=r),n&&"string"==typeof n&&(i=M.filter(n,i)),1<this.length&&(N[e]||M.uniqueSort(i),U.test(e)&&i.reverse()),this.pushStack(i)}});var V=/[^\x20\t\r\n\f]+/g;function z(e){return e}function O(e){throw e}function I(e,t,r,n){var i;try{e&&y(i=e.promise)?i.call(e).done(t).fail(r):e&&y(i=e.then)?i.call(e,t,r):t.apply(void 0,[e].slice(n))}catch(e){r.apply(void 0,[e])}}M.Callbacks=function(e){var t,r;e="string"==typeof e?(t=e,r={},M.each(t.match(V)||[],function(e,t){r[t]=!0}),r):M.extend({},e);var n,i,o,a,s=[],l=[],h=-1,c=function(){for(a=a||e.once,o=n=!0;l.length;h=-1)for(i=l.shift();++h<s.length;)!1===s[h].apply(i[0],i[1])&&e.stopOnFalse&&(h=s.length,i=!1);e.memory||(i=!1),n=!1,a&&(s=i?[]:"")},u={add:function(){return s&&(i&&!n&&(h=s.length-1,l.push(i)),function t(r){M.each(r,function(r,n){y(n)?e.unique&&u.has(n)||s.push(n):n&&n.length&&"string"!==w(n)&&t(n)})}(arguments),i&&!n&&c()),this},remove:function(){return M.each(arguments,function(e,t){for(var r;-1<(r=M.inArray(t,s,r));)s.splice(r,1),r<=h&&h--}),this},has:function(e){return e?-1<M.inArray(e,s):0<s.length},empty:function(){return s&&(s=[]),this},disable:function(){return a=l=[],s=i="",this},disabled:function(){return!s},lock:function(){return a=l=[],i||n||(s=i=""),this},locked:function(){return!!a},fireWith:function(e,t){return a||(t=[e,(t=t||[]).slice?t.slice():t],l.push(t),n||c()),this},fire:function(){return u.fireWith(this,arguments),this},fired:function(){return!!o}};return u},M.extend({Deferred:function(e){var t=[["notify","progress",M.Callbacks("memory"),M.Callbacks("memory"),2],["resolve","done",M.Callbacks("once memory"),M.Callbacks("once memory"),0,"resolved"],["reject","fail",M.Callbacks("once memory"),M.Callbacks("once memory"),1,"rejected"]],n="pending",i={state:function(){return n},always:function(){return o.done(arguments).fail(arguments),this},catch:function(e){return i.then(null,e)},pipe:function(){var e=arguments;return M.Deferred(function(r){M.each(t,function(t,n){var i=y(e[n[4]])&&e[n[4]];o[n[1]](function(){var e=i&&i.apply(this,arguments);e&&y(e.promise)?e.promise().progress(r.notify).done(r.resolve).fail(r.reject):r[n[0]+"With"](this,i?[e]:arguments)})}),e=null}).promise()},then:function(e,n,i){var o=0;function a(e,t,n,i){return function(){var s=this,l=arguments,h=function(){var r,h;if(!(e<o)){if((r=n.apply(s,l))===t.promise())throw new TypeError("Thenable self-resolution");h=r&&("object"==typeof r||"function"==typeof r)&&r.then,y(h)?i?h.call(r,a(o,t,z,i),a(o,t,O,i)):(o++,h.call(r,a(o,t,z,i),a(o,t,O,i),a(o,t,z,t.notifyWith))):(n!==z&&(s=void 0,l=[r]),(i||t.resolveWith)(s,l))}},c=i?h:function(){try{h()}catch(r){M.Deferred.exceptionHook&&M.Deferred.exceptionHook(r,c.stackTrace),o<=e+1&&(n!==O&&(s=void 0,l=[r]),t.rejectWith(s,l))}};e?c():(M.Deferred.getStackHook&&(c.stackTrace=M.Deferred.getStackHook()),r.setTimeout(c))}}return M.Deferred(function(r){t[0][3].add(a(0,r,y(i)?i:z,r.notifyWith)),t[1][3].add(a(0,r,y(e)?e:z)),t[2][3].add(a(0,r,y(n)?n:O))}).promise()},promise:function(e){return null!=e?M.extend(e,i):i}},o={};return M.each(t,function(e,r){var a=r[2],s=r[5];i[r[1]]=a.add,s&&a.add(function(){n=s},t[3-e][2].disable,t[3-e][3].disable,t[0][2].lock,t[0][3].lock),a.add(r[3].fire),o[r[0]]=function(){return o[r[0]+"With"](this===o?void 0:this,arguments),this},o[r[0]+"With"]=a.fireWith}),i.promise(o),e&&e.call(o,o),o},when:function(e){var t=arguments.length,r=t,n=Array(r),i=l.call(arguments),o=M.Deferred(),a=function(e){return function(r){n[e]=this,i[e]=1<arguments.length?l.call(arguments):r,--t||o.resolveWith(n,i)}};if(t<=1&&(I(e,o.done(a(r)).resolve,o.reject,!t),"pending"===o.state()||y(i[r]&&i[r].then)))return o.then();for(;r--;)I(i[r],a(r),o.reject);return o.promise()}});var H=/^(Eval|Internal|Range|Reference|Syntax|Type|URI)Error$/;M.Deferred.exceptionHook=function(e,t){r.console&&r.console.warn&&e&&H.test(e.name)&&r.console.warn("jQuery.Deferred exception: "+e.message,e.stack,t)},M.readyException=function(e){r.setTimeout(function(){throw e})};var G=M.Deferred();function W(){a.removeEventListener("DOMContentLoaded",W),r.removeEventListener("load",W),M.ready()}M.fn.ready=function(e){return G.then(e).catch(function(e){M.readyException(e)}),this},M.extend({isReady:!1,readyWait:1,ready:function(e){(!0===e?--M.readyWait:M.isReady)||(M.isReady=!0)!==e&&0<--M.readyWait||G.resolveWith(a,[M])}}),M.ready.then=G.then,"complete"===a.readyState||"loading"!==a.readyState&&!a.documentElement.doScroll?r.setTimeout(M.ready):(a.addEventListener("DOMContentLoaded",W),r.addEventListener("load",W));var j=function(e,t,r,n,i,o,a){var s=0,l=e.length,h=null==r;if("object"===w(r))for(s in i=!0,r)j(e,t,s,r[s],!0,o,a);else if(void 0!==n&&(i=!0,y(n)||(a=!0),h&&(t=a?(t.call(e,n),null):(h=t,function(e,t,r){return h.call(M(e),r)})),t))for(;s<l;s++)t(e[s],r,a?n:n.call(e[s],s,t(e[s],r)));return i?e:h?t.call(e):l?t(e[0],r):o},X=/^-ms-/,q=/-([a-z])/g;function Y(e,t){return t.toUpperCase()}function K(e){return e.replace(X,"ms-").replace(q,Y)}var Q=function(e){return 1===e.nodeType||9===e.nodeType||!+e.nodeType};function Z(){this.expando=M.expando+Z.uid++}Z.uid=1,Z.prototype={cache:function(e){var t=e[this.expando];return t||(t={},Q(e)&&(e.nodeType?e[this.expando]=t:Object.defineProperty(e,this.expando,{value:t,configurable:!0}))),t},set:function(e,t,r){var n,i=this.cache(e);if("string"==typeof t)i[K(t)]=r;else for(n in t)i[K(n)]=t[n];return i},get:function(e,t){return void 0===t?this.cache(e):e[this.expando]&&e[this.expando][K(t)]},access:function(e,t,r){return void 0===t||t&&"string"==typeof t&&void 0===r?this.get(e,t):(this.set(e,t,r),void 0!==r?r:t)},remove:function(e,t){var r,n=e[this.expando];if(void 0!==n){if(void 0!==t){r=(t=Array.isArray(t)?t.map(K):(t=K(t))in n?[t]:t.match(V)||[]).length;for(;r--;)delete n[t[r]]}(void 0===t||M.isEmptyObject(n))&&(e.nodeType?e[this.expando]=void 0:delete e[this.expando])}},hasData:function(e){var t=e[this.expando];return void 0!==t&&!M.isEmptyObject(t)}};var $=new Z,J=new Z,ee=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,te=/[A-Z]/g;function re(e,t,r){var n,i;if(void 0===r&&1===e.nodeType)if(n="data-"+t.replace(te,"-$&").toLowerCase(),"string"==typeof(r=e.getAttribute(n))){try{r="true"===(i=r)||"false"!==i&&("null"===i?null:i===+i+""?+i:ee.test(i)?JSON.parse(i):i)}catch(e){}J.set(e,t,r)}else r=void 0;return r}M.extend({hasData:function(e){return J.hasData(e)||$.hasData(e)},data:function(e,t,r){return J.access(e,t,r)},removeData:function(e,t){J.remove(e,t)},_data:function(e,t,r){return $.access(e,t,r)},_removeData:function(e,t){$.remove(e,t)}}),M.fn.extend({data:function(e,t){var r,n,i,o=this[0],a=o&&o.attributes;if(void 0!==e)return"object"==typeof e?this.each(function(){J.set(this,e)}):j(this,function(t){var r;if(o&&void 0===t)return void 0!==(r=J.get(o,e))?r:void 0!==(r=re(o,e))?r:void 0;this.each(function(){J.set(this,e,t)})},null,t,1<arguments.length,null,!0);if(this.length&&(i=J.get(o),1===o.nodeType&&!$.get(o,"hasDataAttrs"))){for(r=a.length;r--;)a[r]&&0===(n=a[r].name).indexOf("data-")&&(n=K(n.slice(5)),re(o,n,i[n]));$.set(o,"hasDataAttrs",!0)}return i},removeData:function(e){return this.each(function(){J.remove(this,e)})}}),M.extend({queue:function(e,t,r){var n;if(e)return t=(t||"fx")+"queue",n=$.get(e,t),r&&(!n||Array.isArray(r)?n=$.access(e,t,M.makeArray(r)):n.push(r)),n||[]},dequeue:function(e,t){t=t||"fx";var r=M.queue(e,t),n=r.length,i=r.shift(),o=M._queueHooks(e,t);"inprogress"===i&&(i=r.shift(),n--),i&&("fx"===t&&r.unshift("inprogress"),delete o.stop,i.call(e,function(){M.dequeue(e,t)},o)),!n&&o&&o.empty.fire()},_queueHooks:function(e,t){var r=t+"queueHooks";return $.get(e,r)||$.access(e,r,{empty:M.Callbacks("once memory").add(function(){$.remove(e,[t+"queue",r])})})}}),M.fn.extend({queue:function(e,t){var r=2;return"string"!=typeof e&&(t=e,e="fx",r--),arguments.length<r?M.queue(this[0],e):void 0===t?this:this.each(function(){var r=M.queue(this,e,t);M._queueHooks(this,e),"fx"===e&&"inprogress"!==r[0]&&M.dequeue(this,e)})},dequeue:function(e){return this.each(function(){M.dequeue(this,e)})},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,t){var r,n=1,i=M.Deferred(),o=this,a=this.length,s=function(){--n||i.resolveWith(o,[o])};for("string"!=typeof e&&(t=e,e=void 0),e=e||"fx";a--;)(r=$.get(o[a],e+"queueHooks"))&&r.empty&&(n++,r.empty.add(s));return s(),i.promise(t)}});var ne=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,ie=new RegExp("^(?:([+-])=|)("+ne+")([a-z%]*)$","i"),oe=["Top","Right","Bottom","Left"],ae=function(e,t){return"none"===(e=t||e).style.display||""===e.style.display&&M.contains(e.ownerDocument,e)&&"none"===M.css(e,"display")},se=function(e,t,r,n){var i,o,a={};for(o in t)a[o]=e.style[o],e.style[o]=t[o];for(o in i=r.apply(e,n||[]),t)e.style[o]=a[o];return i};function le(e,t,r,n){var i,o,a=20,s=n?function(){return n.cur()}:function(){return M.css(e,t,"")},l=s(),h=r&&r[3]||(M.cssNumber[t]?"":"px"),c=(M.cssNumber[t]||"px"!==h&&+l)&&ie.exec(M.css(e,t));if(c&&c[3]!==h){for(l/=2,h=h||c[3],c=+l||1;a--;)M.style(e,t,c+h),(1-o)*(1-(o=s()/l||.5))<=0&&(a=0),c/=o;c*=2,M.style(e,t,c+h),r=r||[]}return r&&(c=+c||+l||0,i=r[1]?c+(r[1]+1)*r[2]:+r[2],n&&(n.unit=h,n.start=c,n.end=i)),i}var he={};function ce(e,t){for(var r,n,i,o,a,s,l,h=[],c=0,u=e.length;c<u;c++)(n=e[c]).style&&(r=n.style.display,t?("none"===r&&(h[c]=$.get(n,"display")||null,h[c]||(n.style.display="")),""===n.style.display&&ae(n)&&(h[c]=(l=a=o=void 0,a=(i=n).ownerDocument,s=i.nodeName,(l=he[s])||(o=a.body.appendChild(a.createElement(s)),l=M.css(o,"display"),o.parentNode.removeChild(o),"none"===l&&(l="block"),he[s]=l)))):"none"!==r&&(h[c]="none",$.set(n,"display",r)));for(c=0;c<u;c++)null!=h[c]&&(e[c].style.display=h[c]);return e}M.fn.extend({show:function(){return ce(this,!0)},hide:function(){return ce(this)},toggle:function(e){return"boolean"==typeof e?e?this.show():this.hide():this.each(function(){ae(this)?M(this).show():M(this).hide()})}});var ue=/^(?:checkbox|radio)$/i,de=/<([a-z][^\/\0>\x20\t\r\n\f]+)/i,fe=/^$|^module$|\/(?:java|ecma)script/i,pe={option:[1,"<select multiple='multiple'>","</select>"],thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};function me(e,t){var r;return r=void 0!==e.getElementsByTagName?e.getElementsByTagName(t||"*"):void 0!==e.querySelectorAll?e.querySelectorAll(t||"*"):[],void 0===t||t&&P(e,t)?M.merge([e],r):r}function ge(e,t){for(var r=0,n=e.length;r<n;r++)$.set(e[r],"globalEval",!t||$.get(t[r],"globalEval"))}pe.optgroup=pe.option,pe.tbody=pe.tfoot=pe.colgroup=pe.caption=pe.thead,pe.th=pe.td;var ve,ye,xe=/<|&#?\w+;/;function be(e,t,r,n,i){for(var o,a,s,l,h,c,u=t.createDocumentFragment(),d=[],f=0,p=e.length;f<p;f++)if((o=e[f])||0===o)if("object"===w(o))M.merge(d,o.nodeType?[o]:o);else if(xe.test(o)){for(a=a||u.appendChild(t.createElement("div")),s=(de.exec(o)||["",""])[1].toLowerCase(),l=pe[s]||pe._default,a.innerHTML=l[1]+M.htmlPrefilter(o)+l[2],c=l[0];c--;)a=a.lastChild;M.merge(d,a.childNodes),(a=u.firstChild).textContent=""}else d.push(t.createTextNode(o));for(u.textContent="",f=0;o=d[f++];)if(n&&-1<M.inArray(o,n))i&&i.push(o);else if(h=M.contains(o.ownerDocument,o),a=me(u.appendChild(o),"script"),h&&ge(a),r)for(c=0;o=a[c++];)fe.test(o.type||"")&&r.push(o);return u}ve=a.createDocumentFragment().appendChild(a.createElement("div")),(ye=a.createElement("input")).setAttribute("type","radio"),ye.setAttribute("checked","checked"),ye.setAttribute("name","t"),ve.appendChild(ye),v.checkClone=ve.cloneNode(!0).cloneNode(!0).lastChild.checked,ve.innerHTML="<textarea>x</textarea>",v.noCloneChecked=!!ve.cloneNode(!0).lastChild.defaultValue;var _e=a.documentElement,we=/^key/,Me=/^(?:mouse|pointer|contextmenu|drag|drop)|click/,Se=/^([^.]*)(?:\.(.+)|)/;function Te(){return!0}function Ce(){return!1}function Ee(){try{return a.activeElement}catch(e){}}function Ae(e,t,r,n,i,o){var a,s;if("object"==typeof t){for(s in"string"!=typeof r&&(n=n||r,r=void 0),t)Ae(e,s,r,n,t[s],o);return e}if(null==n&&null==i?(i=r,n=r=void 0):null==i&&("string"==typeof r?(i=n,n=void 0):(i=n,n=r,r=void 0)),!1===i)i=Ce;else if(!i)return e;return 1===o&&(a=i,(i=function(e){return M().off(e),a.apply(this,arguments)}).guid=a.guid||(a.guid=M.guid++)),e.each(function(){M.event.add(this,t,i,n,r)})}M.event={global:{},add:function(e,t,r,n,i){var o,a,s,l,h,c,u,d,f,p,m,g=$.get(e);if(g)for(r.handler&&(r=(o=r).handler,i=o.selector),i&&M.find.matchesSelector(_e,i),r.guid||(r.guid=M.guid++),(l=g.events)||(l=g.events={}),(a=g.handle)||(a=g.handle=function(t){return void 0!==M&&M.event.triggered!==t.type?M.event.dispatch.apply(e,arguments):void 0}),h=(t=(t||"").match(V)||[""]).length;h--;)f=m=(s=Se.exec(t[h])||[])[1],p=(s[2]||"").split(".").sort(),f&&(u=M.event.special[f]||{},f=(i?u.delegateType:u.bindType)||f,u=M.event.special[f]||{},c=M.extend({type:f,origType:m,data:n,handler:r,guid:r.guid,selector:i,needsContext:i&&M.expr.match.needsContext.test(i),namespace:p.join(".")},o),(d=l[f])||((d=l[f]=[]).delegateCount=0,u.setup&&!1!==u.setup.call(e,n,p,a)||e.addEventListener&&e.addEventListener(f,a)),u.add&&(u.add.call(e,c),c.handler.guid||(c.handler.guid=r.guid)),i?d.splice(d.delegateCount++,0,c):d.push(c),M.event.global[f]=!0)},remove:function(e,t,r,n,i){var o,a,s,l,h,c,u,d,f,p,m,g=$.hasData(e)&&$.get(e);if(g&&(l=g.events)){for(h=(t=(t||"").match(V)||[""]).length;h--;)if(f=m=(s=Se.exec(t[h])||[])[1],p=(s[2]||"").split(".").sort(),f){for(u=M.event.special[f]||{},d=l[f=(n?u.delegateType:u.bindType)||f]||[],s=s[2]&&new RegExp("(^|\\.)"+p.join("\\.(?:.*\\.|)")+"(\\.|$)"),a=o=d.length;o--;)c=d[o],!i&&m!==c.origType||r&&r.guid!==c.guid||s&&!s.test(c.namespace)||n&&n!==c.selector&&("**"!==n||!c.selector)||(d.splice(o,1),c.selector&&d.delegateCount--,u.remove&&u.remove.call(e,c));a&&!d.length&&(u.teardown&&!1!==u.teardown.call(e,p,g.handle)||M.removeEvent(e,f,g.handle),delete l[f])}else for(f in l)M.event.remove(e,f+t[h],r,n,!0);M.isEmptyObject(l)&&$.remove(e,"handle events")}},dispatch:function(e){var t,r,n,i,o,a,s=M.event.fix(e),l=new Array(arguments.length),h=($.get(this,"events")||{})[s.type]||[],c=M.event.special[s.type]||{};for(l[0]=s,t=1;t<arguments.length;t++)l[t]=arguments[t];if(s.delegateTarget=this,!c.preDispatch||!1!==c.preDispatch.call(this,s)){for(a=M.event.handlers.call(this,s,h),t=0;(i=a[t++])&&!s.isPropagationStopped();)for(s.currentTarget=i.elem,r=0;(o=i.handlers[r++])&&!s.isImmediatePropagationStopped();)s.rnamespace&&!s.rnamespace.test(o.namespace)||(s.handleObj=o,s.data=o.data,void 0!==(n=((M.event.special[o.origType]||{}).handle||o.handler).apply(i.elem,l))&&!1===(s.result=n)&&(s.preventDefault(),s.stopPropagation()));return c.postDispatch&&c.postDispatch.call(this,s),s.result}},handlers:function(e,t){var r,n,i,o,a,s=[],l=t.delegateCount,h=e.target;if(l&&h.nodeType&&!("click"===e.type&&1<=e.button))for(;h!==this;h=h.parentNode||this)if(1===h.nodeType&&("click"!==e.type||!0!==h.disabled)){for(o=[],a={},r=0;r<l;r++)void 0===a[i=(n=t[r]).selector+" "]&&(a[i]=n.needsContext?-1<M(i,this).index(h):M.find(i,this,null,[h]).length),a[i]&&o.push(n);o.length&&s.push({elem:h,handlers:o})}return h=this,l<t.length&&s.push({elem:h,handlers:t.slice(l)}),s},addProp:function(e,t){Object.defineProperty(M.Event.prototype,e,{enumerable:!0,configurable:!0,get:y(t)?function(){if(this.originalEvent)return t(this.originalEvent)}:function(){if(this.originalEvent)return this.originalEvent[e]},set:function(t){Object.defineProperty(this,e,{enumerable:!0,configurable:!0,writable:!0,value:t})}})},fix:function(e){return e[M.expando]?e:new M.Event(e)},special:{load:{noBubble:!0},focus:{trigger:function(){if(this!==Ee()&&this.focus)return this.focus(),!1},delegateType:"focusin"},blur:{trigger:function(){if(this===Ee()&&this.blur)return this.blur(),!1},delegateType:"focusout"},click:{trigger:function(){if("checkbox"===this.type&&this.click&&P(this,"input"))return this.click(),!1},_default:function(e){return P(e.target,"a")}},beforeunload:{postDispatch:function(e){void 0!==e.result&&e.originalEvent&&(e.originalEvent.returnValue=e.result)}}}},M.removeEvent=function(e,t,r){e.removeEventListener&&e.removeEventListener(t,r)},M.Event=function(e,t){if(!(this instanceof M.Event))return new M.Event(e,t);e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||void 0===e.defaultPrevented&&!1===e.returnValue?Te:Ce,this.target=e.target&&3===e.target.nodeType?e.target.parentNode:e.target,this.currentTarget=e.currentTarget,this.relatedTarget=e.relatedTarget):this.type=e,t&&M.extend(this,t),this.timeStamp=e&&e.timeStamp||Date.now(),this[M.expando]=!0},M.Event.prototype={constructor:M.Event,isDefaultPrevented:Ce,isPropagationStopped:Ce,isImmediatePropagationStopped:Ce,isSimulated:!1,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=Te,e&&!this.isSimulated&&e.preventDefault()},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=Te,e&&!this.isSimulated&&e.stopPropagation()},stopImmediatePropagation:function(){var e=this.originalEvent;this.isImmediatePropagationStopped=Te,e&&!this.isSimulated&&e.stopImmediatePropagation(),this.stopPropagation()}},M.each({altKey:!0,bubbles:!0,cancelable:!0,changedTouches:!0,ctrlKey:!0,detail:!0,eventPhase:!0,metaKey:!0,pageX:!0,pageY:!0,shiftKey:!0,view:!0,char:!0,charCode:!0,key:!0,keyCode:!0,button:!0,buttons:!0,clientX:!0,clientY:!0,offsetX:!0,offsetY:!0,pointerId:!0,pointerType:!0,screenX:!0,screenY:!0,targetTouches:!0,toElement:!0,touches:!0,which:function(e){var t=e.button;return null==e.which&&we.test(e.type)?null!=e.charCode?e.charCode:e.keyCode:!e.which&&void 0!==t&&Me.test(e.type)?1&t?1:2&t?3:4&t?2:0:e.which}},M.event.addProp),M.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(e,t){M.event.special[e]={delegateType:t,bindType:t,handle:function(e){var r,n=e.relatedTarget,i=e.handleObj;return n&&(n===this||M.contains(this,n))||(e.type=i.origType,r=i.handler.apply(this,arguments),e.type=t),r}}}),M.fn.extend({on:function(e,t,r,n){return Ae(this,e,t,r,n)},one:function(e,t,r,n){return Ae(this,e,t,r,n,1)},off:function(e,t,r){var n,i;if(e&&e.preventDefault&&e.handleObj)return n=e.handleObj,M(e.delegateTarget).off(n.namespace?n.origType+"."+n.namespace:n.origType,n.selector,n.handler),this;if("object"!=typeof e)return!1!==t&&"function"!=typeof t||(r=t,t=void 0),!1===r&&(r=Ce),this.each(function(){M.event.remove(this,e,r,t)});for(i in e)this.off(i,t,e[i]);return this}});var Le=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([a-z][^\/\0>\x20\t\r\n\f]*)[^>]*)\/>/gi,Pe=/<script|<style|<link/i,De=/checked\s*(?:[^=]|=\s*.checked.)/i,Re=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g;function ke(e,t){return P(e,"table")&&P(11!==t.nodeType?t:t.firstChild,"tr")&&M(e).children("tbody")[0]||e}function Fe(e){return e.type=(null!==e.getAttribute("type"))+"/"+e.type,e}function Ue(e){return"true/"===(e.type||"").slice(0,5)?e.type=e.type.slice(5):e.removeAttribute("type"),e}function Ne(e,t){var r,n,i,o,a,s,l,h;if(1===t.nodeType){if($.hasData(e)&&(o=$.access(e),a=$.set(t,o),h=o.events))for(i in delete a.handle,a.events={},h)for(r=0,n=h[i].length;r<n;r++)M.event.add(t,i,h[i][r]);J.hasData(e)&&(s=J.access(e),l=M.extend({},s),J.set(t,l))}}function Be(e,t,r,n){t=h.apply([],t);var i,o,a,s,l,c,u=0,d=e.length,f=d-1,p=t[0],m=y(p);if(m||1<d&&"string"==typeof p&&!v.checkClone&&De.test(p))return e.each(function(i){var o=e.eq(i);m&&(t[0]=p.call(this,i,o.html())),Be(o,t,r,n)});if(d&&(o=(i=be(t,e[0].ownerDocument,!1,e,n)).firstChild,1===i.childNodes.length&&(i=o),o||n)){for(s=(a=M.map(me(i,"script"),Fe)).length;u<d;u++)l=i,u!==f&&(l=M.clone(l,!0,!0),s&&M.merge(a,me(l,"script"))),r.call(e[u],l,u);if(s)for(c=a[a.length-1].ownerDocument,M.map(a,Ue),u=0;u<s;u++)l=a[u],fe.test(l.type||"")&&!$.access(l,"globalEval")&&M.contains(c,l)&&(l.src&&"module"!==(l.type||"").toLowerCase()?M._evalUrl&&M._evalUrl(l.src):_(l.textContent.replace(Re,""),c,l))}return e}function Ve(e,t,r){for(var n,i=t?M.filter(t,e):e,o=0;null!=(n=i[o]);o++)r||1!==n.nodeType||M.cleanData(me(n)),n.parentNode&&(r&&M.contains(n.ownerDocument,n)&&ge(me(n,"script")),n.parentNode.removeChild(n));return e}M.extend({htmlPrefilter:function(e){return e.replace(Le,"<$1></$2>")},clone:function(e,t,r){var n,i,o,a,s,l,h,c=e.cloneNode(!0),u=M.contains(e.ownerDocument,e);if(!(v.noCloneChecked||1!==e.nodeType&&11!==e.nodeType||M.isXMLDoc(e)))for(a=me(c),n=0,i=(o=me(e)).length;n<i;n++)s=o[n],"input"===(h=(l=a[n]).nodeName.toLowerCase())&&ue.test(s.type)?l.checked=s.checked:"input"!==h&&"textarea"!==h||(l.defaultValue=s.defaultValue);if(t)if(r)for(o=o||me(e),a=a||me(c),n=0,i=o.length;n<i;n++)Ne(o[n],a[n]);else Ne(e,c);return 0<(a=me(c,"script")).length&&ge(a,!u&&me(e,"script")),c},cleanData:function(e){for(var t,r,n,i=M.event.special,o=0;void 0!==(r=e[o]);o++)if(Q(r)){if(t=r[$.expando]){if(t.events)for(n in t.events)i[n]?M.event.remove(r,n):M.removeEvent(r,n,t.handle);r[$.expando]=void 0}r[J.expando]&&(r[J.expando]=void 0)}}}),M.fn.extend({detach:function(e){return Ve(this,e,!0)},remove:function(e){return Ve(this,e)},text:function(e){return j(this,function(e){return void 0===e?M.text(this):this.empty().each(function(){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||(this.textContent=e)})},null,e,arguments.length)},append:function(){return Be(this,arguments,function(e){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||ke(this,e).appendChild(e)})},prepend:function(){return Be(this,arguments,function(e){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var t=ke(this,e);t.insertBefore(e,t.firstChild)}})},before:function(){return Be(this,arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this)})},after:function(){return Be(this,arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this.nextSibling)})},empty:function(){for(var e,t=0;null!=(e=this[t]);t++)1===e.nodeType&&(M.cleanData(me(e,!1)),e.textContent="");return this},clone:function(e,t){return e=null!=e&&e,t=null==t?e:t,this.map(function(){return M.clone(this,e,t)})},html:function(e){return j(this,function(e){var t=this[0]||{},r=0,n=this.length;if(void 0===e&&1===t.nodeType)return t.innerHTML;if("string"==typeof e&&!Pe.test(e)&&!pe[(de.exec(e)||["",""])[1].toLowerCase()]){e=M.htmlPrefilter(e);try{for(;r<n;r++)1===(t=this[r]||{}).nodeType&&(M.cleanData(me(t,!1)),t.innerHTML=e);t=0}catch(e){}}t&&this.empty().append(e)},null,e,arguments.length)},replaceWith:function(){var e=[];return Be(this,arguments,function(t){var r=this.parentNode;M.inArray(this,e)<0&&(M.cleanData(me(this)),r&&r.replaceChild(t,this))},e)}}),M.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(e,t){M.fn[e]=function(e){for(var r,n=[],i=M(e),o=i.length-1,a=0;a<=o;a++)r=a===o?this:this.clone(!0),M(i[a])[t](r),c.apply(n,r.get());return this.pushStack(n)}});var ze=new RegExp("^("+ne+")(?!px)[a-z%]+$","i"),Oe=function(e){var t=e.ownerDocument.defaultView;return t&&t.opener||(t=r),t.getComputedStyle(e)},Ie=new RegExp(oe.join("|"),"i");function He(e,t,r){var n,i,o,a,s=e.style;return(r=r||Oe(e))&&(""!==(a=r.getPropertyValue(t)||r[t])||M.contains(e.ownerDocument,e)||(a=M.style(e,t)),!v.pixelBoxStyles()&&ze.test(a)&&Ie.test(t)&&(n=s.width,i=s.minWidth,o=s.maxWidth,s.minWidth=s.maxWidth=s.width=a,a=r.width,s.width=n,s.minWidth=i,s.maxWidth=o)),void 0!==a?a+"":a}function Ge(e,t){return{get:function(){if(!e())return(this.get=t).apply(this,arguments);delete this.get}}}!function(){function e(){if(c){h.style.cssText="position:absolute;left:-11111px;width:60px;margin-top:1px;padding:0;border:0",c.style.cssText="position:relative;display:block;box-sizing:border-box;overflow:scroll;margin:auto;border:1px;padding:1px;width:60%;top:1%",_e.appendChild(h).appendChild(c);var e=r.getComputedStyle(c);n="1%"!==e.top,l=12===t(e.marginLeft),c.style.right="60%",s=36===t(e.right),i=36===t(e.width),c.style.position="absolute",o=36===c.offsetWidth||"absolute",_e.removeChild(h),c=null}}function t(e){return Math.round(parseFloat(e))}var n,i,o,s,l,h=a.createElement("div"),c=a.createElement("div");c.style&&(c.style.backgroundClip="content-box",c.cloneNode(!0).style.backgroundClip="",v.clearCloneStyle="content-box"===c.style.backgroundClip,M.extend(v,{boxSizingReliable:function(){return e(),i},pixelBoxStyles:function(){return e(),s},pixelPosition:function(){return e(),n},reliableMarginLeft:function(){return e(),l},scrollboxSize:function(){return e(),o}}))}();var We=/^(none|table(?!-c[ea]).+)/,je=/^--/,Xe={position:"absolute",visibility:"hidden",display:"block"},qe={letterSpacing:"0",fontWeight:"400"},Ye=["Webkit","Moz","ms"],Ke=a.createElement("div").style;function Qe(e){var t=M.cssProps[e];return t||(t=M.cssProps[e]=function(e){if(e in Ke)return e;for(var t=e[0].toUpperCase()+e.slice(1),r=Ye.length;r--;)if((e=Ye[r]+t)in Ke)return e}(e)||e),t}function Ze(e,t,r){var n=ie.exec(t);return n?Math.max(0,n[2]-(r||0))+(n[3]||"px"):t}function $e(e,t,r,n,i,o){var a="width"===t?1:0,s=0,l=0;if(r===(n?"border":"content"))return 0;for(;a<4;a+=2)"margin"===r&&(l+=M.css(e,r+oe[a],!0,i)),n?("content"===r&&(l-=M.css(e,"padding"+oe[a],!0,i)),"margin"!==r&&(l-=M.css(e,"border"+oe[a]+"Width",!0,i))):(l+=M.css(e,"padding"+oe[a],!0,i),"padding"!==r?l+=M.css(e,"border"+oe[a]+"Width",!0,i):s+=M.css(e,"border"+oe[a]+"Width",!0,i));return!n&&0<=o&&(l+=Math.max(0,Math.ceil(e["offset"+t[0].toUpperCase()+t.slice(1)]-o-l-s-.5))),l}function Je(e,t,r){var n=Oe(e),i=He(e,t,n),o="border-box"===M.css(e,"boxSizing",!1,n),a=o;if(ze.test(i)){if(!r)return i;i="auto"}return a=a&&(v.boxSizingReliable()||i===e.style[t]),("auto"===i||!parseFloat(i)&&"inline"===M.css(e,"display",!1,n))&&(i=e["offset"+t[0].toUpperCase()+t.slice(1)],a=!0),(i=parseFloat(i)||0)+$e(e,t,r||(o?"border":"content"),a,n,i)+"px"}function et(e,t,r,n,i){return new et.prototype.init(e,t,r,n,i)}M.extend({cssHooks:{opacity:{get:function(e,t){if(t){var r=He(e,"opacity");return""===r?"1":r}}}},cssNumber:{animationIterationCount:!0,columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{},style:function(e,t,r,n){if(e&&3!==e.nodeType&&8!==e.nodeType&&e.style){var i,o,a,s=K(t),l=je.test(t),h=e.style;if(l||(t=Qe(s)),a=M.cssHooks[t]||M.cssHooks[s],void 0===r)return a&&"get"in a&&void 0!==(i=a.get(e,!1,n))?i:h[t];"string"==(o=typeof r)&&(i=ie.exec(r))&&i[1]&&(r=le(e,t,i),o="number"),null!=r&&r==r&&("number"===o&&(r+=i&&i[3]||(M.cssNumber[s]?"":"px")),v.clearCloneStyle||""!==r||0!==t.indexOf("background")||(h[t]="inherit"),a&&"set"in a&&void 0===(r=a.set(e,r,n))||(l?h.setProperty(t,r):h[t]=r))}},css:function(e,t,r,n){var i,o,a,s=K(t);return je.test(t)||(t=Qe(s)),(a=M.cssHooks[t]||M.cssHooks[s])&&"get"in a&&(i=a.get(e,!0,r)),void 0===i&&(i=He(e,t,n)),"normal"===i&&t in qe&&(i=qe[t]),""===r||r?(o=parseFloat(i),!0===r||isFinite(o)?o||0:i):i}}),M.each(["height","width"],function(e,t){M.cssHooks[t]={get:function(e,r,n){if(r)return!We.test(M.css(e,"display"))||e.getClientRects().length&&e.getBoundingClientRect().width?Je(e,t,n):se(e,Xe,function(){return Je(e,t,n)})},set:function(e,r,n){var i,o=Oe(e),a="border-box"===M.css(e,"boxSizing",!1,o),s=n&&$e(e,t,n,a,o);return a&&v.scrollboxSize()===o.position&&(s-=Math.ceil(e["offset"+t[0].toUpperCase()+t.slice(1)]-parseFloat(o[t])-$e(e,t,"border",!1,o)-.5)),s&&(i=ie.exec(r))&&"px"!==(i[3]||"px")&&(e.style[t]=r,r=M.css(e,t)),Ze(0,r,s)}}}),M.cssHooks.marginLeft=Ge(v.reliableMarginLeft,function(e,t){if(t)return(parseFloat(He(e,"marginLeft"))||e.getBoundingClientRect().left-se(e,{marginLeft:0},function(){return e.getBoundingClientRect().left}))+"px"}),M.each({margin:"",padding:"",border:"Width"},function(e,t){M.cssHooks[e+t]={expand:function(r){for(var n=0,i={},o="string"==typeof r?r.split(" "):[r];n<4;n++)i[e+oe[n]+t]=o[n]||o[n-2]||o[0];return i}},"margin"!==e&&(M.cssHooks[e+t].set=Ze)}),M.fn.extend({css:function(e,t){return j(this,function(e,t,r){var n,i,o={},a=0;if(Array.isArray(t)){for(n=Oe(e),i=t.length;a<i;a++)o[t[a]]=M.css(e,t[a],!1,n);return o}return void 0!==r?M.style(e,t,r):M.css(e,t)},e,t,1<arguments.length)}}),((M.Tween=et).prototype={constructor:et,init:function(e,t,r,n,i,o){this.elem=e,this.prop=r,this.easing=i||M.easing._default,this.options=t,this.start=this.now=this.cur(),this.end=n,this.unit=o||(M.cssNumber[r]?"":"px")},cur:function(){var e=et.propHooks[this.prop];return e&&e.get?e.get(this):et.propHooks._default.get(this)},run:function(e){var t,r=et.propHooks[this.prop];return this.options.duration?this.pos=t=M.easing[this.easing](e,this.options.duration*e,0,1,this.options.duration):this.pos=t=e,this.now=(this.end-this.start)*t+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),r&&r.set?r.set(this):et.propHooks._default.set(this),this}}).init.prototype=et.prototype,(et.propHooks={_default:{get:function(e){var t;return 1!==e.elem.nodeType||null!=e.elem[e.prop]&&null==e.elem.style[e.prop]?e.elem[e.prop]:(t=M.css(e.elem,e.prop,""))&&"auto"!==t?t:0},set:function(e){M.fx.step[e.prop]?M.fx.step[e.prop](e):1!==e.elem.nodeType||null==e.elem.style[M.cssProps[e.prop]]&&!M.cssHooks[e.prop]?e.elem[e.prop]=e.now:M.style(e.elem,e.prop,e.now+e.unit)}}}).scrollTop=et.propHooks.scrollLeft={set:function(e){e.elem.nodeType&&e.elem.parentNode&&(e.elem[e.prop]=e.now)}},M.easing={linear:function(e){return e},swing:function(e){return.5-Math.cos(e*Math.PI)/2},_default:"swing"},M.fx=et.prototype.init,M.fx.step={};var tt,rt,nt,it,ot=/^(?:toggle|show|hide)$/,at=/queueHooks$/;function st(){rt&&(!1===a.hidden&&r.requestAnimationFrame?r.requestAnimationFrame(st):r.setTimeout(st,M.fx.interval),M.fx.tick())}function lt(){return r.setTimeout(function(){tt=void 0}),tt=Date.now()}function ht(e,t){var r,n=0,i={height:e};for(t=t?1:0;n<4;n+=2-t)i["margin"+(r=oe[n])]=i["padding"+r]=e;return t&&(i.opacity=i.width=e),i}function ct(e,t,r){for(var n,i=(ut.tweeners[t]||[]).concat(ut.tweeners["*"]),o=0,a=i.length;o<a;o++)if(n=i[o].call(r,t,e))return n}function ut(e,t,r){var n,i,o=0,a=ut.prefilters.length,s=M.Deferred().always(function(){delete l.elem}),l=function(){if(i)return!1;for(var t=tt||lt(),r=Math.max(0,h.startTime+h.duration-t),n=1-(r/h.duration||0),o=0,a=h.tweens.length;o<a;o++)h.tweens[o].run(n);return s.notifyWith(e,[h,n,r]),n<1&&a?r:(a||s.notifyWith(e,[h,1,0]),s.resolveWith(e,[h]),!1)},h=s.promise({elem:e,props:M.extend({},t),opts:M.extend(!0,{specialEasing:{},easing:M.easing._default},r),originalProperties:t,originalOptions:r,startTime:tt||lt(),duration:r.duration,tweens:[],createTween:function(t,r){var n=M.Tween(e,h.opts,t,r,h.opts.specialEasing[t]||h.opts.easing);return h.tweens.push(n),n},stop:function(t){var r=0,n=t?h.tweens.length:0;if(i)return this;for(i=!0;r<n;r++)h.tweens[r].run(1);return t?(s.notifyWith(e,[h,1,0]),s.resolveWith(e,[h,t])):s.rejectWith(e,[h,t]),this}}),c=h.props;for(function(e,t){var r,n,i,o,a;for(r in e)if(i=t[n=K(r)],o=e[r],Array.isArray(o)&&(i=o[1],o=e[r]=o[0]),r!==n&&(e[n]=o,delete e[r]),(a=M.cssHooks[n])&&"expand"in a)for(r in o=a.expand(o),delete e[n],o)r in e||(e[r]=o[r],t[r]=i);else t[n]=i}(c,h.opts.specialEasing);o<a;o++)if(n=ut.prefilters[o].call(h,e,c,h.opts))return y(n.stop)&&(M._queueHooks(h.elem,h.opts.queue).stop=n.stop.bind(n)),n;return M.map(c,ct,h),y(h.opts.start)&&h.opts.start.call(e,h),h.progress(h.opts.progress).done(h.opts.done,h.opts.complete).fail(h.opts.fail).always(h.opts.always),M.fx.timer(M.extend(l,{elem:e,anim:h,queue:h.opts.queue})),h}M.Animation=M.extend(ut,{tweeners:{"*":[function(e,t){var r=this.createTween(e,t);return le(r.elem,e,ie.exec(t),r),r}]},tweener:function(e,t){for(var r,n=0,i=(e=y(e)?(t=e,["*"]):e.match(V)).length;n<i;n++)r=e[n],ut.tweeners[r]=ut.tweeners[r]||[],ut.tweeners[r].unshift(t)},prefilters:[function(e,t,r){var n,i,o,a,s,l,h,c,u="width"in t||"height"in t,d=this,f={},p=e.style,m=e.nodeType&&ae(e),g=$.get(e,"fxshow");for(n in r.queue||(null==(a=M._queueHooks(e,"fx")).unqueued&&(a.unqueued=0,s=a.empty.fire,a.empty.fire=function(){a.unqueued||s()}),a.unqueued++,d.always(function(){d.always(function(){a.unqueued--,M.queue(e,"fx").length||a.empty.fire()})})),t)if(i=t[n],ot.test(i)){if(delete t[n],o=o||"toggle"===i,i===(m?"hide":"show")){if("show"!==i||!g||void 0===g[n])continue;m=!0}f[n]=g&&g[n]||M.style(e,n)}if((l=!M.isEmptyObject(t))||!M.isEmptyObject(f))for(n in u&&1===e.nodeType&&(r.overflow=[p.overflow,p.overflowX,p.overflowY],null==(h=g&&g.display)&&(h=$.get(e,"display")),"none"===(c=M.css(e,"display"))&&(h?c=h:(ce([e],!0),h=e.style.display||h,c=M.css(e,"display"),ce([e]))),("inline"===c||"inline-block"===c&&null!=h)&&"none"===M.css(e,"float")&&(l||(d.done(function(){p.display=h}),null==h&&(c=p.display,h="none"===c?"":c)),p.display="inline-block")),r.overflow&&(p.overflow="hidden",d.always(function(){p.overflow=r.overflow[0],p.overflowX=r.overflow[1],p.overflowY=r.overflow[2]})),l=!1,f)l||(g?"hidden"in g&&(m=g.hidden):g=$.access(e,"fxshow",{display:h}),o&&(g.hidden=!m),m&&ce([e],!0),d.done(function(){for(n in m||ce([e]),$.remove(e,"fxshow"),f)M.style(e,n,f[n])})),l=ct(m?g[n]:0,n,d),n in g||(g[n]=l.start,m&&(l.end=l.start,l.start=0))}],prefilter:function(e,t){t?ut.prefilters.unshift(e):ut.prefilters.push(e)}}),M.speed=function(e,t,r){var n=e&&"object"==typeof e?M.extend({},e):{complete:r||!r&&t||y(e)&&e,duration:e,easing:r&&t||t&&!y(t)&&t};return M.fx.off?n.duration=0:"number"!=typeof n.duration&&(n.duration in M.fx.speeds?n.duration=M.fx.speeds[n.duration]:n.duration=M.fx.speeds._default),null!=n.queue&&!0!==n.queue||(n.queue="fx"),n.old=n.complete,n.complete=function(){y(n.old)&&n.old.call(this),n.queue&&M.dequeue(this,n.queue)},n},M.fn.extend({fadeTo:function(e,t,r,n){return this.filter(ae).css("opacity",0).show().end().animate({opacity:t},e,r,n)},animate:function(e,t,r,n){var i=M.isEmptyObject(e),o=M.speed(t,r,n),a=function(){var t=ut(this,M.extend({},e),o);(i||$.get(this,"finish"))&&t.stop(!0)};return a.finish=a,i||!1===o.queue?this.each(a):this.queue(o.queue,a)},stop:function(e,t,r){var n=function(e){var t=e.stop;delete e.stop,t(r)};return"string"!=typeof e&&(r=t,t=e,e=void 0),t&&!1!==e&&this.queue(e||"fx",[]),this.each(function(){var t=!0,i=null!=e&&e+"queueHooks",o=M.timers,a=$.get(this);if(i)a[i]&&a[i].stop&&n(a[i]);else for(i in a)a[i]&&a[i].stop&&at.test(i)&&n(a[i]);for(i=o.length;i--;)o[i].elem!==this||null!=e&&o[i].queue!==e||(o[i].anim.stop(r),t=!1,o.splice(i,1));!t&&r||M.dequeue(this,e)})},finish:function(e){return!1!==e&&(e=e||"fx"),this.each(function(){var t,r=$.get(this),n=r[e+"queue"],i=r[e+"queueHooks"],o=M.timers,a=n?n.length:0;for(r.finish=!0,M.queue(this,e,[]),i&&i.stop&&i.stop.call(this,!0),t=o.length;t--;)o[t].elem===this&&o[t].queue===e&&(o[t].anim.stop(!0),o.splice(t,1));for(t=0;t<a;t++)n[t]&&n[t].finish&&n[t].finish.call(this);delete r.finish})}}),M.each(["toggle","show","hide"],function(e,t){var r=M.fn[t];M.fn[t]=function(e,n,i){return null==e||"boolean"==typeof e?r.apply(this,arguments):this.animate(ht(t,!0),e,n,i)}}),M.each({slideDown:ht("show"),slideUp:ht("hide"),slideToggle:ht("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(e,t){M.fn[e]=function(e,r,n){return this.animate(t,e,r,n)}}),M.timers=[],M.fx.tick=function(){var e,t=0,r=M.timers;for(tt=Date.now();t<r.length;t++)(e=r[t])()||r[t]!==e||r.splice(t--,1);r.length||M.fx.stop(),tt=void 0},M.fx.timer=function(e){M.timers.push(e),M.fx.start()},M.fx.interval=13,M.fx.start=function(){rt||(rt=!0,st())},M.fx.stop=function(){rt=null},M.fx.speeds={slow:600,fast:200,_default:400},M.fn.delay=function(e,t){return e=M.fx&&M.fx.speeds[e]||e,t=t||"fx",this.queue(t,function(t,n){var i=r.setTimeout(t,e);n.stop=function(){r.clearTimeout(i)}})},nt=a.createElement("input"),it=a.createElement("select").appendChild(a.createElement("option")),nt.type="checkbox",v.checkOn=""!==nt.value,v.optSelected=it.selected,(nt=a.createElement("input")).value="t",nt.type="radio",v.radioValue="t"===nt.value;var dt,ft=M.expr.attrHandle;M.fn.extend({attr:function(e,t){return j(this,M.attr,e,t,1<arguments.length)},removeAttr:function(e){return this.each(function(){M.removeAttr(this,e)})}}),M.extend({attr:function(e,t,r){var n,i,o=e.nodeType;if(3!==o&&8!==o&&2!==o)return void 0===e.getAttribute?M.prop(e,t,r):(1===o&&M.isXMLDoc(e)||(i=M.attrHooks[t.toLowerCase()]||(M.expr.match.bool.test(t)?dt:void 0)),void 0!==r?null===r?void M.removeAttr(e,t):i&&"set"in i&&void 0!==(n=i.set(e,r,t))?n:(e.setAttribute(t,r+""),r):i&&"get"in i&&null!==(n=i.get(e,t))?n:null==(n=M.find.attr(e,t))?void 0:n)},attrHooks:{type:{set:function(e,t){if(!v.radioValue&&"radio"===t&&P(e,"input")){var r=e.value;return e.setAttribute("type",t),r&&(e.value=r),t}}}},removeAttr:function(e,t){var r,n=0,i=t&&t.match(V);if(i&&1===e.nodeType)for(;r=i[n++];)e.removeAttribute(r)}}),dt={set:function(e,t,r){return!1===t?M.removeAttr(e,r):e.setAttribute(r,r),r}},M.each(M.expr.match.bool.source.match(/\w+/g),function(e,t){var r=ft[t]||M.find.attr;ft[t]=function(e,t,n){var i,o,a=t.toLowerCase();return n||(o=ft[a],ft[a]=i,i=null!=r(e,t,n)?a:null,ft[a]=o),i}});var pt=/^(?:input|select|textarea|button)$/i,mt=/^(?:a|area)$/i;function gt(e){return(e.match(V)||[]).join(" ")}function vt(e){return e.getAttribute&&e.getAttribute("class")||""}function yt(e){return Array.isArray(e)?e:"string"==typeof e&&e.match(V)||[]}M.fn.extend({prop:function(e,t){return j(this,M.prop,e,t,1<arguments.length)},removeProp:function(e){return this.each(function(){delete this[M.propFix[e]||e]})}}),M.extend({prop:function(e,t,r){var n,i,o=e.nodeType;if(3!==o&&8!==o&&2!==o)return 1===o&&M.isXMLDoc(e)||(t=M.propFix[t]||t,i=M.propHooks[t]),void 0!==r?i&&"set"in i&&void 0!==(n=i.set(e,r,t))?n:e[t]=r:i&&"get"in i&&null!==(n=i.get(e,t))?n:e[t]},propHooks:{tabIndex:{get:function(e){var t=M.find.attr(e,"tabindex");return t?parseInt(t,10):pt.test(e.nodeName)||mt.test(e.nodeName)&&e.href?0:-1}}},propFix:{for:"htmlFor",class:"className"}}),v.optSelected||(M.propHooks.selected={get:function(e){var t=e.parentNode;return t&&t.parentNode&&t.parentNode.selectedIndex,null},set:function(e){var t=e.parentNode;t&&(t.selectedIndex,t.parentNode&&t.parentNode.selectedIndex)}}),M.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){M.propFix[this.toLowerCase()]=this}),M.fn.extend({addClass:function(e){var t,r,n,i,o,a,s,l=0;if(y(e))return this.each(function(t){M(this).addClass(e.call(this,t,vt(this)))});if((t=yt(e)).length)for(;r=this[l++];)if(i=vt(r),n=1===r.nodeType&&" "+gt(i)+" "){for(a=0;o=t[a++];)n.indexOf(" "+o+" ")<0&&(n+=o+" ");i!==(s=gt(n))&&r.setAttribute("class",s)}return this},removeClass:function(e){var t,r,n,i,o,a,s,l=0;if(y(e))return this.each(function(t){M(this).removeClass(e.call(this,t,vt(this)))});if(!arguments.length)return this.attr("class","");if((t=yt(e)).length)for(;r=this[l++];)if(i=vt(r),n=1===r.nodeType&&" "+gt(i)+" "){for(a=0;o=t[a++];)for(;-1<n.indexOf(" "+o+" ");)n=n.replace(" "+o+" "," ");i!==(s=gt(n))&&r.setAttribute("class",s)}return this},toggleClass:function(e,t){var r=typeof e,n="string"===r||Array.isArray(e);return"boolean"==typeof t&&n?t?this.addClass(e):this.removeClass(e):y(e)?this.each(function(r){M(this).toggleClass(e.call(this,r,vt(this),t),t)}):this.each(function(){var t,i,o,a;if(n)for(i=0,o=M(this),a=yt(e);t=a[i++];)o.hasClass(t)?o.removeClass(t):o.addClass(t);else void 0!==e&&"boolean"!==r||((t=vt(this))&&$.set(this,"__className__",t),this.setAttribute&&this.setAttribute("class",t||!1===e?"":$.get(this,"__className__")||""))})},hasClass:function(e){var t,r,n=0;for(t=" "+e+" ";r=this[n++];)if(1===r.nodeType&&-1<(" "+gt(vt(r))+" ").indexOf(t))return!0;return!1}});var xt=/\r/g;M.fn.extend({val:function(e){var t,r,n,i=this[0];return arguments.length?(n=y(e),this.each(function(r){var i;1===this.nodeType&&(null==(i=n?e.call(this,r,M(this).val()):e)?i="":"number"==typeof i?i+="":Array.isArray(i)&&(i=M.map(i,function(e){return null==e?"":e+""})),(t=M.valHooks[this.type]||M.valHooks[this.nodeName.toLowerCase()])&&"set"in t&&void 0!==t.set(this,i,"value")||(this.value=i))})):i?(t=M.valHooks[i.type]||M.valHooks[i.nodeName.toLowerCase()])&&"get"in t&&void 0!==(r=t.get(i,"value"))?r:"string"==typeof(r=i.value)?r.replace(xt,""):null==r?"":r:void 0}}),M.extend({valHooks:{option:{get:function(e){var t=M.find.attr(e,"value");return null!=t?t:gt(M.text(e))}},select:{get:function(e){var t,r,n,i=e.options,o=e.selectedIndex,a="select-one"===e.type,s=a?null:[],l=a?o+1:i.length;for(n=o<0?l:a?o:0;n<l;n++)if(((r=i[n]).selected||n===o)&&!r.disabled&&(!r.parentNode.disabled||!P(r.parentNode,"optgroup"))){if(t=M(r).val(),a)return t;s.push(t)}return s},set:function(e,t){for(var r,n,i=e.options,o=M.makeArray(t),a=i.length;a--;)((n=i[a]).selected=-1<M.inArray(M.valHooks.option.get(n),o))&&(r=!0);return r||(e.selectedIndex=-1),o}}}}),M.each(["radio","checkbox"],function(){M.valHooks[this]={set:function(e,t){if(Array.isArray(t))return e.checked=-1<M.inArray(M(e).val(),t)}},v.checkOn||(M.valHooks[this].get=function(e){return null===e.getAttribute("value")?"on":e.value})}),v.focusin="onfocusin"in r;var bt=/^(?:focusinfocus|focusoutblur)$/,_t=function(e){e.stopPropagation()};M.extend(M.event,{trigger:function(e,t,n,i){var o,s,l,h,c,u,d,f,m=[n||a],g=p.call(e,"type")?e.type:e,v=p.call(e,"namespace")?e.namespace.split("."):[];if(s=f=l=n=n||a,3!==n.nodeType&&8!==n.nodeType&&!bt.test(g+M.event.triggered)&&(-1<g.indexOf(".")&&(g=(v=g.split(".")).shift(),v.sort()),c=g.indexOf(":")<0&&"on"+g,(e=e[M.expando]?e:new M.Event(g,"object"==typeof e&&e)).isTrigger=i?2:3,e.namespace=v.join("."),e.rnamespace=e.namespace?new RegExp("(^|\\.)"+v.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,e.result=void 0,e.target||(e.target=n),t=null==t?[e]:M.makeArray(t,[e]),d=M.event.special[g]||{},i||!d.trigger||!1!==d.trigger.apply(n,t))){if(!i&&!d.noBubble&&!x(n)){for(h=d.delegateType||g,bt.test(h+g)||(s=s.parentNode);s;s=s.parentNode)m.push(s),l=s;l===(n.ownerDocument||a)&&m.push(l.defaultView||l.parentWindow||r)}for(o=0;(s=m[o++])&&!e.isPropagationStopped();)f=s,e.type=1<o?h:d.bindType||g,(u=($.get(s,"events")||{})[e.type]&&$.get(s,"handle"))&&u.apply(s,t),(u=c&&s[c])&&u.apply&&Q(s)&&(e.result=u.apply(s,t),!1===e.result&&e.preventDefault());return e.type=g,i||e.isDefaultPrevented()||d._default&&!1!==d._default.apply(m.pop(),t)||!Q(n)||c&&y(n[g])&&!x(n)&&((l=n[c])&&(n[c]=null),M.event.triggered=g,e.isPropagationStopped()&&f.addEventListener(g,_t),n[g](),e.isPropagationStopped()&&f.removeEventListener(g,_t),M.event.triggered=void 0,l&&(n[c]=l)),e.result}},simulate:function(e,t,r){var n=M.extend(new M.Event,r,{type:e,isSimulated:!0});M.event.trigger(n,null,t)}}),M.fn.extend({trigger:function(e,t){return this.each(function(){M.event.trigger(e,t,this)})},triggerHandler:function(e,t){var r=this[0];if(r)return M.event.trigger(e,t,r,!0)}}),v.focusin||M.each({focus:"focusin",blur:"focusout"},function(e,t){var r=function(e){M.event.simulate(t,e.target,M.event.fix(e))};M.event.special[t]={setup:function(){var n=this.ownerDocument||this,i=$.access(n,t);i||n.addEventListener(e,r,!0),$.access(n,t,(i||0)+1)},teardown:function(){var n=this.ownerDocument||this,i=$.access(n,t)-1;i?$.access(n,t,i):(n.removeEventListener(e,r,!0),$.remove(n,t))}}});var wt=r.location,Mt=Date.now(),St=/\?/;M.parseXML=function(e){var t;if(!e||"string"!=typeof e)return null;try{t=(new r.DOMParser).parseFromString(e,"text/xml")}catch(e){t=void 0}return t&&!t.getElementsByTagName("parsererror").length||M.error("Invalid XML: "+e),t};var Tt=/\[\]$/,Ct=/\r?\n/g,Et=/^(?:submit|button|image|reset|file)$/i,At=/^(?:input|select|textarea|keygen)/i;function Lt(e,t,r,n){var i;if(Array.isArray(t))M.each(t,function(t,i){r||Tt.test(e)?n(e,i):Lt(e+"["+("object"==typeof i&&null!=i?t:"")+"]",i,r,n)});else if(r||"object"!==w(t))n(e,t);else for(i in t)Lt(e+"["+i+"]",t[i],r,n)}M.param=function(e,t){var r,n=[],i=function(e,t){var r=y(t)?t():t;n[n.length]=encodeURIComponent(e)+"="+encodeURIComponent(null==r?"":r)};if(Array.isArray(e)||e.jquery&&!M.isPlainObject(e))M.each(e,function(){i(this.name,this.value)});else for(r in e)Lt(r,e[r],t,i);return n.join("&")},M.fn.extend({serialize:function(){return M.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var e=M.prop(this,"elements");return e?M.makeArray(e):this}).filter(function(){var e=this.type;return this.name&&!M(this).is(":disabled")&&At.test(this.nodeName)&&!Et.test(e)&&(this.checked||!ue.test(e))}).map(function(e,t){var r=M(this).val();return null==r?null:Array.isArray(r)?M.map(r,function(e){return{name:t.name,value:e.replace(Ct,"\r\n")}}):{name:t.name,value:r.replace(Ct,"\r\n")}}).get()}});var Pt=/%20/g,Dt=/#.*$/,Rt=/([?&])_=[^&]*/,kt=/^(.*?):[ \t]*([^\r\n]*)$/gm,Ft=/^(?:GET|HEAD)$/,Ut=/^\/\//,Nt={},Bt={},Vt="*/".concat("*"),zt=a.createElement("a");function Ot(e){return function(t,r){"string"!=typeof t&&(r=t,t="*");var n,i=0,o=t.toLowerCase().match(V)||[];if(y(r))for(;n=o[i++];)"+"===n[0]?(n=n.slice(1)||"*",(e[n]=e[n]||[]).unshift(r)):(e[n]=e[n]||[]).push(r)}}function It(e,t,r,n){var i={},o=e===Bt;function a(s){var l;return i[s]=!0,M.each(e[s]||[],function(e,s){var h=s(t,r,n);return"string"!=typeof h||o||i[h]?o?!(l=h):void 0:(t.dataTypes.unshift(h),a(h),!1)}),l}return a(t.dataTypes[0])||!i["*"]&&a("*")}function Ht(e,t){var r,n,i=M.ajaxSettings.flatOptions||{};for(r in t)void 0!==t[r]&&((i[r]?e:n||(n={}))[r]=t[r]);return n&&M.extend(!0,e,n),e}zt.href=wt.href,M.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:wt.href,type:"GET",isLocal:/^(?:about|app|app-storage|.+-extension|file|res|widget):$/.test(wt.protocol),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":Vt,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":JSON.parse,"text xml":M.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(e,t){return t?Ht(Ht(e,M.ajaxSettings),t):Ht(M.ajaxSettings,e)},ajaxPrefilter:Ot(Nt),ajaxTransport:Ot(Bt),ajax:function(e,t){"object"==typeof e&&(t=e,e=void 0),t=t||{};var n,i,o,s,l,h,c,u,d,f,p=M.ajaxSetup({},t),m=p.context||p,g=p.context&&(m.nodeType||m.jquery)?M(m):M.event,v=M.Deferred(),y=M.Callbacks("once memory"),x=p.statusCode||{},b={},_={},w="canceled",S={readyState:0,getResponseHeader:function(e){var t;if(c){if(!s)for(s={};t=kt.exec(o);)s[t[1].toLowerCase()]=t[2];t=s[e.toLowerCase()]}return null==t?null:t},getAllResponseHeaders:function(){return c?o:null},setRequestHeader:function(e,t){return null==c&&(e=_[e.toLowerCase()]=_[e.toLowerCase()]||e,b[e]=t),this},overrideMimeType:function(e){return null==c&&(p.mimeType=e),this},statusCode:function(e){var t;if(e)if(c)S.always(e[S.status]);else for(t in e)x[t]=[x[t],e[t]];return this},abort:function(e){var t=e||w;return n&&n.abort(t),T(0,t),this}};if(v.promise(S),p.url=((e||p.url||wt.href)+"").replace(Ut,wt.protocol+"//"),p.type=t.method||t.type||p.method||p.type,p.dataTypes=(p.dataType||"*").toLowerCase().match(V)||[""],null==p.crossDomain){h=a.createElement("a");try{h.href=p.url,h.href=h.href,p.crossDomain=zt.protocol+"//"+zt.host!=h.protocol+"//"+h.host}catch(e){p.crossDomain=!0}}if(p.data&&p.processData&&"string"!=typeof p.data&&(p.data=M.param(p.data,p.traditional)),It(Nt,p,t,S),c)return S;for(d in(u=M.event&&p.global)&&0==M.active++&&M.event.trigger("ajaxStart"),p.type=p.type.toUpperCase(),p.hasContent=!Ft.test(p.type),i=p.url.replace(Dt,""),p.hasContent?p.data&&p.processData&&0===(p.contentType||"").indexOf("application/x-www-form-urlencoded")&&(p.data=p.data.replace(Pt,"+")):(f=p.url.slice(i.length),p.data&&(p.processData||"string"==typeof p.data)&&(i+=(St.test(i)?"&":"?")+p.data,delete p.data),!1===p.cache&&(i=i.replace(Rt,"$1"),f=(St.test(i)?"&":"?")+"_="+Mt+++f),p.url=i+f),p.ifModified&&(M.lastModified[i]&&S.setRequestHeader("If-Modified-Since",M.lastModified[i]),M.etag[i]&&S.setRequestHeader("If-None-Match",M.etag[i])),(p.data&&p.hasContent&&!1!==p.contentType||t.contentType)&&S.setRequestHeader("Content-Type",p.contentType),S.setRequestHeader("Accept",p.dataTypes[0]&&p.accepts[p.dataTypes[0]]?p.accepts[p.dataTypes[0]]+("*"!==p.dataTypes[0]?", "+Vt+"; q=0.01":""):p.accepts["*"]),p.headers)S.setRequestHeader(d,p.headers[d]);if(p.beforeSend&&(!1===p.beforeSend.call(m,S,p)||c))return S.abort();if(w="abort",y.add(p.complete),S.done(p.success),S.fail(p.error),n=It(Bt,p,t,S)){if(S.readyState=1,u&&g.trigger("ajaxSend",[S,p]),c)return S;p.async&&0<p.timeout&&(l=r.setTimeout(function(){S.abort("timeout")},p.timeout));try{c=!1,n.send(b,T)}catch(e){if(c)throw e;T(-1,e)}}else T(-1,"No Transport");function T(e,t,a,s){var h,d,f,b,_,w=t;c||(c=!0,l&&r.clearTimeout(l),n=void 0,o=s||"",S.readyState=0<e?4:0,h=200<=e&&e<300||304===e,a&&(b=function(e,t,r){for(var n,i,o,a,s=e.contents,l=e.dataTypes;"*"===l[0];)l.shift(),void 0===n&&(n=e.mimeType||t.getResponseHeader("Content-Type"));if(n)for(i in s)if(s[i]&&s[i].test(n)){l.unshift(i);break}if(l[0]in r)o=l[0];else{for(i in r){if(!l[0]||e.converters[i+" "+l[0]]){o=i;break}a||(a=i)}o=o||a}if(o)return o!==l[0]&&l.unshift(o),r[o]}(p,S,a)),b=function(e,t,r,n){var i,o,a,s,l,h={},c=e.dataTypes.slice();if(c[1])for(a in e.converters)h[a.toLowerCase()]=e.converters[a];for(o=c.shift();o;)if(e.responseFields[o]&&(r[e.responseFields[o]]=t),!l&&n&&e.dataFilter&&(t=e.dataFilter(t,e.dataType)),l=o,o=c.shift())if("*"===o)o=l;else if("*"!==l&&l!==o){if(!(a=h[l+" "+o]||h["* "+o]))for(i in h)if((s=i.split(" "))[1]===o&&(a=h[l+" "+s[0]]||h["* "+s[0]])){!0===a?a=h[i]:!0!==h[i]&&(o=s[0],c.unshift(s[1]));break}if(!0!==a)if(a&&e.throws)t=a(t);else try{t=a(t)}catch(e){return{state:"parsererror",error:a?e:"No conversion from "+l+" to "+o}}}return{state:"success",data:t}}(p,b,S,h),h?(p.ifModified&&((_=S.getResponseHeader("Last-Modified"))&&(M.lastModified[i]=_),(_=S.getResponseHeader("etag"))&&(M.etag[i]=_)),204===e||"HEAD"===p.type?w="nocontent":304===e?w="notmodified":(w=b.state,d=b.data,h=!(f=b.error))):(f=w,!e&&w||(w="error",e<0&&(e=0))),S.status=e,S.statusText=(t||w)+"",h?v.resolveWith(m,[d,w,S]):v.rejectWith(m,[S,w,f]),S.statusCode(x),x=void 0,u&&g.trigger(h?"ajaxSuccess":"ajaxError",[S,p,h?d:f]),y.fireWith(m,[S,w]),u&&(g.trigger("ajaxComplete",[S,p]),--M.active||M.event.trigger("ajaxStop")))}return S},getJSON:function(e,t,r){return M.get(e,t,r,"json")},getScript:function(e,t){return M.get(e,void 0,t,"script")}}),M.each(["get","post"],function(e,t){M[t]=function(e,r,n,i){return y(r)&&(i=i||n,n=r,r=void 0),M.ajax(M.extend({url:e,type:t,dataType:i,data:r,success:n},M.isPlainObject(e)&&e))}}),M._evalUrl=function(e){return M.ajax({url:e,type:"GET",dataType:"script",cache:!0,async:!1,global:!1,throws:!0})},M.fn.extend({wrapAll:function(e){var t;return this[0]&&(y(e)&&(e=e.call(this[0])),t=M(e,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&t.insertBefore(this[0]),t.map(function(){for(var e=this;e.firstElementChild;)e=e.firstElementChild;return e}).append(this)),this},wrapInner:function(e){return y(e)?this.each(function(t){M(this).wrapInner(e.call(this,t))}):this.each(function(){var t=M(this),r=t.contents();r.length?r.wrapAll(e):t.append(e)})},wrap:function(e){var t=y(e);return this.each(function(r){M(this).wrapAll(t?e.call(this,r):e)})},unwrap:function(e){return this.parent(e).not("body").each(function(){M(this).replaceWith(this.childNodes)}),this}}),M.expr.pseudos.hidden=function(e){return!M.expr.pseudos.visible(e)},M.expr.pseudos.visible=function(e){return!!(e.offsetWidth||e.offsetHeight||e.getClientRects().length)},M.ajaxSettings.xhr=function(){try{return new r.XMLHttpRequest}catch(e){}};var Gt={0:200,1223:204},Wt=M.ajaxSettings.xhr();v.cors=!!Wt&&"withCredentials"in Wt,v.ajax=Wt=!!Wt,M.ajaxTransport(function(e){var t,n;if(v.cors||Wt&&!e.crossDomain)return{send:function(i,o){var a,s=e.xhr();if(s.open(e.type,e.url,e.async,e.username,e.password),e.xhrFields)for(a in e.xhrFields)s[a]=e.xhrFields[a];for(a in e.mimeType&&s.overrideMimeType&&s.overrideMimeType(e.mimeType),e.crossDomain||i["X-Requested-With"]||(i["X-Requested-With"]="XMLHttpRequest"),i)s.setRequestHeader(a,i[a]);t=function(e){return function(){t&&(t=n=s.onload=s.onerror=s.onabort=s.ontimeout=s.onreadystatechange=null,"abort"===e?s.abort():"error"===e?"number"!=typeof s.status?o(0,"error"):o(s.status,s.statusText):o(Gt[s.status]||s.status,s.statusText,"text"!==(s.responseType||"text")||"string"!=typeof s.responseText?{binary:s.response}:{text:s.responseText},s.getAllResponseHeaders()))}},s.onload=t(),n=s.onerror=s.ontimeout=t("error"),void 0!==s.onabort?s.onabort=n:s.onreadystatechange=function(){4===s.readyState&&r.setTimeout(function(){t&&n()})},t=t("abort");try{s.send(e.hasContent&&e.data||null)}catch(i){if(t)throw i}},abort:function(){t&&t()}}}),M.ajaxPrefilter(function(e){e.crossDomain&&(e.contents.script=!1)}),M.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/\b(?:java|ecma)script\b/},converters:{"text script":function(e){return M.globalEval(e),e}}}),M.ajaxPrefilter("script",function(e){void 0===e.cache&&(e.cache=!1),e.crossDomain&&(e.type="GET")}),M.ajaxTransport("script",function(e){var t,r;if(e.crossDomain)return{send:function(n,i){t=M("<script>").prop({charset:e.scriptCharset,src:e.url}).on("load error",r=function(e){t.remove(),r=null,e&&i("error"===e.type?404:200,e.type)}),a.head.appendChild(t[0])},abort:function(){r&&r()}}});var jt,Xt=[],qt=/(=)\?(?=&|$)|\?\?/;M.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var e=Xt.pop()||M.expando+"_"+Mt++;return this[e]=!0,e}}),M.ajaxPrefilter("json jsonp",function(e,t,n){var i,o,a,s=!1!==e.jsonp&&(qt.test(e.url)?"url":"string"==typeof e.data&&0===(e.contentType||"").indexOf("application/x-www-form-urlencoded")&&qt.test(e.data)&&"data");if(s||"jsonp"===e.dataTypes[0])return i=e.jsonpCallback=y(e.jsonpCallback)?e.jsonpCallback():e.jsonpCallback,s?e[s]=e[s].replace(qt,"$1"+i):!1!==e.jsonp&&(e.url+=(St.test(e.url)?"&":"?")+e.jsonp+"="+i),e.converters["script json"]=function(){return a||M.error(i+" was not called"),a[0]},e.dataTypes[0]="json",o=r[i],r[i]=function(){a=arguments},n.always(function(){void 0===o?M(r).removeProp(i):r[i]=o,e[i]&&(e.jsonpCallback=t.jsonpCallback,Xt.push(i)),a&&y(o)&&o(a[0]),a=o=void 0}),"script"}),v.createHTMLDocument=((jt=a.implementation.createHTMLDocument("").body).innerHTML="<form></form><form></form>",2===jt.childNodes.length),M.parseHTML=function(e,t,r){return"string"!=typeof e?[]:("boolean"==typeof t&&(r=t,t=!1),t||(v.createHTMLDocument?((n=(t=a.implementation.createHTMLDocument("")).createElement("base")).href=a.location.href,t.head.appendChild(n)):t=a),o=!r&&[],(i=D.exec(e))?[t.createElement(i[1])]:(i=be([e],t,o),o&&o.length&&M(o).remove(),M.merge([],i.childNodes)));var n,i,o},M.fn.load=function(e,t,r){var n,i,o,a=this,s=e.indexOf(" ");return-1<s&&(n=gt(e.slice(s)),e=e.slice(0,s)),y(t)?(r=t,t=void 0):t&&"object"==typeof t&&(i="POST"),0<a.length&&M.ajax({url:e,type:i||"GET",dataType:"html",data:t}).done(function(e){o=arguments,a.html(n?M("<div>").append(M.parseHTML(e)).find(n):e)}).always(r&&function(e,t){a.each(function(){r.apply(this,o||[e.responseText,t,e])})}),this},M.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(e,t){M.fn[t]=function(e){return this.on(t,e)}}),M.expr.pseudos.animated=function(e){return M.grep(M.timers,function(t){return e===t.elem}).length},M.offset={setOffset:function(e,t,r){var n,i,o,a,s,l,h=M.css(e,"position"),c=M(e),u={};"static"===h&&(e.style.position="relative"),s=c.offset(),o=M.css(e,"top"),l=M.css(e,"left"),i=("absolute"===h||"fixed"===h)&&-1<(o+l).indexOf("auto")?(a=(n=c.position()).top,n.left):(a=parseFloat(o)||0,parseFloat(l)||0),y(t)&&(t=t.call(e,r,M.extend({},s))),null!=t.top&&(u.top=t.top-s.top+a),null!=t.left&&(u.left=t.left-s.left+i),"using"in t?t.using.call(e,u):c.css(u)}},M.fn.extend({offset:function(e){if(arguments.length)return void 0===e?this:this.each(function(t){M.offset.setOffset(this,e,t)});var t,r,n=this[0];return n?n.getClientRects().length?(t=n.getBoundingClientRect(),r=n.ownerDocument.defaultView,{top:t.top+r.pageYOffset,left:t.left+r.pageXOffset}):{top:0,left:0}:void 0},position:function(){if(this[0]){var e,t,r,n=this[0],i={top:0,left:0};if("fixed"===M.css(n,"position"))t=n.getBoundingClientRect();else{for(t=this.offset(),r=n.ownerDocument,e=n.offsetParent||r.documentElement;e&&(e===r.body||e===r.documentElement)&&"static"===M.css(e,"position");)e=e.parentNode;e&&e!==n&&1===e.nodeType&&((i=M(e).offset()).top+=M.css(e,"borderTopWidth",!0),i.left+=M.css(e,"borderLeftWidth",!0))}return{top:t.top-i.top-M.css(n,"marginTop",!0),left:t.left-i.left-M.css(n,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var e=this.offsetParent;e&&"static"===M.css(e,"position");)e=e.offsetParent;return e||_e})}}),M.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(e,t){var r="pageYOffset"===t;M.fn[e]=function(n){return j(this,function(e,n,i){var o;if(x(e)?o=e:9===e.nodeType&&(o=e.defaultView),void 0===i)return o?o[t]:e[n];o?o.scrollTo(r?o.pageXOffset:i,r?i:o.pageYOffset):e[n]=i},e,n,arguments.length)}}),M.each(["top","left"],function(e,t){M.cssHooks[t]=Ge(v.pixelPosition,function(e,r){if(r)return r=He(e,t),ze.test(r)?M(e).position()[t]+"px":r})}),M.each({Height:"height",Width:"width"},function(e,t){M.each({padding:"inner"+e,content:t,"":"outer"+e},function(r,n){M.fn[n]=function(i,o){var a=arguments.length&&(r||"boolean"!=typeof i),s=r||(!0===i||!0===o?"margin":"border");return j(this,function(t,r,i){var o;return x(t)?0===n.indexOf("outer")?t["inner"+e]:t.document.documentElement["client"+e]:9===t.nodeType?(o=t.documentElement,Math.max(t.body["scroll"+e],o["scroll"+e],t.body["offset"+e],o["offset"+e],o["client"+e])):void 0===i?M.css(t,r,s):M.style(t,r,i,s)},t,a?i:void 0,a)}})}),M.each("blur focus focusin focusout resize scroll click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup contextmenu".split(" "),function(e,t){M.fn[t]=function(e,r){return 0<arguments.length?this.on(t,null,e,r):this.trigger(t)}}),M.fn.extend({hover:function(e,t){return this.mouseenter(e).mouseleave(t||e)}}),M.fn.extend({bind:function(e,t,r){return this.on(e,null,t,r)},unbind:function(e,t){return this.off(e,null,t)},delegate:function(e,t,r,n){return this.on(t,e,r,n)},undelegate:function(e,t,r){return 1===arguments.length?this.off(e,"**"):this.off(t,e||"**",r)}}),M.proxy=function(e,t){var r,n,i;if("string"==typeof t&&(r=e[t],t=e,e=r),y(e))return n=l.call(arguments,2),(i=function(){return e.apply(t||this,n.concat(l.call(arguments)))}).guid=e.guid=e.guid||M.guid++,i},M.holdReady=function(e){e?M.readyWait++:M.ready(!0)},M.isArray=Array.isArray,M.parseJSON=JSON.parse,M.nodeName=P,M.isFunction=y,M.isWindow=x,M.camelCase=K,M.type=w,M.now=Date.now,M.isNumeric=function(e){var t=M.type(e);return("number"===t||"string"===t)&&!isNaN(e-parseFloat(e))},void 0===(n=function(){return M}.apply(t,[]))||(e.exports=n);var Yt=r.jQuery,Kt=r.$;return M.noConflict=function(e){return r.$===M&&(r.$=Kt),e&&r.jQuery===M&&(r.jQuery=Yt),M},i||(r.jQuery=r.$=M),M})},function(e,t,r){"use strict";r.r(t),t.default=function(){var e=Date.now(),t=e,r=0,n=1/0,i=0,o=0,a=1/0,s=0,l=0,h=0,c=document.createElement("div");c.id="stats",c.addEventListener("mousedown",function(e){e.preventDefault(),y(++h%2)},!1),c.style.cssText="width:80px;opacity:0.9;cursor:pointer";var u=document.createElement("div");u.id="fps",u.style.cssText="padding:0 0 3px 3px;text-align:left;background-color:#002",c.appendChild(u);var d=document.createElement("div");d.id="fpsText",d.style.cssText="color:#0ff;font-family:Helvetica,Arial,sans-serif;font-size:9px;font-weight:bold;line-height:15px",d.innerHTML="FPS",u.appendChild(d);var f=document.createElement("div");for(f.id="fpsGraph",f.style.cssText="position:relative;width:74px;height:30px;background-color:#0ff",u.appendChild(f);f.children.length<74;)(v=document.createElement("span")).style.cssText="width:1px;height:30px;float:left;background-color:#113",f.appendChild(v);var p=document.createElement("div");p.id="ms",p.style.cssText="padding:0 0 3px 3px;text-align:left;background-color:#020;display:none",c.appendChild(p);var m=document.createElement("div");m.id="msText",m.style.cssText="color:#0f0;font-family:Helvetica,Arial,sans-serif;font-size:9px;font-weight:bold;line-height:15px",m.innerHTML="MS",p.appendChild(m);var g=document.createElement("div");for(g.id="msGraph",g.style.cssText="position:relative;width:74px;height:30px;background-color:#0f0",p.appendChild(g);g.children.length<74;){var v;(v=document.createElement("span")).style.cssText="width:1px;height:30px;float:left;background-color:#131",g.appendChild(v)}var y=function(e){switch(h=e){case 0:u.style.display="block",p.style.display="none";break;case 1:u.style.display="none",p.style.display="block"}},x=function(e,t){e.appendChild(e.firstChild).style.height=t+"px"};return{REVISION:11,domElement:c,setMode:y,begin:function(){e=Date.now()},end:function(){var h=Date.now();return r=h-e,n=Math.min(n,r),i=Math.max(i,r),m.textContent=r+" MS ("+n+"-"+i+")",x(g,Math.min(30,30-r/200*30)),l++,t+1e3<h&&(o=Math.round(1e3*l/(h-t)),a=Math.min(a,o),s=Math.max(s,o),d.textContent=o+" FPS ("+a+"-"+s+")",x(f,Math.min(30,30-o/100*30)),t=h,l=0),h},update:function(){e=this.end()}}}},function(e,t,r){"use strict";function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}r.r(t);var i,o,a,s,l,h,c,u,d,f,p,m,g,v,y,x,b,_,w,M,S,T,C,E,A,L,P,D,R,k,F,U,N,B,V,z,O,I,H,G,W,j,X,q,Y,K,Q,Z,$=$||{};$.gui=$.gui||{},$.utils=$.utils||{},$.controllers=$.controllers||{},$.dom=$.dom||{},$.color=$.color||{},$.utils.css={load:function(e,t){var r=(t=t||document).createElement("link");r.type="text/css",r.rel="stylesheet",r.href=e,t.getElementsByTagName("head")[0].appendChild(r)},inject:function(e,t){t=t||document;var r=document.createElement("style");r.type="text/css",r.innerHTML=e,t.getElementsByTagName("head")[0].appendChild(r)}},$.utils.common=(i=Array.prototype.forEach,o=Array.prototype.slice,{BREAK:{},extend:function(e){return this.each(o.call(arguments,1),function(t){for(var r in t)this.isUndefined(t[r])||(e[r]=t[r])},this),e},defaults:function(e){return this.each(o.call(arguments,1),function(t){for(var r in t)this.isUndefined(e[r])&&(e[r]=t[r])},this),e},compose:function(){var e=o.call(arguments);return function(){for(var t=o.call(arguments),r=e.length-1;0<=r;r--)t=[e[r].apply(this,t)];return t[0]}},each:function(e,t,r){if(i&&e.forEach===i)e.forEach(t,r);else if(e.length===e.length+0)for(var n=0,o=e.length;n<o&&!(n in e&&t.call(r,e[n],n)===this.BREAK);n++);else for(n in e)if(t.call(r,e[n],n)===this.BREAK)break},defer:function(e){setTimeout(e,0)},toArray:function(e){return e.toArray?e.toArray():o.call(e)},isUndefined:function(e){return void 0===e},isNull:function(e){return null===e},isNaN:function(e){return e!=e},isArray:Array.isArray||function(e){return e.constructor===Array},isObject:function(e){return e===Object(e)},isNumber:function(e){return e===e+0},isString:function(e){return e===e+""},isBoolean:function(e){return!1===e||!0===e},isFunction:function(e){return"[object Function]"===Object.prototype.toString.call(e)}}),$.controllers.Controller=(a=function(e,t){this.initialValue=e[t],this.domElement=document.createElement("div"),this.object=e,this.property=t,this.__onFinishChange=this.__onChange=void 0},$.utils.common.extend(a.prototype,{onChange:function(e){return this.__onChange=e,this},onFinishChange:function(e){return this.__onFinishChange=e,this},setValue:function(e){return this.object[this.property]=e,this.__onChange&&this.__onChange.call(this,e),this.updateDisplay(),this},getValue:function(){return this.object[this.property]},updateDisplay:function(){return this},isModified:function(){return this.initialValue!==this.getValue()}}),a),$.dom.dom=function(e){function t(t){return"0"===t||e.isUndefined(t)?0:(t=t.match(n),e.isNull(t)?0:parseFloat(t[1]))}var r={};e.each({HTMLEvents:["change"],MouseEvents:["click","mousemove","mousedown","mouseup","mouseover"],KeyboardEvents:["keydown"]},function(t,n){e.each(t,function(e){r[e]=n})});var n=/(\d+(\.\d+)?)px/,i={makeSelectable:function(e,t){void 0!==e&&void 0!==e.style&&(e.onselectstart=t?function(){return!1}:function(){},e.style.MozUserSelect=t?"auto":"none",e.style.KhtmlUserSelect=t?"auto":"none",e.unselectable=t?"on":"off")},makeFullscreen:function(t,r,n){e.isUndefined(r)&&(r=!0),e.isUndefined(n)&&(n=!0),t.style.position="absolute",r&&(t.style.left=0,t.style.right=0),n&&(t.style.top=0,t.style.bottom=0)},fakeEvent:function(t,n,i,o){i=i||{};var a=r[n];if(!a)throw Error("Event type "+n+" not supported.");var s=document.createEvent(a);switch(a){case"MouseEvents":s.initMouseEvent(n,i.bubbles||!1,i.cancelable||!0,window,i.clickCount||1,0,0,i.x||i.clientX||0,i.y||i.clientY||0,!1,!1,!1,!1,0,null);break;case"KeyboardEvents":a=s.initKeyboardEvent||s.initKeyEvent,e.defaults(i,{cancelable:!0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,keyCode:void 0,charCode:void 0}),a(n,i.bubbles||!1,i.cancelable,window,i.ctrlKey,i.altKey,i.shiftKey,i.metaKey,i.keyCode,i.charCode);break;default:s.initEvent(n,i.bubbles||!1,i.cancelable||!0)}e.defaults(s,o),t.dispatchEvent(s)},bind:function(e,t,r,n){return e.addEventListener?e.addEventListener(t,r,n||!1):e.attachEvent&&e.attachEvent("on"+t,r),i},unbind:function(e,t,r,n){return e.removeEventListener?e.removeEventListener(t,r,n||!1):e.detachEvent&&e.detachEvent("on"+t,r),i},addClass:function(e,t){if(void 0===e.className)e.className=t;else if(e.className!==t){var r=e.className.split(/ +/);-1==r.indexOf(t)&&(r.push(t),e.className=r.join(" ").replace(/^\s+/,"").replace(/\s+$/,""))}return i},removeClass:function(e,t){if(t){if(void 0!==e.className)if(e.className===t)e.removeAttribute("class");else{var r=e.className.split(/ +/),n=r.indexOf(t);-1!=n&&(r.splice(n,1),e.className=r.join(" "))}}else e.className=void 0;return i},hasClass:function(e,t){return RegExp("(?:^|\\s+)"+t+"(?:\\s+|$)").test(e.className)||!1},getWidth:function(e){return t((e=getComputedStyle(e))["border-left-width"])+t(e["border-right-width"])+t(e["padding-left"])+t(e["padding-right"])+t(e.width)},getHeight:function(e){return t((e=getComputedStyle(e))["border-top-width"])+t(e["border-bottom-width"])+t(e["padding-top"])+t(e["padding-bottom"])+t(e.height)},getOffset:function(e){var t={left:0,top:0};if(e.offsetParent)for(;t.left+=e.offsetLeft,t.top+=e.offsetTop,e=e.offsetParent;);return t},isActive:function(e){return e===document.activeElement&&(e.type||e.href)}};return i}($.utils.common),$.controllers.OptionController=(s=$.controllers.Controller,l=$.dom.dom,h=$.utils.common,(c=function e(t,r,n){e.superclass.call(this,t,r);var i=this;if(this.__select=document.createElement("select"),h.isArray(n)){var o={};h.each(n,function(e){o[e]=e}),n=o}h.each(n,function(e,t){var r=document.createElement("option");r.innerHTML=t,r.setAttribute("value",e),i.__select.appendChild(r)}),this.updateDisplay(),l.bind(this.__select,"change",function(){i.setValue(this.options[this.selectedIndex].value)}),this.domElement.appendChild(this.__select)}).superclass=s,h.extend(c.prototype,s.prototype,{setValue:function(e){return e=c.superclass.prototype.setValue.call(this,e),this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),e},updateDisplay:function(){return this.__select.value=this.getValue(),c.superclass.prototype.updateDisplay.call(this)}}),c),$.controllers.NumberController=(u=$.controllers.Controller,d=$.utils.common,(f=function e(t,r,n){e.superclass.call(this,t,r),n=n||{},this.__min=n.min,this.__max=n.max,this.__step=n.step,d.isUndefined(this.__step)?this.__impliedStep=0==this.initialValue?1:Math.pow(10,Math.floor(Math.log(this.initialValue)/Math.LN10))/10:this.__impliedStep=this.__step,t=-1<(t=(t=this.__impliedStep).toString()).indexOf(".")?t.length-t.indexOf(".")-1:0,this.__precision=t}).superclass=u,d.extend(f.prototype,u.prototype,{setValue:function(e){return void 0!==this.__min&&e<this.__min?e=this.__min:void 0!==this.__max&&e>this.__max&&(e=this.__max),void 0!==this.__step&&0!=e%this.__step&&(e=Math.round(e/this.__step)*this.__step),f.superclass.prototype.setValue.call(this,e)},min:function(e){return this.__min=e,this},max:function(e){return this.__max=e,this},step:function(e){return this.__step=e,this}}),f),$.controllers.NumberControllerBox=(p=$.controllers.NumberController,m=$.dom.dom,g=$.utils.common,(v=function e(t,r,n){function i(){var e=parseFloat(l.__input.value);g.isNaN(e)||l.setValue(e)}function o(e){var t=s-e.clientY;l.setValue(l.getValue()+t*l.__impliedStep),s=e.clientY}function a(){m.unbind(window,"mousemove",o),m.unbind(window,"mouseup",a)}this.__truncationSuspended=!1,e.superclass.call(this,t,r,n);var s,l=this;this.__input=document.createElement("input"),this.__input.setAttribute("type","text"),m.bind(this.__input,"change",i),m.bind(this.__input,"blur",function(){i(),l.__onFinishChange&&l.__onFinishChange.call(l,l.getValue())}),m.bind(this.__input,"mousedown",function(e){m.bind(window,"mousemove",o),m.bind(window,"mouseup",a),s=e.clientY}),m.bind(this.__input,"keydown",function(e){13===e.keyCode&&(l.__truncationSuspended=!0,this.blur(),l.__truncationSuspended=!1)}),this.updateDisplay(),this.domElement.appendChild(this.__input)}).superclass=p,g.extend(v.prototype,p.prototype,{updateDisplay:function(){var e,t=this.__input;if(this.__truncationSuspended)e=this.getValue();else{e=this.getValue();var r=Math.pow(10,this.__precision);e=Math.round(e*r)/r}return t.value=e,v.superclass.prototype.updateDisplay.call(this)}}),v),$.controllers.NumberControllerSlider=(y=$.controllers.NumberController,x=$.dom.dom,b=$.utils.css,_=$.utils.common,(w=function e(t,r,n,i,o){function a(e){e.preventDefault();var t,r,n,i,o=x.getOffset(l.__background),a=x.getWidth(l.__background);return l.setValue((t=e.clientX,r=o.left,n=o.left+a,(i=l.__min)+(t-r)/(n-r)*(l.__max-i))),!1}function s(){x.unbind(window,"mousemove",a),x.unbind(window,"mouseup",s),l.__onFinishChange&&l.__onFinishChange.call(l,l.getValue())}e.superclass.call(this,t,r,{min:n,max:i,step:o});var l=this;this.__background=document.createElement("div"),this.__foreground=document.createElement("div"),x.bind(this.__background,"mousedown",function(e){x.bind(window,"mousemove",a),x.bind(window,"mouseup",s),a(e)}),x.addClass(this.__background,"slider"),x.addClass(this.__foreground,"slider-fg"),this.updateDisplay(),this.__background.appendChild(this.__foreground),this.domElement.appendChild(this.__background)}).superclass=y,w.useDefaultStyles=function(){b.inject("/**\n * dat-gui JavaScript Controller Library\n * http://code.google.com/p/dat-gui\n *\n * Copyright 2011 Data Arts Team, Google Creative Lab\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n */\n\n.slider {\n  box-shadow: inset 0 2px 4px rgba(0,0,0,0.15);\n  height: 1em;\n  border-radius: 1em;\n  background-color: #eee;\n  padding: 0 0.5em;\n  overflow: hidden;\n}\n\n.slider-fg {\n  padding: 1px 0 2px 0;\n  background-color: #aaa;\n  height: 1em;\n  margin-left: -0.5em;\n  padding-right: 0.5em;\n  border-radius: 1em 0 0 1em;\n}\n\n.slider-fg:after {\n  display: inline-block;\n  border-radius: 1em;\n  background-color: #fff;\n  border:  1px solid #aaa;\n  content: '';\n  float: right;\n  margin-right: -1em;\n  margin-top: -1px;\n  height: 0.9em;\n  width: 0.9em;\n}")},_.extend(w.prototype,y.prototype,{updateDisplay:function(){var e=(this.getValue()-this.__min)/(this.__max-this.__min);return this.__foreground.style.width=100*e+"%",w.superclass.prototype.updateDisplay.call(this)}}),w),$.controllers.FunctionController=(M=$.controllers.Controller,S=$.dom.dom,T=$.utils.common,(C=function e(t,r,n){e.superclass.call(this,t,r);var i=this;this.__button=document.createElement("div"),this.__button.innerHTML=void 0===n?"Fire":n,S.bind(this.__button,"click",function(e){return e.preventDefault(),i.fire(),!1}),S.addClass(this.__button,"button"),this.domElement.appendChild(this.__button)}).superclass=M,T.extend(C.prototype,M.prototype,{fire:function(){this.__onChange&&this.__onChange.call(this),this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),this.getValue().call(this.object)}}),C),$.controllers.BooleanController=(E=$.controllers.Controller,A=$.dom.dom,L=$.utils.common,(P=function e(t,r){e.superclass.call(this,t,r);var n=this;this.__prev=this.getValue(),this.__checkbox=document.createElement("input"),this.__checkbox.setAttribute("type","checkbox"),A.bind(this.__checkbox,"change",function(){n.setValue(!n.__prev)},!1),this.domElement.appendChild(this.__checkbox),this.updateDisplay()}).superclass=E,L.extend(P.prototype,E.prototype,{setValue:function(e){return e=P.superclass.prototype.setValue.call(this,e),this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),this.__prev=this.getValue(),e},updateDisplay:function(){return!0===this.getValue()?(this.__checkbox.setAttribute("checked","checked"),this.__checkbox.checked=!0):this.__checkbox.checked=!1,P.superclass.prototype.updateDisplay.call(this)}}),P),$.color.toString=(D=$.utils.common,function(e){if(1==e.a||D.isUndefined(e.a)){for(e=e.hex.toString(16);e.length<6;)e="0"+e;return"#"+e}return"rgba("+Math.round(e.r)+","+Math.round(e.g)+","+Math.round(e.b)+","+e.a+")"}),$.color.interpret=(R=$.color.toString,k=$.utils.common,N=[{litmus:k.isString,conversions:{THREE_CHAR_HEX:{read:function(e){return null!==(e=e.match(/^#([A-F0-9])([A-F0-9])([A-F0-9])$/i))&&{space:"HEX",hex:parseInt("0x"+e[1].toString()+e[1].toString()+e[2].toString()+e[2].toString()+e[3].toString()+e[3].toString())}},write:R},SIX_CHAR_HEX:{read:function(e){return null!==(e=e.match(/^#([A-F0-9]{6})$/i))&&{space:"HEX",hex:parseInt("0x"+e[1].toString())}},write:R},CSS_RGB:{read:function(e){return null!==(e=e.match(/^rgb\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/))&&{space:"RGB",r:parseFloat(e[1]),g:parseFloat(e[2]),b:parseFloat(e[3])}},write:R},CSS_RGBA:{read:function(e){return null!==(e=e.match(/^rgba\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\,\s*(.+)\s*\)/))&&{space:"RGB",r:parseFloat(e[1]),g:parseFloat(e[2]),b:parseFloat(e[3]),a:parseFloat(e[4])}},write:R}}},{litmus:k.isNumber,conversions:{HEX:{read:function(e){return{space:"HEX",hex:e,conversionName:"HEX"}},write:function(e){return e.hex}}}},{litmus:k.isArray,conversions:{RGB_ARRAY:{read:function(e){return 3==e.length&&{space:"RGB",r:e[0],g:e[1],b:e[2]}},write:function(e){return[e.r,e.g,e.b]}},RGBA_ARRAY:{read:function(e){return 4==e.length&&{space:"RGB",r:e[0],g:e[1],b:e[2],a:e[3]}},write:function(e){return[e.r,e.g,e.b,e.a]}}}},{litmus:k.isObject,conversions:{RGBA_OBJ:{read:function(e){return!!(k.isNumber(e.r)&&k.isNumber(e.g)&&k.isNumber(e.b)&&k.isNumber(e.a))&&{space:"RGB",r:e.r,g:e.g,b:e.b,a:e.a}},write:function(e){return{r:e.r,g:e.g,b:e.b,a:e.a}}},RGB_OBJ:{read:function(e){return!!(k.isNumber(e.r)&&k.isNumber(e.g)&&k.isNumber(e.b))&&{space:"RGB",r:e.r,g:e.g,b:e.b}},write:function(e){return{r:e.r,g:e.g,b:e.b}}},HSVA_OBJ:{read:function(e){return!!(k.isNumber(e.h)&&k.isNumber(e.s)&&k.isNumber(e.v)&&k.isNumber(e.a))&&{space:"HSV",h:e.h,s:e.s,v:e.v,a:e.a}},write:function(e){return{h:e.h,s:e.s,v:e.v,a:e.a}}},HSV_OBJ:{read:function(e){return!!(k.isNumber(e.h)&&k.isNumber(e.s)&&k.isNumber(e.v))&&{space:"HSV",h:e.h,s:e.s,v:e.v}},write:function(e){return{h:e.h,s:e.s,v:e.v}}}}}],function(){U=!1;var e=1<arguments.length?k.toArray(arguments):arguments[0];return k.each(N,function(t){if(t.litmus(e))return k.each(t.conversions,function(t,r){if(F=t.read(e),!1===U&&!1!==F)return(U=F).conversionName=r,F.conversion=t,k.BREAK}),k.BREAK}),U}),$.GUI=$.gui.GUI=function(e,t,r,i,o,a,s,l,h,c,u,d,f,p,m){function g(e,t,r,c){if(void 0===t[r])throw Error("Object "+t+' has no property "'+r+'"');t=c.color?new u(t,r):(t=[t,r].concat(c.factoryArgs),i.apply(e,t)),c.before instanceof o&&(c.before=c.before.__li),y(e,t),p.addClass(t.domElement,"c"),r=document.createElement("span"),p.addClass(r,"property-name"),r.innerHTML=t.property;var d=document.createElement("div");return d.appendChild(r),d.appendChild(t.domElement),c=v(e,d,c.before),p.addClass(c,P.CLASS_CONTROLLER_ROW),p.addClass(c,n(t.getValue())),function(e,t,r){if(r.__li=t,r.__gui=e,m.extend(r,{options:function(t){return 1<arguments.length?(r.remove(),g(e,r.object,r.property,{before:r.__li.nextElementSibling,factoryArgs:[m.toArray(arguments)]})):m.isArray(t)||m.isObject(t)?(r.remove(),g(e,r.object,r.property,{before:r.__li.nextElementSibling,factoryArgs:[t]})):void 0},name:function(e){return r.__li.firstElementChild.firstElementChild.innerHTML=e,r},listen:function(){return r.__gui.listen(r),r},remove:function(){return r.__gui.remove(r),r}}),r instanceof h){var n=new l(r.object,r.property,{min:r.__min,max:r.__max,step:r.__step});m.each(["updateDisplay","onChange","onFinishChange"],function(e){var t=r[e],i=n[e];r[e]=n[e]=function(){var e=Array.prototype.slice.call(arguments);return t.apply(r,e),i.apply(n,e)}}),p.addClass(t,"has-slider"),r.domElement.insertBefore(n.domElement,r.domElement.firstElementChild)}else if(r instanceof l){var i=function(t){return m.isNumber(r.__min)&&m.isNumber(r.__max)?(r.remove(),g(e,r.object,r.property,{before:r.__li.nextElementSibling,factoryArgs:[r.__min,r.__max,r.__step]})):t};r.min=m.compose(i,r.min),r.max=m.compose(i,r.max)}else r instanceof a?(p.bind(t,"click",function(){p.fakeEvent(r.__checkbox,"click")}),p.bind(r.__checkbox,"click",function(e){e.stopPropagation()})):r instanceof s?(p.bind(t,"click",function(){p.fakeEvent(r.__button,"click")}),p.bind(t,"mouseover",function(){p.addClass(r.__button,"hover")}),p.bind(t,"mouseout",function(){p.removeClass(r.__button,"hover")})):r instanceof u&&(p.addClass(t,"color"),r.updateDisplay=m.compose(function(e){return t.style.borderLeftColor=r.__color.toString(),e},r.updateDisplay),r.updateDisplay());r.setValue=m.compose(function(t){return e.getRoot().__preset_select&&r.isModified()&&w(e.getRoot(),!0),t},r.setValue)}(e,c,t),e.__controllers.push(t),t}function v(e,t,r){var n=document.createElement("li");return t&&n.appendChild(t),r?e.__ul.insertBefore(n,params.before):e.__ul.appendChild(n),e.onResize(),n}function y(e,t){var r=e.getRoot(),n=r.__rememberedObjects.indexOf(t.object);if(-1!=n){var i=r.__rememberedObjectIndecesToControllers[n];if(void 0===i&&(i={},r.__rememberedObjectIndecesToControllers[n]=i),i[t.property]=t,r.load&&r.load.remembered){if((r=r.load.remembered)[e.preset])r=r[e.preset];else{if(!r[S])return;r=r[S]}r[n]&&void 0!==r[n][t.property]&&(n=r[n][t.property],t.initialValue=n,t.setValue(n))}}}function x(e,t){e.domElement.style.width=t+"px",e.__save_row&&e.autoPlace&&(e.__save_row.style.width=t+"px"),e.__closeButton&&(e.__closeButton.style.width=t+"px")}function b(e,t){var r={};return m.each(e.__rememberedObjects,function(n,i){var o={};m.each(e.__rememberedObjectIndecesToControllers[i],function(e,r){o[r]=t?e.initialValue:e.getValue()}),r[i]=o}),r}function _(e,t,r){var n=document.createElement("option");n.innerHTML=t,n.value=t,e.__preset_select.appendChild(n),r&&(e.__preset_select.selectedIndex=e.__preset_select.length-1)}function w(e,t){var r=e.__preset_select[e.__preset_select.selectedIndex];r.innerHTML=t?r.value+"*":r.value}e.inject(".dg {\n  /** Clear list styles */\n  /* Auto-place container */\n  /* Auto-placed GUI's */\n  /* Line items that don't contain folders. */\n  /** Folder names */\n  /** Hides closed items */\n  /** Controller row */\n  /** Name-half (left) */\n  /** Controller-half (right) */\n  /** Controller placement */\n  /** Shorter number boxes when slider is present. */\n  /** Ensure the entire boolean and function row shows a hand */ }\n  .dg ul {\n    list-style: none;\n    margin: 0;\n    padding: 0;\n    width: 100%;\n    clear: both; }\n  .dg.ac {\n    position: fixed;\n    top: 0;\n    left: 0;\n    right: 0;\n    height: 0;\n    z-index: 0; }\n  .dg:not(.ac) .main {\n    /** Exclude mains in ac so that we don't hide close button */\n    overflow: hidden; }\n  .dg.main {\n    -webkit-transition: opacity 0.1s linear;\n    -o-transition: opacity 0.1s linear;\n    -moz-transition: opacity 0.1s linear;\n    transition: opacity 0.1s linear; }\n    .dg.main.taller-than-window {\n      overflow-y: auto; }\n      .dg.main.taller-than-window .close-button {\n        opacity: 1;\n        /* TODO, these are style notes */\n        margin-top: -1px;\n        border-top: 1px solid #2c2c2c; }\n    .dg.main ul.closed .close-button {\n      opacity: 1 !important; }\n    .dg.main:hover .close-button,\n    .dg.main .close-button.drag {\n      opacity: 1; }\n    .dg.main .close-button {\n      /*opacity: 0;*/\n      -webkit-transition: opacity 0.1s linear;\n      -o-transition: opacity 0.1s linear;\n      -moz-transition: opacity 0.1s linear;\n      transition: opacity 0.1s linear;\n      border: 0;\n      position: absolute;\n      line-height: 19px;\n      height: 20px;\n      /* TODO, these are style notes */\n      cursor: pointer;\n      text-align: center;\n      background-color: #000; }\n      .dg.main .close-button:hover {\n        background-color: #111; }\n  .dg.a {\n    float: right;\n    margin-right: 15px;\n    overflow-x: hidden; }\n    .dg.a.has-save > ul {\n      margin-top: 27px; }\n      .dg.a.has-save > ul.closed {\n        margin-top: 0; }\n    .dg.a .save-row {\n      position: fixed;\n      top: 0;\n      z-index: 1002; }\n  .dg li {\n    -webkit-transition: height 0.1s ease-out;\n    -o-transition: height 0.1s ease-out;\n    -moz-transition: height 0.1s ease-out;\n    transition: height 0.1s ease-out; }\n  .dg li:not(.folder) {\n    cursor: auto;\n    height: 27px;\n    line-height: 27px;\n    overflow: hidden;\n    padding: 0 4px 0 5px; }\n  .dg li.folder {\n    padding: 0;\n    border-left: 4px solid rgba(0, 0, 0, 0); }\n  .dg li.title {\n    cursor: pointer;\n    margin-left: -4px; }\n  .dg .closed li:not(.title),\n  .dg .closed ul li,\n  .dg .closed ul li > * {\n    height: 0;\n    overflow: hidden;\n    border: 0; }\n  .dg .cr {\n    clear: both;\n    padding-left: 3px;\n    height: 27px; }\n  .dg .property-name {\n    cursor: default;\n    float: left;\n    clear: left;\n    width: 40%;\n    overflow: hidden;\n    text-overflow: ellipsis; }\n  .dg .c {\n    float: left;\n    width: 60%; }\n  .dg .c input[type=text] {\n    border: 0;\n    margin-top: 4px;\n    padding: 3px;\n    width: 100%;\n    float: right; }\n  .dg .has-slider input[type=text] {\n    width: 30%;\n    /*display: none;*/\n    margin-left: 0; }\n  .dg .slider {\n    float: left;\n    width: 66%;\n    margin-left: -5px;\n    margin-right: 0;\n    height: 19px;\n    margin-top: 4px; }\n  .dg .slider-fg {\n    height: 100%; }\n  .dg .c input[type=checkbox] {\n    margin-top: 9px; }\n  .dg .c select {\n    margin-top: 5px; }\n  .dg .cr.function,\n  .dg .cr.function .property-name,\n  .dg .cr.function *,\n  .dg .cr.boolean,\n  .dg .cr.boolean * {\n    cursor: pointer; }\n  .dg .selector {\n    display: none;\n    position: absolute;\n    margin-left: -9px;\n    margin-top: 23px;\n    z-index: 10; }\n  .dg .c:hover .selector,\n  .dg .selector.drag {\n    display: block; }\n  .dg li.save-row {\n    padding: 0; }\n    .dg li.save-row .button {\n      display: inline-block;\n      padding: 0px 6px; }\n  .dg.dialogue {\n    background-color: #222;\n    width: 460px;\n    padding: 15px;\n    font-size: 13px;\n    line-height: 15px; }\n\n/* TODO Separate style and structure */\n#dg-new-constructor {\n  padding: 10px;\n  color: #222;\n  font-family: Monaco, monospace;\n  font-size: 10px;\n  border: 0;\n  resize: none;\n  box-shadow: inset 1px 1px 1px #888;\n  word-wrap: break-word;\n  margin: 12px 0;\n  display: block;\n  width: 440px;\n  overflow-y: scroll;\n  height: 100px;\n  position: relative; }\n\n#dg-local-explain {\n  display: none;\n  font-size: 11px;\n  line-height: 17px;\n  border-radius: 3px;\n  background-color: #333;\n  padding: 8px;\n  margin-top: 10px; }\n  #dg-local-explain code {\n    font-size: 10px; }\n\n#dat-gui-save-locally {\n  display: none; }\n\n/** Main type */\n.dg {\n  color: #eee;\n  font: 11px 'Lucida Grande', sans-serif;\n  text-shadow: 0 -1px 0 #111;\n  /** Auto place */\n  /* Controller row, <li> */\n  /** Controllers */ }\n  .dg.main {\n    /** Scrollbar */ }\n    .dg.main::-webkit-scrollbar {\n      width: 5px;\n      background: #1a1a1a; }\n    .dg.main::-webkit-scrollbar-corner {\n      height: 0;\n      display: none; }\n    .dg.main::-webkit-scrollbar-thumb {\n      border-radius: 5px;\n      background: #676767; }\n  .dg li:not(.folder) {\n    background: #1a1a1a;\n    border-bottom: 1px solid #2c2c2c; }\n  .dg li.save-row {\n    line-height: 25px;\n    background: #dad5cb;\n    border: 0; }\n    .dg li.save-row select {\n      margin-left: 5px;\n      width: 108px; }\n    .dg li.save-row .button {\n      margin-left: 5px;\n      margin-top: 1px;\n      border-radius: 2px;\n      font-size: 9px;\n      line-height: 7px;\n      padding: 4px 4px 5px 4px;\n      background: #c5bdad;\n      color: #fff;\n      text-shadow: 0 1px 0 #b0a58f;\n      box-shadow: 0 -1px 0 #b0a58f;\n      cursor: pointer; }\n      .dg li.save-row .button.gears {\n        background: #c5bdad url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAYAAAB/9ZQ7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQJJREFUeNpiYKAU/P//PwGIC/ApCABiBSAW+I8AClAcgKxQ4T9hoMAEUrxx2QSGN6+egDX+/vWT4e7N82AMYoPAx/evwWoYoSYbACX2s7KxCxzcsezDh3evFoDEBYTEEqycggWAzA9AuUSQQgeYPa9fPv6/YWm/Acx5IPb7ty/fw+QZblw67vDs8R0YHyQhgObx+yAJkBqmG5dPPDh1aPOGR/eugW0G4vlIoTIfyFcA+QekhhHJhPdQxbiAIguMBTQZrPD7108M6roWYDFQiIAAv6Aow/1bFwXgis+f2LUAynwoIaNcz8XNx3Dl7MEJUDGQpx9gtQ8YCueB+D26OECAAQDadt7e46D42QAAAABJRU5ErkJggg==) 2px 1px no-repeat;\n        height: 7px;\n        width: 8px; }\n      .dg li.save-row .button:hover {\n        background-color: #bab19e;\n        box-shadow: 0 -1px 0 #b0a58f; }\n  .dg li.folder {\n    border-bottom: 0; }\n  .dg li.title {\n    padding-left: 16px;\n    background: black url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 6px 10px no-repeat;\n    cursor: pointer;\n    border-bottom: 1px solid rgba(255, 255, 255, 0.2); }\n  .dg .closed li.title {\n    background-image: url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlGIWqMCbWAEAOw==); }\n  .dg .cr.boolean {\n    border-left: 3px solid #806787; }\n  .dg .cr.function {\n    border-left: 3px solid #e61d5f; }\n  .dg .cr.number {\n    border-left: 3px solid #2fa1d6; }\n    .dg .cr.number input[type=text] {\n      color: #2fa1d6; }\n  .dg .cr.string {\n    border-left: 3px solid #1ed36f; }\n    .dg .cr.string input[type=text] {\n      color: #1ed36f; }\n  .dg .cr.function:hover, .dg .cr.boolean:hover {\n    background: #111; }\n  .dg .c input[type=text] {\n    background: #303030;\n    outline: none; }\n    .dg .c input[type=text]:hover {\n      background: #3c3c3c; }\n    .dg .c input[type=text]:focus {\n      background: #494949;\n      color: #fff; }\n  .dg .c .slider {\n    background: #303030;\n    cursor: ew-resize; }\n  .dg .c .slider-fg {\n    background: #2fa1d6; }\n  .dg .c .slider:hover {\n    background: #3c3c3c; }\n    .dg .c .slider:hover .slider-fg {\n      background: #44abda; }\n");var M,S="Default";try{M="localStorage"in window&&null!==window.localStorage}catch(e){M=!1}var T,C,E=!0,A=!1,L=[],P=function e(t){function r(){localStorage.setItem(document.location.href+".gui",JSON.stringify(n.getSaveObject()))}var n=this;this.domElement=document.createElement("div"),this.__ul=document.createElement("ul"),this.domElement.appendChild(this.__ul),p.addClass(this.domElement,"dg"),this.__folders={},this.__controllers=[],this.__rememberedObjects=[],this.__rememberedObjectIndecesToControllers=[],this.__listening=[],t=t||{},t=m.defaults(t,{autoPlace:!0,width:e.DEFAULT_WIDTH}),t=m.defaults(t,{resizable:t.autoPlace,hideable:t.autoPlace}),m.isUndefined(t.load)?t.load={preset:S}:t.preset&&(t.load.preset=t.preset),m.isUndefined(t.parent)&&t.hideable&&L.push(this),t.resizable=m.isUndefined(t.parent)&&t.resizable,t.autoPlace&&m.isUndefined(t.scrollable)&&(t.scrollable=!0);var i,o=M&&"true"===localStorage.getItem(document.location.href+".isLocal");if(Object.defineProperties(this,{parent:{get:function(){return t.parent}},scrollable:{get:function(){return t.scrollable}},autoPlace:{get:function(){return t.autoPlace}},preset:{get:function(){return n.parent?n.getRoot().preset:t.load.preset},set:function(e){for(n.parent?n.getRoot().preset=e:t.load.preset=e,e=0;e<this.__preset_select.length;e++)this.__preset_select[e].value==this.preset&&(this.__preset_select.selectedIndex=e);n.revert()}},width:{get:function(){return t.width},set:function(e){t.width=e,x(n,e)}},name:{get:function(){return t.name},set:function(e){t.name=e,s&&(s.innerHTML=t.name)}},closed:{get:function(){return t.closed},set:function(r){t.closed=r,t.closed?p.addClass(n.__ul,e.CLASS_CLOSED):p.removeClass(n.__ul,e.CLASS_CLOSED),this.onResize(),n.__closeButton&&(n.__closeButton.innerHTML=r?e.TEXT_OPEN:e.TEXT_CLOSED)}},load:{get:function(){return t.load}},useLocalStorage:{get:function(){return o},set:function(e){M&&((o=e)?p.bind(window,"unload",r):p.unbind(window,"unload",r),localStorage.setItem(document.location.href+".isLocal",e))}}}),m.isUndefined(t.parent)){if(t.closed=!1,p.addClass(this.domElement,e.CLASS_MAIN),p.makeSelectable(this.domElement,!1),M&&o){n.useLocalStorage=!0;var a=localStorage.getItem(document.location.href+".gui");a&&(t.load=JSON.parse(a))}this.__closeButton=document.createElement("div"),this.__closeButton.innerHTML=e.TEXT_CLOSED,p.addClass(this.__closeButton,e.CLASS_CLOSE_BUTTON),this.domElement.appendChild(this.__closeButton),p.bind(this.__closeButton,"click",function(){n.closed=!n.closed})}else{void 0===t.closed&&(t.closed=!0);var s=document.createTextNode(t.name);p.addClass(s,"controller-name"),a=v(n,s),p.addClass(this.__ul,e.CLASS_CLOSED),p.addClass(a,"title"),p.bind(a,"click",function(e){return e.preventDefault(),n.closed=!n.closed,!1}),t.closed||(this.closed=!1)}t.autoPlace&&(m.isUndefined(t.parent)&&(E&&(C=document.createElement("div"),p.addClass(C,"dg"),p.addClass(C,e.CLASS_AUTO_PLACE_CONTAINER),document.body.appendChild(C),E=!1),C.appendChild(this.domElement),p.addClass(this.domElement,e.CLASS_AUTO_PLACE)),this.parent||x(n,t.width)),p.bind(window,"resize",function(){n.onResize()}),p.bind(this.__ul,"webkitTransitionEnd",function(){n.onResize()}),p.bind(this.__ul,"transitionend",function(){n.onResize()}),p.bind(this.__ul,"oTransitionEnd",function(){n.onResize()}),this.onResize(),t.resizable&&function(e){function t(t){return t.preventDefault(),i=t.clientX,p.addClass(e.__closeButton,P.CLASS_DRAG),p.bind(window,"mousemove",r),p.bind(window,"mouseup",n),!1}function r(t){return t.preventDefault(),e.width+=i-t.clientX,e.onResize(),i=t.clientX,!1}function n(){p.removeClass(e.__closeButton,P.CLASS_DRAG),p.unbind(window,"mousemove",r),p.unbind(window,"mouseup",n)}var i;e.__resize_handle=document.createElement("div"),m.extend(e.__resize_handle.style,{width:"6px",marginLeft:"-3px",height:"200px",cursor:"ew-resize",position:"absolute"}),p.bind(e.__resize_handle,"mousedown",t),p.bind(e.__closeButton,"mousedown",t),e.domElement.insertBefore(e.__resize_handle,e.domElement.firstElementChild)}(this),n.getRoot(),t.parent||((i=n.getRoot()).width+=1,m.defer(function(){i.width-=1}))};return P.toggleHide=function(){A=!A,m.each(L,function(e){e.domElement.style.zIndex=A?-999:999,e.domElement.style.opacity=A?0:1})},P.CLASS_AUTO_PLACE="a",P.CLASS_AUTO_PLACE_CONTAINER="ac",P.CLASS_MAIN="main",P.CLASS_CONTROLLER_ROW="cr",P.CLASS_TOO_TALL="taller-than-window",P.CLASS_CLOSED="closed",P.CLASS_CLOSE_BUTTON="close-button",P.CLASS_DRAG="drag",P.DEFAULT_WIDTH=245,P.TEXT_CLOSED="Close Controls",P.TEXT_OPEN="Open Controls",p.bind(window,"keydown",function(e){"text"===document.activeElement.type||72!==e.which&&72!=e.keyCode||P.toggleHide()},!1),m.extend(P.prototype,{add:function(e,t){return g(this,e,t,{factoryArgs:Array.prototype.slice.call(arguments,2)})},addColor:function(e,t){return g(this,e,t,{color:!0})},remove:function(e){this.__ul.removeChild(e.__li),this.__controllers.slice(this.__controllers.indexOf(e),1);var t=this;m.defer(function(){t.onResize()})},destroy:function(){this.autoPlace&&C.removeChild(this.domElement)},addFolder:function(e){if(void 0!==this.__folders[e])throw Error('You already have a folder in this GUI by the name "'+e+'"');var t={name:e,parent:this};return t.autoPlace=this.autoPlace,this.load&&this.load.folders&&this.load.folders[e]&&(t.closed=this.load.folders[e].closed,t.load=this.load.folders[e]),t=new P(t),this.__folders[e]=t,e=v(this,t.domElement),p.addClass(e,"folder"),t},open:function(){this.closed=!1},close:function(){this.closed=!0},onResize:function(){var e=this.getRoot();if(e.scrollable){var t=p.getOffset(e.__ul).top,r=0;m.each(e.__ul.childNodes,function(t){e.autoPlace&&t===e.__save_row||(r+=p.getHeight(t))}),window.innerHeight-t-20<r?(p.addClass(e.domElement,P.CLASS_TOO_TALL),e.__ul.style.height=window.innerHeight-t-20+"px"):(p.removeClass(e.domElement,P.CLASS_TOO_TALL),e.__ul.style.height="auto")}e.__resize_handle&&m.defer(function(){e.__resize_handle.style.height=e.__ul.offsetHeight+"px"}),e.__closeButton&&(e.__closeButton.style.width=e.width+"px")},remember:function(){if(m.isUndefined(T)&&((T=new f).domElement.innerHTML='<div id="dg-save" class="dg dialogue">\n\n  Here\'s the new load parameter for your <code>GUI</code>\'s constructor:\n\n  <textarea id="dg-new-constructor"></textarea>\n\n  <div id="dg-save-locally">\n\n    <input id="dg-local-storage" type="checkbox"/> Automatically save\n    values to <code>localStorage</code> on exit.\n\n    <div id="dg-local-explain">The values saved to <code>localStorage</code> will\n      override those passed to <code>dat.GUI</code>\'s constructor. This makes it\n      easier to work incrementally, but <code>localStorage</code> is fragile,\n      and your friends may not see the same values you do.\n      \n    </div>\n    \n  </div>\n\n</div>'),this.parent)throw Error("You can only call remember on a top level GUI.");var e=this;m.each(Array.prototype.slice.call(arguments),function(t){0==e.__rememberedObjects.length&&function(e){var t=e.__save_row=document.createElement("li");p.addClass(e.domElement,"has-save"),e.__ul.insertBefore(t,e.__ul.firstChild),p.addClass(t,"save-row");var r=document.createElement("span");r.innerHTML="&nbsp;",p.addClass(r,"button gears");var n=document.createElement("span");n.innerHTML="Save",p.addClass(n,"button"),p.addClass(n,"save");var i=document.createElement("span");i.innerHTML="New",p.addClass(i,"button"),p.addClass(i,"save-as");var o=document.createElement("span");o.innerHTML="Revert",p.addClass(o,"button"),p.addClass(o,"revert");var a=e.__preset_select=document.createElement("select");if(e.load&&e.load.remembered?m.each(e.load.remembered,function(t,r){_(e,r,r==e.preset)}):_(e,S,!1),p.bind(a,"change",function(){for(var t=0;t<e.__preset_select.length;t++)e.__preset_select[t].innerHTML=e.__preset_select[t].value;e.preset=this.value}),t.appendChild(a),t.appendChild(r),t.appendChild(n),t.appendChild(i),t.appendChild(o),M){t=document.getElementById("dg-save-locally");var s=document.getElementById("dg-local-explain");t.style.display="block",t=document.getElementById("dg-local-storage"),"true"===localStorage.getItem(document.location.href+".isLocal")&&t.setAttribute("checked","checked");var l=function(){s.style.display=e.useLocalStorage?"block":"none"};l(),p.bind(t,"change",function(){e.useLocalStorage=!e.useLocalStorage,l()})}var h=document.getElementById("dg-new-constructor");p.bind(h,"keydown",function(e){!e.metaKey||67!==e.which&&67!=e.keyCode||T.hide()}),p.bind(r,"click",function(){h.innerHTML=JSON.stringify(e.getSaveObject(),void 0,2),T.show(),h.focus(),h.select()}),p.bind(n,"click",function(){e.save()}),p.bind(i,"click",function(){var t=prompt("Enter a new preset name.");t&&e.saveAs(t)}),p.bind(o,"click",function(){e.revert()})}(e),-1==e.__rememberedObjects.indexOf(t)&&e.__rememberedObjects.push(t)}),this.autoPlace&&x(this,this.width)},getRoot:function(){for(var e=this;e.parent;)e=e.parent;return e},getSaveObject:function(){var e=this.load;return e.closed=this.closed,0<this.__rememberedObjects.length&&(e.preset=this.preset,e.remembered||(e.remembered={}),e.remembered[this.preset]=b(this)),e.folders={},m.each(this.__folders,function(t,r){e.folders[r]=t.getSaveObject()}),e},save:function(){this.load.remembered||(this.load.remembered={}),this.load.remembered[this.preset]=b(this),w(this,!1)},saveAs:function(e){this.load.remembered||(this.load.remembered={},this.load.remembered[S]=b(this,!0)),this.load.remembered[e]=b(this),this.preset=e,_(this,e,!0)},revert:function(e){m.each(this.__controllers,function(t){this.getRoot().load.remembered?y(e||this.getRoot(),t):t.setValue(t.initialValue)},this),m.each(this.__folders,function(e){e.revert(e)}),e||w(this.getRoot(),!1)},listen:function(e){var t=0==this.__listening.length;this.__listening.push(e),t&&function e(t){0!=t.length&&d(function(){e(t)}),m.each(t,function(e){e.updateDisplay()})}(this.__listening)}}),P}($.utils.css,0,0,$.controllers.factory=(I=$.controllers.OptionController,H=$.controllers.NumberControllerBox,G=$.controllers.NumberControllerSlider,W=$.controllers.StringController=(Y=$.controllers.Controller,K=$.dom.dom,Q=$.utils.common,(Z=function e(t,r){function n(){i.setValue(i.__input.value)}e.superclass.call(this,t,r);var i=this;this.__input=document.createElement("input"),this.__input.setAttribute("type","text"),K.bind(this.__input,"keyup",n),K.bind(this.__input,"change",n),K.bind(this.__input,"blur",function(){i.__onFinishChange&&i.__onFinishChange.call(i,i.getValue())}),K.bind(this.__input,"keydown",function(e){13===e.keyCode&&this.blur()}),this.updateDisplay(),this.domElement.appendChild(this.__input)}).superclass=Y,Q.extend(Z.prototype,Y.prototype,{updateDisplay:function(){return K.isActive(this.__input)||(this.__input.value=this.getValue()),Z.superclass.prototype.updateDisplay.call(this)}}),Z),j=$.controllers.FunctionController,X=$.controllers.BooleanController,q=$.utils.common,function(e,t,r,n){var i=e[t];return q.isArray(r)||q.isObject(r)?new I(e,t,r):q.isNumber(i)?q.isNumber(r)&&q.isNumber(n)?new G(e,t,r,n):new H(e,t,{min:r,max:n}):q.isString(i)?new W(e,t):q.isFunction(i)?new j(e,t,""):q.isBoolean(i)?new X(e,t):void 0}),$.controllers.Controller,$.controllers.BooleanController,$.controllers.FunctionController,$.controllers.NumberControllerBox,$.controllers.NumberControllerSlider,$.controllers.OptionController,$.controllers.ColorController=function(e,t,r,n,i){function o(e,t,r,n){e.style.background="",i.each(s,function(i){e.style.cssText+="background: "+i+"linear-gradient("+t+", "+r+" 0%, "+n+" 100%); "})}var a=function e(a,s){function l(e){d(e),t.bind(window,"mousemove",d),t.bind(window,"mouseup",h)}function h(){t.unbind(window,"mousemove",d),t.unbind(window,"mouseup",h)}function c(){var e=n(this.value);!1!==e?(p.__color.__state=e,p.setValue(p.__color.toOriginal())):this.value=p.__color.toString()}function u(){t.unbind(window,"mousemove",f),t.unbind(window,"mouseup",u)}function d(e){e.preventDefault();var r=t.getWidth(p.__saturation_field),n=t.getOffset(p.__saturation_field),i=(e.clientX-n.left+document.body.scrollLeft)/r;return 1<(e=1-(e.clientY-n.top+document.body.scrollTop)/r)?e=1:e<0&&(e=0),1<i?i=1:i<0&&(i=0),p.__color.v=e,p.__color.s=i,p.setValue(p.__color.toOriginal()),!1}function f(e){e.preventDefault();var r=t.getHeight(p.__hue_field),n=t.getOffset(p.__hue_field);return 1<(e=1-(e.clientY-n.top+document.body.scrollTop)/r)?e=1:e<0&&(e=0),p.__color.h=360*e,p.setValue(p.__color.toOriginal()),!1}e.superclass.call(this,a,s),this.__color=new r(this.getValue()),this.__temp=new r(0);var p=this;this.domElement=document.createElement("div"),t.makeSelectable(this.domElement,!1),this.__selector=document.createElement("div"),this.__selector.className="selector",this.__saturation_field=document.createElement("div"),this.__saturation_field.className="saturation-field",this.__field_knob=document.createElement("div"),this.__field_knob.className="field-knob",this.__field_knob_border="2px solid ",this.__hue_knob=document.createElement("div"),this.__hue_knob.className="hue-knob",this.__hue_field=document.createElement("div"),this.__hue_field.className="hue-field",this.__input=document.createElement("input"),this.__input.type="text",this.__input_textShadow="0 1px 1px ",t.bind(this.__input,"keydown",function(e){13===e.keyCode&&c.call(this)}),t.bind(this.__input,"blur",c),t.bind(this.__selector,"mousedown",function(e){t.addClass(this,"drag").bind(window,"mouseup",function(e){t.removeClass(p.__selector,"drag")})});var m,g=document.createElement("div");i.extend(this.__selector.style,{width:"122px",height:"102px",padding:"3px",backgroundColor:"#222",boxShadow:"0px 1px 3px rgba(0,0,0,0.3)"}),i.extend(this.__field_knob.style,{position:"absolute",width:"12px",height:"12px",border:this.__field_knob_border+(this.__color.v<.5?"#fff":"#000"),boxShadow:"0px 1px 3px rgba(0,0,0,0.5)",borderRadius:"12px",zIndex:1}),i.extend(this.__hue_knob.style,{position:"absolute",width:"15px",height:"2px",borderRight:"4px solid #fff",zIndex:1}),i.extend(this.__saturation_field.style,{width:"100px",height:"100px",border:"1px solid #555",marginRight:"3px",display:"inline-block",cursor:"pointer"}),i.extend(g.style,{width:"100%",height:"100%",background:"none"}),o(g,"top","rgba(0,0,0,0)","#000"),i.extend(this.__hue_field.style,{width:"15px",height:"100px",display:"inline-block",border:"1px solid #555",cursor:"ns-resize"}),(m=this.__hue_field).style.background="",m.style.cssText+="background: -moz-linear-gradient(top,  #ff0000 0%, #ff00ff 17%, #0000ff 34%, #00ffff 50%, #00ff00 67%, #ffff00 84%, #ff0000 100%);",m.style.cssText+="background: -webkit-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",m.style.cssText+="background: -o-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",m.style.cssText+="background: -ms-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",m.style.cssText+="background: linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",i.extend(this.__input.style,{outline:"none",textAlign:"center",color:"#fff",border:0,fontWeight:"bold",textShadow:this.__input_textShadow+"rgba(0,0,0,0.7)"}),t.bind(this.__saturation_field,"mousedown",l),t.bind(this.__field_knob,"mousedown",l),t.bind(this.__hue_field,"mousedown",function(e){f(e),t.bind(window,"mousemove",f),t.bind(window,"mouseup",u)}),this.__saturation_field.appendChild(g),this.__selector.appendChild(this.__field_knob),this.__selector.appendChild(this.__saturation_field),this.__selector.appendChild(this.__hue_field),this.__hue_field.appendChild(this.__hue_knob),this.domElement.appendChild(this.__input),this.domElement.appendChild(this.__selector),this.updateDisplay()};a.superclass=e,i.extend(a.prototype,e.prototype,{updateDisplay:function(){var e=n(this.getValue());if(!1!==e){var t=!1;i.each(r.COMPONENTS,function(r){if(!i.isUndefined(e[r])&&!i.isUndefined(this.__color.__state[r])&&e[r]!==this.__color.__state[r])return t=!0,{}},this),t&&i.extend(this.__color.__state,e)}i.extend(this.__temp.__state,this.__color.__state),this.__temp.a=1;var a=this.__color.v<.5||.5<this.__color.s?255:0,s=255-a;i.extend(this.__field_knob.style,{marginLeft:100*this.__color.s-7+"px",marginTop:100*(1-this.__color.v)-7+"px",backgroundColor:this.__temp.toString(),border:this.__field_knob_border+"rgb("+a+","+a+","+a+")"}),this.__hue_knob.style.marginTop=100*(1-this.__color.h/360)+"px",this.__temp.s=1,this.__temp.v=1,o(this.__saturation_field,"left","#fff",this.__temp.toString()),i.extend(this.__input.style,{backgroundColor:this.__input.value=this.__color.toString(),color:"rgb("+a+","+a+","+a+")",textShadow:this.__input_textShadow+"rgba("+s+","+s+","+s+",.7)"})}});var s=["-moz-","-o-","-webkit-","-ms-",""];return a}($.controllers.Controller,$.dom.dom,$.color.Color=function(e,t,r,n){function i(e,t,r){Object.defineProperty(e,t,{get:function(){return"RGB"===this.__state.space||a(this,t,r),this.__state[t]},set:function(e){"RGB"!==this.__state.space&&(a(this,t,r),this.__state.space="RGB"),this.__state[t]=e}})}function o(e,t){Object.defineProperty(e,t,{get:function(){return"HSV"===this.__state.space||s(this),this.__state[t]},set:function(e){"HSV"!==this.__state.space&&(s(this),this.__state.space="HSV"),this.__state[t]=e}})}function a(e,r,i){if("HEX"===e.__state.space)e.__state[r]=t.component_from_hex(e.__state.hex,i);else{if("HSV"!==e.__state.space)throw"Corrupted color state";n.extend(e.__state,t.hsv_to_rgb(e.__state.h,e.__state.s,e.__state.v))}}function s(e){var r=t.rgb_to_hsv(e.r,e.g,e.b);n.extend(e.__state,{s:r.s,v:r.v}),n.isNaN(r.h)?n.isUndefined(e.__state.h)&&(e.__state.h=0):e.__state.h=r.h}var l=function(){if(this.__state=e.apply(this,arguments),!1===this.__state)throw"Failed to interpret color arguments";this.__state.a=this.__state.a||1};return l.COMPONENTS="r g b h s v hex a".split(" "),n.extend(l.prototype,{toString:function(){return r(this)},toOriginal:function(){return this.__state.conversion.write(this)}}),i(l.prototype,"r",2),i(l.prototype,"g",1),i(l.prototype,"b",0),o(l.prototype,"h"),o(l.prototype,"s"),o(l.prototype,"v"),Object.defineProperty(l.prototype,"a",{get:function(){return this.__state.a},set:function(e){this.__state.a=e}}),Object.defineProperty(l.prototype,"hex",{get:function(){return"HEX"!==!this.__state.space&&(this.__state.hex=t.rgb_to_hex(this.r,this.g,this.b)),this.__state.hex},set:function(e){this.__state.space="HEX",this.__state.hex=e}}),l}($.color.interpret,$.color.math={hsv_to_rgb:function(e,t,r){var n=e/60-Math.floor(e/60),i=r*(1-t),o=r*(1-n*t);return{r:255*(e=[[r,t=r*(1-(1-n)*t),i],[o,r,i],[i,r,t],[i,o,r],[t,i,r],[r,i,o]][Math.floor(e/60)%6])[0],g:255*e[1],b:255*e[2]}},rgb_to_hsv:function(e,t,r){var n=Math.min(e,t,r),i=Math.max(e,t,r);return n=i-n,0==i?{h:NaN,s:0,v:0}:((e=(e==i?(t-r)/n:t==i?2+(r-e)/n:4+(e-t)/n)/6)<0&&(e+=1),{h:360*e,s:n/i,v:i/255})},rgb_to_hex:function(e,t,r){return e=this.hex_with_component(0,2,e),e=this.hex_with_component(e,1,t),this.hex_with_component(e,0,r)},component_from_hex:function(e,t){return e>>8*t&255},hex_with_component:function(e,t,r){return r<<(O=8*t)|e&~(255<<O)}},$.color.toString,$.utils.common),$.color.interpret,$.utils.common),$.utils.requestAnimationFrame=window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e,t){window.setTimeout(e,1e3/60)},$.dom.CenteredDiv=(B=$.dom.dom,V=$.utils.common,(z=function(){this.backgroundElement=document.createElement("div"),V.extend(this.backgroundElement.style,{backgroundColor:"rgba(0,0,0,0.8)",top:0,left:0,display:"none",zIndex:"1000",opacity:0,WebkitTransition:"opacity 0.2s linear"}),B.makeFullscreen(this.backgroundElement),this.backgroundElement.style.position="fixed",this.domElement=document.createElement("div"),V.extend(this.domElement.style,{position:"fixed",display:"none",zIndex:"1001",opacity:0,WebkitTransition:"-webkit-transform 0.2s ease-out, opacity 0.2s linear"}),document.body.appendChild(this.backgroundElement),document.body.appendChild(this.domElement);var e=this;B.bind(this.backgroundElement,"click",function(){e.hide()})}).prototype.show=function(){var e=this;this.backgroundElement.style.display="block",this.domElement.style.display="block",this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)",this.layout(),V.defer(function(){e.backgroundElement.style.opacity=1,e.domElement.style.opacity=1,e.domElement.style.webkitTransform="scale(1)"})},z.prototype.hide=function(){var e=this,t=function t(){e.domElement.style.display="none",e.backgroundElement.style.display="none",B.unbind(e.domElement,"webkitTransitionEnd",t),B.unbind(e.domElement,"transitionend",t),B.unbind(e.domElement,"oTransitionEnd",t)};B.bind(this.domElement,"webkitTransitionEnd",t),B.bind(this.domElement,"transitionend",t),B.bind(this.domElement,"oTransitionEnd",t),this.backgroundElement.style.opacity=0,this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)"},z.prototype.layout=function(){this.domElement.style.left=window.innerWidth/2-B.getWidth(this.domElement)/2+"px",this.domElement.style.top=window.innerHeight/2-B.getHeight(this.domElement)/2+"px"},z),$.dom.dom,$.utils.common),t.default=$}]);
//# sourceMappingURL=02-01.14da89a3.js.map